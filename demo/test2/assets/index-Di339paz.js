var Cx=Object.defineProperty;var xx=(n,t,e)=>t in n?Cx(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var el=(n,t,e)=>xx(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Lf(n){const t=Object.create(null);for(const e of n.split(","))t[e]=1;return e=>e in t}const ve={},Yr=[],Ti=()=>{},vx=()=>!1,Kc=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Pf=n=>n.startsWith("onUpdate:"),$e=Object.assign,Ff=(n,t)=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)},Bx=Object.prototype.hasOwnProperty,ue=(n,t)=>Bx.call(n,t),Yt=Array.isArray,ta=n=>Yc(n)==="[object Map]",Ix=n=>Yc(n)==="[object Set]",$t=n=>typeof n=="function",je=n=>typeof n=="string",_o=n=>typeof n=="symbol",Oe=n=>n!==null&&typeof n=="object",p_=n=>(Oe(n)||$t(n))&&$t(n.then)&&$t(n.catch),bx=Object.prototype.toString,Yc=n=>bx.call(n),Mx=n=>Yc(n).slice(8,-1),Sx=n=>Yc(n)==="[object Object]",Uf=n=>je(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,ea=Lf(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Zc=n=>{const t=Object.create(null);return e=>t[e]||(t[e]=n(e))},Tx=/-(\w)/g,ws=Zc(n=>n.replace(Tx,(t,e)=>e?e.toUpperCase():"")),wx=/\B([A-Z])/g,pr=Zc(n=>n.replace(wx,"-$1").toLowerCase()),g_=Zc(n=>n.charAt(0).toUpperCase()+n.slice(1)),bh=Zc(n=>n?`on${g_(n)}`:""),bs=(n,t)=>!Object.is(n,t),Mh=(n,...t)=>{for(let e=0;e<n.length;e++)n[e](...t)},m_=(n,t,e,i=!1)=>{Object.defineProperty(n,t,{configurable:!0,enumerable:!1,writable:i,value:e})},Rx=n=>{const t=parseFloat(n);return isNaN(t)?n:t};let ap;const $c=()=>ap||(ap=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Nf(n){if(Yt(n)){const t={};for(let e=0;e<n.length;e++){const i=n[e],s=je(i)?Fx(i):Nf(i);if(s)for(const r in s)t[r]=s[r]}return t}else if(je(n)||Oe(n))return n}const Dx=/;(?![^(]*\))/g,Lx=/:([^]+)/,Px=/\/\*[^]*?\*\//g;function Fx(n){const t={};return n.replace(Px,"").split(Dx).forEach(e=>{if(e){const i=e.split(Lx);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function Of(n){let t="";if(je(n))t=n;else if(Yt(n))for(let e=0;e<n.length;e++){const i=Of(n[e]);i&&(t+=i+" ")}else if(Oe(n))for(const e in n)n[e]&&(t+=e+" ");return t.trim()}const Ux="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Nx=Lf(Ux);function __(n){return!!n||n===""}/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ln;class Ox{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ln,!t&&Ln&&(this.index=(Ln.scopes||(Ln.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Ln;try{return Ln=this,t()}finally{Ln=e}}}on(){Ln=this}off(){Ln=this.parent}stop(t){if(this._active){this._active=!1;let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(this.effects.length=0,e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function Gx(){return Ln}let xe;const Sh=new WeakSet;class E_{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ln&&Ln.active&&Ln.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Sh.has(this)&&(Sh.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||C_(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,lp(this),x_(this);const t=xe,e=ai;xe=this,ai=!0;try{return this.fn()}finally{v_(this),xe=t,ai=e,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)Hf(t);this.deps=this.depsTail=void 0,lp(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Sh.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ad(this)&&this.run()}get dirty(){return Ad(this)}}let y_=0,na,ia;function C_(n,t=!1){if(n.flags|=8,t){n.next=ia,ia=n;return}n.next=na,na=n}function Gf(){y_++}function Qf(){if(--y_>0)return;if(ia){let t=ia;for(ia=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let n;for(;na;){let t=na;for(na=void 0;t;){const e=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(i){n||(n=i)}t=e}}if(n)throw n}function x_(n){for(let t=n.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function v_(n){let t,e=n.depsTail,i=e;for(;i;){const s=i.prevDep;i.version===-1?(i===e&&(e=s),Hf(i),Qx(i)):t=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=s}n.deps=t,n.depsTail=e}function Ad(n){for(let t=n.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(B_(t.dep.computed)||t.dep.version!==t.version))return!0;return!!n._dirty}function B_(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===ya))return;n.globalVersion=ya;const t=n.dep;if(n.flags|=2,t.version>0&&!n.isSSR&&n.deps&&!Ad(n)){n.flags&=-3;return}const e=xe,i=ai;xe=n,ai=!0;try{x_(n);const s=n.fn(n._value);(t.version===0||bs(s,n._value))&&(n._value=s,t.version++)}catch(s){throw t.version++,s}finally{xe=e,ai=i,v_(n),n.flags&=-3}}function Hf(n,t=!1){const{dep:e,prevSub:i,nextSub:s}=n;if(i&&(i.nextSub=s,n.prevSub=void 0),s&&(s.prevSub=i,n.nextSub=void 0),e.subs===n&&(e.subs=i,!i&&e.computed)){e.computed.flags&=-5;for(let r=e.computed.deps;r;r=r.nextDep)Hf(r,!0)}!t&&!--e.sc&&e.map&&e.map.delete(e.key)}function Qx(n){const{prevDep:t,nextDep:e}=n;t&&(t.nextDep=e,n.prevDep=void 0),e&&(e.prevDep=t,n.nextDep=void 0)}let ai=!0;const I_=[];function Ps(){I_.push(ai),ai=!1}function Fs(){const n=I_.pop();ai=n===void 0?!0:n}function lp(n){const{cleanup:t}=n;if(n.cleanup=void 0,t){const e=xe;xe=void 0;try{t()}finally{xe=e}}}let ya=0;class Hx{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class kf{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!xe||!ai||xe===this.computed)return;let e=this.activeLink;if(e===void 0||e.sub!==xe)e=this.activeLink=new Hx(xe,this),xe.deps?(e.prevDep=xe.depsTail,xe.depsTail.nextDep=e,xe.depsTail=e):xe.deps=xe.depsTail=e,b_(e);else if(e.version===-1&&(e.version=this.version,e.nextDep)){const i=e.nextDep;i.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=i),e.prevDep=xe.depsTail,e.nextDep=void 0,xe.depsTail.nextDep=e,xe.depsTail=e,xe.deps===e&&(xe.deps=i)}return e}trigger(t){this.version++,ya++,this.notify(t)}notify(t){Gf();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{Qf()}}}function b_(n){if(n.dep.sc++,n.sub.flags&4){const t=n.dep.computed;if(t&&!n.dep.subs){t.flags|=20;for(let i=t.deps;i;i=i.nextDep)b_(i)}const e=n.dep.subs;e!==n&&(n.prevSub=e,e&&(e.nextSub=n)),n.dep.subs=n}}const pd=new WeakMap,sr=Symbol(""),gd=Symbol(""),Ca=Symbol("");function an(n,t,e){if(ai&&xe){let i=pd.get(n);i||pd.set(n,i=new Map);let s=i.get(e);s||(i.set(e,s=new kf),s.map=i,s.key=e),s.track()}}function Zi(n,t,e,i,s,r){const o=pd.get(n);if(!o){ya++;return}const a=l=>{l&&l.trigger()};if(Gf(),t==="clear")o.forEach(a);else{const l=Yt(n),c=l&&Uf(e);if(l&&e==="length"){const h=Number(i);o.forEach((u,d)=>{(d==="length"||d===Ca||!_o(d)&&d>=h)&&a(u)})}else switch((e!==void 0||o.has(void 0))&&a(o.get(e)),c&&a(o.get(Ca)),t){case"add":l?c&&a(o.get("length")):(a(o.get(sr)),ta(n)&&a(o.get(gd)));break;case"delete":l||(a(o.get(sr)),ta(n)&&a(o.get(gd)));break;case"set":ta(n)&&a(o.get(sr));break}}Qf()}function yr(n){const t=he(n);return t===n?t:(an(t,"iterate",Ca),li(n)?t:t.map(gn))}function Vf(n){return an(n=he(n),"iterate",Ca),n}const kx={__proto__:null,[Symbol.iterator](){return Th(this,Symbol.iterator,gn)},concat(...n){return yr(this).concat(...n.map(t=>Yt(t)?yr(t):t))},entries(){return Th(this,"entries",n=>(n[1]=gn(n[1]),n))},every(n,t){return Oi(this,"every",n,t,void 0,arguments)},filter(n,t){return Oi(this,"filter",n,t,e=>e.map(gn),arguments)},find(n,t){return Oi(this,"find",n,t,gn,arguments)},findIndex(n,t){return Oi(this,"findIndex",n,t,void 0,arguments)},findLast(n,t){return Oi(this,"findLast",n,t,gn,arguments)},findLastIndex(n,t){return Oi(this,"findLastIndex",n,t,void 0,arguments)},forEach(n,t){return Oi(this,"forEach",n,t,void 0,arguments)},includes(...n){return wh(this,"includes",n)},indexOf(...n){return wh(this,"indexOf",n)},join(n){return yr(this).join(n)},lastIndexOf(...n){return wh(this,"lastIndexOf",n)},map(n,t){return Oi(this,"map",n,t,void 0,arguments)},pop(){return Io(this,"pop")},push(...n){return Io(this,"push",n)},reduce(n,...t){return cp(this,"reduce",n,t)},reduceRight(n,...t){return cp(this,"reduceRight",n,t)},shift(){return Io(this,"shift")},some(n,t){return Oi(this,"some",n,t,void 0,arguments)},splice(...n){return Io(this,"splice",n)},toReversed(){return yr(this).toReversed()},toSorted(n){return yr(this).toSorted(n)},toSpliced(...n){return yr(this).toSpliced(...n)},unshift(...n){return Io(this,"unshift",n)},values(){return Th(this,"values",gn)}};function Th(n,t,e){const i=Vf(n),s=i[t]();return i!==n&&!li(n)&&(s._next=s.next,s.next=()=>{const r=s._next();return r.value&&(r.value=e(r.value)),r}),s}const Vx=Array.prototype;function Oi(n,t,e,i,s,r){const o=Vf(n),a=o!==n&&!li(n),l=o[t];if(l!==Vx[t]){const u=l.apply(n,r);return a?gn(u):u}let c=e;o!==n&&(a?c=function(u,d){return e.call(this,gn(u),d,n)}:e.length>2&&(c=function(u,d){return e.call(this,u,d,n)}));const h=l.call(o,c,i);return a&&s?s(h):h}function cp(n,t,e,i){const s=Vf(n);let r=e;return s!==n&&(li(n)?e.length>3&&(r=function(o,a,l){return e.call(this,o,a,l,n)}):r=function(o,a,l){return e.call(this,o,gn(a),l,n)}),s[t](r,...i)}function wh(n,t,e){const i=he(n);an(i,"iterate",Ca);const s=i[t](...e);return(s===-1||s===!1)&&qf(e[0])?(e[0]=he(e[0]),i[t](...e)):s}function Io(n,t,e=[]){Ps(),Gf();const i=he(n)[t].apply(n,e);return Qf(),Fs(),i}const zx=Lf("__proto__,__v_isRef,__isVue"),M_=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(_o));function Wx(n){_o(n)||(n=String(n));const t=he(this);return an(t,"has",n),t.hasOwnProperty(n)}class S_{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,i){if(e==="__v_skip")return t.__v_skip;const s=this._isReadonly,r=this._isShallow;if(e==="__v_isReactive")return!s;if(e==="__v_isReadonly")return s;if(e==="__v_isShallow")return r;if(e==="__v_raw")return i===(s?r?ev:D_:r?R_:w_).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const o=Yt(t);if(!s){let l;if(o&&(l=kx[e]))return l;if(e==="hasOwnProperty")return Wx}const a=Reflect.get(t,e,cn(t)?t:i);return(_o(e)?M_.has(e):zx(e))||(s||an(t,"get",e),r)?a:cn(a)?o&&Uf(e)?a:a.value:Oe(a)?s?L_(a):Wf(a):a}}class T_ extends S_{constructor(t=!1){super(!1,t)}set(t,e,i,s){let r=t[e];if(!this._isShallow){const l=hr(r);if(!li(i)&&!hr(i)&&(r=he(r),i=he(i)),!Yt(t)&&cn(r)&&!cn(i))return l?!1:(r.value=i,!0)}const o=Yt(t)&&Uf(e)?Number(e)<t.length:ue(t,e),a=Reflect.set(t,e,i,cn(t)?t:s);return t===he(s)&&(o?bs(i,r)&&Zi(t,"set",e,i):Zi(t,"add",e,i)),a}deleteProperty(t,e){const i=ue(t,e);t[e];const s=Reflect.deleteProperty(t,e);return s&&i&&Zi(t,"delete",e,void 0),s}has(t,e){const i=Reflect.has(t,e);return(!_o(e)||!M_.has(e))&&an(t,"has",e),i}ownKeys(t){return an(t,"iterate",Yt(t)?"length":sr),Reflect.ownKeys(t)}}class Jx extends S_{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const qx=new T_,jx=new Jx,Xx=new T_(!0);const md=n=>n,nl=n=>Reflect.getPrototypeOf(n);function Kx(n,t,e){return function(...i){const s=this.__v_raw,r=he(s),o=ta(r),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,c=s[n](...i),h=e?md:t?_d:gn;return!t&&an(r,"iterate",l?gd:sr),{next(){const{value:u,done:d}=c.next();return d?{value:u,done:d}:{value:a?[h(u[0]),h(u[1])]:h(u),done:d}},[Symbol.iterator](){return this}}}}function il(n){return function(...t){return n==="delete"?!1:n==="clear"?void 0:this}}function Yx(n,t){const e={get(s){const r=this.__v_raw,o=he(r),a=he(s);n||(bs(s,a)&&an(o,"get",s),an(o,"get",a));const{has:l}=nl(o),c=t?md:n?_d:gn;if(l.call(o,s))return c(r.get(s));if(l.call(o,a))return c(r.get(a));r!==o&&r.get(s)},get size(){const s=this.__v_raw;return!n&&an(he(s),"iterate",sr),Reflect.get(s,"size",s)},has(s){const r=this.__v_raw,o=he(r),a=he(s);return n||(bs(s,a)&&an(o,"has",s),an(o,"has",a)),s===a?r.has(s):r.has(s)||r.has(a)},forEach(s,r){const o=this,a=o.__v_raw,l=he(a),c=t?md:n?_d:gn;return!n&&an(l,"iterate",sr),a.forEach((h,u)=>s.call(r,c(h),c(u),o))}};return $e(e,n?{add:il("add"),set:il("set"),delete:il("delete"),clear:il("clear")}:{add(s){!t&&!li(s)&&!hr(s)&&(s=he(s));const r=he(this);return nl(r).has.call(r,s)||(r.add(s),Zi(r,"add",s,s)),this},set(s,r){!t&&!li(r)&&!hr(r)&&(r=he(r));const o=he(this),{has:a,get:l}=nl(o);let c=a.call(o,s);c||(s=he(s),c=a.call(o,s));const h=l.call(o,s);return o.set(s,r),c?bs(r,h)&&Zi(o,"set",s,r):Zi(o,"add",s,r),this},delete(s){const r=he(this),{has:o,get:a}=nl(r);let l=o.call(r,s);l||(s=he(s),l=o.call(r,s)),a&&a.call(r,s);const c=r.delete(s);return l&&Zi(r,"delete",s,void 0),c},clear(){const s=he(this),r=s.size!==0,o=s.clear();return r&&Zi(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{e[s]=Kx(s,n,t)}),e}function zf(n,t){const e=Yx(n,t);return(i,s,r)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?i:Reflect.get(ue(e,s)&&s in i?e:i,s,r)}const Zx={get:zf(!1,!1)},$x={get:zf(!1,!0)},tv={get:zf(!0,!1)};const w_=new WeakMap,R_=new WeakMap,D_=new WeakMap,ev=new WeakMap;function nv(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function iv(n){return n.__v_skip||!Object.isExtensible(n)?0:nv(Mx(n))}function Wf(n){return hr(n)?n:Jf(n,!1,qx,Zx,w_)}function sv(n){return Jf(n,!1,Xx,$x,R_)}function L_(n){return Jf(n,!0,jx,tv,D_)}function Jf(n,t,e,i,s){if(!Oe(n)||n.__v_raw&&!(t&&n.__v_isReactive))return n;const r=s.get(n);if(r)return r;const o=iv(n);if(o===0)return n;const a=new Proxy(n,o===2?i:e);return s.set(n,a),a}function sa(n){return hr(n)?sa(n.__v_raw):!!(n&&n.__v_isReactive)}function hr(n){return!!(n&&n.__v_isReadonly)}function li(n){return!!(n&&n.__v_isShallow)}function qf(n){return n?!!n.__v_raw:!1}function he(n){const t=n&&n.__v_raw;return t?he(t):n}function rv(n){return!ue(n,"__v_skip")&&Object.isExtensible(n)&&m_(n,"__v_skip",!0),n}const gn=n=>Oe(n)?Wf(n):n,_d=n=>Oe(n)?L_(n):n;function cn(n){return n?n.__v_isRef===!0:!1}function hp(n){return ov(n,!1)}function ov(n,t){return cn(n)?n:new av(n,t)}class av{constructor(t,e){this.dep=new kf,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:he(t),this._value=e?t:gn(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,i=this.__v_isShallow||li(t)||hr(t);t=i?t:he(t),bs(t,e)&&(this._rawValue=t,this._value=i?t:gn(t),this.dep.trigger())}}function Ed(n){return cn(n)?n.value:n}const lv={get:(n,t,e)=>t==="__v_raw"?n:Ed(Reflect.get(n,t,e)),set:(n,t,e,i)=>{const s=n[t];return cn(s)&&!cn(e)?(s.value=e,!0):Reflect.set(n,t,e,i)}};function P_(n){return sa(n)?n:new Proxy(n,lv)}class cv{constructor(t,e,i){this.fn=t,this.setter=e,this._value=void 0,this.dep=new kf(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ya-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&xe!==this)return C_(this,!0),!0}get value(){const t=this.dep.track();return B_(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function hv(n,t,e=!1){let i,s;return $t(n)?i=n:(i=n.get,s=n.set),new cv(i,s,e)}const sl={},yc=new WeakMap;let Ys;function uv(n,t=!1,e=Ys){if(e){let i=yc.get(e);i||yc.set(e,i=[]),i.push(n)}}function dv(n,t,e=ve){const{immediate:i,deep:s,once:r,scheduler:o,augmentJob:a,call:l}=e,c=_=>s?_:li(_)||s===!1||s===0?vs(_,1):vs(_);let h,u,d,f,p=!1,m=!1;if(cn(n)?(u=()=>n.value,p=li(n)):sa(n)?(u=()=>c(n),p=!0):Yt(n)?(m=!0,p=n.some(_=>sa(_)||li(_)),u=()=>n.map(_=>{if(cn(_))return _.value;if(sa(_))return c(_);if($t(_))return l?l(_,2):_()})):$t(n)?t?u=l?()=>l(n,2):n:u=()=>{if(d){Ps();try{d()}finally{Fs()}}const _=Ys;Ys=h;try{return l?l(n,3,[f]):n(f)}finally{Ys=_}}:u=Ti,t&&s){const _=u,T=s===!0?1/0:s;u=()=>vs(_(),T)}const g=Gx(),A=()=>{h.stop(),g&&g.active&&Ff(g.effects,h)};if(r&&t){const _=t;t=(...T)=>{_(...T),A()}}let C=m?new Array(n.length).fill(sl):sl;const E=_=>{if(!(!(h.flags&1)||!h.dirty&&!_))if(t){const T=h.run();if(s||p||(m?T.some((M,S)=>bs(M,C[S])):bs(T,C))){d&&d();const M=Ys;Ys=h;try{const S=[T,C===sl?void 0:m&&C[0]===sl?[]:C,f];l?l(t,3,S):t(...S),C=T}finally{Ys=M}}}else h.run()};return a&&a(E),h=new E_(u),h.scheduler=o?()=>o(E,!1):E,f=_=>uv(_,!1,h),d=h.onStop=()=>{const _=yc.get(h);if(_){if(l)l(_,4);else for(const T of _)T();yc.delete(h)}},t?i?E(!0):C=h.run():o?o(E.bind(null,!0),!0):h.run(),A.pause=h.pause.bind(h),A.resume=h.resume.bind(h),A.stop=A,A}function vs(n,t=1/0,e){if(t<=0||!Oe(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),t--,cn(n))vs(n.value,t,e);else if(Yt(n))for(let i=0;i<n.length;i++)vs(n[i],t,e);else if(Ix(n)||ta(n))n.forEach(i=>{vs(i,t,e)});else if(Sx(n)){for(const i in n)vs(n[i],t,e);for(const i of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,i)&&vs(n[i],t,e)}return n}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ha(n,t,e,i){try{return i?n(...i):n()}catch(s){th(s,t,e)}}function Li(n,t,e,i){if($t(n)){const s=Ha(n,t,e,i);return s&&p_(s)&&s.catch(r=>{th(r,t,e)}),s}if(Yt(n)){const s=[];for(let r=0;r<n.length;r++)s.push(Li(n[r],t,e,i));return s}}function th(n,t,e,i=!0){const s=t?t.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||ve;if(t){let a=t.parent;const l=t.proxy,c=`https://vuejs.org/error-reference/#runtime-${e}`;for(;a;){const h=a.ec;if(h){for(let u=0;u<h.length;u++)if(h[u](n,l,c)===!1)return}a=a.parent}if(r){Ps(),Ha(r,null,10,[n,l,c]),Fs();return}}fv(n,e,s,i,o)}function fv(n,t,e,i=!0,s=!1){if(s)throw n;console.error(n)}const mn=[];let yi=-1;const Zr=[];let Cs=null,kr=0;const F_=Promise.resolve();let Cc=null;function Av(n){const t=Cc||F_;return n?t.then(this?n.bind(this):n):t}function pv(n){let t=yi+1,e=mn.length;for(;t<e;){const i=t+e>>>1,s=mn[i],r=xa(s);r<n||r===n&&s.flags&2?t=i+1:e=i}return t}function jf(n){if(!(n.flags&1)){const t=xa(n),e=mn[mn.length-1];!e||!(n.flags&2)&&t>=xa(e)?mn.push(n):mn.splice(pv(t),0,n),n.flags|=1,U_()}}function U_(){Cc||(Cc=F_.then(O_))}function gv(n){Yt(n)?Zr.push(...n):Cs&&n.id===-1?Cs.splice(kr+1,0,n):n.flags&1||(Zr.push(n),n.flags|=1),U_()}function up(n,t,e=yi+1){for(;e<mn.length;e++){const i=mn[e];if(i&&i.flags&2){if(n&&i.id!==n.uid)continue;mn.splice(e,1),e--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function N_(n){if(Zr.length){const t=[...new Set(Zr)].sort((e,i)=>xa(e)-xa(i));if(Zr.length=0,Cs){Cs.push(...t);return}for(Cs=t,kr=0;kr<Cs.length;kr++){const e=Cs[kr];e.flags&4&&(e.flags&=-2),e.flags&8||e(),e.flags&=-2}Cs=null,kr=0}}const xa=n=>n.id==null?n.flags&2?-1:1/0:n.id;function O_(n){try{for(yi=0;yi<mn.length;yi++){const t=mn[yi];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Ha(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;yi<mn.length;yi++){const t=mn[yi];t&&(t.flags&=-2)}yi=-1,mn.length=0,N_(),Cc=null,(mn.length||Zr.length)&&O_()}}let bi=null,G_=null;function xc(n){const t=bi;return bi=n,G_=n&&n.type.__scopeId||null,t}function mv(n,t=bi,e){if(!t||n._n)return n;const i=(...s)=>{i._d&&Ep(-1);const r=xc(t);let o;try{o=n(...s)}finally{xc(r),i._d&&Ep(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function Gs(n,t,e,i){const s=n.dirs,r=t&&t.dirs;for(let o=0;o<s.length;o++){const a=s[o];r&&(a.oldValue=r[o].value);let l=a.dir[i];l&&(Ps(),Li(l,e,8,[n.el,a,n,t]),Fs())}}const _v=Symbol("_vte"),Ev=n=>n.__isTeleport;function Xf(n,t){n.shapeFlag&6&&n.component?(n.transition=t,Xf(n.component.subTree,t)):n.shapeFlag&128?(n.ssContent.transition=t.clone(n.ssContent),n.ssFallback.transition=t.clone(n.ssFallback)):n.transition=t}function Q_(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function vc(n,t,e,i,s=!1){if(Yt(n)){n.forEach((p,m)=>vc(p,t&&(Yt(t)?t[m]:t),e,i,s));return}if(ra(i)&&!s){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&vc(n,t,e,i.component.subTree);return}const r=i.shapeFlag&4?$f(i.component):i.el,o=s?null:r,{i:a,r:l}=n,c=t&&t.r,h=a.refs===ve?a.refs={}:a.refs,u=a.setupState,d=he(u),f=u===ve?()=>!1:p=>ue(d,p);if(c!=null&&c!==l&&(je(c)?(h[c]=null,f(c)&&(u[c]=null)):cn(c)&&(c.value=null)),$t(l))Ha(l,a,12,[o,h]);else{const p=je(l),m=cn(l);if(p||m){const g=()=>{if(n.f){const A=p?f(l)?u[l]:h[l]:l.value;s?Yt(A)&&Ff(A,r):Yt(A)?A.includes(r)||A.push(r):p?(h[l]=[r],f(l)&&(u[l]=h[l])):(l.value=[r],n.k&&(h[n.k]=l.value))}else p?(h[l]=o,f(l)&&(u[l]=o)):m&&(l.value=o,n.k&&(h[n.k]=o))};o?(g.id=-1,Dn(g,e)):g()}}}$c().requestIdleCallback;$c().cancelIdleCallback;const ra=n=>!!n.type.__asyncLoader,H_=n=>n.type.__isKeepAlive;function yv(n,t){k_(n,"a",t)}function Cv(n,t){k_(n,"da",t)}function k_(n,t,e=_n){const i=n.__wdc||(n.__wdc=()=>{let s=e;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(eh(t,i,e),e){let s=e.parent;for(;s&&s.parent;)H_(s.parent.vnode)&&xv(i,t,e,s),s=s.parent}}function xv(n,t,e,i){const s=eh(t,n,i,!0);z_(()=>{Ff(i[t],s)},e)}function eh(n,t,e=_n,i=!1){if(e){const s=e[n]||(e[n]=[]),r=t.__weh||(t.__weh=(...o)=>{Ps();const a=ka(e),l=Li(t,e,n,o);return a(),Fs(),l});return i?s.unshift(r):s.push(r),r}}const ls=n=>(t,e=_n)=>{(!Ia||n==="sp")&&eh(n,(...i)=>t(...i),e)},vv=ls("bm"),V_=ls("m"),Bv=ls("bu"),Iv=ls("u"),bv=ls("bum"),z_=ls("um"),Mv=ls("sp"),Sv=ls("rtg"),Tv=ls("rtc");function wv(n,t=_n){eh("ec",n,t)}const Rv=Symbol.for("v-ndc"),yd=n=>n?hE(n)?$f(n):yd(n.parent):null,oa=$e(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>yd(n.parent),$root:n=>yd(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>Kf(n),$forceUpdate:n=>n.f||(n.f=()=>{jf(n.update)}),$nextTick:n=>n.n||(n.n=Av.bind(n.proxy)),$watch:n=>$v.bind(n)}),Rh=(n,t)=>n!==ve&&!n.__isScriptSetup&&ue(n,t),Dv={get({_:n},t){if(t==="__v_skip")return!0;const{ctx:e,setupState:i,data:s,props:r,accessCache:o,type:a,appContext:l}=n;let c;if(t[0]!=="$"){const f=o[t];if(f!==void 0)switch(f){case 1:return i[t];case 2:return s[t];case 4:return e[t];case 3:return r[t]}else{if(Rh(i,t))return o[t]=1,i[t];if(s!==ve&&ue(s,t))return o[t]=2,s[t];if((c=n.propsOptions[0])&&ue(c,t))return o[t]=3,r[t];if(e!==ve&&ue(e,t))return o[t]=4,e[t];Cd&&(o[t]=0)}}const h=oa[t];let u,d;if(h)return t==="$attrs"&&an(n.attrs,"get",""),h(n);if((u=a.__cssModules)&&(u=u[t]))return u;if(e!==ve&&ue(e,t))return o[t]=4,e[t];if(d=l.config.globalProperties,ue(d,t))return d[t]},set({_:n},t,e){const{data:i,setupState:s,ctx:r}=n;return Rh(s,t)?(s[t]=e,!0):i!==ve&&ue(i,t)?(i[t]=e,!0):ue(n.props,t)||t[0]==="$"&&t.slice(1)in n?!1:(r[t]=e,!0)},has({_:{data:n,setupState:t,accessCache:e,ctx:i,appContext:s,propsOptions:r}},o){let a;return!!e[o]||n!==ve&&ue(n,o)||Rh(t,o)||(a=r[0])&&ue(a,o)||ue(i,o)||ue(oa,o)||ue(s.config.globalProperties,o)},defineProperty(n,t,e){return e.get!=null?n._.accessCache[t]=0:ue(e,"value")&&this.set(n,t,e.value,null),Reflect.defineProperty(n,t,e)}};function dp(n){return Yt(n)?n.reduce((t,e)=>(t[e]=null,t),{}):n}let Cd=!0;function Lv(n){const t=Kf(n),e=n.proxy,i=n.ctx;Cd=!1,t.beforeCreate&&fp(t.beforeCreate,n,"bc");const{data:s,computed:r,methods:o,watch:a,provide:l,inject:c,created:h,beforeMount:u,mounted:d,beforeUpdate:f,updated:p,activated:m,deactivated:g,beforeDestroy:A,beforeUnmount:C,destroyed:E,unmounted:_,render:T,renderTracked:M,renderTriggered:S,errorCaptured:R,serverPrefetch:B,expose:x,inheritAttrs:D,components:V,directives:Q,filters:k}=t;if(c&&Pv(c,i,null),o)for(const X in o){const U=o[X];$t(U)&&(i[X]=U.bind(e))}if(s){const X=s.call(e,e);Oe(X)&&(n.data=Wf(X))}if(Cd=!0,r)for(const X in r){const U=r[X],ut=$t(U)?U.bind(e,e):$t(U.get)?U.get.bind(e,e):Ti,gt=!$t(U)&&$t(U.set)?U.set.bind(e):Ti,Et=vB({get:ut,set:gt});Object.defineProperty(i,X,{enumerable:!0,configurable:!0,get:()=>Et.value,set:Dt=>Et.value=Dt})}if(a)for(const X in a)W_(a[X],i,e,X);if(l){const X=$t(l)?l.call(e):l;Reflect.ownKeys(X).forEach(U=>{Qv(U,X[U])})}h&&fp(h,n,"c");function j(X,U){Yt(U)?U.forEach(ut=>X(ut.bind(e))):U&&X(U.bind(e))}if(j(vv,u),j(V_,d),j(Bv,f),j(Iv,p),j(yv,m),j(Cv,g),j(wv,R),j(Tv,M),j(Sv,S),j(bv,C),j(z_,_),j(Mv,B),Yt(x))if(x.length){const X=n.exposed||(n.exposed={});x.forEach(U=>{Object.defineProperty(X,U,{get:()=>e[U],set:ut=>e[U]=ut})})}else n.exposed||(n.exposed={});T&&n.render===Ti&&(n.render=T),D!=null&&(n.inheritAttrs=D),V&&(n.components=V),Q&&(n.directives=Q),B&&Q_(n)}function Pv(n,t,e=Ti){Yt(n)&&(n=xd(n));for(const i in n){const s=n[i];let r;Oe(s)?"default"in s?r=ac(s.from||i,s.default,!0):r=ac(s.from||i):r=ac(s),cn(r)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):t[i]=r}}function fp(n,t,e){Li(Yt(n)?n.map(i=>i.bind(t.proxy)):n.bind(t.proxy),t,e)}function W_(n,t,e,i){let s=i.includes(".")?rE(e,i):()=>e[i];if(je(n)){const r=t[n];$t(r)&&Lh(s,r)}else if($t(n))Lh(s,n.bind(e));else if(Oe(n))if(Yt(n))n.forEach(r=>W_(r,t,e,i));else{const r=$t(n.handler)?n.handler.bind(e):t[n.handler];$t(r)&&Lh(s,r,n)}}function Kf(n){const t=n.type,{mixins:e,extends:i}=t,{mixins:s,optionsCache:r,config:{optionMergeStrategies:o}}=n.appContext,a=r.get(t);let l;return a?l=a:!s.length&&!e&&!i?l=t:(l={},s.length&&s.forEach(c=>Bc(l,c,o,!0)),Bc(l,t,o)),Oe(t)&&r.set(t,l),l}function Bc(n,t,e,i=!1){const{mixins:s,extends:r}=t;r&&Bc(n,r,e,!0),s&&s.forEach(o=>Bc(n,o,e,!0));for(const o in t)if(!(i&&o==="expose")){const a=Fv[o]||e&&e[o];n[o]=a?a(n[o],t[o]):t[o]}return n}const Fv={data:Ap,props:pp,emits:pp,methods:jo,computed:jo,beforeCreate:An,created:An,beforeMount:An,mounted:An,beforeUpdate:An,updated:An,beforeDestroy:An,beforeUnmount:An,destroyed:An,unmounted:An,activated:An,deactivated:An,errorCaptured:An,serverPrefetch:An,components:jo,directives:jo,watch:Nv,provide:Ap,inject:Uv};function Ap(n,t){return t?n?function(){return $e($t(n)?n.call(this,this):n,$t(t)?t.call(this,this):t)}:t:n}function Uv(n,t){return jo(xd(n),xd(t))}function xd(n){if(Yt(n)){const t={};for(let e=0;e<n.length;e++)t[n[e]]=n[e];return t}return n}function An(n,t){return n?[...new Set([].concat(n,t))]:t}function jo(n,t){return n?$e(Object.create(null),n,t):t}function pp(n,t){return n?Yt(n)&&Yt(t)?[...new Set([...n,...t])]:$e(Object.create(null),dp(n),dp(t??{})):t}function Nv(n,t){if(!n)return t;if(!t)return n;const e=$e(Object.create(null),n);for(const i in t)e[i]=An(n[i],t[i]);return e}function J_(){return{app:null,config:{isNativeTag:vx,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Ov=0;function Gv(n,t){return function(i,s=null){$t(i)||(i=$e({},i)),s!=null&&!Oe(s)&&(s=null);const r=J_(),o=new WeakSet,a=[];let l=!1;const c=r.app={_uid:Ov++,_component:i,_props:s,_container:null,_context:r,_instance:null,version:BB,get config(){return r.config},set config(h){},use(h,...u){return o.has(h)||(h&&$t(h.install)?(o.add(h),h.install(c,...u)):$t(h)&&(o.add(h),h(c,...u))),c},mixin(h){return r.mixins.includes(h)||r.mixins.push(h),c},component(h,u){return u?(r.components[h]=u,c):r.components[h]},directive(h,u){return u?(r.directives[h]=u,c):r.directives[h]},mount(h,u,d){if(!l){const f=c._ceVNode||rr(i,s);return f.appContext=r,d===!0?d="svg":d===!1&&(d=void 0),u&&t?t(f,h):n(f,h,d),l=!0,c._container=h,h.__vue_app__=c,$f(f.component)}},onUnmount(h){a.push(h)},unmount(){l&&(Li(a,c._instance,16),n(null,c._container),delete c._container.__vue_app__)},provide(h,u){return r.provides[h]=u,c},runWithContext(h){const u=$r;$r=c;try{return h()}finally{$r=u}}};return c}}let $r=null;function Qv(n,t){if(_n){let e=_n.provides;const i=_n.parent&&_n.parent.provides;i===e&&(e=_n.provides=Object.create(i)),e[n]=t}}function ac(n,t,e=!1){const i=_n||bi;if(i||$r){const s=$r?$r._context.provides:i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(s&&n in s)return s[n];if(arguments.length>1)return e&&$t(t)?t.call(i&&i.proxy):t}}const q_={},j_=()=>Object.create(q_),X_=n=>Object.getPrototypeOf(n)===q_;function Hv(n,t,e,i=!1){const s={},r=j_();n.propsDefaults=Object.create(null),K_(n,t,s,r);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);e?n.props=i?s:sv(s):n.type.props?n.props=s:n.props=r,n.attrs=r}function kv(n,t,e,i){const{props:s,attrs:r,vnode:{patchFlag:o}}=n,a=he(s),[l]=n.propsOptions;let c=!1;if((i||o>0)&&!(o&16)){if(o&8){const h=n.vnode.dynamicProps;for(let u=0;u<h.length;u++){let d=h[u];if(nh(n.emitsOptions,d))continue;const f=t[d];if(l)if(ue(r,d))f!==r[d]&&(r[d]=f,c=!0);else{const p=ws(d);s[p]=vd(l,a,p,f,n,!1)}else f!==r[d]&&(r[d]=f,c=!0)}}}else{K_(n,t,s,r)&&(c=!0);let h;for(const u in a)(!t||!ue(t,u)&&((h=pr(u))===u||!ue(t,h)))&&(l?e&&(e[u]!==void 0||e[h]!==void 0)&&(s[u]=vd(l,a,u,void 0,n,!0)):delete s[u]);if(r!==a)for(const u in r)(!t||!ue(t,u))&&(delete r[u],c=!0)}c&&Zi(n.attrs,"set","")}function K_(n,t,e,i){const[s,r]=n.propsOptions;let o=!1,a;if(t)for(let l in t){if(ea(l))continue;const c=t[l];let h;s&&ue(s,h=ws(l))?!r||!r.includes(h)?e[h]=c:(a||(a={}))[h]=c:nh(n.emitsOptions,l)||(!(l in i)||c!==i[l])&&(i[l]=c,o=!0)}if(r){const l=he(e),c=a||ve;for(let h=0;h<r.length;h++){const u=r[h];e[u]=vd(s,l,u,c[u],n,!ue(c,u))}}return o}function vd(n,t,e,i,s,r){const o=n[e];if(o!=null){const a=ue(o,"default");if(a&&i===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&$t(l)){const{propsDefaults:c}=s;if(e in c)i=c[e];else{const h=ka(s);i=c[e]=l.call(null,t),h()}}else i=l;s.ce&&s.ce._setProp(e,i)}o[0]&&(r&&!a?i=!1:o[1]&&(i===""||i===pr(e))&&(i=!0))}return i}const Vv=new WeakMap;function Y_(n,t,e=!1){const i=e?Vv:t.propsCache,s=i.get(n);if(s)return s;const r=n.props,o={},a=[];let l=!1;if(!$t(n)){const h=u=>{l=!0;const[d,f]=Y_(u,t,!0);$e(o,d),f&&a.push(...f)};!e&&t.mixins.length&&t.mixins.forEach(h),n.extends&&h(n.extends),n.mixins&&n.mixins.forEach(h)}if(!r&&!l)return Oe(n)&&i.set(n,Yr),Yr;if(Yt(r))for(let h=0;h<r.length;h++){const u=ws(r[h]);gp(u)&&(o[u]=ve)}else if(r)for(const h in r){const u=ws(h);if(gp(u)){const d=r[h],f=o[u]=Yt(d)||$t(d)?{type:d}:$e({},d),p=f.type;let m=!1,g=!0;if(Yt(p))for(let A=0;A<p.length;++A){const C=p[A],E=$t(C)&&C.name;if(E==="Boolean"){m=!0;break}else E==="String"&&(g=!1)}else m=$t(p)&&p.name==="Boolean";f[0]=m,f[1]=g,(m||ue(f,"default"))&&a.push(u)}}const c=[o,a];return Oe(n)&&i.set(n,c),c}function gp(n){return n[0]!=="$"&&!ea(n)}const Z_=n=>n[0]==="_"||n==="$stable",Yf=n=>Yt(n)?n.map(Ci):[Ci(n)],zv=(n,t,e)=>{if(t._n)return t;const i=mv((...s)=>Yf(t(...s)),e);return i._c=!1,i},$_=(n,t,e)=>{const i=n._ctx;for(const s in n){if(Z_(s))continue;const r=n[s];if($t(r))t[s]=zv(s,r,i);else if(r!=null){const o=Yf(r);t[s]=()=>o}}},tE=(n,t)=>{const e=Yf(t);n.slots.default=()=>e},eE=(n,t,e)=>{for(const i in t)(e||i!=="_")&&(n[i]=t[i])},Wv=(n,t,e)=>{const i=n.slots=j_();if(n.vnode.shapeFlag&32){const s=t._;s?(eE(i,t,e),e&&m_(i,"_",s,!0)):$_(t,i)}else t&&tE(n,t)},Jv=(n,t,e)=>{const{vnode:i,slots:s}=n;let r=!0,o=ve;if(i.shapeFlag&32){const a=t._;a?e&&a===1?r=!1:eE(s,t,e):(r=!t.$stable,$_(t,s)),o=t}else t&&(tE(n,t),o={default:1});if(r)for(const a in s)!Z_(a)&&o[a]==null&&delete s[a]},Dn=oB;function qv(n){return jv(n)}function jv(n,t){const e=$c();e.__VUE__=!0;const{insert:i,remove:s,patchProp:r,createElement:o,createText:a,createComment:l,setText:c,setElementText:h,parentNode:u,nextSibling:d,setScopeId:f=Ti,insertStaticContent:p}=n,m=(w,v,z,st=null,$=null,K=null,ht=void 0,nt=null,I=!!v.dynamicChildren)=>{if(w===v)return;w&&!bo(w,v)&&(st=ot(w),Dt(w,$,K,!0),w=null),v.patchFlag===-2&&(I=!1,v.dynamicChildren=null);const{type:y,ref:P,shapeFlag:N}=v;switch(y){case ih:g(w,v,z,st);break;case va:A(w,v,z,st);break;case Fh:w==null&&C(v,z,st,ht);break;case Ki:V(w,v,z,st,$,K,ht,nt,I);break;default:N&1?T(w,v,z,st,$,K,ht,nt,I):N&6?Q(w,v,z,st,$,K,ht,nt,I):(N&64||N&128)&&y.process(w,v,z,st,$,K,ht,nt,I,Vt)}P!=null&&$&&vc(P,w&&w.ref,K,v||w,!v)},g=(w,v,z,st)=>{if(w==null)i(v.el=a(v.children),z,st);else{const $=v.el=w.el;v.children!==w.children&&c($,v.children)}},A=(w,v,z,st)=>{w==null?i(v.el=l(v.children||""),z,st):v.el=w.el},C=(w,v,z,st)=>{[w.el,w.anchor]=p(w.children,v,z,st,w.el,w.anchor)},E=({el:w,anchor:v},z,st)=>{let $;for(;w&&w!==v;)$=d(w),i(w,z,st),w=$;i(v,z,st)},_=({el:w,anchor:v})=>{let z;for(;w&&w!==v;)z=d(w),s(w),w=z;s(v)},T=(w,v,z,st,$,K,ht,nt,I)=>{v.type==="svg"?ht="svg":v.type==="math"&&(ht="mathml"),w==null?M(v,z,st,$,K,ht,nt,I):B(w,v,$,K,ht,nt,I)},M=(w,v,z,st,$,K,ht,nt)=>{let I,y;const{props:P,shapeFlag:N,transition:J,dirs:W}=w;if(I=w.el=o(w.type,K,P&&P.is,P),N&8?h(I,w.children):N&16&&R(w.children,I,null,st,$,Dh(w,K),ht,nt),W&&Gs(w,null,st,"created"),S(I,w,w.scopeId,ht,st),P){for(const dt in P)dt!=="value"&&!ea(dt)&&r(I,dt,null,P[dt],K,st);"value"in P&&r(I,"value",null,P.value,K),(y=P.onVnodeBeforeMount)&&mi(y,st,w)}W&&Gs(w,null,st,"beforeMount");const pt=Xv($,J);pt&&J.beforeEnter(I),i(I,v,z),((y=P&&P.onVnodeMounted)||pt||W)&&Dn(()=>{y&&mi(y,st,w),pt&&J.enter(I),W&&Gs(w,null,st,"mounted")},$)},S=(w,v,z,st,$)=>{if(z&&f(w,z),st)for(let K=0;K<st.length;K++)f(w,st[K]);if($){let K=$.subTree;if(v===K||aE(K.type)&&(K.ssContent===v||K.ssFallback===v)){const ht=$.vnode;S(w,ht,ht.scopeId,ht.slotScopeIds,$.parent)}}},R=(w,v,z,st,$,K,ht,nt,I=0)=>{for(let y=I;y<w.length;y++){const P=w[y]=nt?xs(w[y]):Ci(w[y]);m(null,P,v,z,st,$,K,ht,nt)}},B=(w,v,z,st,$,K,ht)=>{const nt=v.el=w.el;let{patchFlag:I,dynamicChildren:y,dirs:P}=v;I|=w.patchFlag&16;const N=w.props||ve,J=v.props||ve;let W;if(z&&Qs(z,!1),(W=J.onVnodeBeforeUpdate)&&mi(W,z,v,w),P&&Gs(v,w,z,"beforeUpdate"),z&&Qs(z,!0),(N.innerHTML&&J.innerHTML==null||N.textContent&&J.textContent==null)&&h(nt,""),y?x(w.dynamicChildren,y,nt,z,st,Dh(v,$),K):ht||U(w,v,nt,null,z,st,Dh(v,$),K,!1),I>0){if(I&16)D(nt,N,J,z,$);else if(I&2&&N.class!==J.class&&r(nt,"class",null,J.class,$),I&4&&r(nt,"style",N.style,J.style,$),I&8){const pt=v.dynamicProps;for(let dt=0;dt<pt.length;dt++){const ft=pt[dt],zt=N[ft],ct=J[ft];(ct!==zt||ft==="value")&&r(nt,ft,zt,ct,$,z)}}I&1&&w.children!==v.children&&h(nt,v.children)}else!ht&&y==null&&D(nt,N,J,z,$);((W=J.onVnodeUpdated)||P)&&Dn(()=>{W&&mi(W,z,v,w),P&&Gs(v,w,z,"updated")},st)},x=(w,v,z,st,$,K,ht)=>{for(let nt=0;nt<v.length;nt++){const I=w[nt],y=v[nt],P=I.el&&(I.type===Ki||!bo(I,y)||I.shapeFlag&70)?u(I.el):z;m(I,y,P,null,st,$,K,ht,!0)}},D=(w,v,z,st,$)=>{if(v!==z){if(v!==ve)for(const K in v)!ea(K)&&!(K in z)&&r(w,K,v[K],null,$,st);for(const K in z){if(ea(K))continue;const ht=z[K],nt=v[K];ht!==nt&&K!=="value"&&r(w,K,nt,ht,$,st)}"value"in z&&r(w,"value",v.value,z.value,$)}},V=(w,v,z,st,$,K,ht,nt,I)=>{const y=v.el=w?w.el:a(""),P=v.anchor=w?w.anchor:a("");let{patchFlag:N,dynamicChildren:J,slotScopeIds:W}=v;W&&(nt=nt?nt.concat(W):W),w==null?(i(y,z,st),i(P,z,st),R(v.children||[],z,P,$,K,ht,nt,I)):N>0&&N&64&&J&&w.dynamicChildren?(x(w.dynamicChildren,J,z,$,K,ht,nt),(v.key!=null||$&&v===$.subTree)&&nE(w,v,!0)):U(w,v,z,P,$,K,ht,nt,I)},Q=(w,v,z,st,$,K,ht,nt,I)=>{v.slotScopeIds=nt,w==null?v.shapeFlag&512?$.ctx.activate(v,z,st,ht,I):k(v,z,st,$,K,ht,I):et(w,v,I)},k=(w,v,z,st,$,K,ht)=>{const nt=w.component=mB(w,st,$);if(H_(w)&&(nt.ctx.renderer=Vt),_B(nt,!1,ht),nt.asyncDep){if($&&$.registerDep(nt,j,ht),!w.el){const I=nt.subTree=rr(va);A(null,I,v,z)}}else j(nt,w,v,z,$,K,ht)},et=(w,v,z)=>{const st=v.component=w.component;if(sB(w,v,z))if(st.asyncDep&&!st.asyncResolved){X(st,v,z);return}else st.next=v,st.update();else v.el=w.el,st.vnode=v},j=(w,v,z,st,$,K,ht)=>{const nt=()=>{if(w.isMounted){let{next:N,bu:J,u:W,parent:pt,vnode:dt}=w;{const Rt=iE(w);if(Rt){N&&(N.el=dt.el,X(w,N,ht)),Rt.asyncDep.then(()=>{w.isUnmounted||nt()});return}}let ft=N,zt;Qs(w,!1),N?(N.el=dt.el,X(w,N,ht)):N=dt,J&&Mh(J),(zt=N.props&&N.props.onVnodeBeforeUpdate)&&mi(zt,pt,N,dt),Qs(w,!0);const ct=Ph(w),yt=w.subTree;w.subTree=ct,m(yt,ct,u(yt.el),ot(yt),w,$,K),N.el=ct.el,ft===null&&rB(w,ct.el),W&&Dn(W,$),(zt=N.props&&N.props.onVnodeUpdated)&&Dn(()=>mi(zt,pt,N,dt),$)}else{let N;const{el:J,props:W}=v,{bm:pt,m:dt,parent:ft,root:zt,type:ct}=w,yt=ra(v);if(Qs(w,!1),pt&&Mh(pt),!yt&&(N=W&&W.onVnodeBeforeMount)&&mi(N,ft,v),Qs(w,!0),J&&Zt){const Rt=()=>{w.subTree=Ph(w),Zt(J,w.subTree,w,$,null)};yt&&ct.__asyncHydrate?ct.__asyncHydrate(J,w,Rt):Rt()}else{zt.ce&&zt.ce._injectChildStyle(ct);const Rt=w.subTree=Ph(w);m(null,Rt,z,st,w,$,K),v.el=Rt.el}if(dt&&Dn(dt,$),!yt&&(N=W&&W.onVnodeMounted)){const Rt=v;Dn(()=>mi(N,ft,Rt),$)}(v.shapeFlag&256||ft&&ra(ft.vnode)&&ft.vnode.shapeFlag&256)&&w.a&&Dn(w.a,$),w.isMounted=!0,v=z=st=null}};w.scope.on();const I=w.effect=new E_(nt);w.scope.off();const y=w.update=I.run.bind(I),P=w.job=I.runIfDirty.bind(I);P.i=w,P.id=w.uid,I.scheduler=()=>jf(P),Qs(w,!0),y()},X=(w,v,z)=>{v.component=w;const st=w.vnode.props;w.vnode=v,w.next=null,kv(w,v.props,st,z),Jv(w,v.children,z),Ps(),up(w),Fs()},U=(w,v,z,st,$,K,ht,nt,I=!1)=>{const y=w&&w.children,P=w?w.shapeFlag:0,N=v.children,{patchFlag:J,shapeFlag:W}=v;if(J>0){if(J&128){gt(y,N,z,st,$,K,ht,nt,I);return}else if(J&256){ut(y,N,z,st,$,K,ht,nt,I);return}}W&8?(P&16&&H(y,$,K),N!==y&&h(z,N)):P&16?W&16?gt(y,N,z,st,$,K,ht,nt,I):H(y,$,K,!0):(P&8&&h(z,""),W&16&&R(N,z,st,$,K,ht,nt,I))},ut=(w,v,z,st,$,K,ht,nt,I)=>{w=w||Yr,v=v||Yr;const y=w.length,P=v.length,N=Math.min(y,P);let J;for(J=0;J<N;J++){const W=v[J]=I?xs(v[J]):Ci(v[J]);m(w[J],W,z,null,$,K,ht,nt,I)}y>P?H(w,$,K,!0,!1,N):R(v,z,st,$,K,ht,nt,I,N)},gt=(w,v,z,st,$,K,ht,nt,I)=>{let y=0;const P=v.length;let N=w.length-1,J=P-1;for(;y<=N&&y<=J;){const W=w[y],pt=v[y]=I?xs(v[y]):Ci(v[y]);if(bo(W,pt))m(W,pt,z,null,$,K,ht,nt,I);else break;y++}for(;y<=N&&y<=J;){const W=w[N],pt=v[J]=I?xs(v[J]):Ci(v[J]);if(bo(W,pt))m(W,pt,z,null,$,K,ht,nt,I);else break;N--,J--}if(y>N){if(y<=J){const W=J+1,pt=W<P?v[W].el:st;for(;y<=J;)m(null,v[y]=I?xs(v[y]):Ci(v[y]),z,pt,$,K,ht,nt,I),y++}}else if(y>J)for(;y<=N;)Dt(w[y],$,K,!0),y++;else{const W=y,pt=y,dt=new Map;for(y=pt;y<=J;y++){const Ht=v[y]=I?xs(v[y]):Ci(v[y]);Ht.key!=null&&dt.set(Ht.key,y)}let ft,zt=0;const ct=J-pt+1;let yt=!1,Rt=0;const Ot=new Array(ct);for(y=0;y<ct;y++)Ot[y]=0;for(y=W;y<=N;y++){const Ht=w[y];if(zt>=ct){Dt(Ht,$,K,!0);continue}let Gt;if(Ht.key!=null)Gt=dt.get(Ht.key);else for(ft=pt;ft<=J;ft++)if(Ot[ft-pt]===0&&bo(Ht,v[ft])){Gt=ft;break}Gt===void 0?Dt(Ht,$,K,!0):(Ot[Gt-pt]=y+1,Gt>=Rt?Rt=Gt:yt=!0,m(Ht,v[Gt],z,null,$,K,ht,nt,I),zt++)}const St=yt?Kv(Ot):Yr;for(ft=St.length-1,y=ct-1;y>=0;y--){const Ht=pt+y,Gt=v[Ht],de=Ht+1<P?v[Ht+1].el:st;Ot[y]===0?m(null,Gt,z,de,$,K,ht,nt,I):yt&&(ft<0||y!==St[ft]?Et(Gt,z,de,2):ft--)}}},Et=(w,v,z,st,$=null)=>{const{el:K,type:ht,transition:nt,children:I,shapeFlag:y}=w;if(y&6){Et(w.component.subTree,v,z,st);return}if(y&128){w.suspense.move(v,z,st);return}if(y&64){ht.move(w,v,z,Vt);return}if(ht===Ki){i(K,v,z);for(let N=0;N<I.length;N++)Et(I[N],v,z,st);i(w.anchor,v,z);return}if(ht===Fh){E(w,v,z);return}if(st!==2&&y&1&&nt)if(st===0)nt.beforeEnter(K),i(K,v,z),Dn(()=>nt.enter(K),$);else{const{leave:N,delayLeave:J,afterLeave:W}=nt,pt=()=>i(K,v,z),dt=()=>{N(K,()=>{pt(),W&&W()})};J?J(K,pt,dt):dt()}else i(K,v,z)},Dt=(w,v,z,st=!1,$=!1)=>{const{type:K,props:ht,ref:nt,children:I,dynamicChildren:y,shapeFlag:P,patchFlag:N,dirs:J,cacheIndex:W}=w;if(N===-2&&($=!1),nt!=null&&vc(nt,null,z,w,!0),W!=null&&(v.renderCache[W]=void 0),P&256){v.ctx.deactivate(w);return}const pt=P&1&&J,dt=!ra(w);let ft;if(dt&&(ft=ht&&ht.onVnodeBeforeUnmount)&&mi(ft,v,w),P&6)mt(w.component,z,st);else{if(P&128){w.suspense.unmount(z,st);return}pt&&Gs(w,null,v,"beforeUnmount"),P&64?w.type.remove(w,v,z,Vt,st):y&&!y.hasOnce&&(K!==Ki||N>0&&N&64)?H(y,v,z,!1,!0):(K===Ki&&N&384||!$&&P&16)&&H(I,v,z),st&&Jt(w)}(dt&&(ft=ht&&ht.onVnodeUnmounted)||pt)&&Dn(()=>{ft&&mi(ft,v,w),pt&&Gs(w,null,v,"unmounted")},z)},Jt=w=>{const{type:v,el:z,anchor:st,transition:$}=w;if(v===Ki){at(z,st);return}if(v===Fh){_(w);return}const K=()=>{s(z),$&&!$.persisted&&$.afterLeave&&$.afterLeave()};if(w.shapeFlag&1&&$&&!$.persisted){const{leave:ht,delayLeave:nt}=$,I=()=>ht(z,K);nt?nt(w.el,K,I):I()}else K()},at=(w,v)=>{let z;for(;w!==v;)z=d(w),s(w),w=z;s(v)},mt=(w,v,z)=>{const{bum:st,scope:$,job:K,subTree:ht,um:nt,m:I,a:y}=w;mp(I),mp(y),st&&Mh(st),$.stop(),K&&(K.flags|=8,Dt(ht,w,v,z)),nt&&Dn(nt,v),Dn(()=>{w.isUnmounted=!0},v),v&&v.pendingBranch&&!v.isUnmounted&&w.asyncDep&&!w.asyncResolved&&w.suspenseId===v.pendingId&&(v.deps--,v.deps===0&&v.resolve())},H=(w,v,z,st=!1,$=!1,K=0)=>{for(let ht=K;ht<w.length;ht++)Dt(w[ht],v,z,st,$)},ot=w=>{if(w.shapeFlag&6)return ot(w.component.subTree);if(w.shapeFlag&128)return w.suspense.next();const v=d(w.anchor||w.el),z=v&&v[_v];return z?d(z):v};let vt=!1;const Mt=(w,v,z)=>{w==null?v._vnode&&Dt(v._vnode,null,null,!0):m(v._vnode||null,w,v,null,null,null,z),v._vnode=w,vt||(vt=!0,up(),N_(),vt=!1)},Vt={p:m,um:Dt,m:Et,r:Jt,mt:k,mc:R,pc:U,pbc:x,n:ot,o:n};let ae,Zt;return{render:Mt,hydrate:ae,createApp:Gv(Mt,ae)}}function Dh({type:n,props:t},e){return e==="svg"&&n==="foreignObject"||e==="mathml"&&n==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:e}function Qs({effect:n,job:t},e){e?(n.flags|=32,t.flags|=4):(n.flags&=-33,t.flags&=-5)}function Xv(n,t){return(!n||n&&!n.pendingBranch)&&t&&!t.persisted}function nE(n,t,e=!1){const i=n.children,s=t.children;if(Yt(i)&&Yt(s))for(let r=0;r<i.length;r++){const o=i[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=xs(s[r]),a.el=o.el),!e&&a.patchFlag!==-2&&nE(o,a)),a.type===ih&&(a.el=o.el)}}function Kv(n){const t=n.slice(),e=[0];let i,s,r,o,a;const l=n.length;for(i=0;i<l;i++){const c=n[i];if(c!==0){if(s=e[e.length-1],n[s]<c){t[i]=s,e.push(i);continue}for(r=0,o=e.length-1;r<o;)a=r+o>>1,n[e[a]]<c?r=a+1:o=a;c<n[e[r]]&&(r>0&&(t[i]=e[r-1]),e[r]=i)}}for(r=e.length,o=e[r-1];r-- >0;)e[r]=o,o=t[o];return e}function iE(n){const t=n.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:iE(t)}function mp(n){if(n)for(let t=0;t<n.length;t++)n[t].flags|=8}const Yv=Symbol.for("v-scx"),Zv=()=>ac(Yv);function Lh(n,t,e){return sE(n,t,e)}function sE(n,t,e=ve){const{immediate:i,deep:s,flush:r,once:o}=e,a=$e({},e),l=t&&i||!t&&r!=="post";let c;if(Ia){if(r==="sync"){const f=Zv();c=f.__watcherHandles||(f.__watcherHandles=[])}else if(!l){const f=()=>{};return f.stop=Ti,f.resume=Ti,f.pause=Ti,f}}const h=_n;a.call=(f,p,m)=>Li(f,h,p,m);let u=!1;r==="post"?a.scheduler=f=>{Dn(f,h&&h.suspense)}:r!=="sync"&&(u=!0,a.scheduler=(f,p)=>{p?f():jf(f)}),a.augmentJob=f=>{t&&(f.flags|=4),u&&(f.flags|=2,h&&(f.id=h.uid,f.i=h))};const d=dv(n,t,a);return Ia&&(c?c.push(d):l&&d()),d}function $v(n,t,e){const i=this.proxy,s=je(n)?n.includes(".")?rE(i,n):()=>i[n]:n.bind(i,i);let r;$t(t)?r=t:(r=t.handler,e=t);const o=ka(this),a=sE(s,r.bind(i),e);return o(),a}function rE(n,t){const e=t.split(".");return()=>{let i=n;for(let s=0;s<e.length&&i;s++)i=i[e[s]];return i}}const tB=(n,t)=>t==="modelValue"||t==="model-value"?n.modelModifiers:n[`${t}Modifiers`]||n[`${ws(t)}Modifiers`]||n[`${pr(t)}Modifiers`];function eB(n,t,...e){if(n.isUnmounted)return;const i=n.vnode.props||ve;let s=e;const r=t.startsWith("update:"),o=r&&tB(i,t.slice(7));o&&(o.trim&&(s=e.map(h=>je(h)?h.trim():h)),o.number&&(s=e.map(Rx)));let a,l=i[a=bh(t)]||i[a=bh(ws(t))];!l&&r&&(l=i[a=bh(pr(t))]),l&&Li(l,n,6,s);const c=i[a+"Once"];if(c){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Li(c,n,6,s)}}function oE(n,t,e=!1){const i=t.emitsCache,s=i.get(n);if(s!==void 0)return s;const r=n.emits;let o={},a=!1;if(!$t(n)){const l=c=>{const h=oE(c,t,!0);h&&(a=!0,$e(o,h))};!e&&t.mixins.length&&t.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!r&&!a?(Oe(n)&&i.set(n,null),null):(Yt(r)?r.forEach(l=>o[l]=null):$e(o,r),Oe(n)&&i.set(n,o),o)}function nh(n,t){return!n||!Kc(t)?!1:(t=t.slice(2).replace(/Once$/,""),ue(n,t[0].toLowerCase()+t.slice(1))||ue(n,pr(t))||ue(n,t))}function Ph(n){const{type:t,vnode:e,proxy:i,withProxy:s,propsOptions:[r],slots:o,attrs:a,emit:l,render:c,renderCache:h,props:u,data:d,setupState:f,ctx:p,inheritAttrs:m}=n,g=xc(n);let A,C;try{if(e.shapeFlag&4){const _=s||i,T=_;A=Ci(c.call(T,_,h,u,f,d,p)),C=a}else{const _=t;A=Ci(_.length>1?_(u,{attrs:a,slots:o,emit:l}):_(u,null)),C=t.props?a:nB(a)}}catch(_){aa.length=0,th(_,n,1),A=rr(va)}let E=A;if(C&&m!==!1){const _=Object.keys(C),{shapeFlag:T}=E;_.length&&T&7&&(r&&_.some(Pf)&&(C=iB(C,r)),E=so(E,C,!1,!0))}return e.dirs&&(E=so(E,null,!1,!0),E.dirs=E.dirs?E.dirs.concat(e.dirs):e.dirs),e.transition&&Xf(E,e.transition),A=E,xc(g),A}const nB=n=>{let t;for(const e in n)(e==="class"||e==="style"||Kc(e))&&((t||(t={}))[e]=n[e]);return t},iB=(n,t)=>{const e={};for(const i in n)(!Pf(i)||!(i.slice(9)in t))&&(e[i]=n[i]);return e};function sB(n,t,e){const{props:i,children:s,component:r}=n,{props:o,children:a,patchFlag:l}=t,c=r.emitsOptions;if(t.dirs||t.transition)return!0;if(e&&l>=0){if(l&1024)return!0;if(l&16)return i?_p(i,o,c):!!o;if(l&8){const h=t.dynamicProps;for(let u=0;u<h.length;u++){const d=h[u];if(o[d]!==i[d]&&!nh(c,d))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?_p(i,o,c):!0:!!o;return!1}function _p(n,t,e){const i=Object.keys(t);if(i.length!==Object.keys(n).length)return!0;for(let s=0;s<i.length;s++){const r=i[s];if(t[r]!==n[r]&&!nh(e,r))return!0}return!1}function rB({vnode:n,parent:t},e){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===n&&(i.el=n.el),i===n)(n=t.vnode).el=e,t=t.parent;else break}}const aE=n=>n.__isSuspense;function oB(n,t){t&&t.pendingBranch?Yt(n)?t.effects.push(...n):t.effects.push(n):gv(n)}const Ki=Symbol.for("v-fgt"),ih=Symbol.for("v-txt"),va=Symbol.for("v-cmt"),Fh=Symbol.for("v-stc"),aa=[];let On=null;function aB(n=!1){aa.push(On=n?null:[])}function lB(){aa.pop(),On=aa[aa.length-1]||null}let Ba=1;function Ep(n,t=!1){Ba+=n,n<0&&On&&t&&(On.hasOnce=!0)}function cB(n){return n.dynamicChildren=Ba>0?On||Yr:null,lB(),Ba>0&&On&&On.push(n),n}function hB(n,t,e,i,s,r){return cB(Wr(n,t,e,i,s,r,!0))}function lE(n){return n?n.__v_isVNode===!0:!1}function bo(n,t){return n.type===t.type&&n.key===t.key}const cE=({key:n})=>n??null,lc=({ref:n,ref_key:t,ref_for:e})=>(typeof n=="number"&&(n=""+n),n!=null?je(n)||cn(n)||$t(n)?{i:bi,r:n,k:t,f:!!e}:n:null);function Wr(n,t=null,e=null,i=0,s=null,r=n===Ki?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:t,key:t&&cE(t),ref:t&&lc(t),scopeId:G_,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:bi};return a?(Zf(l,e),r&128&&n.normalize(l)):e&&(l.shapeFlag|=je(e)?8:16),Ba>0&&!o&&On&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&On.push(l),l}const rr=uB;function uB(n,t=null,e=null,i=0,s=null,r=!1){if((!n||n===Rv)&&(n=va),lE(n)){const a=so(n,t,!0);return e&&Zf(a,e),Ba>0&&!r&&On&&(a.shapeFlag&6?On[On.indexOf(n)]=a:On.push(a)),a.patchFlag=-2,a}if(xB(n)&&(n=n.__vccOpts),t){t=dB(t);let{class:a,style:l}=t;a&&!je(a)&&(t.class=Of(a)),Oe(l)&&(qf(l)&&!Yt(l)&&(l=$e({},l)),t.style=Nf(l))}const o=je(n)?1:aE(n)?128:Ev(n)?64:Oe(n)?4:$t(n)?2:0;return Wr(n,t,e,i,s,o,r,!0)}function dB(n){return n?qf(n)||X_(n)?$e({},n):n:null}function so(n,t,e=!1,i=!1){const{props:s,ref:r,patchFlag:o,children:a,transition:l}=n,c=t?AB(s||{},t):s,h={__v_isVNode:!0,__v_skip:!0,type:n.type,props:c,key:c&&cE(c),ref:t&&t.ref?e&&r?Yt(r)?r.concat(lc(t)):[r,lc(t)]:lc(t):r,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:t&&n.type!==Ki?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&so(n.ssContent),ssFallback:n.ssFallback&&so(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&i&&Xf(h,l.clone(h)),h}function fB(n=" ",t=0){return rr(ih,null,n,t)}function Ci(n){return n==null||typeof n=="boolean"?rr(va):Yt(n)?rr(Ki,null,n.slice()):lE(n)?xs(n):rr(ih,null,String(n))}function xs(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:so(n)}function Zf(n,t){let e=0;const{shapeFlag:i}=n;if(t==null)t=null;else if(Yt(t))e=16;else if(typeof t=="object")if(i&65){const s=t.default;s&&(s._c&&(s._d=!1),Zf(n,s()),s._c&&(s._d=!0));return}else{e=32;const s=t._;!s&&!X_(t)?t._ctx=bi:s===3&&bi&&(bi.slots._===1?t._=1:(t._=2,n.patchFlag|=1024))}else $t(t)?(t={default:t,_ctx:bi},e=32):(t=String(t),i&64?(e=16,t=[fB(t)]):e=8);n.children=t,n.shapeFlag|=e}function AB(...n){const t={};for(let e=0;e<n.length;e++){const i=n[e];for(const s in i)if(s==="class")t.class!==i.class&&(t.class=Of([t.class,i.class]));else if(s==="style")t.style=Nf([t.style,i.style]);else if(Kc(s)){const r=t[s],o=i[s];o&&r!==o&&!(Yt(r)&&r.includes(o))&&(t[s]=r?[].concat(r,o):o)}else s!==""&&(t[s]=i[s])}return t}function mi(n,t,e,i=null){Li(n,t,7,[e,i])}const pB=J_();let gB=0;function mB(n,t,e){const i=n.type,s=(t?t.appContext:n.appContext)||pB,r={uid:gB++,vnode:n,type:i,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ox(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Y_(i,s),emitsOptions:oE(i,s),emit:null,emitted:null,propsDefaults:ve,inheritAttrs:i.inheritAttrs,ctx:ve,data:ve,props:ve,attrs:ve,slots:ve,refs:ve,setupState:ve,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=eB.bind(null,r),n.ce&&n.ce(r),r}let _n=null,Ic,Bd;{const n=$c(),t=(e,i)=>{let s;return(s=n[e])||(s=n[e]=[]),s.push(i),r=>{s.length>1?s.forEach(o=>o(r)):s[0](r)}};Ic=t("__VUE_INSTANCE_SETTERS__",e=>_n=e),Bd=t("__VUE_SSR_SETTERS__",e=>Ia=e)}const ka=n=>{const t=_n;return Ic(n),n.scope.on(),()=>{n.scope.off(),Ic(t)}},yp=()=>{_n&&_n.scope.off(),Ic(null)};function hE(n){return n.vnode.shapeFlag&4}let Ia=!1;function _B(n,t=!1,e=!1){t&&Bd(t);const{props:i,children:s}=n.vnode,r=hE(n);Hv(n,i,r,t),Wv(n,s,e);const o=r?EB(n,t):void 0;return t&&Bd(!1),o}function EB(n,t){const e=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,Dv);const{setup:i}=e;if(i){Ps();const s=n.setupContext=i.length>1?CB(n):null,r=ka(n),o=Ha(i,n,0,[n.props,s]),a=p_(o);if(Fs(),r(),(a||n.sp)&&!ra(n)&&Q_(n),a){if(o.then(yp,yp),t)return o.then(l=>{Cp(n,l,t)}).catch(l=>{th(l,n,0)});n.asyncDep=o}else Cp(n,o,t)}else uE(n,t)}function Cp(n,t,e){$t(t)?n.type.__ssrInlineRender?n.ssrRender=t:n.render=t:Oe(t)&&(n.setupState=P_(t)),uE(n,e)}let xp;function uE(n,t,e){const i=n.type;if(!n.render){if(!t&&xp&&!i.render){const s=i.template||Kf(n).template;if(s){const{isCustomElement:r,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:l}=i,c=$e($e({isCustomElement:r,delimiters:a},o),l);i.render=xp(s,c)}}n.render=i.render||Ti}{const s=ka(n);Ps();try{Lv(n)}finally{Fs(),s()}}}const yB={get(n,t){return an(n,"get",""),n[t]}};function CB(n){const t=e=>{n.exposed=e||{}};return{attrs:new Proxy(n.attrs,yB),slots:n.slots,emit:n.emit,expose:t}}function $f(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(P_(rv(n.exposed)),{get(t,e){if(e in t)return t[e];if(e in oa)return oa[e](n)},has(t,e){return e in t||e in oa}})):n.proxy}function xB(n){return $t(n)&&"__vccOpts"in n}const vB=(n,t)=>hv(n,t,Ia),BB="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Id;const vp=typeof window<"u"&&window.trustedTypes;if(vp)try{Id=vp.createPolicy("vue",{createHTML:n=>n})}catch{}const dE=Id?n=>Id.createHTML(n):n=>n,IB="http://www.w3.org/2000/svg",bB="http://www.w3.org/1998/Math/MathML",ji=typeof document<"u"?document:null,Bp=ji&&ji.createElement("template"),MB={insert:(n,t,e)=>{t.insertBefore(n,e||null)},remove:n=>{const t=n.parentNode;t&&t.removeChild(n)},createElement:(n,t,e,i)=>{const s=t==="svg"?ji.createElementNS(IB,n):t==="mathml"?ji.createElementNS(bB,n):e?ji.createElement(n,{is:e}):ji.createElement(n);return n==="select"&&i&&i.multiple!=null&&s.setAttribute("multiple",i.multiple),s},createText:n=>ji.createTextNode(n),createComment:n=>ji.createComment(n),setText:(n,t)=>{n.nodeValue=t},setElementText:(n,t)=>{n.textContent=t},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>ji.querySelector(n),setScopeId(n,t){n.setAttribute(t,"")},insertStaticContent(n,t,e,i,s,r){const o=e?e.previousSibling:t.lastChild;if(s&&(s===r||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),e),!(s===r||!(s=s.nextSibling)););else{Bp.innerHTML=dE(i==="svg"?`<svg>${n}</svg>`:i==="mathml"?`<math>${n}</math>`:n);const a=Bp.content;if(i==="svg"||i==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}t.insertBefore(a,e)}return[o?o.nextSibling:t.firstChild,e?e.previousSibling:t.lastChild]}},SB=Symbol("_vtc");function TB(n,t,e){const i=n[SB];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?n.removeAttribute("class"):e?n.setAttribute("class",t):n.className=t}const Ip=Symbol("_vod"),wB=Symbol("_vsh"),RB=Symbol(""),DB=/(^|;)\s*display\s*:/;function LB(n,t,e){const i=n.style,s=je(e);let r=!1;if(e&&!s){if(t)if(je(t))for(const o of t.split(";")){const a=o.slice(0,o.indexOf(":")).trim();e[a]==null&&cc(i,a,"")}else for(const o in t)e[o]==null&&cc(i,o,"");for(const o in e)o==="display"&&(r=!0),cc(i,o,e[o])}else if(s){if(t!==e){const o=i[RB];o&&(e+=";"+o),i.cssText=e,r=DB.test(e)}}else t&&n.removeAttribute("style");Ip in n&&(n[Ip]=r?i.display:"",n[wB]&&(i.display="none"))}const bp=/\s*!important$/;function cc(n,t,e){if(Yt(e))e.forEach(i=>cc(n,t,i));else if(e==null&&(e=""),t.startsWith("--"))n.setProperty(t,e);else{const i=PB(n,t);bp.test(e)?n.setProperty(pr(i),e.replace(bp,""),"important"):n[i]=e}}const Mp=["Webkit","Moz","ms"],Uh={};function PB(n,t){const e=Uh[t];if(e)return e;let i=ws(t);if(i!=="filter"&&i in n)return Uh[t]=i;i=g_(i);for(let s=0;s<Mp.length;s++){const r=Mp[s]+i;if(r in n)return Uh[t]=r}return t}const Sp="http://www.w3.org/1999/xlink";function Tp(n,t,e,i,s,r=Nx(t)){i&&t.startsWith("xlink:")?e==null?n.removeAttributeNS(Sp,t.slice(6,t.length)):n.setAttributeNS(Sp,t,e):e==null||r&&!__(e)?n.removeAttribute(t):n.setAttribute(t,r?"":_o(e)?String(e):e)}function wp(n,t,e,i,s){if(t==="innerHTML"||t==="textContent"){e!=null&&(n[t]=t==="innerHTML"?dE(e):e);return}const r=n.tagName;if(t==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?n.getAttribute("value")||"":n.value,l=e==null?n.type==="checkbox"?"on":"":String(e);(a!==l||!("_value"in n))&&(n.value=l),e==null&&n.removeAttribute(t),n._value=e;return}let o=!1;if(e===""||e==null){const a=typeof n[t];a==="boolean"?e=__(e):e==null&&a==="string"?(e="",o=!0):a==="number"&&(e=0,o=!0)}try{n[t]=e}catch{}o&&n.removeAttribute(s||t)}function FB(n,t,e,i){n.addEventListener(t,e,i)}function UB(n,t,e,i){n.removeEventListener(t,e,i)}const Rp=Symbol("_vei");function NB(n,t,e,i,s=null){const r=n[Rp]||(n[Rp]={}),o=r[t];if(i&&o)o.value=i;else{const[a,l]=OB(t);if(i){const c=r[t]=HB(i,s);FB(n,a,c,l)}else o&&(UB(n,a,o,l),r[t]=void 0)}}const Dp=/(?:Once|Passive|Capture)$/;function OB(n){let t;if(Dp.test(n)){t={};let i;for(;i=n.match(Dp);)n=n.slice(0,n.length-i[0].length),t[i[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):pr(n.slice(2)),t]}let Nh=0;const GB=Promise.resolve(),QB=()=>Nh||(GB.then(()=>Nh=0),Nh=Date.now());function HB(n,t){const e=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=e.attached)return;Li(kB(i,e.value),t,5,[i])};return e.value=n,e.attached=QB(),e}function kB(n,t){if(Yt(t)){const e=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{e.call(n),n._stopped=!0},t.map(i=>s=>!s._stopped&&i&&i(s))}else return t}const Lp=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,VB=(n,t,e,i,s,r)=>{const o=s==="svg";t==="class"?TB(n,i,o):t==="style"?LB(n,e,i):Kc(t)?Pf(t)||NB(n,t,e,i,r):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):zB(n,t,i,o))?(wp(n,t,i),!n.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Tp(n,t,i,o,r,t!=="value")):n._isVueCE&&(/[A-Z]/.test(t)||!je(i))?wp(n,ws(t),i,r,t):(t==="true-value"?n._trueValue=i:t==="false-value"&&(n._falseValue=i),Tp(n,t,i,o))};function zB(n,t,e,i){if(i)return!!(t==="innerHTML"||t==="textContent"||t in n&&Lp(t)&&$t(e));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&n.tagName==="INPUT"||t==="type"&&n.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const s=n.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Lp(t)&&je(e)?!1:t in n}const WB=$e({patchProp:VB},MB);let Pp;function JB(){return Pp||(Pp=qv(WB))}const qB=(...n)=>{const t=JB().createApp(...n),{mount:e}=t;return t.mount=i=>{const s=XB(i);if(!s)return;const r=t._component;!$t(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=e(s,!1,jB(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},t};function jB(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function XB(n){return je(n)?document.querySelector(n):n}const KB="data:image/png;base64,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",YB="/assets/map-C4iiSWLM.png";/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const tA="170",to={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Jr={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},ZB=0,Fp=1,$B=2,fE=1,tI=2,Ji=3,os=0,Mn=1,Un=2,Ms=0,is=1,Up=2,Np=3,Op=4,eI=5,$s=100,nI=101,iI=102,sI=103,rI=104,oI=200,aI=201,lI=202,cI=203,bd=204,Md=205,hI=206,uI=207,dI=208,fI=209,AI=210,pI=211,gI=212,mI=213,_I=214,Sd=0,Td=1,wd=2,ro=3,Rd=4,Dd=5,Ld=6,Pd=7,AE=0,EI=1,yI=2,Ss=0,CI=1,xI=2,vI=3,BI=4,II=5,bI=6,MI=7,Gp="attached",SI="detached",pE=300,ur=301,oo=302,Fd=303,Ud=304,sh=306,Rs=1e3,ts=1001,bc=1002,Ze=1003,gE=1004,Xo=1005,ln=1006,hc=1007,Mi=1008,We=1009,mE=1010,_E=1011,ba=1012,eA=1013,dr=1014,Ke=1015,si=1016,nA=1017,iA=1018,ao=1020,EE=35902,yE=1021,CE=1022,Qe=1023,xE=1024,vE=1025,eo=1026,lo=1027,Bs=1028,sA=1029,er=1030,rA=1031,oA=1033,uc=33776,la=33777,dc=33778,ca=33779,Mc=35840,Nd=35841,Sc=35842,Od=35843,Tc=36196,wc=37492,Rc=37496,Ma=37808,Gd=37809,Qd=37810,Hd=37811,Sa=37812,kd=37813,Vd=37814,zd=37815,Wd=37816,Jd=37817,qd=37818,jd=37819,Xd=37820,Kd=37821,ha=36492,Yd=36494,Dc=36495,BE=36283,Zd=36284,$d=36285,tf=36286,Ta=2300,wa=2301,Oh=2302,Qp=2400,Hp=2401,kp=2402,TI=2500,wI=0,IE=1,ef=2,RI=3200,DI=3201,bE=0,LI=1,vi="",De="srgb",tn="srgb-linear",rh="linear",me="srgb",Cr=7680,Vp=519,PI=512,FI=513,UI=514,ME=515,NI=516,OI=517,GI=518,QI=519,nf=35044,zp="300 es",es=2e3,Lc=2001;class Us{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const s=this._listeners[t];if(s!==void 0){const r=s.indexOf(e);r!==-1&&s.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let r=0,o=s.length;r<o;r++)s[r].call(this,t);t.target=null}}}const sn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Wp=1234567;const or=Math.PI/180,co=180/Math.PI;function ci(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(sn[n&255]+sn[n>>8&255]+sn[n>>16&255]+sn[n>>24&255]+"-"+sn[t&255]+sn[t>>8&255]+"-"+sn[t>>16&15|64]+sn[t>>24&255]+"-"+sn[e&63|128]+sn[e>>8&255]+"-"+sn[e>>16&255]+sn[e>>24&255]+sn[i&255]+sn[i>>8&255]+sn[i>>16&255]+sn[i>>24&255]).toLowerCase()}function Je(n,t,e){return Math.max(t,Math.min(e,n))}function aA(n,t){return(n%t+t)%t}function HI(n,t,e,i,s){return i+(n-t)*(s-i)/(e-t)}function kI(n,t,e){return n!==t?(e-n)/(t-n):0}function ua(n,t,e){return(1-e)*n+e*t}function VI(n,t,e,i){return ua(n,t,1-Math.exp(-e*i))}function zI(n,t=1){return t-Math.abs(aA(n,t*2)-t)}function WI(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*(3-2*n))}function JI(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*n*(n*(n*6-15)+10))}function qI(n,t){return n+Math.floor(Math.random()*(t-n+1))}function jI(n,t){return n+Math.random()*(t-n)}function XI(n){return n*(.5-Math.random())}function KI(n){n!==void 0&&(Wp=n);let t=Wp+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function YI(n){return n*or}function ZI(n){return n*co}function $I(n){return(n&n-1)===0&&n!==0}function tb(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function eb(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function nb(n,t,e,i,s){const r=Math.cos,o=Math.sin,a=r(e/2),l=o(e/2),c=r((t+i)/2),h=o((t+i)/2),u=r((t-i)/2),d=o((t-i)/2),f=r((i-t)/2),p=o((i-t)/2);switch(s){case"XYX":n.set(a*h,l*u,l*d,a*c);break;case"YZY":n.set(l*d,a*h,l*u,a*c);break;case"ZXZ":n.set(l*u,l*d,a*h,a*c);break;case"XZX":n.set(a*h,l*p,l*f,a*c);break;case"YXY":n.set(l*f,a*h,l*p,a*c);break;case"ZYZ":n.set(l*p,l*f,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function ni(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Ae(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const SE={DEG2RAD:or,RAD2DEG:co,generateUUID:ci,clamp:Je,euclideanModulo:aA,mapLinear:HI,inverseLerp:kI,lerp:ua,damp:VI,pingpong:zI,smoothstep:WI,smootherstep:JI,randInt:qI,randFloat:jI,randFloatSpread:XI,seededRandom:KI,degToRad:YI,radToDeg:ZI,isPowerOfTwo:$I,ceilPowerOfTwo:tb,floorPowerOfTwo:eb,setQuaternionFromProperEuler:nb,normalize:Ae,denormalize:ni};class kt{constructor(t=0,e=0){kt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Je(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*s+t.x,this.y=r*s+o*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xt{constructor(t,e,i,s,r,o,a,l,c){Xt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,r,o,a,l,c)}set(t,e,i,s,r,o,a,l,c){const h=this.elements;return h[0]=t,h[1]=s,h[2]=a,h[3]=e,h[4]=r,h[5]=l,h[6]=i,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],h=i[4],u=i[7],d=i[2],f=i[5],p=i[8],m=s[0],g=s[3],A=s[6],C=s[1],E=s[4],_=s[7],T=s[2],M=s[5],S=s[8];return r[0]=o*m+a*C+l*T,r[3]=o*g+a*E+l*M,r[6]=o*A+a*_+l*S,r[1]=c*m+h*C+u*T,r[4]=c*g+h*E+u*M,r[7]=c*A+h*_+u*S,r[2]=d*m+f*C+p*T,r[5]=d*g+f*E+p*M,r[8]=d*A+f*_+p*S,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e*o*h-e*a*c-i*r*h+i*a*l+s*r*c-s*o*l}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=h*o-a*c,d=a*l-h*r,f=c*r-o*l,p=e*u+i*d+s*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=u*m,t[1]=(s*c-h*i)*m,t[2]=(a*i-s*o)*m,t[3]=d*m,t[4]=(h*e-s*l)*m,t[5]=(s*r-a*e)*m,t[6]=f*m,t[7]=(i*l-c*e)*m,t[8]=(o*e-i*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(i*l,i*c,-i*(l*o+c*a)+o+t,-s*c,s*l,-s*(-c*o+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Gh.makeScale(t,e)),this}rotate(t){return this.premultiply(Gh.makeRotation(-t)),this}translate(t,e){return this.premultiply(Gh.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Gh=new Xt;function TE(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function Ra(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function ib(){const n=Ra("canvas");return n.style.display="block",n}const Jp={};function Ko(n){n in Jp||(Jp[n]=!0,console.warn(n))}function sb(n,t,e){return new Promise(function(i,s){function r(){switch(n.clientWaitSync(t,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(r,e);break;default:i()}}setTimeout(r,e)})}function rb(n){const t=n.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function ob(n){const t=n.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const ee={enabled:!0,workingColorSpace:tn,spaces:{},convert:function(n,t,e){return this.enabled===!1||t===e||!t||!e||(this.spaces[t].transfer===me&&(n.r=ss(n.r),n.g=ss(n.g),n.b=ss(n.b)),this.spaces[t].primaries!==this.spaces[e].primaries&&(n.applyMatrix3(this.spaces[t].toXYZ),n.applyMatrix3(this.spaces[e].fromXYZ)),this.spaces[e].transfer===me&&(n.r=no(n.r),n.g=no(n.g),n.b=no(n.b))),n},fromWorkingColorSpace:function(n,t){return this.convert(n,this.workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===vi?rh:this.spaces[n].transfer},getLuminanceCoefficients:function(n,t=this.workingColorSpace){return n.fromArray(this.spaces[t].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,t,e){return n.copy(this.spaces[t].toXYZ).multiply(this.spaces[e].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace}};function ss(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function no(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}const qp=[.64,.33,.3,.6,.15,.06],jp=[.2126,.7152,.0722],Xp=[.3127,.329],Kp=new Xt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Yp=new Xt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ee.define({[tn]:{primaries:qp,whitePoint:Xp,transfer:rh,toXYZ:Kp,fromXYZ:Yp,luminanceCoefficients:jp,workingColorSpaceConfig:{unpackColorSpace:De},outputColorSpaceConfig:{drawingBufferColorSpace:De}},[De]:{primaries:qp,whitePoint:Xp,transfer:me,toXYZ:Kp,fromXYZ:Yp,luminanceCoefficients:jp,outputColorSpaceConfig:{drawingBufferColorSpace:De}}});let xr;class ab{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{xr===void 0&&(xr=Ra("canvas")),xr.width=t.width,xr.height=t.height;const i=xr.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=xr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Ra("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),r=s.data;for(let o=0;o<r.length;o++)r[o]=ss(r[o]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(ss(e[i]/255)*255):e[i]=ss(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let lb=0;class wE{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:lb++}),this.uuid=ci(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let r;if(Array.isArray(s)){r=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?r.push(Qh(s[o].image)):r.push(Qh(s[o]))}else r=Qh(s);i.url=r}return e||(t.images[this.uuid]=i),i}}function Qh(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?ab.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let cb=0;class Fe extends Us{constructor(t=Fe.DEFAULT_IMAGE,e=Fe.DEFAULT_MAPPING,i=ts,s=ts,r=ln,o=Mi,a=Qe,l=We,c=Fe.DEFAULT_ANISOTROPY,h=vi){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:cb++}),this.uuid=ci(),this.name="",this.source=new wE(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new kt(0,0),this.repeat=new kt(1,1),this.center=new kt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==pE)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Rs:t.x=t.x-Math.floor(t.x);break;case ts:t.x=t.x<0?0:1;break;case bc:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Rs:t.y=t.y-Math.floor(t.y);break;case ts:t.y=t.y<0?0:1;break;case bc:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Fe.DEFAULT_IMAGE=null;Fe.DEFAULT_MAPPING=pE;Fe.DEFAULT_ANISOTROPY=1;class oe{constructor(t=0,e=0,i=0,s=1){oe.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*i+o[8]*s+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*s+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*s+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*s+o[15]*r,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,r;const l=t.elements,c=l[0],h=l[4],u=l[8],d=l[1],f=l[5],p=l[9],m=l[2],g=l[6],A=l[10];if(Math.abs(h-d)<.01&&Math.abs(u-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+m)<.1&&Math.abs(p+g)<.1&&Math.abs(c+f+A-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const E=(c+1)/2,_=(f+1)/2,T=(A+1)/2,M=(h+d)/4,S=(u+m)/4,R=(p+g)/4;return E>_&&E>T?E<.01?(i=0,s=.707106781,r=.707106781):(i=Math.sqrt(E),s=M/i,r=S/i):_>T?_<.01?(i=.707106781,s=0,r=.707106781):(s=Math.sqrt(_),i=M/s,r=R/s):T<.01?(i=.707106781,s=.707106781,r=0):(r=Math.sqrt(T),i=S/r,s=R/r),this.set(i,s,r,e),this}let C=Math.sqrt((g-p)*(g-p)+(u-m)*(u-m)+(d-h)*(d-h));return Math.abs(C)<.001&&(C=1),this.x=(g-p)/C,this.y=(u-m)/C,this.z=(d-h)/C,this.w=Math.acos((c+f+A-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class hb extends Us{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new oe(0,0,t,e),this.scissorTest=!1,this.viewport=new oe(0,0,t,e);const s={width:t,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ln,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const r=new Fe(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);r.flipY=!1,r.generateMipmaps=i.generateMipmaps,r.internalFormat=i.internalFormat,this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=r.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let s=0,r=this.textures.length;s<r;s++)this.textures[s].image.width=t,this.textures[s].image.height=e,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let i=0,s=t.textures.length;i<s;i++)this.textures[i]=t.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new wE(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ds extends hb{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class RE extends Fe{constructor(t=null,e=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=Ze,this.minFilter=Ze,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class DE extends Fe{constructor(t=null,e=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=Ze,this.minFilter=Ze,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class hi{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,o,a){let l=i[s+0],c=i[s+1],h=i[s+2],u=i[s+3];const d=r[o+0],f=r[o+1],p=r[o+2],m=r[o+3];if(a===0){t[e+0]=l,t[e+1]=c,t[e+2]=h,t[e+3]=u;return}if(a===1){t[e+0]=d,t[e+1]=f,t[e+2]=p,t[e+3]=m;return}if(u!==m||l!==d||c!==f||h!==p){let g=1-a;const A=l*d+c*f+h*p+u*m,C=A>=0?1:-1,E=1-A*A;if(E>Number.EPSILON){const T=Math.sqrt(E),M=Math.atan2(T,A*C);g=Math.sin(g*M)/T,a=Math.sin(a*M)/T}const _=a*C;if(l=l*g+d*_,c=c*g+f*_,h=h*g+p*_,u=u*g+m*_,g===1-a){const T=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=T,c*=T,h*=T,u*=T}}t[e]=l,t[e+1]=c,t[e+2]=h,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,s,r,o){const a=i[s],l=i[s+1],c=i[s+2],h=i[s+3],u=r[o],d=r[o+1],f=r[o+2],p=r[o+3];return t[e]=a*p+h*u+l*f-c*d,t[e+1]=l*p+h*d+c*u-a*f,t[e+2]=c*p+h*f+a*d-l*u,t[e+3]=h*p-a*u-l*d-c*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,r=t._z,o=t._order,a=Math.cos,l=Math.sin,c=a(i/2),h=a(s/2),u=a(r/2),d=l(i/2),f=l(s/2),p=l(r/2);switch(o){case"XYZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"YXZ":this._x=d*h*u+c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"ZXY":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u-d*f*p;break;case"ZYX":this._x=d*h*u-c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u+d*f*p;break;case"YZX":this._x=d*h*u+c*f*p,this._y=c*f*u+d*h*p,this._z=c*h*p-d*f*u,this._w=c*h*u-d*f*p;break;case"XZY":this._x=d*h*u-c*f*p,this._y=c*f*u-d*h*p,this._z=c*h*p+d*f*u,this._w=c*h*u+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],u=e[10],d=i+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(h-l)*f,this._y=(r-c)*f,this._z=(o-s)*f}else if(i>a&&i>u){const f=2*Math.sqrt(1+i-a-u);this._w=(h-l)/f,this._x=.25*f,this._y=(s+o)/f,this._z=(r+c)/f}else if(a>u){const f=2*Math.sqrt(1+a-i-u);this._w=(r-c)/f,this._x=(s+o)/f,this._y=.25*f,this._z=(l+h)/f}else{const f=2*Math.sqrt(1+u-i-a);this._w=(o-s)/f,this._x=(r+c)/f,this._y=(l+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Je(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,o=t._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=i*h+o*a+s*c-r*l,this._y=s*h+o*l+r*a-i*c,this._z=r*h+o*c+i*l-s*a,this._w=o*h-i*a-s*l-r*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,r=this._z,o=this._w;let a=o*t._w+i*t._x+s*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=i,this._y=s,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*i+e*this._x,this._y=f*s+e*this._y,this._z=f*r+e*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-e)*h)/c,d=Math.sin(e*h)/c;return this._w=o*u+this._w*d,this._x=i*u+this._x*d,this._y=s*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),r=Math.sqrt(i);return this.set(s*Math.sin(t),s*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class L{constructor(t=0,e=0,i=0){L.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Zp.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Zp.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,o=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*o,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*o,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*o,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,o=t.y,a=t.z,l=t.w,c=2*(o*s-a*i),h=2*(a*e-r*s),u=2*(r*i-o*e);return this.x=e+l*c+o*u-a*h,this.y=i+l*h+a*c-r*u,this.z=s+l*u+r*h-o*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,o=e.x,a=e.y,l=e.z;return this.x=s*l-r*a,this.y=r*o-i*l,this.z=i*a-s*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Hh.copy(this).projectOnVector(t),this.sub(Hh)}reflect(t){return this.sub(Hh.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Je(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Hh=new L,Zp=new hi;class ui{constructor(t=new L(1/0,1/0,1/0),e=new L(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Yn.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Yn.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Yn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const r=i.getAttribute("position");if(e===!0&&r!==void 0&&t.isInstancedMesh!==!0)for(let o=0,a=r.count;o<a;o++)t.isMesh===!0?t.getVertexPosition(o,Yn):Yn.fromBufferAttribute(r,o),Yn.applyMatrix4(t.matrixWorld),this.expandByPoint(Yn);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),rl.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),rl.copy(i.boundingBox)),rl.applyMatrix4(t.matrixWorld),this.union(rl)}const s=t.children;for(let r=0,o=s.length;r<o;r++)this.expandByObject(s[r],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Yn),Yn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Mo),ol.subVectors(this.max,Mo),vr.subVectors(t.a,Mo),Br.subVectors(t.b,Mo),Ir.subVectors(t.c,Mo),us.subVectors(Br,vr),ds.subVectors(Ir,Br),Hs.subVectors(vr,Ir);let e=[0,-us.z,us.y,0,-ds.z,ds.y,0,-Hs.z,Hs.y,us.z,0,-us.x,ds.z,0,-ds.x,Hs.z,0,-Hs.x,-us.y,us.x,0,-ds.y,ds.x,0,-Hs.y,Hs.x,0];return!kh(e,vr,Br,Ir,ol)||(e=[1,0,0,0,1,0,0,0,1],!kh(e,vr,Br,Ir,ol))?!1:(al.crossVectors(us,ds),e=[al.x,al.y,al.z],kh(e,vr,Br,Ir,ol))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Yn).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Yn).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Gi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Gi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Gi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Gi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Gi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Gi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Gi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Gi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Gi),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Gi=[new L,new L,new L,new L,new L,new L,new L,new L],Yn=new L,rl=new ui,vr=new L,Br=new L,Ir=new L,us=new L,ds=new L,Hs=new L,Mo=new L,ol=new L,al=new L,ks=new L;function kh(n,t,e,i,s){for(let r=0,o=n.length-3;r<=o;r+=3){ks.fromArray(n,r);const a=s.x*Math.abs(ks.x)+s.y*Math.abs(ks.y)+s.z*Math.abs(ks.z),l=t.dot(ks),c=e.dot(ks),h=i.dot(ks);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const ub=new ui,So=new L,Vh=new L;class Ai{constructor(t=new L,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):ub.setFromPoints(t).getCenter(i);let s=0;for(let r=0,o=t.length;r<o;r++)s=Math.max(s,i.distanceToSquared(t[r]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;So.subVectors(t,this.center);const e=So.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(So,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Vh.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(So.copy(t.center).add(Vh)),this.expandByPoint(So.copy(t.center).sub(Vh))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Qi=new L,zh=new L,ll=new L,fs=new L,Wh=new L,cl=new L,Jh=new L;class Va{constructor(t=new L,e=new L(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Qi)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Qi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Qi.copy(this.origin).addScaledVector(this.direction,e),Qi.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){zh.copy(t).add(e).multiplyScalar(.5),ll.copy(e).sub(t).normalize(),fs.copy(this.origin).sub(zh);const r=t.distanceTo(e)*.5,o=-this.direction.dot(ll),a=fs.dot(this.direction),l=-fs.dot(ll),c=fs.lengthSq(),h=Math.abs(1-o*o);let u,d,f,p;if(h>0)if(u=o*l-a,d=o*a-l,p=r*h,u>=0)if(d>=-p)if(d<=p){const m=1/h;u*=m,d*=m,f=u*(u+o*d+2*a)+d*(o*u+d+2*l)+c}else d=r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d=-r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;else d<=-p?(u=Math.max(0,-(-o*r+a)),d=u>0?-r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+c):d<=p?(u=0,d=Math.min(Math.max(-r,-l),r),f=d*(d+2*l)+c):(u=Math.max(0,-(o*r+a)),d=u>0?r:Math.min(Math.max(-r,-l),r),f=-u*u+d*(d+2*l)+c);else d=o>0?-r:r,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(zh).addScaledVector(ll,d),f}intersectSphere(t,e){Qi.subVectors(t.center,this.origin);const i=Qi.dot(this.direction),s=Qi.dot(Qi)-i*i,r=t.radius*t.radius;if(s>r)return null;const o=Math.sqrt(r-s),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(i=(t.min.x-d.x)*c,s=(t.max.x-d.x)*c):(i=(t.max.x-d.x)*c,s=(t.min.x-d.x)*c),h>=0?(r=(t.min.y-d.y)*h,o=(t.max.y-d.y)*h):(r=(t.max.y-d.y)*h,o=(t.min.y-d.y)*h),i>o||r>s||((r>i||isNaN(i))&&(i=r),(o<s||isNaN(s))&&(s=o),u>=0?(a=(t.min.z-d.z)*u,l=(t.max.z-d.z)*u):(a=(t.max.z-d.z)*u,l=(t.min.z-d.z)*u),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,Qi)!==null}intersectTriangle(t,e,i,s,r){Wh.subVectors(e,t),cl.subVectors(i,t),Jh.crossVectors(Wh,cl);let o=this.direction.dot(Jh),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;fs.subVectors(this.origin,t);const l=a*this.direction.dot(cl.crossVectors(fs,cl));if(l<0)return null;const c=a*this.direction.dot(Wh.cross(fs));if(c<0||l+c>o)return null;const h=-a*fs.dot(Jh);return h<0?null:this.at(h/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class wt{constructor(t,e,i,s,r,o,a,l,c,h,u,d,f,p,m,g){wt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,r,o,a,l,c,h,u,d,f,p,m,g)}set(t,e,i,s,r,o,a,l,c,h,u,d,f,p,m,g){const A=this.elements;return A[0]=t,A[4]=e,A[8]=i,A[12]=s,A[1]=r,A[5]=o,A[9]=a,A[13]=l,A[2]=c,A[6]=h,A[10]=u,A[14]=d,A[3]=f,A[7]=p,A[11]=m,A[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new wt().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/br.setFromMatrixColumn(t,0).length(),r=1/br.setFromMatrixColumn(t,1).length(),o=1/br.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*o,e[9]=i[9]*o,e[10]=i[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,r=t.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(s),c=Math.sin(s),h=Math.cos(r),u=Math.sin(r);if(t.order==="XYZ"){const d=o*h,f=o*u,p=a*h,m=a*u;e[0]=l*h,e[4]=-l*u,e[8]=c,e[1]=f+p*c,e[5]=d-m*c,e[9]=-a*l,e[2]=m-d*c,e[6]=p+f*c,e[10]=o*l}else if(t.order==="YXZ"){const d=l*h,f=l*u,p=c*h,m=c*u;e[0]=d+m*a,e[4]=p*a-f,e[8]=o*c,e[1]=o*u,e[5]=o*h,e[9]=-a,e[2]=f*a-p,e[6]=m+d*a,e[10]=o*l}else if(t.order==="ZXY"){const d=l*h,f=l*u,p=c*h,m=c*u;e[0]=d-m*a,e[4]=-o*u,e[8]=p+f*a,e[1]=f+p*a,e[5]=o*h,e[9]=m-d*a,e[2]=-o*c,e[6]=a,e[10]=o*l}else if(t.order==="ZYX"){const d=o*h,f=o*u,p=a*h,m=a*u;e[0]=l*h,e[4]=p*c-f,e[8]=d*c+m,e[1]=l*u,e[5]=m*c+d,e[9]=f*c-p,e[2]=-c,e[6]=a*l,e[10]=o*l}else if(t.order==="YZX"){const d=o*l,f=o*c,p=a*l,m=a*c;e[0]=l*h,e[4]=m-d*u,e[8]=p*u+f,e[1]=u,e[5]=o*h,e[9]=-a*h,e[2]=-c*h,e[6]=f*u+p,e[10]=d-m*u}else if(t.order==="XZY"){const d=o*l,f=o*c,p=a*l,m=a*c;e[0]=l*h,e[4]=-u,e[8]=c*h,e[1]=d*u+m,e[5]=o*h,e[9]=f*u-p,e[2]=p*u-f,e[6]=a*h,e[10]=m*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(db,t,fb)}lookAt(t,e,i){const s=this.elements;return Tn.subVectors(t,e),Tn.lengthSq()===0&&(Tn.z=1),Tn.normalize(),As.crossVectors(i,Tn),As.lengthSq()===0&&(Math.abs(i.z)===1?Tn.x+=1e-4:Tn.z+=1e-4,Tn.normalize(),As.crossVectors(i,Tn)),As.normalize(),hl.crossVectors(Tn,As),s[0]=As.x,s[4]=hl.x,s[8]=Tn.x,s[1]=As.y,s[5]=hl.y,s[9]=Tn.y,s[2]=As.z,s[6]=hl.z,s[10]=Tn.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],h=i[1],u=i[5],d=i[9],f=i[13],p=i[2],m=i[6],g=i[10],A=i[14],C=i[3],E=i[7],_=i[11],T=i[15],M=s[0],S=s[4],R=s[8],B=s[12],x=s[1],D=s[5],V=s[9],Q=s[13],k=s[2],et=s[6],j=s[10],X=s[14],U=s[3],ut=s[7],gt=s[11],Et=s[15];return r[0]=o*M+a*x+l*k+c*U,r[4]=o*S+a*D+l*et+c*ut,r[8]=o*R+a*V+l*j+c*gt,r[12]=o*B+a*Q+l*X+c*Et,r[1]=h*M+u*x+d*k+f*U,r[5]=h*S+u*D+d*et+f*ut,r[9]=h*R+u*V+d*j+f*gt,r[13]=h*B+u*Q+d*X+f*Et,r[2]=p*M+m*x+g*k+A*U,r[6]=p*S+m*D+g*et+A*ut,r[10]=p*R+m*V+g*j+A*gt,r[14]=p*B+m*Q+g*X+A*Et,r[3]=C*M+E*x+_*k+T*U,r[7]=C*S+E*D+_*et+T*ut,r[11]=C*R+E*V+_*j+T*gt,r[15]=C*B+E*Q+_*X+T*Et,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],o=t[1],a=t[5],l=t[9],c=t[13],h=t[2],u=t[6],d=t[10],f=t[14],p=t[3],m=t[7],g=t[11],A=t[15];return p*(+r*l*u-s*c*u-r*a*d+i*c*d+s*a*f-i*l*f)+m*(+e*l*f-e*c*d+r*o*d-s*o*f+s*c*h-r*l*h)+g*(+e*c*u-e*a*f-r*o*u+i*o*f+r*a*h-i*c*h)+A*(-s*a*h-e*l*u+e*a*d+s*o*u-i*o*d+i*l*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],A=t[15],C=u*g*c-m*d*c+m*l*f-a*g*f-u*l*A+a*d*A,E=p*d*c-h*g*c-p*l*f+o*g*f+h*l*A-o*d*A,_=h*m*c-p*u*c+p*a*f-o*m*f-h*a*A+o*u*A,T=p*u*l-h*m*l-p*a*d+o*m*d+h*a*g-o*u*g,M=e*C+i*E+s*_+r*T;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/M;return t[0]=C*S,t[1]=(m*d*r-u*g*r-m*s*f+i*g*f+u*s*A-i*d*A)*S,t[2]=(a*g*r-m*l*r+m*s*c-i*g*c-a*s*A+i*l*A)*S,t[3]=(u*l*r-a*d*r-u*s*c+i*d*c+a*s*f-i*l*f)*S,t[4]=E*S,t[5]=(h*g*r-p*d*r+p*s*f-e*g*f-h*s*A+e*d*A)*S,t[6]=(p*l*r-o*g*r-p*s*c+e*g*c+o*s*A-e*l*A)*S,t[7]=(o*d*r-h*l*r+h*s*c-e*d*c-o*s*f+e*l*f)*S,t[8]=_*S,t[9]=(p*u*r-h*m*r-p*i*f+e*m*f+h*i*A-e*u*A)*S,t[10]=(o*m*r-p*a*r+p*i*c-e*m*c-o*i*A+e*a*A)*S,t[11]=(h*a*r-o*u*r-h*i*c+e*u*c+o*i*f-e*a*f)*S,t[12]=T*S,t[13]=(h*m*s-p*u*s+p*i*d-e*m*d-h*i*g+e*u*g)*S,t[14]=(p*a*s-o*m*s-p*i*l+e*m*l+o*i*g-e*a*g)*S,t[15]=(o*u*s-h*a*s+h*i*l-e*u*l-o*i*d+e*a*d)*S,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,o=t.x,a=t.y,l=t.z,c=r*o,h=r*a;return this.set(c*o+i,c*a-s*l,c*l+s*a,0,c*a+s*l,h*a+i,h*l-s*o,0,c*l-s*a,h*l+s*o,r*l*l+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,o){return this.set(1,i,r,0,t,1,o,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,o=e._y,a=e._z,l=e._w,c=r+r,h=o+o,u=a+a,d=r*c,f=r*h,p=r*u,m=o*h,g=o*u,A=a*u,C=l*c,E=l*h,_=l*u,T=i.x,M=i.y,S=i.z;return s[0]=(1-(m+A))*T,s[1]=(f+_)*T,s[2]=(p-E)*T,s[3]=0,s[4]=(f-_)*M,s[5]=(1-(d+A))*M,s[6]=(g+C)*M,s[7]=0,s[8]=(p+E)*S,s[9]=(g-C)*S,s[10]=(1-(d+m))*S,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=br.set(s[0],s[1],s[2]).length();const o=br.set(s[4],s[5],s[6]).length(),a=br.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],Zn.copy(this);const c=1/r,h=1/o,u=1/a;return Zn.elements[0]*=c,Zn.elements[1]*=c,Zn.elements[2]*=c,Zn.elements[4]*=h,Zn.elements[5]*=h,Zn.elements[6]*=h,Zn.elements[8]*=u,Zn.elements[9]*=u,Zn.elements[10]*=u,e.setFromRotationMatrix(Zn),i.x=r,i.y=o,i.z=a,this}makePerspective(t,e,i,s,r,o,a=es){const l=this.elements,c=2*r/(e-t),h=2*r/(i-s),u=(e+t)/(e-t),d=(i+s)/(i-s);let f,p;if(a===es)f=-(o+r)/(o-r),p=-2*o*r/(o-r);else if(a===Lc)f=-o/(o-r),p=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,i,s,r,o,a=es){const l=this.elements,c=1/(e-t),h=1/(i-s),u=1/(o-r),d=(e+t)*c,f=(i+s)*h;let p,m;if(a===es)p=(o+r)*u,m=-2*u;else if(a===Lc)p=r*u,m=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=m,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const br=new L,Zn=new wt,db=new L(0,0,0),fb=new L(1,1,1),As=new L,hl=new L,Tn=new L,$p=new wt,tg=new hi;class Hn{constructor(t=0,e=0,i=0,s=Hn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],f=s[10];switch(e){case"XYZ":this._y=Math.asin(Je(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Je(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(Je(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-Je(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Je(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Je(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return $p.makeRotationFromQuaternion(t),this.setFromRotationMatrix($p,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return tg.setFromEuler(this),this.setFromQuaternion(tg,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Hn.DEFAULT_ORDER="XYZ";class lA{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Ab=0;const eg=new L,Mr=new hi,Hi=new wt,ul=new L,To=new L,pb=new L,gb=new hi,ng=new L(1,0,0),ig=new L(0,1,0),sg=new L(0,0,1),rg={type:"added"},mb={type:"removed"},Sr={type:"childadded",child:null},qh={type:"childremoved",child:null};class Me extends Us{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Ab++}),this.uuid=ci(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Me.DEFAULT_UP.clone();const t=new L,e=new Hn,i=new hi,s=new L(1,1,1);function r(){i.setFromEuler(e,!1)}function o(){e.setFromQuaternion(i,void 0,!1)}e._onChange(r),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new wt},normalMatrix:{value:new Xt}}),this.matrix=new wt,this.matrixWorld=new wt,this.matrixAutoUpdate=Me.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Me.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new lA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Mr.setFromAxisAngle(t,e),this.quaternion.multiply(Mr),this}rotateOnWorldAxis(t,e){return Mr.setFromAxisAngle(t,e),this.quaternion.premultiply(Mr),this}rotateX(t){return this.rotateOnAxis(ng,t)}rotateY(t){return this.rotateOnAxis(ig,t)}rotateZ(t){return this.rotateOnAxis(sg,t)}translateOnAxis(t,e){return eg.copy(t).applyQuaternion(this.quaternion),this.position.add(eg.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ng,t)}translateY(t){return this.translateOnAxis(ig,t)}translateZ(t){return this.translateOnAxis(sg,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Hi.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ul.copy(t):ul.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),To.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Hi.lookAt(To,ul,this.up):Hi.lookAt(ul,To,this.up),this.quaternion.setFromRotationMatrix(Hi),s&&(Hi.extractRotation(s.matrixWorld),Mr.setFromRotationMatrix(Hi),this.quaternion.premultiply(Mr.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(rg),Sr.child=t,this.dispatchEvent(Sr),Sr.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(mb),qh.child=t,this.dispatchEvent(qh),qh.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Hi.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Hi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Hi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(rg),Sr.child=t,this.dispatchEvent(Sr),Sr.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectByProperty(t,e);if(o!==void 0)return o}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(To,t,pb),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(To,gb,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let r=0,o=s.length;r<o;r++)s[r].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];r(t.shapes,u)}else r(t.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(t.materials,this.material[l]));s.material=a}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(r(t.animations,l))}}if(e){const a=o(t.geometries),l=o(t.materials),c=o(t.textures),h=o(t.images),u=o(t.shapes),d=o(t.skeletons),f=o(t.animations),p=o(t.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),h.length>0&&(i.images=h),u.length>0&&(i.shapes=u),d.length>0&&(i.skeletons=d),f.length>0&&(i.animations=f),p.length>0&&(i.nodes=p)}return i.object=s,i;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}Me.DEFAULT_UP=new L(0,1,0);Me.DEFAULT_MATRIX_AUTO_UPDATE=!0;Me.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $n=new L,ki=new L,jh=new L,Vi=new L,Tr=new L,wr=new L,og=new L,Xh=new L,Kh=new L,Yh=new L,Zh=new oe,$h=new oe,tu=new oe;class Nn{constructor(t=new L,e=new L,i=new L){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),$n.subVectors(t,e),s.cross($n);const r=s.lengthSq();return r>0?s.multiplyScalar(1/Math.sqrt(r)):s.set(0,0,0)}static getBarycoord(t,e,i,s,r){$n.subVectors(s,e),ki.subVectors(i,e),jh.subVectors(t,e);const o=$n.dot($n),a=$n.dot(ki),l=$n.dot(jh),c=ki.dot(ki),h=ki.dot(jh),u=o*c-a*a;if(u===0)return r.set(0,0,0),null;const d=1/u,f=(c*l-a*h)*d,p=(o*h-a*l)*d;return r.set(1-f-p,p,f)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,Vi)===null?!1:Vi.x>=0&&Vi.y>=0&&Vi.x+Vi.y<=1}static getInterpolation(t,e,i,s,r,o,a,l){return this.getBarycoord(t,e,i,s,Vi)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(r,Vi.x),l.addScaledVector(o,Vi.y),l.addScaledVector(a,Vi.z),l)}static getInterpolatedAttribute(t,e,i,s,r,o){return Zh.setScalar(0),$h.setScalar(0),tu.setScalar(0),Zh.fromBufferAttribute(t,e),$h.fromBufferAttribute(t,i),tu.fromBufferAttribute(t,s),o.setScalar(0),o.addScaledVector(Zh,r.x),o.addScaledVector($h,r.y),o.addScaledVector(tu,r.z),o}static isFrontFacing(t,e,i,s){return $n.subVectors(i,e),ki.subVectors(t,e),$n.cross(ki).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return $n.subVectors(this.c,this.b),ki.subVectors(this.a,this.b),$n.cross(ki).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Nn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Nn.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,r){return Nn.getInterpolation(t,this.a,this.b,this.c,e,i,s,r)}containsPoint(t){return Nn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Nn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,r=this.c;let o,a;Tr.subVectors(s,i),wr.subVectors(r,i),Xh.subVectors(t,i);const l=Tr.dot(Xh),c=wr.dot(Xh);if(l<=0&&c<=0)return e.copy(i);Kh.subVectors(t,s);const h=Tr.dot(Kh),u=wr.dot(Kh);if(h>=0&&u<=h)return e.copy(s);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),e.copy(i).addScaledVector(Tr,o);Yh.subVectors(t,r);const f=Tr.dot(Yh),p=wr.dot(Yh);if(p>=0&&f<=p)return e.copy(r);const m=f*c-l*p;if(m<=0&&c>=0&&p<=0)return a=c/(c-p),e.copy(i).addScaledVector(wr,a);const g=h*p-f*u;if(g<=0&&u-h>=0&&f-p>=0)return og.subVectors(r,s),a=(u-h)/(u-h+(f-p)),e.copy(s).addScaledVector(og,a);const A=1/(g+m+d);return o=m*A,a=d*A,e.copy(i).addScaledVector(Tr,o).addScaledVector(wr,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const LE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ps={h:0,s:0,l:0},dl={h:0,s:0,l:0};function eu(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}class tt{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=De){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ee.toWorkingColorSpace(this,e),this}setRGB(t,e,i,s=ee.workingColorSpace){return this.r=t,this.g=e,this.b=i,ee.toWorkingColorSpace(this,s),this}setHSL(t,e,i,s=ee.workingColorSpace){if(t=aA(t,1),e=Je(e,0,1),i=Je(i,0,1),e===0)this.r=this.g=this.b=i;else{const r=i<=.5?i*(1+e):i+e-i*e,o=2*i-r;this.r=eu(o,r,t+1/3),this.g=eu(o,r,t),this.b=eu(o,r,t-1/3)}return ee.toWorkingColorSpace(this,s),this}setStyle(t,e=De){function i(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=s[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=De){const i=LE[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ss(t.r),this.g=ss(t.g),this.b=ss(t.b),this}copyLinearToSRGB(t){return this.r=no(t.r),this.g=no(t.g),this.b=no(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=De){return ee.fromWorkingColorSpace(rn.copy(this),t),Math.round(Je(rn.r*255,0,255))*65536+Math.round(Je(rn.g*255,0,255))*256+Math.round(Je(rn.b*255,0,255))}getHexString(t=De){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ee.workingColorSpace){ee.fromWorkingColorSpace(rn.copy(this),e);const i=rn.r,s=rn.g,r=rn.b,o=Math.max(i,s,r),a=Math.min(i,s,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case i:l=(s-r)/u+(s<r?6:0);break;case s:l=(r-i)/u+2;break;case r:l=(i-s)/u+4;break}l/=6}return t.h=l,t.s=c,t.l=h,t}getRGB(t,e=ee.workingColorSpace){return ee.fromWorkingColorSpace(rn.copy(this),e),t.r=rn.r,t.g=rn.g,t.b=rn.b,t}getStyle(t=De){ee.fromWorkingColorSpace(rn.copy(this),t);const e=rn.r,i=rn.g,s=rn.b;return t!==De?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(ps),this.setHSL(ps.h+t,ps.s+e,ps.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(ps),t.getHSL(dl);const i=ua(ps.h,dl.h,e),s=ua(ps.s,dl.s,e),r=ua(ps.l,dl.l,e);return this.setHSL(i,s,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,r=t.elements;return this.r=r[0]*e+r[3]*i+r[6]*s,this.g=r[1]*e+r[4]*i+r[7]*s,this.b=r[2]*e+r[5]*i+r[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const rn=new tt;tt.NAMES=LE;let _b=0;class wi extends Us{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_b++}),this.uuid=ci(),this.name="",this.blending=is,this.side=os,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=bd,this.blendDst=Md,this.blendEquation=$s,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new tt(0,0,0),this.blendAlpha=0,this.depthFunc=ro,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Vp,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Cr,this.stencilZFail=Cr,this.stencilZPass=Cr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==is&&(i.blending=this.blending),this.side!==os&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==bd&&(i.blendSrc=this.blendSrc),this.blendDst!==Md&&(i.blendDst=this.blendDst),this.blendEquation!==$s&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==ro&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Vp&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Cr&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Cr&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Cr&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(e){const r=s(t.textures),o=s(t.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let r=0;r!==s;++r)i[r]=e[r].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Gn extends wi{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new tt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hn,this.combine=AE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Le=new L,fl=new kt;class Ue{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=nf,this.updateRanges=[],this.gpuType=Ke,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,r=this.itemSize;s<r;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)fl.fromBufferAttribute(this,e),fl.applyMatrix3(t),this.setXY(e,fl.x,fl.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Le.fromBufferAttribute(this,e),Le.applyMatrix3(t),this.setXYZ(e,Le.x,Le.y,Le.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Le.fromBufferAttribute(this,e),Le.applyMatrix4(t),this.setXYZ(e,Le.x,Le.y,Le.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Le.fromBufferAttribute(this,e),Le.applyNormalMatrix(t),this.setXYZ(e,Le.x,Le.y,Le.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Le.fromBufferAttribute(this,e),Le.transformDirection(t),this.setXYZ(e,Le.x,Le.y,Le.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=ni(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=Ae(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=ni(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=ni(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=ni(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=ni(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),i=Ae(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),i=Ae(i,this.array),s=Ae(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),i=Ae(i,this.array),s=Ae(s,this.array),r=Ae(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==nf&&(t.usage=this.usage),t}}class ag extends Ue{constructor(t,e,i){super(new Uint8Array(t),e,i)}}class PE extends Ue{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class FE extends Ue{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ne extends Ue{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Eb=0;const Vn=new wt,nu=new Me,Rr=new L,wn=new ui,wo=new ui,ze=new L;class en extends Us{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Eb++}),this.uuid=ci(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(TE(t)?FE:PE)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const r=new Xt().getNormalMatrix(t);i.applyNormalMatrix(r),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Vn.makeRotationFromQuaternion(t),this.applyMatrix4(Vn),this}rotateX(t){return Vn.makeRotationX(t),this.applyMatrix4(Vn),this}rotateY(t){return Vn.makeRotationY(t),this.applyMatrix4(Vn),this}rotateZ(t){return Vn.makeRotationZ(t),this.applyMatrix4(Vn),this}translate(t,e,i){return Vn.makeTranslation(t,e,i),this.applyMatrix4(Vn),this}scale(t,e,i){return Vn.makeScale(t,e,i),this.applyMatrix4(Vn),this}lookAt(t){return nu.lookAt(t),nu.updateMatrix(),this.applyMatrix4(nu.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Rr).negate(),this.translate(Rr.x,Rr.y,Rr.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const i=[];for(let s=0,r=t.length;s<r;s++){const o=t[s];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Ne(i,3))}else{for(let i=0,s=e.count;i<s;i++){const r=t[i];e.setXYZ(i,r.x,r.y,r.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ui);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new L(-1/0,-1/0,-1/0),new L(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const r=e[i];wn.setFromBufferAttribute(r),this.morphTargetsRelative?(ze.addVectors(this.boundingBox.min,wn.min),this.boundingBox.expandByPoint(ze),ze.addVectors(this.boundingBox.max,wn.max),this.boundingBox.expandByPoint(ze)):(this.boundingBox.expandByPoint(wn.min),this.boundingBox.expandByPoint(wn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ai);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new L,1/0);return}if(t){const i=this.boundingSphere.center;if(wn.setFromBufferAttribute(t),e)for(let r=0,o=e.length;r<o;r++){const a=e[r];wo.setFromBufferAttribute(a),this.morphTargetsRelative?(ze.addVectors(wn.min,wo.min),wn.expandByPoint(ze),ze.addVectors(wn.max,wo.max),wn.expandByPoint(ze)):(wn.expandByPoint(wo.min),wn.expandByPoint(wo.max))}wn.getCenter(i);let s=0;for(let r=0,o=t.count;r<o;r++)ze.fromBufferAttribute(t,r),s=Math.max(s,i.distanceToSquared(ze));if(e)for(let r=0,o=e.length;r<o;r++){const a=e[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)ze.fromBufferAttribute(a,c),l&&(Rr.fromBufferAttribute(t,c),ze.add(Rr)),s=Math.max(s,i.distanceToSquared(ze))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.position,s=e.normal,r=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ue(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let R=0;R<i.count;R++)a[R]=new L,l[R]=new L;const c=new L,h=new L,u=new L,d=new kt,f=new kt,p=new kt,m=new L,g=new L;function A(R,B,x){c.fromBufferAttribute(i,R),h.fromBufferAttribute(i,B),u.fromBufferAttribute(i,x),d.fromBufferAttribute(r,R),f.fromBufferAttribute(r,B),p.fromBufferAttribute(r,x),h.sub(c),u.sub(c),f.sub(d),p.sub(d);const D=1/(f.x*p.y-p.x*f.y);isFinite(D)&&(m.copy(h).multiplyScalar(p.y).addScaledVector(u,-f.y).multiplyScalar(D),g.copy(u).multiplyScalar(f.x).addScaledVector(h,-p.x).multiplyScalar(D),a[R].add(m),a[B].add(m),a[x].add(m),l[R].add(g),l[B].add(g),l[x].add(g))}let C=this.groups;C.length===0&&(C=[{start:0,count:t.count}]);for(let R=0,B=C.length;R<B;++R){const x=C[R],D=x.start,V=x.count;for(let Q=D,k=D+V;Q<k;Q+=3)A(t.getX(Q+0),t.getX(Q+1),t.getX(Q+2))}const E=new L,_=new L,T=new L,M=new L;function S(R){T.fromBufferAttribute(s,R),M.copy(T);const B=a[R];E.copy(B),E.sub(T.multiplyScalar(T.dot(B))).normalize(),_.crossVectors(M,B);const D=_.dot(l[R])<0?-1:1;o.setXYZW(R,E.x,E.y,E.z,D)}for(let R=0,B=C.length;R<B;++R){const x=C[R],D=x.start,V=x.count;for(let Q=D,k=D+V;Q<k;Q+=3)S(t.getX(Q+0)),S(t.getX(Q+1)),S(t.getX(Q+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ue(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const s=new L,r=new L,o=new L,a=new L,l=new L,c=new L,h=new L,u=new L;if(t)for(let d=0,f=t.count;d<f;d+=3){const p=t.getX(d+0),m=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),o.fromBufferAttribute(e,g),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),c.fromBufferAttribute(i,g),a.add(h),l.add(h),c.add(h),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z),i.setXYZ(g,c.x,c.y,c.z)}else for(let d=0,f=e.count;d<f;d+=3)s.fromBufferAttribute(e,d+0),r.fromBufferAttribute(e,d+1),o.fromBufferAttribute(e,d+2),h.subVectors(o,r),u.subVectors(s,r),h.cross(u),i.setXYZ(d+0,h.x,h.y,h.z),i.setXYZ(d+1,h.x,h.y,h.z),i.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)ze.fromBufferAttribute(t,e),ze.normalize(),t.setXYZ(e,ze.x,ze.y,ze.z)}toNonIndexed(){function t(a,l){const c=a.array,h=a.itemSize,u=a.normalized,d=new c.constructor(l.length*h);let f=0,p=0;for(let m=0,g=l.length;m<g;m++){a.isInterleavedBufferAttribute?f=l[m]*a.data.stride+a.offset:f=l[m]*h;for(let A=0;A<h;A++)d[p++]=c[f++]}return new Ue(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new en,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],c=t(l,i);e.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,u=c.length;h<u;h++){const d=c[h],f=t(d,i);l.push(f)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];e.addGroup(c.start,c.count,c.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const l in i){const c=i[l];t.data.attributes[l]=c.toJSON(t.data)}const s={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const f=c[u];h.push(f.toJSON(t.data))}h.length>0&&(s[l]=h,r=!0)}r&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const s=t.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(e))}const r=t.morphAttributes;for(const c in r){const h=[],u=r[c];for(let d=0,f=u.length;d<f;d++)h.push(u[d].clone(e));this.morphAttributes[c]=h}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const lg=new wt,Vs=new Va,Al=new Ai,cg=new L,pl=new L,gl=new L,ml=new L,iu=new L,_l=new L,hg=new L,El=new L;class Ye extends Me{constructor(t=new en,e=new Gn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,r=i.morphAttributes.position,o=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const a=this.morphTargetInfluences;if(r&&a){_l.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],u=r[l];h!==0&&(iu.fromBufferAttribute(u,t),o?_l.addScaledVector(iu,h):_l.addScaledVector(iu.sub(e),h))}e.add(_l)}return e}raycast(t,e){const i=this.geometry,s=this.material,r=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Al.copy(i.boundingSphere),Al.applyMatrix4(r),Vs.copy(t.ray).recast(t.near),!(Al.containsPoint(Vs.origin)===!1&&(Vs.intersectSphere(Al,cg)===null||Vs.origin.distanceToSquared(cg)>(t.far-t.near)**2))&&(lg.copy(r).invert(),Vs.copy(t.ray).applyMatrix4(lg),!(i.boundingBox!==null&&Vs.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,Vs)))}_computeIntersections(t,e,i){let s;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,u=r.attributes.normal,d=r.groups,f=r.drawRange;if(a!==null)if(Array.isArray(o))for(let p=0,m=d.length;p<m;p++){const g=d[p],A=o[g.materialIndex],C=Math.max(g.start,f.start),E=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));for(let _=C,T=E;_<T;_+=3){const M=a.getX(_),S=a.getX(_+1),R=a.getX(_+2);s=yl(this,A,t,i,c,h,u,M,S,R),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{const p=Math.max(0,f.start),m=Math.min(a.count,f.start+f.count);for(let g=p,A=m;g<A;g+=3){const C=a.getX(g),E=a.getX(g+1),_=a.getX(g+2);s=yl(this,o,t,i,c,h,u,C,E,_),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}else if(l!==void 0)if(Array.isArray(o))for(let p=0,m=d.length;p<m;p++){const g=d[p],A=o[g.materialIndex],C=Math.max(g.start,f.start),E=Math.min(l.count,Math.min(g.start+g.count,f.start+f.count));for(let _=C,T=E;_<T;_+=3){const M=_,S=_+1,R=_+2;s=yl(this,A,t,i,c,h,u,M,S,R),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{const p=Math.max(0,f.start),m=Math.min(l.count,f.start+f.count);for(let g=p,A=m;g<A;g+=3){const C=g,E=g+1,_=g+2;s=yl(this,o,t,i,c,h,u,C,E,_),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}}}function yb(n,t,e,i,s,r,o,a){let l;if(t.side===Mn?l=i.intersectTriangle(o,r,s,!0,a):l=i.intersectTriangle(s,r,o,t.side===os,a),l===null)return null;El.copy(a),El.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(El);return c<e.near||c>e.far?null:{distance:c,point:El.clone(),object:n}}function yl(n,t,e,i,s,r,o,a,l,c){n.getVertexPosition(a,pl),n.getVertexPosition(l,gl),n.getVertexPosition(c,ml);const h=yb(n,t,e,i,pl,gl,ml,hg);if(h){const u=new L;Nn.getBarycoord(hg,pl,gl,ml,u),s&&(h.uv=Nn.getInterpolatedAttribute(s,a,l,c,u,new kt)),r&&(h.uv1=Nn.getInterpolatedAttribute(r,a,l,c,u,new kt)),o&&(h.normal=Nn.getInterpolatedAttribute(o,a,l,c,u,new L),h.normal.dot(i.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:l,c,normal:new L,materialIndex:0};Nn.getNormal(pl,gl,ml,d.normal),h.face=d,h.barycoord=u}return h}class Eo extends en{constructor(t=1,e=1,i=1,s=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:r,depthSegments:o};const a=this;s=Math.floor(s),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],u=[];let d=0,f=0;p("z","y","x",-1,-1,i,e,t,o,r,0),p("z","y","x",1,-1,i,e,-t,o,r,1),p("x","z","y",1,1,t,i,e,s,o,2),p("x","z","y",1,-1,t,i,-e,s,o,3),p("x","y","z",1,-1,t,e,i,s,r,4),p("x","y","z",-1,-1,t,e,-i,s,r,5),this.setIndex(l),this.setAttribute("position",new Ne(c,3)),this.setAttribute("normal",new Ne(h,3)),this.setAttribute("uv",new Ne(u,2));function p(m,g,A,C,E,_,T,M,S,R,B){const x=_/S,D=T/R,V=_/2,Q=T/2,k=M/2,et=S+1,j=R+1;let X=0,U=0;const ut=new L;for(let gt=0;gt<j;gt++){const Et=gt*D-Q;for(let Dt=0;Dt<et;Dt++){const Jt=Dt*x-V;ut[m]=Jt*C,ut[g]=Et*E,ut[A]=k,c.push(ut.x,ut.y,ut.z),ut[m]=0,ut[g]=0,ut[A]=M>0?1:-1,h.push(ut.x,ut.y,ut.z),u.push(Dt/S),u.push(1-gt/R),X+=1}}for(let gt=0;gt<R;gt++)for(let Et=0;Et<S;Et++){const Dt=d+Et+et*gt,Jt=d+Et+et*(gt+1),at=d+(Et+1)+et*(gt+1),mt=d+(Et+1)+et*gt;l.push(Dt,Jt,mt),l.push(Jt,at,mt),U+=6}a.addGroup(f,U,B),f+=U,d+=X}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Eo(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function ho(n){const t={};for(const e in n){t[e]={};for(const i in n[e]){const s=n[e][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][i]=null):t[e][i]=s.clone():Array.isArray(s)?t[e][i]=s.slice():t[e][i]=s}}return t}function pn(n){const t={};for(let e=0;e<n.length;e++){const i=ho(n[e]);for(const s in i)t[s]=i[s]}return t}function Cb(n){const t=[];for(let e=0;e<n.length;e++)t.push(n[e].clone());return t}function UE(n){const t=n.getRenderTarget();return t===null?n.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:ee.workingColorSpace}const xb={clone:ho,merge:pn};var vb=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Bb=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class di extends wi{static get type(){return"ShaderMaterial"}constructor(t){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=vb,this.fragmentShader=Bb,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=ho(t.uniforms),this.uniformsGroups=Cb(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const o=this.uniforms[s].value;o&&o.isTexture?e.uniforms[s]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[s]={type:"m4",value:o.toArray()}:e.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class NE extends Me{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new wt,this.projectionMatrix=new wt,this.projectionMatrixInverse=new wt,this.coordinateSystem=es}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const gs=new L,ug=new kt,dg=new kt;class Xe extends NE{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=co*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(or*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return co*2*Math.atan(Math.tan(or*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){gs.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(gs.x,gs.y).multiplyScalar(-t/gs.z),gs.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(gs.x,gs.y).multiplyScalar(-t/gs.z)}getViewSize(t,e){return this.getViewBounds(t,ug,dg),e.subVectors(dg,ug)}setViewOffset(t,e,i,s,r,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(or*.5*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*s/l,e-=o.offsetY*i/c,s*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Dr=-90,Lr=1;class OE extends Me{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Xe(Dr,Lr,t,e);s.layers=this.layers,this.add(s);const r=new Xe(Dr,Lr,t,e);r.layers=this.layers,this.add(r);const o=new Xe(Dr,Lr,t,e);o.layers=this.layers,this.add(o);const a=new Xe(Dr,Lr,t,e);a.layers=this.layers,this.add(a);const l=new Xe(Dr,Lr,t,e);l.layers=this.layers,this.add(l);const c=new Xe(Dr,Lr,t,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,s,r,o,a,l]=e;for(const c of e)this.remove(c);if(t===es)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===Lc)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of e)this.add(c),c.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[r,o,a,l,c,h]=this.children,u=t.getRenderTarget(),d=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const m=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,s),t.render(e,r),t.setRenderTarget(i,1,s),t.render(e,o),t.setRenderTarget(i,2,s),t.render(e,a),t.setRenderTarget(i,3,s),t.render(e,l),t.setRenderTarget(i,4,s),t.render(e,c),i.texture.generateMipmaps=m,t.setRenderTarget(i,5,s),t.render(e,h),t.setRenderTarget(u,d,f),t.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class GE extends Fe{constructor(t,e,i,s,r,o,a,l,c,h){t=t!==void 0?t:[],e=e!==void 0?e:ur,super(t,e,i,s,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Ib extends Ds{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},s=[i,i,i,i,i,i];this.texture=new GE(s,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:ln}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Eo(5,5,5),r=new di({name:"CubemapFromEquirect",uniforms:ho(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Mn,blending:Ms});r.uniforms.tEquirect.value=e;const o=new Ye(s,r),a=e.minFilter;return e.minFilter===Mi&&(e.minFilter=ln),new OE(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,i,s){const r=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,i,s);t.setRenderTarget(r)}}const su=new L,bb=new L,Mb=new Xt;class Yi{constructor(t=new L(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=su.subVectors(i,e).cross(bb.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(su),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/s;return r<0||r>1?null:e.copy(t.start).addScaledVector(i,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||Mb.getNormalMatrix(t),s=this.coplanarPoint(su).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const zs=new Ai,Cl=new L;class oh{constructor(t=new Yi,e=new Yi,i=new Yi,s=new Yi,r=new Yi,o=new Yi){this.planes=[t,e,i,s,r,o]}set(t,e,i,s,r,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(s),a[4].copy(r),a[5].copy(o),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=es){const i=this.planes,s=t.elements,r=s[0],o=s[1],a=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],f=s[8],p=s[9],m=s[10],g=s[11],A=s[12],C=s[13],E=s[14],_=s[15];if(i[0].setComponents(l-r,d-c,g-f,_-A).normalize(),i[1].setComponents(l+r,d+c,g+f,_+A).normalize(),i[2].setComponents(l+o,d+h,g+p,_+C).normalize(),i[3].setComponents(l-o,d-h,g-p,_-C).normalize(),i[4].setComponents(l-a,d-u,g-m,_-E).normalize(),e===es)i[5].setComponents(l+a,d+u,g+m,_+E).normalize();else if(e===Lc)i[5].setComponents(a,u,m,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),zs.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),zs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(zs)}intersectsSprite(t){return zs.center.set(0,0,0),zs.radius=.7071067811865476,zs.applyMatrix4(t.matrixWorld),this.intersectsSphere(zs)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(i)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(Cl.x=s.normal.x>0?t.max.x:t.min.x,Cl.y=s.normal.y>0?t.max.y:t.min.y,Cl.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(Cl)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function QE(){let n=null,t=!1,e=null,i=null;function s(r,o){e(r,o),i=n.requestAnimationFrame(s)}return{start:function(){t!==!0&&e!==null&&(i=n.requestAnimationFrame(s),t=!0)},stop:function(){n.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(r){e=r},setContext:function(r){n=r}}}function Sb(n){const t=new WeakMap;function e(a,l){const c=a.array,h=a.usage,u=c.byteLength,d=n.createBuffer();n.bindBuffer(l,d),n.bufferData(l,c,h),a.onUploadCallback();let f;if(c instanceof Float32Array)f=n.FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?f=n.HALF_FLOAT:f=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=n.SHORT;else if(c instanceof Uint32Array)f=n.UNSIGNED_INT;else if(c instanceof Int32Array)f=n.INT;else if(c instanceof Int8Array)f=n.BYTE;else if(c instanceof Uint8Array)f=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:u}}function i(a,l,c){const h=l.array,u=l.updateRanges;if(n.bindBuffer(c,a),u.length===0)n.bufferSubData(c,0,h);else{u.sort((f,p)=>f.start-p.start);let d=0;for(let f=1;f<u.length;f++){const p=u[d],m=u[f];m.start<=p.start+p.count+1?p.count=Math.max(p.count,m.start+m.count-p.start):(++d,u[d]=m)}u.length=d+1;for(let f=0,p=u.length;f<p;f++){const m=u[f];n.bufferSubData(c,m.start*h.BYTES_PER_ELEMENT,h,m.start,m.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(a){return a.isInterleavedBufferAttribute&&(a=a.data),t.get(a)}function r(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=t.get(a);l&&(n.deleteBuffer(l.buffer),t.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=t.get(a);(!h||h.version<a.version)&&t.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=t.get(a);if(c===void 0)t.set(a,e(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:s,remove:r,update:o}}class za extends en{constructor(t=1,e=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:s};const r=t/2,o=e/2,a=Math.floor(i),l=Math.floor(s),c=a+1,h=l+1,u=t/a,d=e/l,f=[],p=[],m=[],g=[];for(let A=0;A<h;A++){const C=A*d-o;for(let E=0;E<c;E++){const _=E*u-r;p.push(_,-C,0),m.push(0,0,1),g.push(E/a),g.push(1-A/l)}}for(let A=0;A<l;A++)for(let C=0;C<a;C++){const E=C+c*A,_=C+c*(A+1),T=C+1+c*(A+1),M=C+1+c*A;f.push(E,_,M),f.push(_,T,M)}this.setIndex(f),this.setAttribute("position",new Ne(p,3)),this.setAttribute("normal",new Ne(m,3)),this.setAttribute("uv",new Ne(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new za(t.width,t.height,t.widthSegments,t.heightSegments)}}var Tb=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,wb=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,Rb=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Db=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Lb=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Pb=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Fb=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Ub=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Nb=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,Ob=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,Gb=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,Qb=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,Hb=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,kb=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Vb=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,zb=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Wb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Jb=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,qb=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,jb=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Xb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Kb=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,Yb=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Zb=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,$b=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,tM=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,eM=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,nM=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,iM=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,sM=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,rM="gl_FragColor = linearToOutputTexel( gl_FragColor );",oM=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,aM=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,lM=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,cM=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,hM=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,uM=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,dM=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fM=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,AM=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,pM=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gM=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,mM=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,_M=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,EM=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,yM=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,CM=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,xM=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,vM=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,BM=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,IM=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,bM=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,MM=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,SM=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,TM=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,wM=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,RM=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,DM=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,LM=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,PM=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,FM=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,UM=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,NM=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,OM=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,GM=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,QM=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,HM=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,kM=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,VM=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,zM=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,WM=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,JM=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,qM=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,jM=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,XM=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,KM=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,YM=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,ZM=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,$M=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,tS=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,eS=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,nS=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,iS=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,sS=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,rS=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,oS=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,aS=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,lS=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,cS=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,hS=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,uS=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,dS=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,fS=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,AS=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,pS=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,gS=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,mS=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,_S=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ES=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,yS=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,CS=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,xS=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,vS=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,BS=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,IS=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bS=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,MS=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const SS=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,TS=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,wS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,RS=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,DS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,LS=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PS=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,FS=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,US=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,NS=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,OS=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,GS=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,QS=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,HS=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,kS=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,VS=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zS=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,WS=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JS=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,qS=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jS=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,XS=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,KS=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YS=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZS=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,$S=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,tT=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,eT=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nT=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,iT=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sT=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,rT=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,oT=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,aT=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Kt={alphahash_fragment:Tb,alphahash_pars_fragment:wb,alphamap_fragment:Rb,alphamap_pars_fragment:Db,alphatest_fragment:Lb,alphatest_pars_fragment:Pb,aomap_fragment:Fb,aomap_pars_fragment:Ub,batching_pars_vertex:Nb,batching_vertex:Ob,begin_vertex:Gb,beginnormal_vertex:Qb,bsdfs:Hb,iridescence_fragment:kb,bumpmap_pars_fragment:Vb,clipping_planes_fragment:zb,clipping_planes_pars_fragment:Wb,clipping_planes_pars_vertex:Jb,clipping_planes_vertex:qb,color_fragment:jb,color_pars_fragment:Xb,color_pars_vertex:Kb,color_vertex:Yb,common:Zb,cube_uv_reflection_fragment:$b,defaultnormal_vertex:tM,displacementmap_pars_vertex:eM,displacementmap_vertex:nM,emissivemap_fragment:iM,emissivemap_pars_fragment:sM,colorspace_fragment:rM,colorspace_pars_fragment:oM,envmap_fragment:aM,envmap_common_pars_fragment:lM,envmap_pars_fragment:cM,envmap_pars_vertex:hM,envmap_physical_pars_fragment:CM,envmap_vertex:uM,fog_vertex:dM,fog_pars_vertex:fM,fog_fragment:AM,fog_pars_fragment:pM,gradientmap_pars_fragment:gM,lightmap_pars_fragment:mM,lights_lambert_fragment:_M,lights_lambert_pars_fragment:EM,lights_pars_begin:yM,lights_toon_fragment:xM,lights_toon_pars_fragment:vM,lights_phong_fragment:BM,lights_phong_pars_fragment:IM,lights_physical_fragment:bM,lights_physical_pars_fragment:MM,lights_fragment_begin:SM,lights_fragment_maps:TM,lights_fragment_end:wM,logdepthbuf_fragment:RM,logdepthbuf_pars_fragment:DM,logdepthbuf_pars_vertex:LM,logdepthbuf_vertex:PM,map_fragment:FM,map_pars_fragment:UM,map_particle_fragment:NM,map_particle_pars_fragment:OM,metalnessmap_fragment:GM,metalnessmap_pars_fragment:QM,morphinstance_vertex:HM,morphcolor_vertex:kM,morphnormal_vertex:VM,morphtarget_pars_vertex:zM,morphtarget_vertex:WM,normal_fragment_begin:JM,normal_fragment_maps:qM,normal_pars_fragment:jM,normal_pars_vertex:XM,normal_vertex:KM,normalmap_pars_fragment:YM,clearcoat_normal_fragment_begin:ZM,clearcoat_normal_fragment_maps:$M,clearcoat_pars_fragment:tS,iridescence_pars_fragment:eS,opaque_fragment:nS,packing:iS,premultiplied_alpha_fragment:sS,project_vertex:rS,dithering_fragment:oS,dithering_pars_fragment:aS,roughnessmap_fragment:lS,roughnessmap_pars_fragment:cS,shadowmap_pars_fragment:hS,shadowmap_pars_vertex:uS,shadowmap_vertex:dS,shadowmask_pars_fragment:fS,skinbase_vertex:AS,skinning_pars_vertex:pS,skinning_vertex:gS,skinnormal_vertex:mS,specularmap_fragment:_S,specularmap_pars_fragment:ES,tonemapping_fragment:yS,tonemapping_pars_fragment:CS,transmission_fragment:xS,transmission_pars_fragment:vS,uv_pars_fragment:BS,uv_pars_vertex:IS,uv_vertex:bS,worldpos_vertex:MS,background_vert:SS,background_frag:TS,backgroundCube_vert:wS,backgroundCube_frag:RS,cube_vert:DS,cube_frag:LS,depth_vert:PS,depth_frag:FS,distanceRGBA_vert:US,distanceRGBA_frag:NS,equirect_vert:OS,equirect_frag:GS,linedashed_vert:QS,linedashed_frag:HS,meshbasic_vert:kS,meshbasic_frag:VS,meshlambert_vert:zS,meshlambert_frag:WS,meshmatcap_vert:JS,meshmatcap_frag:qS,meshnormal_vert:jS,meshnormal_frag:XS,meshphong_vert:KS,meshphong_frag:YS,meshphysical_vert:ZS,meshphysical_frag:$S,meshtoon_vert:tT,meshtoon_frag:eT,points_vert:nT,points_frag:iT,shadow_vert:sT,shadow_frag:rT,sprite_vert:oT,sprite_frag:aT},Ct={common:{diffuse:{value:new tt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Xt},alphaMap:{value:null},alphaMapTransform:{value:new Xt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Xt}},envmap:{envMap:{value:null},envMapRotation:{value:new Xt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Xt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Xt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Xt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Xt},normalScale:{value:new kt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Xt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Xt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Xt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Xt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new tt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Xt},alphaTest:{value:0},uvTransform:{value:new Xt}},sprite:{diffuse:{value:new tt(16777215)},opacity:{value:1},center:{value:new kt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Xt},alphaMap:{value:null},alphaMapTransform:{value:new Xt},alphaTest:{value:0}}},xi={basic:{uniforms:pn([Ct.common,Ct.specularmap,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.fog]),vertexShader:Kt.meshbasic_vert,fragmentShader:Kt.meshbasic_frag},lambert:{uniforms:pn([Ct.common,Ct.specularmap,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.fog,Ct.lights,{emissive:{value:new tt(0)}}]),vertexShader:Kt.meshlambert_vert,fragmentShader:Kt.meshlambert_frag},phong:{uniforms:pn([Ct.common,Ct.specularmap,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.fog,Ct.lights,{emissive:{value:new tt(0)},specular:{value:new tt(1118481)},shininess:{value:30}}]),vertexShader:Kt.meshphong_vert,fragmentShader:Kt.meshphong_frag},standard:{uniforms:pn([Ct.common,Ct.envmap,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.roughnessmap,Ct.metalnessmap,Ct.fog,Ct.lights,{emissive:{value:new tt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Kt.meshphysical_vert,fragmentShader:Kt.meshphysical_frag},toon:{uniforms:pn([Ct.common,Ct.aomap,Ct.lightmap,Ct.emissivemap,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.gradientmap,Ct.fog,Ct.lights,{emissive:{value:new tt(0)}}]),vertexShader:Kt.meshtoon_vert,fragmentShader:Kt.meshtoon_frag},matcap:{uniforms:pn([Ct.common,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,Ct.fog,{matcap:{value:null}}]),vertexShader:Kt.meshmatcap_vert,fragmentShader:Kt.meshmatcap_frag},points:{uniforms:pn([Ct.points,Ct.fog]),vertexShader:Kt.points_vert,fragmentShader:Kt.points_frag},dashed:{uniforms:pn([Ct.common,Ct.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kt.linedashed_vert,fragmentShader:Kt.linedashed_frag},depth:{uniforms:pn([Ct.common,Ct.displacementmap]),vertexShader:Kt.depth_vert,fragmentShader:Kt.depth_frag},normal:{uniforms:pn([Ct.common,Ct.bumpmap,Ct.normalmap,Ct.displacementmap,{opacity:{value:1}}]),vertexShader:Kt.meshnormal_vert,fragmentShader:Kt.meshnormal_frag},sprite:{uniforms:pn([Ct.sprite,Ct.fog]),vertexShader:Kt.sprite_vert,fragmentShader:Kt.sprite_frag},background:{uniforms:{uvTransform:{value:new Xt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Kt.background_vert,fragmentShader:Kt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Xt}},vertexShader:Kt.backgroundCube_vert,fragmentShader:Kt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Kt.cube_vert,fragmentShader:Kt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kt.equirect_vert,fragmentShader:Kt.equirect_frag},distanceRGBA:{uniforms:pn([Ct.common,Ct.displacementmap,{referencePosition:{value:new L},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kt.distanceRGBA_vert,fragmentShader:Kt.distanceRGBA_frag},shadow:{uniforms:pn([Ct.lights,Ct.fog,{color:{value:new tt(0)},opacity:{value:1}}]),vertexShader:Kt.shadow_vert,fragmentShader:Kt.shadow_frag}};xi.physical={uniforms:pn([xi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Xt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Xt},clearcoatNormalScale:{value:new kt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Xt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Xt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Xt},sheen:{value:0},sheenColor:{value:new tt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Xt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Xt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Xt},transmissionSamplerSize:{value:new kt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Xt},attenuationDistance:{value:0},attenuationColor:{value:new tt(0)},specularColor:{value:new tt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Xt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Xt},anisotropyVector:{value:new kt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Xt}}]),vertexShader:Kt.meshphysical_vert,fragmentShader:Kt.meshphysical_frag};const xl={r:0,b:0,g:0},Ws=new Hn,lT=new wt;function cT(n,t,e,i,s,r,o){const a=new tt(0);let l=r===!0?0:1,c,h,u=null,d=0,f=null;function p(C){let E=C.isScene===!0?C.background:null;return E&&E.isTexture&&(E=(C.backgroundBlurriness>0?e:t).get(E)),E}function m(C){let E=!1;const _=p(C);_===null?A(a,l):_&&_.isColor&&(A(_,1),E=!0);const T=n.xr.getEnvironmentBlendMode();T==="additive"?i.buffers.color.setClear(0,0,0,1,o):T==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||E)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function g(C,E){const _=p(E);_&&(_.isCubeTexture||_.mapping===sh)?(h===void 0&&(h=new Ye(new Eo(1,1,1),new di({name:"BackgroundCubeMaterial",uniforms:ho(xi.backgroundCube.uniforms),vertexShader:xi.backgroundCube.vertexShader,fragmentShader:xi.backgroundCube.fragmentShader,side:Mn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(T,M,S){this.matrixWorld.copyPosition(S.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(h)),Ws.copy(E.backgroundRotation),Ws.x*=-1,Ws.y*=-1,Ws.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Ws.y*=-1,Ws.z*=-1),h.material.uniforms.envMap.value=_,h.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(lT.makeRotationFromEuler(Ws)),h.material.toneMapped=ee.getTransfer(_.colorSpace)!==me,(u!==_||d!==_.version||f!==n.toneMapping)&&(h.material.needsUpdate=!0,u=_,d=_.version,f=n.toneMapping),h.layers.enableAll(),C.unshift(h,h.geometry,h.material,0,0,null)):_&&_.isTexture&&(c===void 0&&(c=new Ye(new za(2,2),new di({name:"BackgroundMaterial",uniforms:ho(xi.background.uniforms),vertexShader:xi.background.vertexShader,fragmentShader:xi.background.fragmentShader,side:os,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,c.material.toneMapped=ee.getTransfer(_.colorSpace)!==me,_.matrixAutoUpdate===!0&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(u!==_||d!==_.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,u=_,d=_.version,f=n.toneMapping),c.layers.enableAll(),C.unshift(c,c.geometry,c.material,0,0,null))}function A(C,E){C.getRGB(xl,UE(n)),i.buffers.color.setClear(xl.r,xl.g,xl.b,E,o)}return{getClearColor:function(){return a},setClearColor:function(C,E=1){a.set(C),l=E,A(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(C){l=C,A(a,l)},render:m,addToRenderList:g}}function hT(n,t){const e=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},s=d(null);let r=s,o=!1;function a(x,D,V,Q,k){let et=!1;const j=u(Q,V,D);r!==j&&(r=j,c(r.object)),et=f(x,Q,V,k),et&&p(x,Q,V,k),k!==null&&t.update(k,n.ELEMENT_ARRAY_BUFFER),(et||o)&&(o=!1,_(x,D,V,Q),k!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.get(k).buffer))}function l(){return n.createVertexArray()}function c(x){return n.bindVertexArray(x)}function h(x){return n.deleteVertexArray(x)}function u(x,D,V){const Q=V.wireframe===!0;let k=i[x.id];k===void 0&&(k={},i[x.id]=k);let et=k[D.id];et===void 0&&(et={},k[D.id]=et);let j=et[Q];return j===void 0&&(j=d(l()),et[Q]=j),j}function d(x){const D=[],V=[],Q=[];for(let k=0;k<e;k++)D[k]=0,V[k]=0,Q[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:D,enabledAttributes:V,attributeDivisors:Q,object:x,attributes:{},index:null}}function f(x,D,V,Q){const k=r.attributes,et=D.attributes;let j=0;const X=V.getAttributes();for(const U in X)if(X[U].location>=0){const gt=k[U];let Et=et[U];if(Et===void 0&&(U==="instanceMatrix"&&x.instanceMatrix&&(Et=x.instanceMatrix),U==="instanceColor"&&x.instanceColor&&(Et=x.instanceColor)),gt===void 0||gt.attribute!==Et||Et&&gt.data!==Et.data)return!0;j++}return r.attributesNum!==j||r.index!==Q}function p(x,D,V,Q){const k={},et=D.attributes;let j=0;const X=V.getAttributes();for(const U in X)if(X[U].location>=0){let gt=et[U];gt===void 0&&(U==="instanceMatrix"&&x.instanceMatrix&&(gt=x.instanceMatrix),U==="instanceColor"&&x.instanceColor&&(gt=x.instanceColor));const Et={};Et.attribute=gt,gt&&gt.data&&(Et.data=gt.data),k[U]=Et,j++}r.attributes=k,r.attributesNum=j,r.index=Q}function m(){const x=r.newAttributes;for(let D=0,V=x.length;D<V;D++)x[D]=0}function g(x){A(x,0)}function A(x,D){const V=r.newAttributes,Q=r.enabledAttributes,k=r.attributeDivisors;V[x]=1,Q[x]===0&&(n.enableVertexAttribArray(x),Q[x]=1),k[x]!==D&&(n.vertexAttribDivisor(x,D),k[x]=D)}function C(){const x=r.newAttributes,D=r.enabledAttributes;for(let V=0,Q=D.length;V<Q;V++)D[V]!==x[V]&&(n.disableVertexAttribArray(V),D[V]=0)}function E(x,D,V,Q,k,et,j){j===!0?n.vertexAttribIPointer(x,D,V,k,et):n.vertexAttribPointer(x,D,V,Q,k,et)}function _(x,D,V,Q){m();const k=Q.attributes,et=V.getAttributes(),j=D.defaultAttributeValues;for(const X in et){const U=et[X];if(U.location>=0){let ut=k[X];if(ut===void 0&&(X==="instanceMatrix"&&x.instanceMatrix&&(ut=x.instanceMatrix),X==="instanceColor"&&x.instanceColor&&(ut=x.instanceColor)),ut!==void 0){const gt=ut.normalized,Et=ut.itemSize,Dt=t.get(ut);if(Dt===void 0)continue;const Jt=Dt.buffer,at=Dt.type,mt=Dt.bytesPerElement,H=at===n.INT||at===n.UNSIGNED_INT||ut.gpuType===eA;if(ut.isInterleavedBufferAttribute){const ot=ut.data,vt=ot.stride,Mt=ut.offset;if(ot.isInstancedInterleavedBuffer){for(let Vt=0;Vt<U.locationSize;Vt++)A(U.location+Vt,ot.meshPerAttribute);x.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=ot.meshPerAttribute*ot.count)}else for(let Vt=0;Vt<U.locationSize;Vt++)g(U.location+Vt);n.bindBuffer(n.ARRAY_BUFFER,Jt);for(let Vt=0;Vt<U.locationSize;Vt++)E(U.location+Vt,Et/U.locationSize,at,gt,vt*mt,(Mt+Et/U.locationSize*Vt)*mt,H)}else{if(ut.isInstancedBufferAttribute){for(let ot=0;ot<U.locationSize;ot++)A(U.location+ot,ut.meshPerAttribute);x.isInstancedMesh!==!0&&Q._maxInstanceCount===void 0&&(Q._maxInstanceCount=ut.meshPerAttribute*ut.count)}else for(let ot=0;ot<U.locationSize;ot++)g(U.location+ot);n.bindBuffer(n.ARRAY_BUFFER,Jt);for(let ot=0;ot<U.locationSize;ot++)E(U.location+ot,Et/U.locationSize,at,gt,Et*mt,Et/U.locationSize*ot*mt,H)}}else if(j!==void 0){const gt=j[X];if(gt!==void 0)switch(gt.length){case 2:n.vertexAttrib2fv(U.location,gt);break;case 3:n.vertexAttrib3fv(U.location,gt);break;case 4:n.vertexAttrib4fv(U.location,gt);break;default:n.vertexAttrib1fv(U.location,gt)}}}}C()}function T(){R();for(const x in i){const D=i[x];for(const V in D){const Q=D[V];for(const k in Q)h(Q[k].object),delete Q[k];delete D[V]}delete i[x]}}function M(x){if(i[x.id]===void 0)return;const D=i[x.id];for(const V in D){const Q=D[V];for(const k in Q)h(Q[k].object),delete Q[k];delete D[V]}delete i[x.id]}function S(x){for(const D in i){const V=i[D];if(V[x.id]===void 0)continue;const Q=V[x.id];for(const k in Q)h(Q[k].object),delete Q[k];delete V[x.id]}}function R(){B(),o=!0,r!==s&&(r=s,c(r.object))}function B(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:a,reset:R,resetDefaultState:B,dispose:T,releaseStatesOfGeometry:M,releaseStatesOfProgram:S,initAttributes:m,enableAttribute:g,disableUnusedAttributes:C}}function uT(n,t,e){let i;function s(c){i=c}function r(c,h){n.drawArrays(i,c,h),e.update(h,i,1)}function o(c,h,u){u!==0&&(n.drawArraysInstanced(i,c,h,u),e.update(h,i,u))}function a(c,h,u){if(u===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,h,0,u);let f=0;for(let p=0;p<u;p++)f+=h[p];e.update(f,i,1)}function l(c,h,u,d){if(u===0)return;const f=t.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<c.length;p++)o(c[p],h[p],d[p]);else{f.multiDrawArraysInstancedWEBGL(i,c,0,h,0,d,0,u);let p=0;for(let m=0;m<u;m++)p+=h[m]*d[m];e.update(p,i,1)}}this.setMode=s,this.render=r,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function dT(n,t,e,i){let s;function r(){if(s!==void 0)return s;if(t.has("EXT_texture_filter_anisotropic")===!0){const S=t.get("EXT_texture_filter_anisotropic");s=n.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function o(S){return!(S!==Qe&&i.convert(S)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(S){const R=S===si&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(S!==We&&i.convert(S)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&S!==Ke&&!R)}function l(S){if(S==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";S="mediump"}return S==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=e.precision!==void 0?e.precision:"highp";const h=l(c);h!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",h,"instead."),c=h);const u=e.logarithmicDepthBuffer===!0,d=e.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),f=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=n.getParameter(n.MAX_TEXTURE_SIZE),g=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),A=n.getParameter(n.MAX_VERTEX_ATTRIBS),C=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),E=n.getParameter(n.MAX_VARYING_VECTORS),_=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),T=p>0,M=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:u,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:g,maxAttributes:A,maxVertexUniforms:C,maxVaryings:E,maxFragmentUniforms:_,vertexTextures:T,maxSamples:M}}function fT(n){const t=this;let e=null,i=0,s=!1,r=!1;const o=new Yi,a=new Xt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){const f=u.length!==0||d||i!==0||s;return s=d,i=u.length,f},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(u,d){e=h(u,d,0)},this.setState=function(u,d,f){const p=u.clippingPlanes,m=u.clipIntersection,g=u.clipShadows,A=n.get(u);if(!s||p===null||p.length===0||r&&!g)r?h(null):c();else{const C=r?0:i,E=C*4;let _=A.clippingState||null;l.value=_,_=h(p,d,E,f);for(let T=0;T!==E;++T)_[T]=e[T];A.clippingState=_,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=C}};function c(){l.value!==e&&(l.value=e,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function h(u,d,f,p){const m=u!==null?u.length:0;let g=null;if(m!==0){if(g=l.value,p!==!0||g===null){const A=f+m*4,C=d.matrixWorldInverse;a.getNormalMatrix(C),(g===null||g.length<A)&&(g=new Float32Array(A));for(let E=0,_=f;E!==m;++E,_+=4)o.copy(u[E]).applyMatrix4(C,a),o.normal.toArray(g,_),g[_+3]=o.constant}l.value=g,l.needsUpdate=!0}return t.numPlanes=m,t.numIntersection=0,g}}function AT(n){let t=new WeakMap;function e(o,a){return a===Fd?o.mapping=ur:a===Ud&&(o.mapping=oo),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===Fd||a===Ud)if(t.has(o)){const l=t.get(o).texture;return e(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new Ib(l.height);return c.fromEquirectangularTexture(n,o),t.set(o,c),o.addEventListener("dispose",s),e(c.texture,o.mapping)}else return null}}return o}function s(o){const a=o.target;a.removeEventListener("dispose",s);const l=t.get(a);l!==void 0&&(t.delete(a),l.dispose())}function r(){t=new WeakMap}return{get:i,dispose:r}}class ah extends NE{constructor(t=-1,e=1,i=1,s=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,o=i+t,a=s+e,l=s-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const qr=4,fg=[.125,.215,.35,.446,.526,.582],tr=20,ru=new ah,Ag=new tt;let ou=null,au=0,lu=0,cu=!1;const Zs=(1+Math.sqrt(5))/2,Pr=1/Zs,pg=[new L(-Zs,Pr,0),new L(Zs,Pr,0),new L(-Pr,0,Zs),new L(Pr,0,Zs),new L(0,Zs,-Pr),new L(0,Zs,Pr),new L(-1,1,-1),new L(1,1,-1),new L(-1,1,1),new L(1,1,1)];class gg{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,s=100){ou=this._renderer.getRenderTarget(),au=this._renderer.getActiveCubeFace(),lu=this._renderer.getActiveMipmapLevel(),cu=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,s,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Eg(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_g(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(ou,au,lu),this._renderer.xr.enabled=cu,t.scissorTest=!1,vl(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===ur||t.mapping===oo?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),ou=this._renderer.getRenderTarget(),au=this._renderer.getActiveCubeFace(),lu=this._renderer.getActiveMipmapLevel(),cu=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:ln,minFilter:ln,generateMipmaps:!1,type:si,format:Qe,colorSpace:tn,depthBuffer:!1},s=mg(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mg(t,e,i);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=pT(r)),this._blurMaterial=gT(r,t,e)}return s}_compileMaterial(t){const e=new Ye(this._lodPlanes[0],t);this._renderer.compile(e,ru)}_sceneToCubeUV(t,e,i,s){const a=new Xe(90,1,e,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,d=h.toneMapping;h.getClearColor(Ag),h.toneMapping=Ss,h.autoClear=!1;const f=new Gn({name:"PMREM.Background",side:Mn,depthWrite:!1,depthTest:!1}),p=new Ye(new Eo,f);let m=!1;const g=t.background;g?g.isColor&&(f.color.copy(g),t.background=null,m=!0):(f.color.copy(Ag),m=!0);for(let A=0;A<6;A++){const C=A%3;C===0?(a.up.set(0,l[A],0),a.lookAt(c[A],0,0)):C===1?(a.up.set(0,0,l[A]),a.lookAt(0,c[A],0)):(a.up.set(0,l[A],0),a.lookAt(0,0,c[A]));const E=this._cubeSize;vl(s,C*E,A>2?E:0,E,E),h.setRenderTarget(s),m&&h.render(p,a),h.render(t,a)}p.geometry.dispose(),p.material.dispose(),h.toneMapping=d,h.autoClear=u,t.background=g}_textureToCubeUV(t,e){const i=this._renderer,s=t.mapping===ur||t.mapping===oo;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=Eg()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_g());const r=s?this._cubemapMaterial:this._equirectMaterial,o=new Ye(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=t;const l=this._cubeSize;vl(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(o,ru)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const s=this._lodPlanes.length;for(let r=1;r<s;r++){const o=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=pg[(s-r-1)%pg.length];this._blur(t,r-1,r,o,a)}e.autoClear=i}_blur(t,e,i,s,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,i,s,"latitudinal",r),this._halfBlur(o,t,i,i,s,"longitudinal",r)}_halfBlur(t,e,i,s,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new Ye(this._lodPlanes[s],c),d=c.uniforms,f=this._sizeLods[i]-1,p=isFinite(r)?Math.PI/(2*f):2*Math.PI/(2*tr-1),m=r/p,g=isFinite(r)?1+Math.floor(h*m):tr;g>tr&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${tr}`);const A=[];let C=0;for(let S=0;S<tr;++S){const R=S/m,B=Math.exp(-R*R/2);A.push(B),S===0?C+=B:S<g&&(C+=2*B)}for(let S=0;S<A.length;S++)A[S]=A[S]/C;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=A,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:E}=this;d.dTheta.value=p,d.mipInt.value=E-i;const _=this._sizeLods[s],T=3*_*(s>E-qr?s-E+qr:0),M=4*(this._cubeSize-_);vl(e,T,M,3*_,2*_),l.setRenderTarget(e),l.render(u,ru)}}function pT(n){const t=[],e=[],i=[];let s=n;const r=n-qr+1+fg.length;for(let o=0;o<r;o++){const a=Math.pow(2,s);e.push(a);let l=1/a;o>n-qr?l=fg[o-n+qr-1]:o===0&&(l=0),i.push(l);const c=1/(a-2),h=-c,u=1+c,d=[h,h,u,h,u,u,h,h,u,u,h,u],f=6,p=6,m=3,g=2,A=1,C=new Float32Array(m*p*f),E=new Float32Array(g*p*f),_=new Float32Array(A*p*f);for(let M=0;M<f;M++){const S=M%3*2/3-1,R=M>2?0:-1,B=[S,R,0,S+2/3,R,0,S+2/3,R+1,0,S,R,0,S+2/3,R+1,0,S,R+1,0];C.set(B,m*p*M),E.set(d,g*p*M);const x=[M,M,M,M,M,M];_.set(x,A*p*M)}const T=new en;T.setAttribute("position",new Ue(C,m)),T.setAttribute("uv",new Ue(E,g)),T.setAttribute("faceIndex",new Ue(_,A)),t.push(T),s>qr&&s--}return{lodPlanes:t,sizeLods:e,sigmas:i}}function mg(n,t,e){const i=new Ds(n,t,e);return i.texture.mapping=sh,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function vl(n,t,e,i,s){n.viewport.set(t,e,i,s),n.scissor.set(t,e,i,s)}function gT(n,t,e){const i=new Float32Array(tr),s=new L(0,1,0);return new di({name:"SphericalGaussianBlur",defines:{n:tr,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:cA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function _g(){return new di({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:cA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function Eg(){return new di({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:cA(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ms,depthTest:!1,depthWrite:!1})}function cA(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function mT(n){let t=new WeakMap,e=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Fd||l===Ud,h=l===ur||l===oo;if(c||h){let u=t.get(a);const d=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return e===null&&(e=new gg(n)),u=c?e.fromEquirectangular(a,u):e.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,t.set(a,u),u.texture;if(u!==void 0)return u.texture;{const f=a.image;return c&&f&&f.height>0||h&&f&&s(f)?(e===null&&(e=new gg(n)),u=c?e.fromEquirectangular(a):e.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,t.set(a,u),a.addEventListener("dispose",r),u.texture):null}}}return a}function s(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:i,dispose:o}}function _T(n){const t={};function e(i){if(t[i]!==void 0)return t[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return t[i]=s,s}return{has:function(i){return e(i)!==null},init:function(){e("EXT_color_buffer_float"),e("WEBGL_clip_cull_distance"),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture"),e("WEBGL_render_shared_exponent")},get:function(i){const s=e(i);return s===null&&Ko("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function ET(n,t,e,i){const s={},r=new WeakMap;function o(u){const d=u.target;d.index!==null&&t.remove(d.index);for(const p in d.attributes)t.remove(d.attributes[p]);for(const p in d.morphAttributes){const m=d.morphAttributes[p];for(let g=0,A=m.length;g<A;g++)t.remove(m[g])}d.removeEventListener("dispose",o),delete s[d.id];const f=r.get(d);f&&(t.remove(f),r.delete(d)),i.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,e.memory.geometries--}function a(u,d){return s[d.id]===!0||(d.addEventListener("dispose",o),s[d.id]=!0,e.memory.geometries++),d}function l(u){const d=u.attributes;for(const p in d)t.update(d[p],n.ARRAY_BUFFER);const f=u.morphAttributes;for(const p in f){const m=f[p];for(let g=0,A=m.length;g<A;g++)t.update(m[g],n.ARRAY_BUFFER)}}function c(u){const d=[],f=u.index,p=u.attributes.position;let m=0;if(f!==null){const C=f.array;m=f.version;for(let E=0,_=C.length;E<_;E+=3){const T=C[E+0],M=C[E+1],S=C[E+2];d.push(T,M,M,S,S,T)}}else if(p!==void 0){const C=p.array;m=p.version;for(let E=0,_=C.length/3-1;E<_;E+=3){const T=E+0,M=E+1,S=E+2;d.push(T,M,M,S,S,T)}}else return;const g=new(TE(d)?FE:PE)(d,1);g.version=m;const A=r.get(u);A&&t.remove(A),r.set(u,g)}function h(u){const d=r.get(u);if(d){const f=u.index;f!==null&&d.version<f.version&&c(u)}else c(u);return r.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function yT(n,t,e){let i;function s(d){i=d}let r,o;function a(d){r=d.type,o=d.bytesPerElement}function l(d,f){n.drawElements(i,f,r,d*o),e.update(f,i,1)}function c(d,f,p){p!==0&&(n.drawElementsInstanced(i,f,r,d*o,p),e.update(f,i,p))}function h(d,f,p){if(p===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,f,0,r,d,0,p);let g=0;for(let A=0;A<p;A++)g+=f[A];e.update(g,i,1)}function u(d,f,p,m){if(p===0)return;const g=t.get("WEBGL_multi_draw");if(g===null)for(let A=0;A<d.length;A++)c(d[A]/o,f[A],m[A]);else{g.multiDrawElementsInstancedWEBGL(i,f,0,r,d,0,m,0,p);let A=0;for(let C=0;C<p;C++)A+=f[C]*m[C];e.update(A,i,1)}}this.setMode=s,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=h,this.renderMultiDrawInstances=u}function CT(n){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function i(r,o,a){switch(e.calls++,o){case n.TRIANGLES:e.triangles+=a*(r/3);break;case n.LINES:e.lines+=a*(r/2);break;case n.LINE_STRIP:e.lines+=a*(r-1);break;case n.LINE_LOOP:e.lines+=a*r;break;case n.POINTS:e.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:s,update:i}}function xT(n,t,e){const i=new WeakMap,s=new oe;function r(o,a,l){const c=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=h!==void 0?h.length:0;let d=i.get(a);if(d===void 0||d.count!==u){let x=function(){R.dispose(),i.delete(a),a.removeEventListener("dispose",x)};var f=x;d!==void 0&&d.texture.dispose();const p=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,g=a.morphAttributes.color!==void 0,A=a.morphAttributes.position||[],C=a.morphAttributes.normal||[],E=a.morphAttributes.color||[];let _=0;p===!0&&(_=1),m===!0&&(_=2),g===!0&&(_=3);let T=a.attributes.position.count*_,M=1;T>t.maxTextureSize&&(M=Math.ceil(T/t.maxTextureSize),T=t.maxTextureSize);const S=new Float32Array(T*M*4*u),R=new RE(S,T,M,u);R.type=Ke,R.needsUpdate=!0;const B=_*4;for(let D=0;D<u;D++){const V=A[D],Q=C[D],k=E[D],et=T*M*4*D;for(let j=0;j<V.count;j++){const X=j*B;p===!0&&(s.fromBufferAttribute(V,j),S[et+X+0]=s.x,S[et+X+1]=s.y,S[et+X+2]=s.z,S[et+X+3]=0),m===!0&&(s.fromBufferAttribute(Q,j),S[et+X+4]=s.x,S[et+X+5]=s.y,S[et+X+6]=s.z,S[et+X+7]=0),g===!0&&(s.fromBufferAttribute(k,j),S[et+X+8]=s.x,S[et+X+9]=s.y,S[et+X+10]=s.z,S[et+X+11]=k.itemSize===4?s.w:1)}}d={count:u,texture:R,size:new kt(T,M)},i.set(a,d),a.addEventListener("dispose",x)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,e);else{let p=0;for(let g=0;g<c.length;g++)p+=c[g];const m=a.morphTargetsRelative?1:1-p;l.getUniforms().setValue(n,"morphTargetBaseInfluence",m),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",d.texture,e),l.getUniforms().setValue(n,"morphTargetsTextureSize",d.size)}return{update:r}}function vT(n,t,e,i){let s=new WeakMap;function r(l){const c=i.render.frame,h=l.geometry,u=t.get(l,h);if(s.get(u)!==c&&(t.update(u),s.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),s.get(l)!==c&&(e.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&e.update(l.instanceColor,n.ARRAY_BUFFER),s.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;s.get(d)!==c&&(d.update(),s.set(d,c))}return u}function o(){s=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),e.remove(c.instanceMatrix),c.instanceColor!==null&&e.remove(c.instanceColor)}return{update:r,dispose:o}}class HE extends Fe{constructor(t,e,i,s,r,o,a,l,c,h=eo){if(h!==eo&&h!==lo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&h===eo&&(i=dr),i===void 0&&h===lo&&(i=ao),super(null,s,r,o,a,l,h,i,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Ze,this.minFilter=l!==void 0?l:Ze,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const kE=new Fe,yg=new HE(1,1),VE=new RE,zE=new DE,WE=new GE,Cg=[],xg=[],vg=new Float32Array(16),Bg=new Float32Array(9),Ig=new Float32Array(4);function yo(n,t,e){const i=n[0];if(i<=0||i>0)return n;const s=t*e;let r=Cg[s];if(r===void 0&&(r=new Float32Array(s),Cg[s]=r),t!==0){i.toArray(r,0);for(let o=1,a=0;o!==t;++o)a+=e,n[o].toArray(r,a)}return r}function ke(n,t){if(n.length!==t.length)return!1;for(let e=0,i=n.length;e<i;e++)if(n[e]!==t[e])return!1;return!0}function Ve(n,t){for(let e=0,i=t.length;e<i;e++)n[e]=t[e]}function lh(n,t){let e=xg[t];e===void 0&&(e=new Int32Array(t),xg[t]=e);for(let i=0;i!==t;++i)e[i]=n.allocateTextureUnit();return e}function BT(n,t){const e=this.cache;e[0]!==t&&(n.uniform1f(this.addr,t),e[0]=t)}function IT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ke(e,t))return;n.uniform2fv(this.addr,t),Ve(e,t)}}function bT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(n.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(ke(e,t))return;n.uniform3fv(this.addr,t),Ve(e,t)}}function MT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ke(e,t))return;n.uniform4fv(this.addr,t),Ve(e,t)}}function ST(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(ke(e,t))return;n.uniformMatrix2fv(this.addr,!1,t),Ve(e,t)}else{if(ke(e,i))return;Ig.set(i),n.uniformMatrix2fv(this.addr,!1,Ig),Ve(e,i)}}function TT(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(ke(e,t))return;n.uniformMatrix3fv(this.addr,!1,t),Ve(e,t)}else{if(ke(e,i))return;Bg.set(i),n.uniformMatrix3fv(this.addr,!1,Bg),Ve(e,i)}}function wT(n,t){const e=this.cache,i=t.elements;if(i===void 0){if(ke(e,t))return;n.uniformMatrix4fv(this.addr,!1,t),Ve(e,t)}else{if(ke(e,i))return;vg.set(i),n.uniformMatrix4fv(this.addr,!1,vg),Ve(e,i)}}function RT(n,t){const e=this.cache;e[0]!==t&&(n.uniform1i(this.addr,t),e[0]=t)}function DT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ke(e,t))return;n.uniform2iv(this.addr,t),Ve(e,t)}}function LT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(ke(e,t))return;n.uniform3iv(this.addr,t),Ve(e,t)}}function PT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ke(e,t))return;n.uniform4iv(this.addr,t),Ve(e,t)}}function FT(n,t){const e=this.cache;e[0]!==t&&(n.uniform1ui(this.addr,t),e[0]=t)}function UT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(n.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(ke(e,t))return;n.uniform2uiv(this.addr,t),Ve(e,t)}}function NT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(n.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(ke(e,t))return;n.uniform3uiv(this.addr,t),Ve(e,t)}}function OT(n,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(n.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(ke(e,t))return;n.uniform4uiv(this.addr,t),Ve(e,t)}}function GT(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);let r;this.type===n.SAMPLER_2D_SHADOW?(yg.compareFunction=ME,r=yg):r=kE,e.setTexture2D(t||r,s)}function QT(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture3D(t||zE,s)}function HT(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTextureCube(t||WE,s)}function kT(n,t,e){const i=this.cache,s=e.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),e.setTexture2DArray(t||VE,s)}function VT(n){switch(n){case 5126:return BT;case 35664:return IT;case 35665:return bT;case 35666:return MT;case 35674:return ST;case 35675:return TT;case 35676:return wT;case 5124:case 35670:return RT;case 35667:case 35671:return DT;case 35668:case 35672:return LT;case 35669:case 35673:return PT;case 5125:return FT;case 36294:return UT;case 36295:return NT;case 36296:return OT;case 35678:case 36198:case 36298:case 36306:case 35682:return GT;case 35679:case 36299:case 36307:return QT;case 35680:case 36300:case 36308:case 36293:return HT;case 36289:case 36303:case 36311:case 36292:return kT}}function zT(n,t){n.uniform1fv(this.addr,t)}function WT(n,t){const e=yo(t,this.size,2);n.uniform2fv(this.addr,e)}function JT(n,t){const e=yo(t,this.size,3);n.uniform3fv(this.addr,e)}function qT(n,t){const e=yo(t,this.size,4);n.uniform4fv(this.addr,e)}function jT(n,t){const e=yo(t,this.size,4);n.uniformMatrix2fv(this.addr,!1,e)}function XT(n,t){const e=yo(t,this.size,9);n.uniformMatrix3fv(this.addr,!1,e)}function KT(n,t){const e=yo(t,this.size,16);n.uniformMatrix4fv(this.addr,!1,e)}function YT(n,t){n.uniform1iv(this.addr,t)}function ZT(n,t){n.uniform2iv(this.addr,t)}function $T(n,t){n.uniform3iv(this.addr,t)}function tw(n,t){n.uniform4iv(this.addr,t)}function ew(n,t){n.uniform1uiv(this.addr,t)}function nw(n,t){n.uniform2uiv(this.addr,t)}function iw(n,t){n.uniform3uiv(this.addr,t)}function sw(n,t){n.uniform4uiv(this.addr,t)}function rw(n,t,e){const i=this.cache,s=t.length,r=lh(e,s);ke(i,r)||(n.uniform1iv(this.addr,r),Ve(i,r));for(let o=0;o!==s;++o)e.setTexture2D(t[o]||kE,r[o])}function ow(n,t,e){const i=this.cache,s=t.length,r=lh(e,s);ke(i,r)||(n.uniform1iv(this.addr,r),Ve(i,r));for(let o=0;o!==s;++o)e.setTexture3D(t[o]||zE,r[o])}function aw(n,t,e){const i=this.cache,s=t.length,r=lh(e,s);ke(i,r)||(n.uniform1iv(this.addr,r),Ve(i,r));for(let o=0;o!==s;++o)e.setTextureCube(t[o]||WE,r[o])}function lw(n,t,e){const i=this.cache,s=t.length,r=lh(e,s);ke(i,r)||(n.uniform1iv(this.addr,r),Ve(i,r));for(let o=0;o!==s;++o)e.setTexture2DArray(t[o]||VE,r[o])}function cw(n){switch(n){case 5126:return zT;case 35664:return WT;case 35665:return JT;case 35666:return qT;case 35674:return jT;case 35675:return XT;case 35676:return KT;case 5124:case 35670:return YT;case 35667:case 35671:return ZT;case 35668:case 35672:return $T;case 35669:case 35673:return tw;case 5125:return ew;case 36294:return nw;case 36295:return iw;case 36296:return sw;case 35678:case 36198:case 36298:case 36306:case 35682:return rw;case 35679:case 36299:case 36307:return ow;case 35680:case 36300:case 36308:case 36293:return aw;case 36289:case 36303:case 36311:case 36292:return lw}}class hw{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=VT(e.type)}}class uw{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=cw(e.type)}}class dw{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const s=this.seq;for(let r=0,o=s.length;r!==o;++r){const a=s[r];a.setValue(t,e[a.id],i)}}}const hu=/(\w+)(\])?(\[|\.)?/g;function bg(n,t){n.seq.push(t),n.map[t.id]=t}function fw(n,t,e){const i=n.name,s=i.length;for(hu.lastIndex=0;;){const r=hu.exec(i),o=hu.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===s){bg(e,c===void 0?new hw(a,n,t):new uw(a,n,t));break}else{let u=e.map[a];u===void 0&&(u=new dw(a),bg(e,u)),e=u}}}class fc{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const r=t.getActiveUniform(e,s),o=t.getUniformLocation(e,r.name);fw(r,o,this)}}setValue(t,e,i,s){const r=this.map[e];r!==void 0&&r.setValue(t,i,s)}setOptional(t,e,i){const s=e[i];s!==void 0&&this.setValue(t,i,s)}static upload(t,e,i,s){for(let r=0,o=e.length;r!==o;++r){const a=e[r],l=i[a.id];l.needsUpdate!==!1&&a.setValue(t,l.value,s)}}static seqWithValue(t,e){const i=[];for(let s=0,r=t.length;s!==r;++s){const o=t[s];o.id in e&&i.push(o)}return i}}function Mg(n,t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}const Aw=37297;let pw=0;function gw(n,t){const e=n.split(`
`),i=[],s=Math.max(t-6,0),r=Math.min(t+6,e.length);for(let o=s;o<r;o++){const a=o+1;i.push(`${a===t?">":" "} ${a}: ${e[o]}`)}return i.join(`
`)}const Sg=new Xt;function mw(n){ee._getMatrix(Sg,ee.workingColorSpace,n);const t=`mat3( ${Sg.elements.map(e=>e.toFixed(4))} )`;switch(ee.getTransfer(n)){case rh:return[t,"LinearTransferOETF"];case me:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[t,"LinearTransferOETF"]}}function Tg(n,t,e){const i=n.getShaderParameter(t,n.COMPILE_STATUS),s=n.getShaderInfoLog(t).trim();if(i&&s==="")return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const o=parseInt(r[1]);return e.toUpperCase()+`

`+s+`

`+gw(n.getShaderSource(t),o)}else return s}function _w(n,t){const e=mw(t);return[`vec4 ${n}( vec4 value ) {`,`	return ${e[1]}( vec4( value.rgb * ${e[0]}, value.a ) );`,"}"].join(`
`)}function Ew(n,t){let e;switch(t){case CI:e="Linear";break;case xI:e="Reinhard";break;case vI:e="Cineon";break;case BI:e="ACESFilmic";break;case bI:e="AgX";break;case MI:e="Neutral";break;case II:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+n+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}const Bl=new L;function yw(){ee.getLuminanceCoefficients(Bl);const n=Bl.x.toFixed(4),t=Bl.y.toFixed(4),e=Bl.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${t}, ${e} );`,"	return dot( weights, rgb );","}"].join(`
`)}function Cw(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Yo).join(`
`)}function xw(n){const t=[];for(const e in n){const i=n[e];i!==!1&&t.push("#define "+e+" "+i)}return t.join(`
`)}function vw(n,t){const e={},i=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const r=n.getActiveAttrib(t,s),o=r.name;let a=1;r.type===n.FLOAT_MAT2&&(a=2),r.type===n.FLOAT_MAT3&&(a=3),r.type===n.FLOAT_MAT4&&(a=4),e[o]={type:r.type,location:n.getAttribLocation(t,o),locationSize:a}}return e}function Yo(n){return n!==""}function wg(n,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Rg(n,t){return n.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Bw=/^[ \t]*#include +<([\w\d./]+)>/gm;function sf(n){return n.replace(Bw,bw)}const Iw=new Map;function bw(n,t){let e=Kt[t];if(e===void 0){const i=Iw.get(t);if(i!==void 0)e=Kt[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,i);else throw new Error("Can not resolve #include <"+t+">")}return sf(e)}const Mw=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Dg(n){return n.replace(Mw,Sw)}function Sw(n,t,e,i){let s="";for(let r=parseInt(t);r<parseInt(e);r++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return s}function Lg(n){let t=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?t+=`
#define HIGH_PRECISION`:n.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Tw(n){let t="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===fE?t="SHADOWMAP_TYPE_PCF":n.shadowMapType===tI?t="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Ji&&(t="SHADOWMAP_TYPE_VSM"),t}function ww(n){let t="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case ur:case oo:t="ENVMAP_TYPE_CUBE";break;case sh:t="ENVMAP_TYPE_CUBE_UV";break}return t}function Rw(n){let t="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case oo:t="ENVMAP_MODE_REFRACTION";break}return t}function Dw(n){let t="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case AE:t="ENVMAP_BLENDING_MULTIPLY";break;case EI:t="ENVMAP_BLENDING_MIX";break;case yI:t="ENVMAP_BLENDING_ADD";break}return t}function Lw(n){const t=n.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:i,maxMip:e}}function Pw(n,t,e,i){const s=n.getContext(),r=e.defines;let o=e.vertexShader,a=e.fragmentShader;const l=Tw(e),c=ww(e),h=Rw(e),u=Dw(e),d=Lw(e),f=Cw(e),p=xw(r),m=s.createProgram();let g,A,C=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(g=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,p].filter(Yo).join(`
`),g.length>0&&(g+=`
`),A=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,p].filter(Yo).join(`
`),A.length>0&&(A+=`
`)):(g=[Lg(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,p,e.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",e.batching?"#define USE_BATCHING":"",e.batchingColor?"#define USE_BATCHING_COLOR":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.instancingMorph?"#define USE_INSTANCING_MORPH":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Yo).join(`
`),A=[Lg(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,p,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.envMap?"#define "+h:"",e.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.dispersion?"#define USE_DISPERSION":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor||e.batchingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Ss?"#define TONE_MAPPING":"",e.toneMapping!==Ss?Kt.tonemapping_pars_fragment:"",e.toneMapping!==Ss?Ew("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Kt.colorspace_pars_fragment,_w("linearToOutputTexel",e.outputColorSpace),yw(),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(Yo).join(`
`)),o=sf(o),o=wg(o,e),o=Rg(o,e),a=sf(a),a=wg(a,e),a=Rg(a,e),o=Dg(o),a=Dg(a),e.isRawShaderMaterial!==!0&&(C=`#version 300 es
`,g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,A=["#define varying in",e.glslVersion===zp?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===zp?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+A);const E=C+g+o,_=C+A+a,T=Mg(s,s.VERTEX_SHADER,E),M=Mg(s,s.FRAGMENT_SHADER,_);s.attachShader(m,T),s.attachShader(m,M),e.index0AttributeName!==void 0?s.bindAttribLocation(m,0,e.index0AttributeName):e.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m);function S(D){if(n.debug.checkShaderErrors){const V=s.getProgramInfoLog(m).trim(),Q=s.getShaderInfoLog(T).trim(),k=s.getShaderInfoLog(M).trim();let et=!0,j=!0;if(s.getProgramParameter(m,s.LINK_STATUS)===!1)if(et=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,m,T,M);else{const X=Tg(s,T,"vertex"),U=Tg(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,s.VALIDATE_STATUS)+`

Material Name: `+D.name+`
Material Type: `+D.type+`

Program Info Log: `+V+`
`+X+`
`+U)}else V!==""?console.warn("THREE.WebGLProgram: Program Info Log:",V):(Q===""||k==="")&&(j=!1);j&&(D.diagnostics={runnable:et,programLog:V,vertexShader:{log:Q,prefix:g},fragmentShader:{log:k,prefix:A}})}s.deleteShader(T),s.deleteShader(M),R=new fc(s,m),B=vw(s,m)}let R;this.getUniforms=function(){return R===void 0&&S(this),R};let B;this.getAttributes=function(){return B===void 0&&S(this),B};let x=e.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return x===!1&&(x=s.getProgramParameter(m,Aw)),x},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=pw++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=T,this.fragmentShader=M,this}let Fw=0;class Uw{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,s=this._getShaderStage(e),r=this._getShaderStage(i),o=this._getShaderCacheForMaterial(t);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return i===void 0&&(i=new Nw(t),e.set(t,i)),i}}class Nw{constructor(t){this.id=Fw++,this.code=t,this.usedTimes=0}}function Ow(n,t,e,i,s,r,o){const a=new lA,l=new Uw,c=new Set,h=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let f=s.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(B){return c.add(B),B===0?"uv":`uv${B}`}function g(B,x,D,V,Q){const k=V.fog,et=Q.geometry,j=B.isMeshStandardMaterial?V.environment:null,X=(B.isMeshStandardMaterial?e:t).get(B.envMap||j),U=X&&X.mapping===sh?X.image.height:null,ut=p[B.type];B.precision!==null&&(f=s.getMaxPrecision(B.precision),f!==B.precision&&console.warn("THREE.WebGLProgram.getParameters:",B.precision,"not supported, using",f,"instead."));const gt=et.morphAttributes.position||et.morphAttributes.normal||et.morphAttributes.color,Et=gt!==void 0?gt.length:0;let Dt=0;et.morphAttributes.position!==void 0&&(Dt=1),et.morphAttributes.normal!==void 0&&(Dt=2),et.morphAttributes.color!==void 0&&(Dt=3);let Jt,at,mt,H;if(ut){const fe=xi[ut];Jt=fe.vertexShader,at=fe.fragmentShader}else Jt=B.vertexShader,at=B.fragmentShader,l.update(B),mt=l.getVertexShaderID(B),H=l.getFragmentShaderID(B);const ot=n.getRenderTarget(),vt=n.state.buffers.depth.getReversed(),Mt=Q.isInstancedMesh===!0,Vt=Q.isBatchedMesh===!0,ae=!!B.map,Zt=!!B.matcap,w=!!X,v=!!B.aoMap,z=!!B.lightMap,st=!!B.bumpMap,$=!!B.normalMap,K=!!B.displacementMap,ht=!!B.emissiveMap,nt=!!B.metalnessMap,I=!!B.roughnessMap,y=B.anisotropy>0,P=B.clearcoat>0,N=B.dispersion>0,J=B.iridescence>0,W=B.sheen>0,pt=B.transmission>0,dt=y&&!!B.anisotropyMap,ft=P&&!!B.clearcoatMap,zt=P&&!!B.clearcoatNormalMap,ct=P&&!!B.clearcoatRoughnessMap,yt=J&&!!B.iridescenceMap,Rt=J&&!!B.iridescenceThicknessMap,Ot=W&&!!B.sheenColorMap,St=W&&!!B.sheenRoughnessMap,Ht=!!B.specularMap,Gt=!!B.specularColorMap,de=!!B.specularIntensityMap,F=pt&&!!B.transmissionMap,xt=pt&&!!B.thicknessMap,rt=!!B.gradientMap,lt=!!B.alphaMap,bt=B.alphaTest>0,Bt=!!B.alphaHash,qt=!!B.extensions;let we=Ss;B.toneMapped&&(ot===null||ot.isXRRenderTarget===!0)&&(we=n.toneMapping);const nn={shaderID:ut,shaderType:B.type,shaderName:B.name,vertexShader:Jt,fragmentShader:at,defines:B.defines,customVertexShaderID:mt,customFragmentShaderID:H,isRawShaderMaterial:B.isRawShaderMaterial===!0,glslVersion:B.glslVersion,precision:f,batching:Vt,batchingColor:Vt&&Q._colorsTexture!==null,instancing:Mt,instancingColor:Mt&&Q.instanceColor!==null,instancingMorph:Mt&&Q.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ot===null?n.outputColorSpace:ot.isXRRenderTarget===!0?ot.texture.colorSpace:tn,alphaToCoverage:!!B.alphaToCoverage,map:ae,matcap:Zt,envMap:w,envMapMode:w&&X.mapping,envMapCubeUVHeight:U,aoMap:v,lightMap:z,bumpMap:st,normalMap:$,displacementMap:d&&K,emissiveMap:ht,normalMapObjectSpace:$&&B.normalMapType===LI,normalMapTangentSpace:$&&B.normalMapType===bE,metalnessMap:nt,roughnessMap:I,anisotropy:y,anisotropyMap:dt,clearcoat:P,clearcoatMap:ft,clearcoatNormalMap:zt,clearcoatRoughnessMap:ct,dispersion:N,iridescence:J,iridescenceMap:yt,iridescenceThicknessMap:Rt,sheen:W,sheenColorMap:Ot,sheenRoughnessMap:St,specularMap:Ht,specularColorMap:Gt,specularIntensityMap:de,transmission:pt,transmissionMap:F,thicknessMap:xt,gradientMap:rt,opaque:B.transparent===!1&&B.blending===is&&B.alphaToCoverage===!1,alphaMap:lt,alphaTest:bt,alphaHash:Bt,combine:B.combine,mapUv:ae&&m(B.map.channel),aoMapUv:v&&m(B.aoMap.channel),lightMapUv:z&&m(B.lightMap.channel),bumpMapUv:st&&m(B.bumpMap.channel),normalMapUv:$&&m(B.normalMap.channel),displacementMapUv:K&&m(B.displacementMap.channel),emissiveMapUv:ht&&m(B.emissiveMap.channel),metalnessMapUv:nt&&m(B.metalnessMap.channel),roughnessMapUv:I&&m(B.roughnessMap.channel),anisotropyMapUv:dt&&m(B.anisotropyMap.channel),clearcoatMapUv:ft&&m(B.clearcoatMap.channel),clearcoatNormalMapUv:zt&&m(B.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ct&&m(B.clearcoatRoughnessMap.channel),iridescenceMapUv:yt&&m(B.iridescenceMap.channel),iridescenceThicknessMapUv:Rt&&m(B.iridescenceThicknessMap.channel),sheenColorMapUv:Ot&&m(B.sheenColorMap.channel),sheenRoughnessMapUv:St&&m(B.sheenRoughnessMap.channel),specularMapUv:Ht&&m(B.specularMap.channel),specularColorMapUv:Gt&&m(B.specularColorMap.channel),specularIntensityMapUv:de&&m(B.specularIntensityMap.channel),transmissionMapUv:F&&m(B.transmissionMap.channel),thicknessMapUv:xt&&m(B.thicknessMap.channel),alphaMapUv:lt&&m(B.alphaMap.channel),vertexTangents:!!et.attributes.tangent&&($||y),vertexColors:B.vertexColors,vertexAlphas:B.vertexColors===!0&&!!et.attributes.color&&et.attributes.color.itemSize===4,pointsUvs:Q.isPoints===!0&&!!et.attributes.uv&&(ae||lt),fog:!!k,useFog:B.fog===!0,fogExp2:!!k&&k.isFogExp2,flatShading:B.flatShading===!0,sizeAttenuation:B.sizeAttenuation===!0,logarithmicDepthBuffer:u,reverseDepthBuffer:vt,skinning:Q.isSkinnedMesh===!0,morphTargets:et.morphAttributes.position!==void 0,morphNormals:et.morphAttributes.normal!==void 0,morphColors:et.morphAttributes.color!==void 0,morphTargetsCount:Et,morphTextureStride:Dt,numDirLights:x.directional.length,numPointLights:x.point.length,numSpotLights:x.spot.length,numSpotLightMaps:x.spotLightMap.length,numRectAreaLights:x.rectArea.length,numHemiLights:x.hemi.length,numDirLightShadows:x.directionalShadowMap.length,numPointLightShadows:x.pointShadowMap.length,numSpotLightShadows:x.spotShadowMap.length,numSpotLightShadowsWithMaps:x.numSpotLightShadowsWithMaps,numLightProbes:x.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:B.dithering,shadowMapEnabled:n.shadowMap.enabled&&D.length>0,shadowMapType:n.shadowMap.type,toneMapping:we,decodeVideoTexture:ae&&B.map.isVideoTexture===!0&&ee.getTransfer(B.map.colorSpace)===me,decodeVideoTextureEmissive:ht&&B.emissiveMap.isVideoTexture===!0&&ee.getTransfer(B.emissiveMap.colorSpace)===me,premultipliedAlpha:B.premultipliedAlpha,doubleSided:B.side===Un,flipSided:B.side===Mn,useDepthPacking:B.depthPacking>=0,depthPacking:B.depthPacking||0,index0AttributeName:B.index0AttributeName,extensionClipCullDistance:qt&&B.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(qt&&B.extensions.multiDraw===!0||Vt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:B.customProgramCacheKey()};return nn.vertexUv1s=c.has(1),nn.vertexUv2s=c.has(2),nn.vertexUv3s=c.has(3),c.clear(),nn}function A(B){const x=[];if(B.shaderID?x.push(B.shaderID):(x.push(B.customVertexShaderID),x.push(B.customFragmentShaderID)),B.defines!==void 0)for(const D in B.defines)x.push(D),x.push(B.defines[D]);return B.isRawShaderMaterial===!1&&(C(x,B),E(x,B),x.push(n.outputColorSpace)),x.push(B.customProgramCacheKey),x.join()}function C(B,x){B.push(x.precision),B.push(x.outputColorSpace),B.push(x.envMapMode),B.push(x.envMapCubeUVHeight),B.push(x.mapUv),B.push(x.alphaMapUv),B.push(x.lightMapUv),B.push(x.aoMapUv),B.push(x.bumpMapUv),B.push(x.normalMapUv),B.push(x.displacementMapUv),B.push(x.emissiveMapUv),B.push(x.metalnessMapUv),B.push(x.roughnessMapUv),B.push(x.anisotropyMapUv),B.push(x.clearcoatMapUv),B.push(x.clearcoatNormalMapUv),B.push(x.clearcoatRoughnessMapUv),B.push(x.iridescenceMapUv),B.push(x.iridescenceThicknessMapUv),B.push(x.sheenColorMapUv),B.push(x.sheenRoughnessMapUv),B.push(x.specularMapUv),B.push(x.specularColorMapUv),B.push(x.specularIntensityMapUv),B.push(x.transmissionMapUv),B.push(x.thicknessMapUv),B.push(x.combine),B.push(x.fogExp2),B.push(x.sizeAttenuation),B.push(x.morphTargetsCount),B.push(x.morphAttributeCount),B.push(x.numDirLights),B.push(x.numPointLights),B.push(x.numSpotLights),B.push(x.numSpotLightMaps),B.push(x.numHemiLights),B.push(x.numRectAreaLights),B.push(x.numDirLightShadows),B.push(x.numPointLightShadows),B.push(x.numSpotLightShadows),B.push(x.numSpotLightShadowsWithMaps),B.push(x.numLightProbes),B.push(x.shadowMapType),B.push(x.toneMapping),B.push(x.numClippingPlanes),B.push(x.numClipIntersection),B.push(x.depthPacking)}function E(B,x){a.disableAll(),x.supportsVertexTextures&&a.enable(0),x.instancing&&a.enable(1),x.instancingColor&&a.enable(2),x.instancingMorph&&a.enable(3),x.matcap&&a.enable(4),x.envMap&&a.enable(5),x.normalMapObjectSpace&&a.enable(6),x.normalMapTangentSpace&&a.enable(7),x.clearcoat&&a.enable(8),x.iridescence&&a.enable(9),x.alphaTest&&a.enable(10),x.vertexColors&&a.enable(11),x.vertexAlphas&&a.enable(12),x.vertexUv1s&&a.enable(13),x.vertexUv2s&&a.enable(14),x.vertexUv3s&&a.enable(15),x.vertexTangents&&a.enable(16),x.anisotropy&&a.enable(17),x.alphaHash&&a.enable(18),x.batching&&a.enable(19),x.dispersion&&a.enable(20),x.batchingColor&&a.enable(21),B.push(a.mask),a.disableAll(),x.fog&&a.enable(0),x.useFog&&a.enable(1),x.flatShading&&a.enable(2),x.logarithmicDepthBuffer&&a.enable(3),x.reverseDepthBuffer&&a.enable(4),x.skinning&&a.enable(5),x.morphTargets&&a.enable(6),x.morphNormals&&a.enable(7),x.morphColors&&a.enable(8),x.premultipliedAlpha&&a.enable(9),x.shadowMapEnabled&&a.enable(10),x.doubleSided&&a.enable(11),x.flipSided&&a.enable(12),x.useDepthPacking&&a.enable(13),x.dithering&&a.enable(14),x.transmission&&a.enable(15),x.sheen&&a.enable(16),x.opaque&&a.enable(17),x.pointsUvs&&a.enable(18),x.decodeVideoTexture&&a.enable(19),x.decodeVideoTextureEmissive&&a.enable(20),x.alphaToCoverage&&a.enable(21),B.push(a.mask)}function _(B){const x=p[B.type];let D;if(x){const V=xi[x];D=xb.clone(V.uniforms)}else D=B.uniforms;return D}function T(B,x){let D;for(let V=0,Q=h.length;V<Q;V++){const k=h[V];if(k.cacheKey===x){D=k,++D.usedTimes;break}}return D===void 0&&(D=new Pw(n,x,B,r),h.push(D)),D}function M(B){if(--B.usedTimes===0){const x=h.indexOf(B);h[x]=h[h.length-1],h.pop(),B.destroy()}}function S(B){l.remove(B)}function R(){l.dispose()}return{getParameters:g,getProgramCacheKey:A,getUniforms:_,acquireProgram:T,releaseProgram:M,releaseShaderCache:S,programs:h,dispose:R}}function Gw(){let n=new WeakMap;function t(o){return n.has(o)}function e(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function s(o,a,l){n.get(o)[a]=l}function r(){n=new WeakMap}return{has:t,get:e,remove:i,update:s,dispose:r}}function Qw(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.material.id!==t.material.id?n.material.id-t.material.id:n.z!==t.z?n.z-t.z:n.id-t.id}function Pg(n,t){return n.groupOrder!==t.groupOrder?n.groupOrder-t.groupOrder:n.renderOrder!==t.renderOrder?n.renderOrder-t.renderOrder:n.z!==t.z?t.z-n.z:n.id-t.id}function Fg(){const n=[];let t=0;const e=[],i=[],s=[];function r(){t=0,e.length=0,i.length=0,s.length=0}function o(u,d,f,p,m,g){let A=n[t];return A===void 0?(A={id:u.id,object:u,geometry:d,material:f,groupOrder:p,renderOrder:u.renderOrder,z:m,group:g},n[t]=A):(A.id=u.id,A.object=u,A.geometry=d,A.material=f,A.groupOrder=p,A.renderOrder=u.renderOrder,A.z=m,A.group=g),t++,A}function a(u,d,f,p,m,g){const A=o(u,d,f,p,m,g);f.transmission>0?i.push(A):f.transparent===!0?s.push(A):e.push(A)}function l(u,d,f,p,m,g){const A=o(u,d,f,p,m,g);f.transmission>0?i.unshift(A):f.transparent===!0?s.unshift(A):e.unshift(A)}function c(u,d){e.length>1&&e.sort(u||Qw),i.length>1&&i.sort(d||Pg),s.length>1&&s.sort(d||Pg)}function h(){for(let u=t,d=n.length;u<d;u++){const f=n[u];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:e,transmissive:i,transparent:s,init:r,push:a,unshift:l,finish:h,sort:c}}function Hw(){let n=new WeakMap;function t(i,s){const r=n.get(i);let o;return r===void 0?(o=new Fg,n.set(i,[o])):s>=r.length?(o=new Fg,r.push(o)):o=r[s],o}function e(){n=new WeakMap}return{get:t,dispose:e}}function kw(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new L,color:new tt};break;case"SpotLight":e={position:new L,direction:new L,color:new tt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new L,color:new tt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new L,skyColor:new tt,groundColor:new tt};break;case"RectAreaLight":e={color:new tt,position:new L,halfWidth:new L,halfHeight:new L};break}return n[t.id]=e,e}}}function Vw(){const n={};return{get:function(t){if(n[t.id]!==void 0)return n[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kt};break;case"SpotLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kt};break;case"PointLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new kt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[t.id]=e,e}}}let zw=0;function Ww(n,t){return(t.castShadow?2:0)-(n.castShadow?2:0)+(t.map?1:0)-(n.map?1:0)}function Jw(n){const t=new kw,e=Vw(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new L);const s=new L,r=new wt,o=new wt;function a(c){let h=0,u=0,d=0;for(let B=0;B<9;B++)i.probe[B].set(0,0,0);let f=0,p=0,m=0,g=0,A=0,C=0,E=0,_=0,T=0,M=0,S=0;c.sort(Ww);for(let B=0,x=c.length;B<x;B++){const D=c[B],V=D.color,Q=D.intensity,k=D.distance,et=D.shadow&&D.shadow.map?D.shadow.map.texture:null;if(D.isAmbientLight)h+=V.r*Q,u+=V.g*Q,d+=V.b*Q;else if(D.isLightProbe){for(let j=0;j<9;j++)i.probe[j].addScaledVector(D.sh.coefficients[j],Q);S++}else if(D.isDirectionalLight){const j=t.get(D);if(j.color.copy(D.color).multiplyScalar(D.intensity),D.castShadow){const X=D.shadow,U=e.get(D);U.shadowIntensity=X.intensity,U.shadowBias=X.bias,U.shadowNormalBias=X.normalBias,U.shadowRadius=X.radius,U.shadowMapSize=X.mapSize,i.directionalShadow[f]=U,i.directionalShadowMap[f]=et,i.directionalShadowMatrix[f]=D.shadow.matrix,C++}i.directional[f]=j,f++}else if(D.isSpotLight){const j=t.get(D);j.position.setFromMatrixPosition(D.matrixWorld),j.color.copy(V).multiplyScalar(Q),j.distance=k,j.coneCos=Math.cos(D.angle),j.penumbraCos=Math.cos(D.angle*(1-D.penumbra)),j.decay=D.decay,i.spot[m]=j;const X=D.shadow;if(D.map&&(i.spotLightMap[T]=D.map,T++,X.updateMatrices(D),D.castShadow&&M++),i.spotLightMatrix[m]=X.matrix,D.castShadow){const U=e.get(D);U.shadowIntensity=X.intensity,U.shadowBias=X.bias,U.shadowNormalBias=X.normalBias,U.shadowRadius=X.radius,U.shadowMapSize=X.mapSize,i.spotShadow[m]=U,i.spotShadowMap[m]=et,_++}m++}else if(D.isRectAreaLight){const j=t.get(D);j.color.copy(V).multiplyScalar(Q),j.halfWidth.set(D.width*.5,0,0),j.halfHeight.set(0,D.height*.5,0),i.rectArea[g]=j,g++}else if(D.isPointLight){const j=t.get(D);if(j.color.copy(D.color).multiplyScalar(D.intensity),j.distance=D.distance,j.decay=D.decay,D.castShadow){const X=D.shadow,U=e.get(D);U.shadowIntensity=X.intensity,U.shadowBias=X.bias,U.shadowNormalBias=X.normalBias,U.shadowRadius=X.radius,U.shadowMapSize=X.mapSize,U.shadowCameraNear=X.camera.near,U.shadowCameraFar=X.camera.far,i.pointShadow[p]=U,i.pointShadowMap[p]=et,i.pointShadowMatrix[p]=D.shadow.matrix,E++}i.point[p]=j,p++}else if(D.isHemisphereLight){const j=t.get(D);j.skyColor.copy(D.color).multiplyScalar(Q),j.groundColor.copy(D.groundColor).multiplyScalar(Q),i.hemi[A]=j,A++}}g>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ct.LTC_FLOAT_1,i.rectAreaLTC2=Ct.LTC_FLOAT_2):(i.rectAreaLTC1=Ct.LTC_HALF_1,i.rectAreaLTC2=Ct.LTC_HALF_2)),i.ambient[0]=h,i.ambient[1]=u,i.ambient[2]=d;const R=i.hash;(R.directionalLength!==f||R.pointLength!==p||R.spotLength!==m||R.rectAreaLength!==g||R.hemiLength!==A||R.numDirectionalShadows!==C||R.numPointShadows!==E||R.numSpotShadows!==_||R.numSpotMaps!==T||R.numLightProbes!==S)&&(i.directional.length=f,i.spot.length=m,i.rectArea.length=g,i.point.length=p,i.hemi.length=A,i.directionalShadow.length=C,i.directionalShadowMap.length=C,i.pointShadow.length=E,i.pointShadowMap.length=E,i.spotShadow.length=_,i.spotShadowMap.length=_,i.directionalShadowMatrix.length=C,i.pointShadowMatrix.length=E,i.spotLightMatrix.length=_+T-M,i.spotLightMap.length=T,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=S,R.directionalLength=f,R.pointLength=p,R.spotLength=m,R.rectAreaLength=g,R.hemiLength=A,R.numDirectionalShadows=C,R.numPointShadows=E,R.numSpotShadows=_,R.numSpotMaps=T,R.numLightProbes=S,i.version=zw++)}function l(c,h){let u=0,d=0,f=0,p=0,m=0;const g=h.matrixWorldInverse;for(let A=0,C=c.length;A<C;A++){const E=c[A];if(E.isDirectionalLight){const _=i.directional[u];_.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(g),u++}else if(E.isSpotLight){const _=i.spot[f];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(g),_.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(g),f++}else if(E.isRectAreaLight){const _=i.rectArea[p];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(g),o.identity(),r.copy(E.matrixWorld),r.premultiply(g),o.extractRotation(r),_.halfWidth.set(E.width*.5,0,0),_.halfHeight.set(0,E.height*.5,0),_.halfWidth.applyMatrix4(o),_.halfHeight.applyMatrix4(o),p++}else if(E.isPointLight){const _=i.point[d];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(g),d++}else if(E.isHemisphereLight){const _=i.hemi[m];_.direction.setFromMatrixPosition(E.matrixWorld),_.direction.transformDirection(g),m++}}}return{setup:a,setupView:l,state:i}}function Ug(n){const t=new Jw(n),e=[],i=[];function s(h){c.camera=h,e.length=0,i.length=0}function r(h){e.push(h)}function o(h){i.push(h)}function a(){t.setup(e)}function l(h){t.setupView(e,h)}const c={lightsArray:e,shadowsArray:i,camera:null,lights:t,transmissionRenderTarget:{}};return{init:s,state:c,setupLights:a,setupLightsView:l,pushLight:r,pushShadow:o}}function qw(n){let t=new WeakMap;function e(s,r=0){const o=t.get(s);let a;return o===void 0?(a=new Ug(n),t.set(s,[a])):r>=o.length?(a=new Ug(n),o.push(a)):a=o[r],a}function i(){t=new WeakMap}return{get:e,dispose:i}}class jw extends wi{static get type(){return"MeshDepthMaterial"}constructor(t){super(),this.isMeshDepthMaterial=!0,this.depthPacking=RI,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Xw extends wi{static get type(){return"MeshDistanceMaterial"}constructor(t){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const Kw=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Yw=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Zw(n,t,e){let i=new oh;const s=new kt,r=new kt,o=new oe,a=new jw({depthPacking:DI}),l=new Xw,c={},h=e.maxTextureSize,u={[os]:Mn,[Mn]:os,[Un]:Un},d=new di({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new kt},radius:{value:4}},vertexShader:Kw,fragmentShader:Yw}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new en;p.setAttribute("position",new Ue(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Ye(p,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=fE;let A=this.type;this.render=function(M,S,R){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||M.length===0)return;const B=n.getRenderTarget(),x=n.getActiveCubeFace(),D=n.getActiveMipmapLevel(),V=n.state;V.setBlending(Ms),V.buffers.color.setClear(1,1,1,1),V.buffers.depth.setTest(!0),V.setScissorTest(!1);const Q=A!==Ji&&this.type===Ji,k=A===Ji&&this.type!==Ji;for(let et=0,j=M.length;et<j;et++){const X=M[et],U=X.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",X,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;s.copy(U.mapSize);const ut=U.getFrameExtents();if(s.multiply(ut),r.copy(U.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/ut.x),s.x=r.x*ut.x,U.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/ut.y),s.y=r.y*ut.y,U.mapSize.y=r.y)),U.map===null||Q===!0||k===!0){const Et=this.type!==Ji?{minFilter:Ze,magFilter:Ze}:{};U.map!==null&&U.map.dispose(),U.map=new Ds(s.x,s.y,Et),U.map.texture.name=X.name+".shadowMap",U.camera.updateProjectionMatrix()}n.setRenderTarget(U.map),n.clear();const gt=U.getViewportCount();for(let Et=0;Et<gt;Et++){const Dt=U.getViewport(Et);o.set(r.x*Dt.x,r.y*Dt.y,r.x*Dt.z,r.y*Dt.w),V.viewport(o),U.updateMatrices(X,Et),i=U.getFrustum(),_(S,R,U.camera,X,this.type)}U.isPointLightShadow!==!0&&this.type===Ji&&C(U,R),U.needsUpdate=!1}A=this.type,g.needsUpdate=!1,n.setRenderTarget(B,x,D)};function C(M,S){const R=t.update(m);d.defines.VSM_SAMPLES!==M.blurSamples&&(d.defines.VSM_SAMPLES=M.blurSamples,f.defines.VSM_SAMPLES=M.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new Ds(s.x,s.y)),d.uniforms.shadow_pass.value=M.map.texture,d.uniforms.resolution.value=M.mapSize,d.uniforms.radius.value=M.radius,n.setRenderTarget(M.mapPass),n.clear(),n.renderBufferDirect(S,null,R,d,m,null),f.uniforms.shadow_pass.value=M.mapPass.texture,f.uniforms.resolution.value=M.mapSize,f.uniforms.radius.value=M.radius,n.setRenderTarget(M.map),n.clear(),n.renderBufferDirect(S,null,R,f,m,null)}function E(M,S,R,B){let x=null;const D=R.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(D!==void 0)x=D;else if(x=R.isPointLight===!0?l:a,n.localClippingEnabled&&S.clipShadows===!0&&Array.isArray(S.clippingPlanes)&&S.clippingPlanes.length!==0||S.displacementMap&&S.displacementScale!==0||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const V=x.uuid,Q=S.uuid;let k=c[V];k===void 0&&(k={},c[V]=k);let et=k[Q];et===void 0&&(et=x.clone(),k[Q]=et,S.addEventListener("dispose",T)),x=et}if(x.visible=S.visible,x.wireframe=S.wireframe,B===Ji?x.side=S.shadowSide!==null?S.shadowSide:S.side:x.side=S.shadowSide!==null?S.shadowSide:u[S.side],x.alphaMap=S.alphaMap,x.alphaTest=S.alphaTest,x.map=S.map,x.clipShadows=S.clipShadows,x.clippingPlanes=S.clippingPlanes,x.clipIntersection=S.clipIntersection,x.displacementMap=S.displacementMap,x.displacementScale=S.displacementScale,x.displacementBias=S.displacementBias,x.wireframeLinewidth=S.wireframeLinewidth,x.linewidth=S.linewidth,R.isPointLight===!0&&x.isMeshDistanceMaterial===!0){const V=n.properties.get(x);V.light=R}return x}function _(M,S,R,B,x){if(M.visible===!1)return;if(M.layers.test(S.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&x===Ji)&&(!M.frustumCulled||i.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(R.matrixWorldInverse,M.matrixWorld);const Q=t.update(M),k=M.material;if(Array.isArray(k)){const et=Q.groups;for(let j=0,X=et.length;j<X;j++){const U=et[j],ut=k[U.materialIndex];if(ut&&ut.visible){const gt=E(M,ut,B,x);M.onBeforeShadow(n,M,S,R,Q,gt,U),n.renderBufferDirect(R,null,Q,gt,M,U),M.onAfterShadow(n,M,S,R,Q,gt,U)}}}else if(k.visible){const et=E(M,k,B,x);M.onBeforeShadow(n,M,S,R,Q,et,null),n.renderBufferDirect(R,null,Q,et,M,null),M.onAfterShadow(n,M,S,R,Q,et,null)}}const V=M.children;for(let Q=0,k=V.length;Q<k;Q++)_(V[Q],S,R,B,x)}function T(M){M.target.removeEventListener("dispose",T);for(const R in c){const B=c[R],x=M.target.uuid;x in B&&(B[x].dispose(),delete B[x])}}}const $w={[Sd]:Td,[wd]:Ld,[Rd]:Pd,[ro]:Dd,[Td]:Sd,[Ld]:wd,[Pd]:Rd,[Dd]:ro};function t1(n,t){function e(){let F=!1;const xt=new oe;let rt=null;const lt=new oe(0,0,0,0);return{setMask:function(bt){rt!==bt&&!F&&(n.colorMask(bt,bt,bt,bt),rt=bt)},setLocked:function(bt){F=bt},setClear:function(bt,Bt,qt,we,nn){nn===!0&&(bt*=we,Bt*=we,qt*=we),xt.set(bt,Bt,qt,we),lt.equals(xt)===!1&&(n.clearColor(bt,Bt,qt,we),lt.copy(xt))},reset:function(){F=!1,rt=null,lt.set(-1,0,0,0)}}}function i(){let F=!1,xt=!1,rt=null,lt=null,bt=null;return{setReversed:function(Bt){if(xt!==Bt){const qt=t.get("EXT_clip_control");xt?qt.clipControlEXT(qt.LOWER_LEFT_EXT,qt.ZERO_TO_ONE_EXT):qt.clipControlEXT(qt.LOWER_LEFT_EXT,qt.NEGATIVE_ONE_TO_ONE_EXT);const we=bt;bt=null,this.setClear(we)}xt=Bt},getReversed:function(){return xt},setTest:function(Bt){Bt?ot(n.DEPTH_TEST):vt(n.DEPTH_TEST)},setMask:function(Bt){rt!==Bt&&!F&&(n.depthMask(Bt),rt=Bt)},setFunc:function(Bt){if(xt&&(Bt=$w[Bt]),lt!==Bt){switch(Bt){case Sd:n.depthFunc(n.NEVER);break;case Td:n.depthFunc(n.ALWAYS);break;case wd:n.depthFunc(n.LESS);break;case ro:n.depthFunc(n.LEQUAL);break;case Rd:n.depthFunc(n.EQUAL);break;case Dd:n.depthFunc(n.GEQUAL);break;case Ld:n.depthFunc(n.GREATER);break;case Pd:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}lt=Bt}},setLocked:function(Bt){F=Bt},setClear:function(Bt){bt!==Bt&&(xt&&(Bt=1-Bt),n.clearDepth(Bt),bt=Bt)},reset:function(){F=!1,rt=null,lt=null,bt=null,xt=!1}}}function s(){let F=!1,xt=null,rt=null,lt=null,bt=null,Bt=null,qt=null,we=null,nn=null;return{setTest:function(fe){F||(fe?ot(n.STENCIL_TEST):vt(n.STENCIL_TEST))},setMask:function(fe){xt!==fe&&!F&&(n.stencilMask(fe),xt=fe)},setFunc:function(fe,Xn,Ui){(rt!==fe||lt!==Xn||bt!==Ui)&&(n.stencilFunc(fe,Xn,Ui),rt=fe,lt=Xn,bt=Ui)},setOp:function(fe,Xn,Ui){(Bt!==fe||qt!==Xn||we!==Ui)&&(n.stencilOp(fe,Xn,Ui),Bt=fe,qt=Xn,we=Ui)},setLocked:function(fe){F=fe},setClear:function(fe){nn!==fe&&(n.clearStencil(fe),nn=fe)},reset:function(){F=!1,xt=null,rt=null,lt=null,bt=null,Bt=null,qt=null,we=null,nn=null}}}const r=new e,o=new i,a=new s,l=new WeakMap,c=new WeakMap;let h={},u={},d=new WeakMap,f=[],p=null,m=!1,g=null,A=null,C=null,E=null,_=null,T=null,M=null,S=new tt(0,0,0),R=0,B=!1,x=null,D=null,V=null,Q=null,k=null;const et=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let j=!1,X=0;const U=n.getParameter(n.VERSION);U.indexOf("WebGL")!==-1?(X=parseFloat(/^WebGL (\d)/.exec(U)[1]),j=X>=1):U.indexOf("OpenGL ES")!==-1&&(X=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),j=X>=2);let ut=null,gt={};const Et=n.getParameter(n.SCISSOR_BOX),Dt=n.getParameter(n.VIEWPORT),Jt=new oe().fromArray(Et),at=new oe().fromArray(Dt);function mt(F,xt,rt,lt){const bt=new Uint8Array(4),Bt=n.createTexture();n.bindTexture(F,Bt),n.texParameteri(F,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(F,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let qt=0;qt<rt;qt++)F===n.TEXTURE_3D||F===n.TEXTURE_2D_ARRAY?n.texImage3D(xt,0,n.RGBA,1,1,lt,0,n.RGBA,n.UNSIGNED_BYTE,bt):n.texImage2D(xt+qt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,bt);return Bt}const H={};H[n.TEXTURE_2D]=mt(n.TEXTURE_2D,n.TEXTURE_2D,1),H[n.TEXTURE_CUBE_MAP]=mt(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),H[n.TEXTURE_2D_ARRAY]=mt(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),H[n.TEXTURE_3D]=mt(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),o.setClear(1),a.setClear(0),ot(n.DEPTH_TEST),o.setFunc(ro),st(!1),$(Fp),ot(n.CULL_FACE),v(Ms);function ot(F){h[F]!==!0&&(n.enable(F),h[F]=!0)}function vt(F){h[F]!==!1&&(n.disable(F),h[F]=!1)}function Mt(F,xt){return u[F]!==xt?(n.bindFramebuffer(F,xt),u[F]=xt,F===n.DRAW_FRAMEBUFFER&&(u[n.FRAMEBUFFER]=xt),F===n.FRAMEBUFFER&&(u[n.DRAW_FRAMEBUFFER]=xt),!0):!1}function Vt(F,xt){let rt=f,lt=!1;if(F){rt=d.get(xt),rt===void 0&&(rt=[],d.set(xt,rt));const bt=F.textures;if(rt.length!==bt.length||rt[0]!==n.COLOR_ATTACHMENT0){for(let Bt=0,qt=bt.length;Bt<qt;Bt++)rt[Bt]=n.COLOR_ATTACHMENT0+Bt;rt.length=bt.length,lt=!0}}else rt[0]!==n.BACK&&(rt[0]=n.BACK,lt=!0);lt&&n.drawBuffers(rt)}function ae(F){return p!==F?(n.useProgram(F),p=F,!0):!1}const Zt={[$s]:n.FUNC_ADD,[nI]:n.FUNC_SUBTRACT,[iI]:n.FUNC_REVERSE_SUBTRACT};Zt[sI]=n.MIN,Zt[rI]=n.MAX;const w={[oI]:n.ZERO,[aI]:n.ONE,[lI]:n.SRC_COLOR,[bd]:n.SRC_ALPHA,[AI]:n.SRC_ALPHA_SATURATE,[dI]:n.DST_COLOR,[hI]:n.DST_ALPHA,[cI]:n.ONE_MINUS_SRC_COLOR,[Md]:n.ONE_MINUS_SRC_ALPHA,[fI]:n.ONE_MINUS_DST_COLOR,[uI]:n.ONE_MINUS_DST_ALPHA,[pI]:n.CONSTANT_COLOR,[gI]:n.ONE_MINUS_CONSTANT_COLOR,[mI]:n.CONSTANT_ALPHA,[_I]:n.ONE_MINUS_CONSTANT_ALPHA};function v(F,xt,rt,lt,bt,Bt,qt,we,nn,fe){if(F===Ms){m===!0&&(vt(n.BLEND),m=!1);return}if(m===!1&&(ot(n.BLEND),m=!0),F!==eI){if(F!==g||fe!==B){if((A!==$s||_!==$s)&&(n.blendEquation(n.FUNC_ADD),A=$s,_=$s),fe)switch(F){case is:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Up:n.blendFunc(n.ONE,n.ONE);break;case Np:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Op:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}else switch(F){case is:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Up:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case Np:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Op:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",F);break}C=null,E=null,T=null,M=null,S.set(0,0,0),R=0,g=F,B=fe}return}bt=bt||xt,Bt=Bt||rt,qt=qt||lt,(xt!==A||bt!==_)&&(n.blendEquationSeparate(Zt[xt],Zt[bt]),A=xt,_=bt),(rt!==C||lt!==E||Bt!==T||qt!==M)&&(n.blendFuncSeparate(w[rt],w[lt],w[Bt],w[qt]),C=rt,E=lt,T=Bt,M=qt),(we.equals(S)===!1||nn!==R)&&(n.blendColor(we.r,we.g,we.b,nn),S.copy(we),R=nn),g=F,B=!1}function z(F,xt){F.side===Un?vt(n.CULL_FACE):ot(n.CULL_FACE);let rt=F.side===Mn;xt&&(rt=!rt),st(rt),F.blending===is&&F.transparent===!1?v(Ms):v(F.blending,F.blendEquation,F.blendSrc,F.blendDst,F.blendEquationAlpha,F.blendSrcAlpha,F.blendDstAlpha,F.blendColor,F.blendAlpha,F.premultipliedAlpha),o.setFunc(F.depthFunc),o.setTest(F.depthTest),o.setMask(F.depthWrite),r.setMask(F.colorWrite);const lt=F.stencilWrite;a.setTest(lt),lt&&(a.setMask(F.stencilWriteMask),a.setFunc(F.stencilFunc,F.stencilRef,F.stencilFuncMask),a.setOp(F.stencilFail,F.stencilZFail,F.stencilZPass)),ht(F.polygonOffset,F.polygonOffsetFactor,F.polygonOffsetUnits),F.alphaToCoverage===!0?ot(n.SAMPLE_ALPHA_TO_COVERAGE):vt(n.SAMPLE_ALPHA_TO_COVERAGE)}function st(F){x!==F&&(F?n.frontFace(n.CW):n.frontFace(n.CCW),x=F)}function $(F){F!==ZB?(ot(n.CULL_FACE),F!==D&&(F===Fp?n.cullFace(n.BACK):F===$B?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):vt(n.CULL_FACE),D=F}function K(F){F!==V&&(j&&n.lineWidth(F),V=F)}function ht(F,xt,rt){F?(ot(n.POLYGON_OFFSET_FILL),(Q!==xt||k!==rt)&&(n.polygonOffset(xt,rt),Q=xt,k=rt)):vt(n.POLYGON_OFFSET_FILL)}function nt(F){F?ot(n.SCISSOR_TEST):vt(n.SCISSOR_TEST)}function I(F){F===void 0&&(F=n.TEXTURE0+et-1),ut!==F&&(n.activeTexture(F),ut=F)}function y(F,xt,rt){rt===void 0&&(ut===null?rt=n.TEXTURE0+et-1:rt=ut);let lt=gt[rt];lt===void 0&&(lt={type:void 0,texture:void 0},gt[rt]=lt),(lt.type!==F||lt.texture!==xt)&&(ut!==rt&&(n.activeTexture(rt),ut=rt),n.bindTexture(F,xt||H[F]),lt.type=F,lt.texture=xt)}function P(){const F=gt[ut];F!==void 0&&F.type!==void 0&&(n.bindTexture(F.type,null),F.type=void 0,F.texture=void 0)}function N(){try{n.compressedTexImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function J(){try{n.compressedTexImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function W(){try{n.texSubImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function pt(){try{n.texSubImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function dt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ft(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function zt(){try{n.texStorage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function ct(){try{n.texStorage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function yt(){try{n.texImage2D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Rt(){try{n.texImage3D.apply(n,arguments)}catch(F){console.error("THREE.WebGLState:",F)}}function Ot(F){Jt.equals(F)===!1&&(n.scissor(F.x,F.y,F.z,F.w),Jt.copy(F))}function St(F){at.equals(F)===!1&&(n.viewport(F.x,F.y,F.z,F.w),at.copy(F))}function Ht(F,xt){let rt=c.get(xt);rt===void 0&&(rt=new WeakMap,c.set(xt,rt));let lt=rt.get(F);lt===void 0&&(lt=n.getUniformBlockIndex(xt,F.name),rt.set(F,lt))}function Gt(F,xt){const lt=c.get(xt).get(F);l.get(xt)!==lt&&(n.uniformBlockBinding(xt,lt,F.__bindingPointIndex),l.set(xt,lt))}function de(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},ut=null,gt={},u={},d=new WeakMap,f=[],p=null,m=!1,g=null,A=null,C=null,E=null,_=null,T=null,M=null,S=new tt(0,0,0),R=0,B=!1,x=null,D=null,V=null,Q=null,k=null,Jt.set(0,0,n.canvas.width,n.canvas.height),at.set(0,0,n.canvas.width,n.canvas.height),r.reset(),o.reset(),a.reset()}return{buffers:{color:r,depth:o,stencil:a},enable:ot,disable:vt,bindFramebuffer:Mt,drawBuffers:Vt,useProgram:ae,setBlending:v,setMaterial:z,setFlipSided:st,setCullFace:$,setLineWidth:K,setPolygonOffset:ht,setScissorTest:nt,activeTexture:I,bindTexture:y,unbindTexture:P,compressedTexImage2D:N,compressedTexImage3D:J,texImage2D:yt,texImage3D:Rt,updateUBOMapping:Ht,uniformBlockBinding:Gt,texStorage2D:zt,texStorage3D:ct,texSubImage2D:W,texSubImage3D:pt,compressedTexSubImage2D:dt,compressedTexSubImage3D:ft,scissor:Ot,viewport:St,reset:de}}function Ng(n,t,e,i){const s=e1(i);switch(e){case yE:return n*t;case xE:return n*t;case vE:return n*t*2;case Bs:return n*t/s.components*s.byteLength;case sA:return n*t/s.components*s.byteLength;case er:return n*t*2/s.components*s.byteLength;case rA:return n*t*2/s.components*s.byteLength;case CE:return n*t*3/s.components*s.byteLength;case Qe:return n*t*4/s.components*s.byteLength;case oA:return n*t*4/s.components*s.byteLength;case uc:case la:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case dc:case ca:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case Nd:case Od:return Math.max(n,16)*Math.max(t,8)/4;case Mc:case Sc:return Math.max(n,8)*Math.max(t,8)/2;case Tc:case wc:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*8;case Rc:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case Ma:return Math.floor((n+3)/4)*Math.floor((t+3)/4)*16;case Gd:return Math.floor((n+4)/5)*Math.floor((t+3)/4)*16;case Qd:return Math.floor((n+4)/5)*Math.floor((t+4)/5)*16;case Hd:return Math.floor((n+5)/6)*Math.floor((t+4)/5)*16;case Sa:return Math.floor((n+5)/6)*Math.floor((t+5)/6)*16;case kd:return Math.floor((n+7)/8)*Math.floor((t+4)/5)*16;case Vd:return Math.floor((n+7)/8)*Math.floor((t+5)/6)*16;case zd:return Math.floor((n+7)/8)*Math.floor((t+7)/8)*16;case Wd:return Math.floor((n+9)/10)*Math.floor((t+4)/5)*16;case Jd:return Math.floor((n+9)/10)*Math.floor((t+5)/6)*16;case qd:return Math.floor((n+9)/10)*Math.floor((t+7)/8)*16;case jd:return Math.floor((n+9)/10)*Math.floor((t+9)/10)*16;case Xd:return Math.floor((n+11)/12)*Math.floor((t+9)/10)*16;case Kd:return Math.floor((n+11)/12)*Math.floor((t+11)/12)*16;case ha:case Yd:case Dc:return Math.ceil(n/4)*Math.ceil(t/4)*16;case BE:case Zd:return Math.ceil(n/4)*Math.ceil(t/4)*8;case $d:case tf:return Math.ceil(n/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function e1(n){switch(n){case We:case mE:return{byteLength:1,components:1};case ba:case _E:case si:return{byteLength:2,components:1};case nA:case iA:return{byteLength:2,components:4};case dr:case eA:case Ke:return{byteLength:4,components:1};case EE:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}function n1(n,t,e,i,s,r,o){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new kt,h=new WeakMap;let u;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(I,y){return f?new OffscreenCanvas(I,y):Ra("canvas")}function m(I,y,P){let N=1;const J=nt(I);if((J.width>P||J.height>P)&&(N=P/Math.max(J.width,J.height)),N<1)if(typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&I instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&I instanceof ImageBitmap||typeof VideoFrame<"u"&&I instanceof VideoFrame){const W=Math.floor(N*J.width),pt=Math.floor(N*J.height);u===void 0&&(u=p(W,pt));const dt=y?p(W,pt):u;return dt.width=W,dt.height=pt,dt.getContext("2d").drawImage(I,0,0,W,pt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+J.width+"x"+J.height+") to ("+W+"x"+pt+")."),dt}else return"data"in I&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+J.width+"x"+J.height+")."),I;return I}function g(I){return I.generateMipmaps}function A(I){n.generateMipmap(I)}function C(I){return I.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:I.isWebGL3DRenderTarget?n.TEXTURE_3D:I.isWebGLArrayRenderTarget||I.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function E(I,y,P,N,J=!1){if(I!==null){if(n[I]!==void 0)return n[I];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+I+"'")}let W=y;if(y===n.RED&&(P===n.FLOAT&&(W=n.R32F),P===n.HALF_FLOAT&&(W=n.R16F),P===n.UNSIGNED_BYTE&&(W=n.R8)),y===n.RED_INTEGER&&(P===n.UNSIGNED_BYTE&&(W=n.R8UI),P===n.UNSIGNED_SHORT&&(W=n.R16UI),P===n.UNSIGNED_INT&&(W=n.R32UI),P===n.BYTE&&(W=n.R8I),P===n.SHORT&&(W=n.R16I),P===n.INT&&(W=n.R32I)),y===n.RG&&(P===n.FLOAT&&(W=n.RG32F),P===n.HALF_FLOAT&&(W=n.RG16F),P===n.UNSIGNED_BYTE&&(W=n.RG8)),y===n.RG_INTEGER&&(P===n.UNSIGNED_BYTE&&(W=n.RG8UI),P===n.UNSIGNED_SHORT&&(W=n.RG16UI),P===n.UNSIGNED_INT&&(W=n.RG32UI),P===n.BYTE&&(W=n.RG8I),P===n.SHORT&&(W=n.RG16I),P===n.INT&&(W=n.RG32I)),y===n.RGB_INTEGER&&(P===n.UNSIGNED_BYTE&&(W=n.RGB8UI),P===n.UNSIGNED_SHORT&&(W=n.RGB16UI),P===n.UNSIGNED_INT&&(W=n.RGB32UI),P===n.BYTE&&(W=n.RGB8I),P===n.SHORT&&(W=n.RGB16I),P===n.INT&&(W=n.RGB32I)),y===n.RGBA_INTEGER&&(P===n.UNSIGNED_BYTE&&(W=n.RGBA8UI),P===n.UNSIGNED_SHORT&&(W=n.RGBA16UI),P===n.UNSIGNED_INT&&(W=n.RGBA32UI),P===n.BYTE&&(W=n.RGBA8I),P===n.SHORT&&(W=n.RGBA16I),P===n.INT&&(W=n.RGBA32I)),y===n.RGB&&P===n.UNSIGNED_INT_5_9_9_9_REV&&(W=n.RGB9_E5),y===n.RGBA){const pt=J?rh:ee.getTransfer(N);P===n.FLOAT&&(W=n.RGBA32F),P===n.HALF_FLOAT&&(W=n.RGBA16F),P===n.UNSIGNED_BYTE&&(W=pt===me?n.SRGB8_ALPHA8:n.RGBA8),P===n.UNSIGNED_SHORT_4_4_4_4&&(W=n.RGBA4),P===n.UNSIGNED_SHORT_5_5_5_1&&(W=n.RGB5_A1)}return(W===n.R16F||W===n.R32F||W===n.RG16F||W===n.RG32F||W===n.RGBA16F||W===n.RGBA32F)&&t.get("EXT_color_buffer_float"),W}function _(I,y){let P;return I?y===null||y===dr||y===ao?P=n.DEPTH24_STENCIL8:y===Ke?P=n.DEPTH32F_STENCIL8:y===ba&&(P=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):y===null||y===dr||y===ao?P=n.DEPTH_COMPONENT24:y===Ke?P=n.DEPTH_COMPONENT32F:y===ba&&(P=n.DEPTH_COMPONENT16),P}function T(I,y){return g(I)===!0||I.isFramebufferTexture&&I.minFilter!==Ze&&I.minFilter!==ln?Math.log2(Math.max(y.width,y.height))+1:I.mipmaps!==void 0&&I.mipmaps.length>0?I.mipmaps.length:I.isCompressedTexture&&Array.isArray(I.image)?y.mipmaps.length:1}function M(I){const y=I.target;y.removeEventListener("dispose",M),R(y),y.isVideoTexture&&h.delete(y)}function S(I){const y=I.target;y.removeEventListener("dispose",S),x(y)}function R(I){const y=i.get(I);if(y.__webglInit===void 0)return;const P=I.source,N=d.get(P);if(N){const J=N[y.__cacheKey];J.usedTimes--,J.usedTimes===0&&B(I),Object.keys(N).length===0&&d.delete(P)}i.remove(I)}function B(I){const y=i.get(I);n.deleteTexture(y.__webglTexture);const P=I.source,N=d.get(P);delete N[y.__cacheKey],o.memory.textures--}function x(I){const y=i.get(I);if(I.depthTexture&&(I.depthTexture.dispose(),i.remove(I.depthTexture)),I.isWebGLCubeRenderTarget)for(let N=0;N<6;N++){if(Array.isArray(y.__webglFramebuffer[N]))for(let J=0;J<y.__webglFramebuffer[N].length;J++)n.deleteFramebuffer(y.__webglFramebuffer[N][J]);else n.deleteFramebuffer(y.__webglFramebuffer[N]);y.__webglDepthbuffer&&n.deleteRenderbuffer(y.__webglDepthbuffer[N])}else{if(Array.isArray(y.__webglFramebuffer))for(let N=0;N<y.__webglFramebuffer.length;N++)n.deleteFramebuffer(y.__webglFramebuffer[N]);else n.deleteFramebuffer(y.__webglFramebuffer);if(y.__webglDepthbuffer&&n.deleteRenderbuffer(y.__webglDepthbuffer),y.__webglMultisampledFramebuffer&&n.deleteFramebuffer(y.__webglMultisampledFramebuffer),y.__webglColorRenderbuffer)for(let N=0;N<y.__webglColorRenderbuffer.length;N++)y.__webglColorRenderbuffer[N]&&n.deleteRenderbuffer(y.__webglColorRenderbuffer[N]);y.__webglDepthRenderbuffer&&n.deleteRenderbuffer(y.__webglDepthRenderbuffer)}const P=I.textures;for(let N=0,J=P.length;N<J;N++){const W=i.get(P[N]);W.__webglTexture&&(n.deleteTexture(W.__webglTexture),o.memory.textures--),i.remove(P[N])}i.remove(I)}let D=0;function V(){D=0}function Q(){const I=D;return I>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+I+" texture units while this GPU supports only "+s.maxTextures),D+=1,I}function k(I){const y=[];return y.push(I.wrapS),y.push(I.wrapT),y.push(I.wrapR||0),y.push(I.magFilter),y.push(I.minFilter),y.push(I.anisotropy),y.push(I.internalFormat),y.push(I.format),y.push(I.type),y.push(I.generateMipmaps),y.push(I.premultiplyAlpha),y.push(I.flipY),y.push(I.unpackAlignment),y.push(I.colorSpace),y.join()}function et(I,y){const P=i.get(I);if(I.isVideoTexture&&K(I),I.isRenderTargetTexture===!1&&I.version>0&&P.__version!==I.version){const N=I.image;if(N===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(N.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{at(P,I,y);return}}e.bindTexture(n.TEXTURE_2D,P.__webglTexture,n.TEXTURE0+y)}function j(I,y){const P=i.get(I);if(I.version>0&&P.__version!==I.version){at(P,I,y);return}e.bindTexture(n.TEXTURE_2D_ARRAY,P.__webglTexture,n.TEXTURE0+y)}function X(I,y){const P=i.get(I);if(I.version>0&&P.__version!==I.version){at(P,I,y);return}e.bindTexture(n.TEXTURE_3D,P.__webglTexture,n.TEXTURE0+y)}function U(I,y){const P=i.get(I);if(I.version>0&&P.__version!==I.version){mt(P,I,y);return}e.bindTexture(n.TEXTURE_CUBE_MAP,P.__webglTexture,n.TEXTURE0+y)}const ut={[Rs]:n.REPEAT,[ts]:n.CLAMP_TO_EDGE,[bc]:n.MIRRORED_REPEAT},gt={[Ze]:n.NEAREST,[gE]:n.NEAREST_MIPMAP_NEAREST,[Xo]:n.NEAREST_MIPMAP_LINEAR,[ln]:n.LINEAR,[hc]:n.LINEAR_MIPMAP_NEAREST,[Mi]:n.LINEAR_MIPMAP_LINEAR},Et={[PI]:n.NEVER,[QI]:n.ALWAYS,[FI]:n.LESS,[ME]:n.LEQUAL,[UI]:n.EQUAL,[GI]:n.GEQUAL,[NI]:n.GREATER,[OI]:n.NOTEQUAL};function Dt(I,y){if(y.type===Ke&&t.has("OES_texture_float_linear")===!1&&(y.magFilter===ln||y.magFilter===hc||y.magFilter===Xo||y.magFilter===Mi||y.minFilter===ln||y.minFilter===hc||y.minFilter===Xo||y.minFilter===Mi)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(I,n.TEXTURE_WRAP_S,ut[y.wrapS]),n.texParameteri(I,n.TEXTURE_WRAP_T,ut[y.wrapT]),(I===n.TEXTURE_3D||I===n.TEXTURE_2D_ARRAY)&&n.texParameteri(I,n.TEXTURE_WRAP_R,ut[y.wrapR]),n.texParameteri(I,n.TEXTURE_MAG_FILTER,gt[y.magFilter]),n.texParameteri(I,n.TEXTURE_MIN_FILTER,gt[y.minFilter]),y.compareFunction&&(n.texParameteri(I,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(I,n.TEXTURE_COMPARE_FUNC,Et[y.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(y.magFilter===Ze||y.minFilter!==Xo&&y.minFilter!==Mi||y.type===Ke&&t.has("OES_texture_float_linear")===!1)return;if(y.anisotropy>1||i.get(y).__currentAnisotropy){const P=t.get("EXT_texture_filter_anisotropic");n.texParameterf(I,P.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(y.anisotropy,s.getMaxAnisotropy())),i.get(y).__currentAnisotropy=y.anisotropy}}}function Jt(I,y){let P=!1;I.__webglInit===void 0&&(I.__webglInit=!0,y.addEventListener("dispose",M));const N=y.source;let J=d.get(N);J===void 0&&(J={},d.set(N,J));const W=k(y);if(W!==I.__cacheKey){J[W]===void 0&&(J[W]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,P=!0),J[W].usedTimes++;const pt=J[I.__cacheKey];pt!==void 0&&(J[I.__cacheKey].usedTimes--,pt.usedTimes===0&&B(y)),I.__cacheKey=W,I.__webglTexture=J[W].texture}return P}function at(I,y,P){let N=n.TEXTURE_2D;(y.isDataArrayTexture||y.isCompressedArrayTexture)&&(N=n.TEXTURE_2D_ARRAY),y.isData3DTexture&&(N=n.TEXTURE_3D);const J=Jt(I,y),W=y.source;e.bindTexture(N,I.__webglTexture,n.TEXTURE0+P);const pt=i.get(W);if(W.version!==pt.__version||J===!0){e.activeTexture(n.TEXTURE0+P);const dt=ee.getPrimaries(ee.workingColorSpace),ft=y.colorSpace===vi?null:ee.getPrimaries(y.colorSpace),zt=y.colorSpace===vi||dt===ft?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,y.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,y.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,zt);let ct=m(y.image,!1,s.maxTextureSize);ct=ht(y,ct);const yt=r.convert(y.format,y.colorSpace),Rt=r.convert(y.type);let Ot=E(y.internalFormat,yt,Rt,y.colorSpace,y.isVideoTexture);Dt(N,y);let St;const Ht=y.mipmaps,Gt=y.isVideoTexture!==!0,de=pt.__version===void 0||J===!0,F=W.dataReady,xt=T(y,ct);if(y.isDepthTexture)Ot=_(y.format===lo,y.type),de&&(Gt?e.texStorage2D(n.TEXTURE_2D,1,Ot,ct.width,ct.height):e.texImage2D(n.TEXTURE_2D,0,Ot,ct.width,ct.height,0,yt,Rt,null));else if(y.isDataTexture)if(Ht.length>0){Gt&&de&&e.texStorage2D(n.TEXTURE_2D,xt,Ot,Ht[0].width,Ht[0].height);for(let rt=0,lt=Ht.length;rt<lt;rt++)St=Ht[rt],Gt?F&&e.texSubImage2D(n.TEXTURE_2D,rt,0,0,St.width,St.height,yt,Rt,St.data):e.texImage2D(n.TEXTURE_2D,rt,Ot,St.width,St.height,0,yt,Rt,St.data);y.generateMipmaps=!1}else Gt?(de&&e.texStorage2D(n.TEXTURE_2D,xt,Ot,ct.width,ct.height),F&&e.texSubImage2D(n.TEXTURE_2D,0,0,0,ct.width,ct.height,yt,Rt,ct.data)):e.texImage2D(n.TEXTURE_2D,0,Ot,ct.width,ct.height,0,yt,Rt,ct.data);else if(y.isCompressedTexture)if(y.isCompressedArrayTexture){Gt&&de&&e.texStorage3D(n.TEXTURE_2D_ARRAY,xt,Ot,Ht[0].width,Ht[0].height,ct.depth);for(let rt=0,lt=Ht.length;rt<lt;rt++)if(St=Ht[rt],y.format!==Qe)if(yt!==null)if(Gt){if(F)if(y.layerUpdates.size>0){const bt=Ng(St.width,St.height,y.format,y.type);for(const Bt of y.layerUpdates){const qt=St.data.subarray(Bt*bt/St.data.BYTES_PER_ELEMENT,(Bt+1)*bt/St.data.BYTES_PER_ELEMENT);e.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,rt,0,0,Bt,St.width,St.height,1,yt,qt)}y.clearLayerUpdates()}else e.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,rt,0,0,0,St.width,St.height,ct.depth,yt,St.data)}else e.compressedTexImage3D(n.TEXTURE_2D_ARRAY,rt,Ot,St.width,St.height,ct.depth,0,St.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Gt?F&&e.texSubImage3D(n.TEXTURE_2D_ARRAY,rt,0,0,0,St.width,St.height,ct.depth,yt,Rt,St.data):e.texImage3D(n.TEXTURE_2D_ARRAY,rt,Ot,St.width,St.height,ct.depth,0,yt,Rt,St.data)}else{Gt&&de&&e.texStorage2D(n.TEXTURE_2D,xt,Ot,Ht[0].width,Ht[0].height);for(let rt=0,lt=Ht.length;rt<lt;rt++)St=Ht[rt],y.format!==Qe?yt!==null?Gt?F&&e.compressedTexSubImage2D(n.TEXTURE_2D,rt,0,0,St.width,St.height,yt,St.data):e.compressedTexImage2D(n.TEXTURE_2D,rt,Ot,St.width,St.height,0,St.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Gt?F&&e.texSubImage2D(n.TEXTURE_2D,rt,0,0,St.width,St.height,yt,Rt,St.data):e.texImage2D(n.TEXTURE_2D,rt,Ot,St.width,St.height,0,yt,Rt,St.data)}else if(y.isDataArrayTexture)if(Gt){if(de&&e.texStorage3D(n.TEXTURE_2D_ARRAY,xt,Ot,ct.width,ct.height,ct.depth),F)if(y.layerUpdates.size>0){const rt=Ng(ct.width,ct.height,y.format,y.type);for(const lt of y.layerUpdates){const bt=ct.data.subarray(lt*rt/ct.data.BYTES_PER_ELEMENT,(lt+1)*rt/ct.data.BYTES_PER_ELEMENT);e.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,lt,ct.width,ct.height,1,yt,Rt,bt)}y.clearLayerUpdates()}else e.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,ct.width,ct.height,ct.depth,yt,Rt,ct.data)}else e.texImage3D(n.TEXTURE_2D_ARRAY,0,Ot,ct.width,ct.height,ct.depth,0,yt,Rt,ct.data);else if(y.isData3DTexture)Gt?(de&&e.texStorage3D(n.TEXTURE_3D,xt,Ot,ct.width,ct.height,ct.depth),F&&e.texSubImage3D(n.TEXTURE_3D,0,0,0,0,ct.width,ct.height,ct.depth,yt,Rt,ct.data)):e.texImage3D(n.TEXTURE_3D,0,Ot,ct.width,ct.height,ct.depth,0,yt,Rt,ct.data);else if(y.isFramebufferTexture){if(de)if(Gt)e.texStorage2D(n.TEXTURE_2D,xt,Ot,ct.width,ct.height);else{let rt=ct.width,lt=ct.height;for(let bt=0;bt<xt;bt++)e.texImage2D(n.TEXTURE_2D,bt,Ot,rt,lt,0,yt,Rt,null),rt>>=1,lt>>=1}}else if(Ht.length>0){if(Gt&&de){const rt=nt(Ht[0]);e.texStorage2D(n.TEXTURE_2D,xt,Ot,rt.width,rt.height)}for(let rt=0,lt=Ht.length;rt<lt;rt++)St=Ht[rt],Gt?F&&e.texSubImage2D(n.TEXTURE_2D,rt,0,0,yt,Rt,St):e.texImage2D(n.TEXTURE_2D,rt,Ot,yt,Rt,St);y.generateMipmaps=!1}else if(Gt){if(de){const rt=nt(ct);e.texStorage2D(n.TEXTURE_2D,xt,Ot,rt.width,rt.height)}F&&e.texSubImage2D(n.TEXTURE_2D,0,0,0,yt,Rt,ct)}else e.texImage2D(n.TEXTURE_2D,0,Ot,yt,Rt,ct);g(y)&&A(N),pt.__version=W.version,y.onUpdate&&y.onUpdate(y)}I.__version=y.version}function mt(I,y,P){if(y.image.length!==6)return;const N=Jt(I,y),J=y.source;e.bindTexture(n.TEXTURE_CUBE_MAP,I.__webglTexture,n.TEXTURE0+P);const W=i.get(J);if(J.version!==W.__version||N===!0){e.activeTexture(n.TEXTURE0+P);const pt=ee.getPrimaries(ee.workingColorSpace),dt=y.colorSpace===vi?null:ee.getPrimaries(y.colorSpace),ft=y.colorSpace===vi||pt===dt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,y.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,y.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,ft);const zt=y.isCompressedTexture||y.image[0].isCompressedTexture,ct=y.image[0]&&y.image[0].isDataTexture,yt=[];for(let lt=0;lt<6;lt++)!zt&&!ct?yt[lt]=m(y.image[lt],!0,s.maxCubemapSize):yt[lt]=ct?y.image[lt].image:y.image[lt],yt[lt]=ht(y,yt[lt]);const Rt=yt[0],Ot=r.convert(y.format,y.colorSpace),St=r.convert(y.type),Ht=E(y.internalFormat,Ot,St,y.colorSpace),Gt=y.isVideoTexture!==!0,de=W.__version===void 0||N===!0,F=J.dataReady;let xt=T(y,Rt);Dt(n.TEXTURE_CUBE_MAP,y);let rt;if(zt){Gt&&de&&e.texStorage2D(n.TEXTURE_CUBE_MAP,xt,Ht,Rt.width,Rt.height);for(let lt=0;lt<6;lt++){rt=yt[lt].mipmaps;for(let bt=0;bt<rt.length;bt++){const Bt=rt[bt];y.format!==Qe?Ot!==null?Gt?F&&e.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt,0,0,Bt.width,Bt.height,Ot,Bt.data):e.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt,Ht,Bt.width,Bt.height,0,Bt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Gt?F&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt,0,0,Bt.width,Bt.height,Ot,St,Bt.data):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt,Ht,Bt.width,Bt.height,0,Ot,St,Bt.data)}}}else{if(rt=y.mipmaps,Gt&&de){rt.length>0&&xt++;const lt=nt(yt[0]);e.texStorage2D(n.TEXTURE_CUBE_MAP,xt,Ht,lt.width,lt.height)}for(let lt=0;lt<6;lt++)if(ct){Gt?F&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,yt[lt].width,yt[lt].height,Ot,St,yt[lt].data):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,Ht,yt[lt].width,yt[lt].height,0,Ot,St,yt[lt].data);for(let bt=0;bt<rt.length;bt++){const qt=rt[bt].image[lt].image;Gt?F&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt+1,0,0,qt.width,qt.height,Ot,St,qt.data):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt+1,Ht,qt.width,qt.height,0,Ot,St,qt.data)}}else{Gt?F&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,0,0,Ot,St,yt[lt]):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,0,Ht,Ot,St,yt[lt]);for(let bt=0;bt<rt.length;bt++){const Bt=rt[bt];Gt?F&&e.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt+1,0,0,Ot,St,Bt.image[lt]):e.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+lt,bt+1,Ht,Ot,St,Bt.image[lt])}}}g(y)&&A(n.TEXTURE_CUBE_MAP),W.__version=J.version,y.onUpdate&&y.onUpdate(y)}I.__version=y.version}function H(I,y,P,N,J,W){const pt=r.convert(P.format,P.colorSpace),dt=r.convert(P.type),ft=E(P.internalFormat,pt,dt,P.colorSpace),zt=i.get(y),ct=i.get(P);if(ct.__renderTarget=y,!zt.__hasExternalTextures){const yt=Math.max(1,y.width>>W),Rt=Math.max(1,y.height>>W);J===n.TEXTURE_3D||J===n.TEXTURE_2D_ARRAY?e.texImage3D(J,W,ft,yt,Rt,y.depth,0,pt,dt,null):e.texImage2D(J,W,ft,yt,Rt,0,pt,dt,null)}e.bindFramebuffer(n.FRAMEBUFFER,I),$(y)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,N,J,ct.__webglTexture,0,st(y)):(J===n.TEXTURE_2D||J>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&J<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,N,J,ct.__webglTexture,W),e.bindFramebuffer(n.FRAMEBUFFER,null)}function ot(I,y,P){if(n.bindRenderbuffer(n.RENDERBUFFER,I),y.depthBuffer){const N=y.depthTexture,J=N&&N.isDepthTexture?N.type:null,W=_(y.stencilBuffer,J),pt=y.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,dt=st(y);$(y)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,dt,W,y.width,y.height):P?n.renderbufferStorageMultisample(n.RENDERBUFFER,dt,W,y.width,y.height):n.renderbufferStorage(n.RENDERBUFFER,W,y.width,y.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,pt,n.RENDERBUFFER,I)}else{const N=y.textures;for(let J=0;J<N.length;J++){const W=N[J],pt=r.convert(W.format,W.colorSpace),dt=r.convert(W.type),ft=E(W.internalFormat,pt,dt,W.colorSpace),zt=st(y);P&&$(y)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,zt,ft,y.width,y.height):$(y)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,zt,ft,y.width,y.height):n.renderbufferStorage(n.RENDERBUFFER,ft,y.width,y.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function vt(I,y){if(y&&y.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(n.FRAMEBUFFER,I),!(y.depthTexture&&y.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const N=i.get(y.depthTexture);N.__renderTarget=y,(!N.__webglTexture||y.depthTexture.image.width!==y.width||y.depthTexture.image.height!==y.height)&&(y.depthTexture.image.width=y.width,y.depthTexture.image.height=y.height,y.depthTexture.needsUpdate=!0),et(y.depthTexture,0);const J=N.__webglTexture,W=st(y);if(y.depthTexture.format===eo)$(y)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,J,0,W):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,J,0);else if(y.depthTexture.format===lo)$(y)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,J,0,W):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,J,0);else throw new Error("Unknown depthTexture format")}function Mt(I){const y=i.get(I),P=I.isWebGLCubeRenderTarget===!0;if(y.__boundDepthTexture!==I.depthTexture){const N=I.depthTexture;if(y.__depthDisposeCallback&&y.__depthDisposeCallback(),N){const J=()=>{delete y.__boundDepthTexture,delete y.__depthDisposeCallback,N.removeEventListener("dispose",J)};N.addEventListener("dispose",J),y.__depthDisposeCallback=J}y.__boundDepthTexture=N}if(I.depthTexture&&!y.__autoAllocateDepthBuffer){if(P)throw new Error("target.depthTexture not supported in Cube render targets");vt(y.__webglFramebuffer,I)}else if(P){y.__webglDepthbuffer=[];for(let N=0;N<6;N++)if(e.bindFramebuffer(n.FRAMEBUFFER,y.__webglFramebuffer[N]),y.__webglDepthbuffer[N]===void 0)y.__webglDepthbuffer[N]=n.createRenderbuffer(),ot(y.__webglDepthbuffer[N],I,!1);else{const J=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,W=y.__webglDepthbuffer[N];n.bindRenderbuffer(n.RENDERBUFFER,W),n.framebufferRenderbuffer(n.FRAMEBUFFER,J,n.RENDERBUFFER,W)}}else if(e.bindFramebuffer(n.FRAMEBUFFER,y.__webglFramebuffer),y.__webglDepthbuffer===void 0)y.__webglDepthbuffer=n.createRenderbuffer(),ot(y.__webglDepthbuffer,I,!1);else{const N=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,J=y.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,J),n.framebufferRenderbuffer(n.FRAMEBUFFER,N,n.RENDERBUFFER,J)}e.bindFramebuffer(n.FRAMEBUFFER,null)}function Vt(I,y,P){const N=i.get(I);y!==void 0&&H(N.__webglFramebuffer,I,I.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),P!==void 0&&Mt(I)}function ae(I){const y=I.texture,P=i.get(I),N=i.get(y);I.addEventListener("dispose",S);const J=I.textures,W=I.isWebGLCubeRenderTarget===!0,pt=J.length>1;if(pt||(N.__webglTexture===void 0&&(N.__webglTexture=n.createTexture()),N.__version=y.version,o.memory.textures++),W){P.__webglFramebuffer=[];for(let dt=0;dt<6;dt++)if(y.mipmaps&&y.mipmaps.length>0){P.__webglFramebuffer[dt]=[];for(let ft=0;ft<y.mipmaps.length;ft++)P.__webglFramebuffer[dt][ft]=n.createFramebuffer()}else P.__webglFramebuffer[dt]=n.createFramebuffer()}else{if(y.mipmaps&&y.mipmaps.length>0){P.__webglFramebuffer=[];for(let dt=0;dt<y.mipmaps.length;dt++)P.__webglFramebuffer[dt]=n.createFramebuffer()}else P.__webglFramebuffer=n.createFramebuffer();if(pt)for(let dt=0,ft=J.length;dt<ft;dt++){const zt=i.get(J[dt]);zt.__webglTexture===void 0&&(zt.__webglTexture=n.createTexture(),o.memory.textures++)}if(I.samples>0&&$(I)===!1){P.__webglMultisampledFramebuffer=n.createFramebuffer(),P.__webglColorRenderbuffer=[],e.bindFramebuffer(n.FRAMEBUFFER,P.__webglMultisampledFramebuffer);for(let dt=0;dt<J.length;dt++){const ft=J[dt];P.__webglColorRenderbuffer[dt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,P.__webglColorRenderbuffer[dt]);const zt=r.convert(ft.format,ft.colorSpace),ct=r.convert(ft.type),yt=E(ft.internalFormat,zt,ct,ft.colorSpace,I.isXRRenderTarget===!0),Rt=st(I);n.renderbufferStorageMultisample(n.RENDERBUFFER,Rt,yt,I.width,I.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+dt,n.RENDERBUFFER,P.__webglColorRenderbuffer[dt])}n.bindRenderbuffer(n.RENDERBUFFER,null),I.depthBuffer&&(P.__webglDepthRenderbuffer=n.createRenderbuffer(),ot(P.__webglDepthRenderbuffer,I,!0)),e.bindFramebuffer(n.FRAMEBUFFER,null)}}if(W){e.bindTexture(n.TEXTURE_CUBE_MAP,N.__webglTexture),Dt(n.TEXTURE_CUBE_MAP,y);for(let dt=0;dt<6;dt++)if(y.mipmaps&&y.mipmaps.length>0)for(let ft=0;ft<y.mipmaps.length;ft++)H(P.__webglFramebuffer[dt][ft],I,y,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+dt,ft);else H(P.__webglFramebuffer[dt],I,y,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+dt,0);g(y)&&A(n.TEXTURE_CUBE_MAP),e.unbindTexture()}else if(pt){for(let dt=0,ft=J.length;dt<ft;dt++){const zt=J[dt],ct=i.get(zt);e.bindTexture(n.TEXTURE_2D,ct.__webglTexture),Dt(n.TEXTURE_2D,zt),H(P.__webglFramebuffer,I,zt,n.COLOR_ATTACHMENT0+dt,n.TEXTURE_2D,0),g(zt)&&A(n.TEXTURE_2D)}e.unbindTexture()}else{let dt=n.TEXTURE_2D;if((I.isWebGL3DRenderTarget||I.isWebGLArrayRenderTarget)&&(dt=I.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),e.bindTexture(dt,N.__webglTexture),Dt(dt,y),y.mipmaps&&y.mipmaps.length>0)for(let ft=0;ft<y.mipmaps.length;ft++)H(P.__webglFramebuffer[ft],I,y,n.COLOR_ATTACHMENT0,dt,ft);else H(P.__webglFramebuffer,I,y,n.COLOR_ATTACHMENT0,dt,0);g(y)&&A(dt),e.unbindTexture()}I.depthBuffer&&Mt(I)}function Zt(I){const y=I.textures;for(let P=0,N=y.length;P<N;P++){const J=y[P];if(g(J)){const W=C(I),pt=i.get(J).__webglTexture;e.bindTexture(W,pt),A(W),e.unbindTexture()}}}const w=[],v=[];function z(I){if(I.samples>0){if($(I)===!1){const y=I.textures,P=I.width,N=I.height;let J=n.COLOR_BUFFER_BIT;const W=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,pt=i.get(I),dt=y.length>1;if(dt)for(let ft=0;ft<y.length;ft++)e.bindFramebuffer(n.FRAMEBUFFER,pt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ft,n.RENDERBUFFER,null),e.bindFramebuffer(n.FRAMEBUFFER,pt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+ft,n.TEXTURE_2D,null,0);e.bindFramebuffer(n.READ_FRAMEBUFFER,pt.__webglMultisampledFramebuffer),e.bindFramebuffer(n.DRAW_FRAMEBUFFER,pt.__webglFramebuffer);for(let ft=0;ft<y.length;ft++){if(I.resolveDepthBuffer&&(I.depthBuffer&&(J|=n.DEPTH_BUFFER_BIT),I.stencilBuffer&&I.resolveStencilBuffer&&(J|=n.STENCIL_BUFFER_BIT)),dt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,pt.__webglColorRenderbuffer[ft]);const zt=i.get(y[ft]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,zt,0)}n.blitFramebuffer(0,0,P,N,0,0,P,N,J,n.NEAREST),l===!0&&(w.length=0,v.length=0,w.push(n.COLOR_ATTACHMENT0+ft),I.depthBuffer&&I.resolveDepthBuffer===!1&&(w.push(W),v.push(W),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,v)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,w))}if(e.bindFramebuffer(n.READ_FRAMEBUFFER,null),e.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),dt)for(let ft=0;ft<y.length;ft++){e.bindFramebuffer(n.FRAMEBUFFER,pt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ft,n.RENDERBUFFER,pt.__webglColorRenderbuffer[ft]);const zt=i.get(y[ft]).__webglTexture;e.bindFramebuffer(n.FRAMEBUFFER,pt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+ft,n.TEXTURE_2D,zt,0)}e.bindFramebuffer(n.DRAW_FRAMEBUFFER,pt.__webglMultisampledFramebuffer)}else if(I.depthBuffer&&I.resolveDepthBuffer===!1&&l){const y=I.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[y])}}}function st(I){return Math.min(s.maxSamples,I.samples)}function $(I){const y=i.get(I);return I.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&y.__useRenderToTexture!==!1}function K(I){const y=o.render.frame;h.get(I)!==y&&(h.set(I,y),I.update())}function ht(I,y){const P=I.colorSpace,N=I.format,J=I.type;return I.isCompressedTexture===!0||I.isVideoTexture===!0||P!==tn&&P!==vi&&(ee.getTransfer(P)===me?(N!==Qe||J!==We)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",P)),y}function nt(I){return typeof HTMLImageElement<"u"&&I instanceof HTMLImageElement?(c.width=I.naturalWidth||I.width,c.height=I.naturalHeight||I.height):typeof VideoFrame<"u"&&I instanceof VideoFrame?(c.width=I.displayWidth,c.height=I.displayHeight):(c.width=I.width,c.height=I.height),c}this.allocateTextureUnit=Q,this.resetTextureUnits=V,this.setTexture2D=et,this.setTexture2DArray=j,this.setTexture3D=X,this.setTextureCube=U,this.rebindTextures=Vt,this.setupRenderTarget=ae,this.updateRenderTargetMipmap=Zt,this.updateMultisampleRenderTarget=z,this.setupDepthRenderbuffer=Mt,this.setupFrameBufferTexture=H,this.useMultisampledRTT=$}function i1(n,t){function e(i,s=vi){let r;const o=ee.getTransfer(s);if(i===We)return n.UNSIGNED_BYTE;if(i===nA)return n.UNSIGNED_SHORT_4_4_4_4;if(i===iA)return n.UNSIGNED_SHORT_5_5_5_1;if(i===EE)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===mE)return n.BYTE;if(i===_E)return n.SHORT;if(i===ba)return n.UNSIGNED_SHORT;if(i===eA)return n.INT;if(i===dr)return n.UNSIGNED_INT;if(i===Ke)return n.FLOAT;if(i===si)return n.HALF_FLOAT;if(i===yE)return n.ALPHA;if(i===CE)return n.RGB;if(i===Qe)return n.RGBA;if(i===xE)return n.LUMINANCE;if(i===vE)return n.LUMINANCE_ALPHA;if(i===eo)return n.DEPTH_COMPONENT;if(i===lo)return n.DEPTH_STENCIL;if(i===Bs)return n.RED;if(i===sA)return n.RED_INTEGER;if(i===er)return n.RG;if(i===rA)return n.RG_INTEGER;if(i===oA)return n.RGBA_INTEGER;if(i===uc||i===la||i===dc||i===ca)if(o===me)if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),r!==null){if(i===uc)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===la)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===dc)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===ca)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(r=t.get("WEBGL_compressed_texture_s3tc"),r!==null){if(i===uc)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===la)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===dc)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===ca)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Mc||i===Nd||i===Sc||i===Od)if(r=t.get("WEBGL_compressed_texture_pvrtc"),r!==null){if(i===Mc)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Nd)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Sc)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Od)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===Tc||i===wc||i===Rc)if(r=t.get("WEBGL_compressed_texture_etc"),r!==null){if(i===Tc||i===wc)return o===me?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===Rc)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Ma||i===Gd||i===Qd||i===Hd||i===Sa||i===kd||i===Vd||i===zd||i===Wd||i===Jd||i===qd||i===jd||i===Xd||i===Kd)if(r=t.get("WEBGL_compressed_texture_astc"),r!==null){if(i===Ma)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Gd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Qd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Hd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Sa)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===kd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===Vd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===zd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Wd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Jd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===qd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===jd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Xd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===Kd)return o===me?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===ha||i===Yd||i===Dc)if(r=t.get("EXT_texture_compression_bptc"),r!==null){if(i===ha)return o===me?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===Yd)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===Dc)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===BE||i===Zd||i===$d||i===tf)if(r=t.get("EXT_texture_compression_rgtc"),r!==null){if(i===ha)return r.COMPRESSED_RED_RGTC1_EXT;if(i===Zd)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===$d)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===tf)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===ao?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:e}}class JE extends Xe{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class ri extends Me{constructor(){super(),this.isGroup=!0,this.type="Group"}}const s1={type:"move"};class uu{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ri,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ri,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new L,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new L),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ri,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new L,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new L),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let s=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(c&&t.hand){o=!0;for(const m of t.hand.values()){const g=e.getJointPose(m,i),A=this._getHandJoint(c,m);g!==null&&(A.matrix.fromArray(g.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=g.radius),A.visible=g!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=e.getPose(t.targetRaySpace,i),s===null&&r!==null&&(s=r),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(s1)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const i=new ri;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}const r1=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,o1=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class a1{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,i){if(this.texture===null){const s=new Fe,r=t.properties.get(s);r.__webglTexture=e.texture,(e.depthNear!=i.depthNear||e.depthFar!=i.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=s}}getMesh(t){if(this.texture!==null&&this.mesh===null){const e=t.cameras[0].viewport,i=new di({vertexShader:r1,fragmentShader:o1,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new Ye(new za(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class l1 extends Us{constructor(t,e){super();const i=this;let s=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,u=null,d=null,f=null,p=null;const m=new a1,g=e.getContextAttributes();let A=null,C=null;const E=[],_=[],T=new kt;let M=null;const S=new Xe;S.viewport=new oe;const R=new Xe;R.viewport=new oe;const B=[S,R],x=new JE;let D=null,V=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(at){let mt=E[at];return mt===void 0&&(mt=new uu,E[at]=mt),mt.getTargetRaySpace()},this.getControllerGrip=function(at){let mt=E[at];return mt===void 0&&(mt=new uu,E[at]=mt),mt.getGripSpace()},this.getHand=function(at){let mt=E[at];return mt===void 0&&(mt=new uu,E[at]=mt),mt.getHandSpace()};function Q(at){const mt=_.indexOf(at.inputSource);if(mt===-1)return;const H=E[mt];H!==void 0&&(H.update(at.inputSource,at.frame,c||o),H.dispatchEvent({type:at.type,data:at.inputSource}))}function k(){s.removeEventListener("select",Q),s.removeEventListener("selectstart",Q),s.removeEventListener("selectend",Q),s.removeEventListener("squeeze",Q),s.removeEventListener("squeezestart",Q),s.removeEventListener("squeezeend",Q),s.removeEventListener("end",k),s.removeEventListener("inputsourceschange",et);for(let at=0;at<E.length;at++){const mt=_[at];mt!==null&&(_[at]=null,E[at].disconnect(mt))}D=null,V=null,m.reset(),t.setRenderTarget(A),f=null,d=null,u=null,s=null,C=null,Jt.stop(),i.isPresenting=!1,t.setPixelRatio(M),t.setSize(T.width,T.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(at){r=at,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(at){a=at,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(at){c=at},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(at){if(s=at,s!==null){if(A=t.getRenderTarget(),s.addEventListener("select",Q),s.addEventListener("selectstart",Q),s.addEventListener("selectend",Q),s.addEventListener("squeeze",Q),s.addEventListener("squeezestart",Q),s.addEventListener("squeezeend",Q),s.addEventListener("end",k),s.addEventListener("inputsourceschange",et),g.xrCompatible!==!0&&await e.makeXRCompatible(),M=t.getPixelRatio(),t.getSize(T),s.renderState.layers===void 0){const mt={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:r};f=new XRWebGLLayer(s,e,mt),s.updateRenderState({baseLayer:f}),t.setPixelRatio(1),t.setSize(f.framebufferWidth,f.framebufferHeight,!1),C=new Ds(f.framebufferWidth,f.framebufferHeight,{format:Qe,type:We,colorSpace:t.outputColorSpace,stencilBuffer:g.stencil})}else{let mt=null,H=null,ot=null;g.depth&&(ot=g.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,mt=g.stencil?lo:eo,H=g.stencil?ao:dr);const vt={colorFormat:e.RGBA8,depthFormat:ot,scaleFactor:r};u=new XRWebGLBinding(s,e),d=u.createProjectionLayer(vt),s.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),C=new Ds(d.textureWidth,d.textureHeight,{format:Qe,type:We,depthTexture:new HE(d.textureWidth,d.textureHeight,H,void 0,void 0,void 0,void 0,void 0,void 0,mt),stencilBuffer:g.stencil,colorSpace:t.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}C.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await s.requestReferenceSpace(a),Jt.setContext(s),Jt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function et(at){for(let mt=0;mt<at.removed.length;mt++){const H=at.removed[mt],ot=_.indexOf(H);ot>=0&&(_[ot]=null,E[ot].disconnect(H))}for(let mt=0;mt<at.added.length;mt++){const H=at.added[mt];let ot=_.indexOf(H);if(ot===-1){for(let Mt=0;Mt<E.length;Mt++)if(Mt>=_.length){_.push(H),ot=Mt;break}else if(_[Mt]===null){_[Mt]=H,ot=Mt;break}if(ot===-1)break}const vt=E[ot];vt&&vt.connect(H)}}const j=new L,X=new L;function U(at,mt,H){j.setFromMatrixPosition(mt.matrixWorld),X.setFromMatrixPosition(H.matrixWorld);const ot=j.distanceTo(X),vt=mt.projectionMatrix.elements,Mt=H.projectionMatrix.elements,Vt=vt[14]/(vt[10]-1),ae=vt[14]/(vt[10]+1),Zt=(vt[9]+1)/vt[5],w=(vt[9]-1)/vt[5],v=(vt[8]-1)/vt[0],z=(Mt[8]+1)/Mt[0],st=Vt*v,$=Vt*z,K=ot/(-v+z),ht=K*-v;if(mt.matrixWorld.decompose(at.position,at.quaternion,at.scale),at.translateX(ht),at.translateZ(K),at.matrixWorld.compose(at.position,at.quaternion,at.scale),at.matrixWorldInverse.copy(at.matrixWorld).invert(),vt[10]===-1)at.projectionMatrix.copy(mt.projectionMatrix),at.projectionMatrixInverse.copy(mt.projectionMatrixInverse);else{const nt=Vt+K,I=ae+K,y=st-ht,P=$+(ot-ht),N=Zt*ae/I*nt,J=w*ae/I*nt;at.projectionMatrix.makePerspective(y,P,N,J,nt,I),at.projectionMatrixInverse.copy(at.projectionMatrix).invert()}}function ut(at,mt){mt===null?at.matrixWorld.copy(at.matrix):at.matrixWorld.multiplyMatrices(mt.matrixWorld,at.matrix),at.matrixWorldInverse.copy(at.matrixWorld).invert()}this.updateCamera=function(at){if(s===null)return;let mt=at.near,H=at.far;m.texture!==null&&(m.depthNear>0&&(mt=m.depthNear),m.depthFar>0&&(H=m.depthFar)),x.near=R.near=S.near=mt,x.far=R.far=S.far=H,(D!==x.near||V!==x.far)&&(s.updateRenderState({depthNear:x.near,depthFar:x.far}),D=x.near,V=x.far),S.layers.mask=at.layers.mask|2,R.layers.mask=at.layers.mask|4,x.layers.mask=S.layers.mask|R.layers.mask;const ot=at.parent,vt=x.cameras;ut(x,ot);for(let Mt=0;Mt<vt.length;Mt++)ut(vt[Mt],ot);vt.length===2?U(x,S,R):x.projectionMatrix.copy(S.projectionMatrix),gt(at,x,ot)};function gt(at,mt,H){H===null?at.matrix.copy(mt.matrixWorld):(at.matrix.copy(H.matrixWorld),at.matrix.invert(),at.matrix.multiply(mt.matrixWorld)),at.matrix.decompose(at.position,at.quaternion,at.scale),at.updateMatrixWorld(!0),at.projectionMatrix.copy(mt.projectionMatrix),at.projectionMatrixInverse.copy(mt.projectionMatrixInverse),at.isPerspectiveCamera&&(at.fov=co*2*Math.atan(1/at.projectionMatrix.elements[5]),at.zoom=1)}this.getCamera=function(){return x},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(at){l=at,d!==null&&(d.fixedFoveation=at),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=at)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(x)};let Et=null;function Dt(at,mt){if(h=mt.getViewerPose(c||o),p=mt,h!==null){const H=h.views;f!==null&&(t.setRenderTargetFramebuffer(C,f.framebuffer),t.setRenderTarget(C));let ot=!1;H.length!==x.cameras.length&&(x.cameras.length=0,ot=!0);for(let Mt=0;Mt<H.length;Mt++){const Vt=H[Mt];let ae=null;if(f!==null)ae=f.getViewport(Vt);else{const w=u.getViewSubImage(d,Vt);ae=w.viewport,Mt===0&&(t.setRenderTargetTextures(C,w.colorTexture,d.ignoreDepthValues?void 0:w.depthStencilTexture),t.setRenderTarget(C))}let Zt=B[Mt];Zt===void 0&&(Zt=new Xe,Zt.layers.enable(Mt),Zt.viewport=new oe,B[Mt]=Zt),Zt.matrix.fromArray(Vt.transform.matrix),Zt.matrix.decompose(Zt.position,Zt.quaternion,Zt.scale),Zt.projectionMatrix.fromArray(Vt.projectionMatrix),Zt.projectionMatrixInverse.copy(Zt.projectionMatrix).invert(),Zt.viewport.set(ae.x,ae.y,ae.width,ae.height),Mt===0&&(x.matrix.copy(Zt.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale)),ot===!0&&x.cameras.push(Zt)}const vt=s.enabledFeatures;if(vt&&vt.includes("depth-sensing")){const Mt=u.getDepthInformation(H[0]);Mt&&Mt.isValid&&Mt.texture&&m.init(t,Mt,s.renderState)}}for(let H=0;H<E.length;H++){const ot=_[H],vt=E[H];ot!==null&&vt!==void 0&&vt.update(ot,mt,c||o)}Et&&Et(at,mt),mt.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:mt}),p=null}const Jt=new QE;Jt.setAnimationLoop(Dt),this.setAnimationLoop=function(at){Et=at},this.dispose=function(){}}}const Js=new Hn,c1=new wt;function h1(n,t){function e(g,A){g.matrixAutoUpdate===!0&&g.updateMatrix(),A.value.copy(g.matrix)}function i(g,A){A.color.getRGB(g.fogColor.value,UE(n)),A.isFog?(g.fogNear.value=A.near,g.fogFar.value=A.far):A.isFogExp2&&(g.fogDensity.value=A.density)}function s(g,A,C,E,_){A.isMeshBasicMaterial||A.isMeshLambertMaterial?r(g,A):A.isMeshToonMaterial?(r(g,A),u(g,A)):A.isMeshPhongMaterial?(r(g,A),h(g,A)):A.isMeshStandardMaterial?(r(g,A),d(g,A),A.isMeshPhysicalMaterial&&f(g,A,_)):A.isMeshMatcapMaterial?(r(g,A),p(g,A)):A.isMeshDepthMaterial?r(g,A):A.isMeshDistanceMaterial?(r(g,A),m(g,A)):A.isMeshNormalMaterial?r(g,A):A.isLineBasicMaterial?(o(g,A),A.isLineDashedMaterial&&a(g,A)):A.isPointsMaterial?l(g,A,C,E):A.isSpriteMaterial?c(g,A):A.isShadowMaterial?(g.color.value.copy(A.color),g.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}function r(g,A){g.opacity.value=A.opacity,A.color&&g.diffuse.value.copy(A.color),A.emissive&&g.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(g.map.value=A.map,e(A.map,g.mapTransform)),A.alphaMap&&(g.alphaMap.value=A.alphaMap,e(A.alphaMap,g.alphaMapTransform)),A.bumpMap&&(g.bumpMap.value=A.bumpMap,e(A.bumpMap,g.bumpMapTransform),g.bumpScale.value=A.bumpScale,A.side===Mn&&(g.bumpScale.value*=-1)),A.normalMap&&(g.normalMap.value=A.normalMap,e(A.normalMap,g.normalMapTransform),g.normalScale.value.copy(A.normalScale),A.side===Mn&&g.normalScale.value.negate()),A.displacementMap&&(g.displacementMap.value=A.displacementMap,e(A.displacementMap,g.displacementMapTransform),g.displacementScale.value=A.displacementScale,g.displacementBias.value=A.displacementBias),A.emissiveMap&&(g.emissiveMap.value=A.emissiveMap,e(A.emissiveMap,g.emissiveMapTransform)),A.specularMap&&(g.specularMap.value=A.specularMap,e(A.specularMap,g.specularMapTransform)),A.alphaTest>0&&(g.alphaTest.value=A.alphaTest);const C=t.get(A),E=C.envMap,_=C.envMapRotation;E&&(g.envMap.value=E,Js.copy(_),Js.x*=-1,Js.y*=-1,Js.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Js.y*=-1,Js.z*=-1),g.envMapRotation.value.setFromMatrix4(c1.makeRotationFromEuler(Js)),g.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=A.reflectivity,g.ior.value=A.ior,g.refractionRatio.value=A.refractionRatio),A.lightMap&&(g.lightMap.value=A.lightMap,g.lightMapIntensity.value=A.lightMapIntensity,e(A.lightMap,g.lightMapTransform)),A.aoMap&&(g.aoMap.value=A.aoMap,g.aoMapIntensity.value=A.aoMapIntensity,e(A.aoMap,g.aoMapTransform))}function o(g,A){g.diffuse.value.copy(A.color),g.opacity.value=A.opacity,A.map&&(g.map.value=A.map,e(A.map,g.mapTransform))}function a(g,A){g.dashSize.value=A.dashSize,g.totalSize.value=A.dashSize+A.gapSize,g.scale.value=A.scale}function l(g,A,C,E){g.diffuse.value.copy(A.color),g.opacity.value=A.opacity,g.size.value=A.size*C,g.scale.value=E*.5,A.map&&(g.map.value=A.map,e(A.map,g.uvTransform)),A.alphaMap&&(g.alphaMap.value=A.alphaMap,e(A.alphaMap,g.alphaMapTransform)),A.alphaTest>0&&(g.alphaTest.value=A.alphaTest)}function c(g,A){g.diffuse.value.copy(A.color),g.opacity.value=A.opacity,g.rotation.value=A.rotation,A.map&&(g.map.value=A.map,e(A.map,g.mapTransform)),A.alphaMap&&(g.alphaMap.value=A.alphaMap,e(A.alphaMap,g.alphaMapTransform)),A.alphaTest>0&&(g.alphaTest.value=A.alphaTest)}function h(g,A){g.specular.value.copy(A.specular),g.shininess.value=Math.max(A.shininess,1e-4)}function u(g,A){A.gradientMap&&(g.gradientMap.value=A.gradientMap)}function d(g,A){g.metalness.value=A.metalness,A.metalnessMap&&(g.metalnessMap.value=A.metalnessMap,e(A.metalnessMap,g.metalnessMapTransform)),g.roughness.value=A.roughness,A.roughnessMap&&(g.roughnessMap.value=A.roughnessMap,e(A.roughnessMap,g.roughnessMapTransform)),A.envMap&&(g.envMapIntensity.value=A.envMapIntensity)}function f(g,A,C){g.ior.value=A.ior,A.sheen>0&&(g.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),g.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(g.sheenColorMap.value=A.sheenColorMap,e(A.sheenColorMap,g.sheenColorMapTransform)),A.sheenRoughnessMap&&(g.sheenRoughnessMap.value=A.sheenRoughnessMap,e(A.sheenRoughnessMap,g.sheenRoughnessMapTransform))),A.clearcoat>0&&(g.clearcoat.value=A.clearcoat,g.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(g.clearcoatMap.value=A.clearcoatMap,e(A.clearcoatMap,g.clearcoatMapTransform)),A.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap,e(A.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),A.clearcoatNormalMap&&(g.clearcoatNormalMap.value=A.clearcoatNormalMap,e(A.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),A.side===Mn&&g.clearcoatNormalScale.value.negate())),A.dispersion>0&&(g.dispersion.value=A.dispersion),A.iridescence>0&&(g.iridescence.value=A.iridescence,g.iridescenceIOR.value=A.iridescenceIOR,g.iridescenceThicknessMinimum.value=A.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=A.iridescenceThicknessRange[1],A.iridescenceMap&&(g.iridescenceMap.value=A.iridescenceMap,e(A.iridescenceMap,g.iridescenceMapTransform)),A.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=A.iridescenceThicknessMap,e(A.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),A.transmission>0&&(g.transmission.value=A.transmission,g.transmissionSamplerMap.value=C.texture,g.transmissionSamplerSize.value.set(C.width,C.height),A.transmissionMap&&(g.transmissionMap.value=A.transmissionMap,e(A.transmissionMap,g.transmissionMapTransform)),g.thickness.value=A.thickness,A.thicknessMap&&(g.thicknessMap.value=A.thicknessMap,e(A.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=A.attenuationDistance,g.attenuationColor.value.copy(A.attenuationColor)),A.anisotropy>0&&(g.anisotropyVector.value.set(A.anisotropy*Math.cos(A.anisotropyRotation),A.anisotropy*Math.sin(A.anisotropyRotation)),A.anisotropyMap&&(g.anisotropyMap.value=A.anisotropyMap,e(A.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=A.specularIntensity,g.specularColor.value.copy(A.specularColor),A.specularColorMap&&(g.specularColorMap.value=A.specularColorMap,e(A.specularColorMap,g.specularColorMapTransform)),A.specularIntensityMap&&(g.specularIntensityMap.value=A.specularIntensityMap,e(A.specularIntensityMap,g.specularIntensityMapTransform))}function p(g,A){A.matcap&&(g.matcap.value=A.matcap)}function m(g,A){const C=t.get(A).light;g.referencePosition.value.setFromMatrixPosition(C.matrixWorld),g.nearDistance.value=C.shadow.camera.near,g.farDistance.value=C.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function u1(n,t,e,i){let s={},r={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(C,E){const _=E.program;i.uniformBlockBinding(C,_)}function c(C,E){let _=s[C.id];_===void 0&&(p(C),_=h(C),s[C.id]=_,C.addEventListener("dispose",g));const T=E.program;i.updateUBOMapping(C,T);const M=t.render.frame;r[C.id]!==M&&(d(C),r[C.id]=M)}function h(C){const E=u();C.__bindingPointIndex=E;const _=n.createBuffer(),T=C.__size,M=C.usage;return n.bindBuffer(n.UNIFORM_BUFFER,_),n.bufferData(n.UNIFORM_BUFFER,T,M),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,E,_),_}function u(){for(let C=0;C<a;C++)if(o.indexOf(C)===-1)return o.push(C),C;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(C){const E=s[C.id],_=C.uniforms,T=C.__cache;n.bindBuffer(n.UNIFORM_BUFFER,E);for(let M=0,S=_.length;M<S;M++){const R=Array.isArray(_[M])?_[M]:[_[M]];for(let B=0,x=R.length;B<x;B++){const D=R[B];if(f(D,M,B,T)===!0){const V=D.__offset,Q=Array.isArray(D.value)?D.value:[D.value];let k=0;for(let et=0;et<Q.length;et++){const j=Q[et],X=m(j);typeof j=="number"||typeof j=="boolean"?(D.__data[0]=j,n.bufferSubData(n.UNIFORM_BUFFER,V+k,D.__data)):j.isMatrix3?(D.__data[0]=j.elements[0],D.__data[1]=j.elements[1],D.__data[2]=j.elements[2],D.__data[3]=0,D.__data[4]=j.elements[3],D.__data[5]=j.elements[4],D.__data[6]=j.elements[5],D.__data[7]=0,D.__data[8]=j.elements[6],D.__data[9]=j.elements[7],D.__data[10]=j.elements[8],D.__data[11]=0):(j.toArray(D.__data,k),k+=X.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,V,D.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function f(C,E,_,T){const M=C.value,S=E+"_"+_;if(T[S]===void 0)return typeof M=="number"||typeof M=="boolean"?T[S]=M:T[S]=M.clone(),!0;{const R=T[S];if(typeof M=="number"||typeof M=="boolean"){if(R!==M)return T[S]=M,!0}else if(R.equals(M)===!1)return R.copy(M),!0}return!1}function p(C){const E=C.uniforms;let _=0;const T=16;for(let S=0,R=E.length;S<R;S++){const B=Array.isArray(E[S])?E[S]:[E[S]];for(let x=0,D=B.length;x<D;x++){const V=B[x],Q=Array.isArray(V.value)?V.value:[V.value];for(let k=0,et=Q.length;k<et;k++){const j=Q[k],X=m(j),U=_%T,ut=U%X.boundary,gt=U+ut;_+=ut,gt!==0&&T-gt<X.storage&&(_+=T-gt),V.__data=new Float32Array(X.storage/Float32Array.BYTES_PER_ELEMENT),V.__offset=_,_+=X.storage}}}const M=_%T;return M>0&&(_+=T-M),C.__size=_,C.__cache={},this}function m(C){const E={boundary:0,storage:0};return typeof C=="number"||typeof C=="boolean"?(E.boundary=4,E.storage=4):C.isVector2?(E.boundary=8,E.storage=8):C.isVector3||C.isColor?(E.boundary=16,E.storage=12):C.isVector4?(E.boundary=16,E.storage=16):C.isMatrix3?(E.boundary=48,E.storage=48):C.isMatrix4?(E.boundary=64,E.storage=64):C.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",C),E}function g(C){const E=C.target;E.removeEventListener("dispose",g);const _=o.indexOf(E.__bindingPointIndex);o.splice(_,1),n.deleteBuffer(s[E.id]),delete s[E.id],delete r[E.id]}function A(){for(const C in s)n.deleteBuffer(s[C]);o=[],s={},r={}}return{bind:l,update:c,dispose:A}}class qE{constructor(t={}){const{canvas:e=ib(),context:i=null,depth:s=!0,stencil:r=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:d=!1}=t;this.isWebGLRenderer=!0;let f;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=i.getContextAttributes().alpha}else f=o;const p=new Uint32Array(4),m=new Int32Array(4);let g=null,A=null;const C=[],E=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=De,this.toneMapping=Ss,this.toneMappingExposure=1;const _=this;let T=!1,M=0,S=0,R=null,B=-1,x=null;const D=new oe,V=new oe;let Q=null;const k=new tt(0);let et=0,j=e.width,X=e.height,U=1,ut=null,gt=null;const Et=new oe(0,0,j,X),Dt=new oe(0,0,j,X);let Jt=!1;const at=new oh;let mt=!1,H=!1;const ot=new wt,vt=new wt,Mt=new L,Vt=new oe,ae={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Zt=!1;function w(){return R===null?U:1}let v=i;function z(b,O){return e.getContext(b,O)}try{const b={alpha:!0,depth:s,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${tA}`),e.addEventListener("webglcontextlost",lt,!1),e.addEventListener("webglcontextrestored",bt,!1),e.addEventListener("webglcontextcreationerror",Bt,!1),v===null){const O="webgl2";if(v=z(O,b),v===null)throw z(O)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(b){throw console.error("THREE.WebGLRenderer: "+b.message),b}let st,$,K,ht,nt,I,y,P,N,J,W,pt,dt,ft,zt,ct,yt,Rt,Ot,St,Ht,Gt,de,F;function xt(){st=new _T(v),st.init(),Gt=new i1(v,st),$=new dT(v,st,t,Gt),K=new t1(v,st),$.reverseDepthBuffer&&d&&K.buffers.depth.setReversed(!0),ht=new CT(v),nt=new Gw,I=new n1(v,st,K,nt,$,Gt,ht),y=new AT(_),P=new mT(_),N=new Sb(v),de=new hT(v,N),J=new ET(v,N,ht,de),W=new vT(v,J,N,ht),Ot=new xT(v,$,I),ct=new fT(nt),pt=new Ow(_,y,P,st,$,de,ct),dt=new h1(_,nt),ft=new Hw,zt=new qw(st),Rt=new cT(_,y,P,K,W,f,l),yt=new Zw(_,W,$),F=new u1(v,ht,$,K),St=new uT(v,st,ht),Ht=new yT(v,st,ht),ht.programs=pt.programs,_.capabilities=$,_.extensions=st,_.properties=nt,_.renderLists=ft,_.shadowMap=yt,_.state=K,_.info=ht}xt();const rt=new l1(_,v);this.xr=rt,this.getContext=function(){return v},this.getContextAttributes=function(){return v.getContextAttributes()},this.forceContextLoss=function(){const b=st.get("WEBGL_lose_context");b&&b.loseContext()},this.forceContextRestore=function(){const b=st.get("WEBGL_lose_context");b&&b.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(b){b!==void 0&&(U=b,this.setSize(j,X,!1))},this.getSize=function(b){return b.set(j,X)},this.setSize=function(b,O,Y=!0){if(rt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}j=b,X=O,e.width=Math.floor(b*U),e.height=Math.floor(O*U),Y===!0&&(e.style.width=b+"px",e.style.height=O+"px"),this.setViewport(0,0,b,O)},this.getDrawingBufferSize=function(b){return b.set(j*U,X*U).floor()},this.setDrawingBufferSize=function(b,O,Y){j=b,X=O,U=Y,e.width=Math.floor(b*Y),e.height=Math.floor(O*Y),this.setViewport(0,0,b,O)},this.getCurrentViewport=function(b){return b.copy(D)},this.getViewport=function(b){return b.copy(Et)},this.setViewport=function(b,O,Y,Z){b.isVector4?Et.set(b.x,b.y,b.z,b.w):Et.set(b,O,Y,Z),K.viewport(D.copy(Et).multiplyScalar(U).round())},this.getScissor=function(b){return b.copy(Dt)},this.setScissor=function(b,O,Y,Z){b.isVector4?Dt.set(b.x,b.y,b.z,b.w):Dt.set(b,O,Y,Z),K.scissor(V.copy(Dt).multiplyScalar(U).round())},this.getScissorTest=function(){return Jt},this.setScissorTest=function(b){K.setScissorTest(Jt=b)},this.setOpaqueSort=function(b){ut=b},this.setTransparentSort=function(b){gt=b},this.getClearColor=function(b){return b.copy(Rt.getClearColor())},this.setClearColor=function(){Rt.setClearColor.apply(Rt,arguments)},this.getClearAlpha=function(){return Rt.getClearAlpha()},this.setClearAlpha=function(){Rt.setClearAlpha.apply(Rt,arguments)},this.clear=function(b=!0,O=!0,Y=!0){let Z=0;if(b){let G=!1;if(R!==null){const _t=R.texture.format;G=_t===oA||_t===rA||_t===sA}if(G){const _t=R.texture.type,It=_t===We||_t===dr||_t===ba||_t===ao||_t===nA||_t===iA,Lt=Rt.getClearColor(),Pt=Rt.getClearAlpha(),Wt=Lt.r,jt=Lt.g,Ft=Lt.b;It?(p[0]=Wt,p[1]=jt,p[2]=Ft,p[3]=Pt,v.clearBufferuiv(v.COLOR,0,p)):(m[0]=Wt,m[1]=jt,m[2]=Ft,m[3]=Pt,v.clearBufferiv(v.COLOR,0,m))}else Z|=v.COLOR_BUFFER_BIT}O&&(Z|=v.DEPTH_BUFFER_BIT),Y&&(Z|=v.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),v.clear(Z)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",lt,!1),e.removeEventListener("webglcontextrestored",bt,!1),e.removeEventListener("webglcontextcreationerror",Bt,!1),ft.dispose(),zt.dispose(),nt.dispose(),y.dispose(),P.dispose(),W.dispose(),de.dispose(),F.dispose(),pt.dispose(),rt.dispose(),rt.removeEventListener("sessionstart",$A),rt.removeEventListener("sessionend",tp),Os.stop()};function lt(b){b.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),T=!0}function bt(){console.log("THREE.WebGLRenderer: Context Restored."),T=!1;const b=ht.autoReset,O=yt.enabled,Y=yt.autoUpdate,Z=yt.needsUpdate,G=yt.type;xt(),ht.autoReset=b,yt.enabled=O,yt.autoUpdate=Y,yt.needsUpdate=Z,yt.type=G}function Bt(b){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",b.statusMessage)}function qt(b){const O=b.target;O.removeEventListener("dispose",qt),we(O)}function we(b){nn(b),nt.remove(b)}function nn(b){const O=nt.get(b).programs;O!==void 0&&(O.forEach(function(Y){pt.releaseProgram(Y)}),b.isShaderMaterial&&pt.releaseShaderCache(b))}this.renderBufferDirect=function(b,O,Y,Z,G,_t){O===null&&(O=ae);const It=G.isMesh&&G.matrixWorld.determinant()<0,Lt=_x(b,O,Y,Z,G);K.setMaterial(Z,It);let Pt=Y.index,Wt=1;if(Z.wireframe===!0){if(Pt=J.getWireframeAttribute(Y),Pt===void 0)return;Wt=2}const jt=Y.drawRange,Ft=Y.attributes.position;let ie=jt.start*Wt,Ce=(jt.start+jt.count)*Wt;_t!==null&&(ie=Math.max(ie,_t.start*Wt),Ce=Math.min(Ce,(_t.start+_t.count)*Wt)),Pt!==null?(ie=Math.max(ie,0),Ce=Math.min(Ce,Pt.count)):Ft!=null&&(ie=Math.max(ie,0),Ce=Math.min(Ce,Ft.count));const Be=Ce-ie;if(Be<0||Be===1/0)return;de.setup(G,Z,Lt,Y,Pt);let En,le=St;if(Pt!==null&&(En=N.get(Pt),le=Ht,le.setIndex(En)),G.isMesh)Z.wireframe===!0?(K.setLineWidth(Z.wireframeLinewidth*w()),le.setMode(v.LINES)):le.setMode(v.TRIANGLES);else if(G.isLine){let Ut=Z.linewidth;Ut===void 0&&(Ut=1),K.setLineWidth(Ut*w()),G.isLineSegments?le.setMode(v.LINES):G.isLineLoop?le.setMode(v.LINE_LOOP):le.setMode(v.LINE_STRIP)}else G.isPoints?le.setMode(v.POINTS):G.isSprite&&le.setMode(v.TRIANGLES);if(G.isBatchedMesh)if(G._multiDrawInstances!==null)le.renderMultiDrawInstances(G._multiDrawStarts,G._multiDrawCounts,G._multiDrawCount,G._multiDrawInstances);else if(st.get("WEBGL_multi_draw"))le.renderMultiDraw(G._multiDrawStarts,G._multiDrawCounts,G._multiDrawCount);else{const Ut=G._multiDrawStarts,Ni=G._multiDrawCounts,ce=G._multiDrawCount,Kn=Pt?N.get(Pt).bytesPerElement:1,Er=nt.get(Z).currentProgram.getUniforms();for(let Sn=0;Sn<ce;Sn++)Er.setValue(v,"_gl_DrawID",Sn),le.render(Ut[Sn]/Kn,Ni[Sn])}else if(G.isInstancedMesh)le.renderInstances(ie,Be,G.count);else if(Y.isInstancedBufferGeometry){const Ut=Y._maxInstanceCount!==void 0?Y._maxInstanceCount:1/0,Ni=Math.min(Y.instanceCount,Ut);le.renderInstances(ie,Be,Ni)}else le.render(ie,Be)};function fe(b,O,Y){b.transparent===!0&&b.side===Un&&b.forceSinglePass===!1?(b.side=Mn,b.needsUpdate=!0,tl(b,O,Y),b.side=os,b.needsUpdate=!0,tl(b,O,Y),b.side=Un):tl(b,O,Y)}this.compile=function(b,O,Y=null){Y===null&&(Y=b),A=zt.get(Y),A.init(O),E.push(A),Y.traverseVisible(function(G){G.isLight&&G.layers.test(O.layers)&&(A.pushLight(G),G.castShadow&&A.pushShadow(G))}),b!==Y&&b.traverseVisible(function(G){G.isLight&&G.layers.test(O.layers)&&(A.pushLight(G),G.castShadow&&A.pushShadow(G))}),A.setupLights();const Z=new Set;return b.traverse(function(G){if(!(G.isMesh||G.isPoints||G.isLine||G.isSprite))return;const _t=G.material;if(_t)if(Array.isArray(_t))for(let It=0;It<_t.length;It++){const Lt=_t[It];fe(Lt,Y,G),Z.add(Lt)}else fe(_t,Y,G),Z.add(_t)}),E.pop(),A=null,Z},this.compileAsync=function(b,O,Y=null){const Z=this.compile(b,O,Y);return new Promise(G=>{function _t(){if(Z.forEach(function(It){nt.get(It).currentProgram.isReady()&&Z.delete(It)}),Z.size===0){G(b);return}setTimeout(_t,10)}st.get("KHR_parallel_shader_compile")!==null?_t():setTimeout(_t,10)})};let Xn=null;function Ui(b){Xn&&Xn(b)}function $A(){Os.stop()}function tp(){Os.start()}const Os=new QE;Os.setAnimationLoop(Ui),typeof self<"u"&&Os.setContext(self),this.setAnimationLoop=function(b){Xn=b,rt.setAnimationLoop(b),b===null?Os.stop():Os.start()},rt.addEventListener("sessionstart",$A),rt.addEventListener("sessionend",tp),this.render=function(b,O){if(O!==void 0&&O.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(T===!0)return;if(b.matrixWorldAutoUpdate===!0&&b.updateMatrixWorld(),O.parent===null&&O.matrixWorldAutoUpdate===!0&&O.updateMatrixWorld(),rt.enabled===!0&&rt.isPresenting===!0&&(rt.cameraAutoUpdate===!0&&rt.updateCamera(O),O=rt.getCamera()),b.isScene===!0&&b.onBeforeRender(_,b,O,R),A=zt.get(b,E.length),A.init(O),E.push(A),vt.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),at.setFromProjectionMatrix(vt),H=this.localClippingEnabled,mt=ct.init(this.clippingPlanes,H),g=ft.get(b,C.length),g.init(),C.push(g),rt.enabled===!0&&rt.isPresenting===!0){const _t=_.xr.getDepthSensingMesh();_t!==null&&Ih(_t,O,-1/0,_.sortObjects)}Ih(b,O,0,_.sortObjects),g.finish(),_.sortObjects===!0&&g.sort(ut,gt),Zt=rt.enabled===!1||rt.isPresenting===!1||rt.hasDepthSensing()===!1,Zt&&Rt.addToRenderList(g,b),this.info.render.frame++,mt===!0&&ct.beginShadows();const Y=A.state.shadowsArray;yt.render(Y,b,O),mt===!0&&ct.endShadows(),this.info.autoReset===!0&&this.info.reset();const Z=g.opaque,G=g.transmissive;if(A.setupLights(),O.isArrayCamera){const _t=O.cameras;if(G.length>0)for(let It=0,Lt=_t.length;It<Lt;It++){const Pt=_t[It];np(Z,G,b,Pt)}Zt&&Rt.render(b);for(let It=0,Lt=_t.length;It<Lt;It++){const Pt=_t[It];ep(g,b,Pt,Pt.viewport)}}else G.length>0&&np(Z,G,b,O),Zt&&Rt.render(b),ep(g,b,O);R!==null&&(I.updateMultisampleRenderTarget(R),I.updateRenderTargetMipmap(R)),b.isScene===!0&&b.onAfterRender(_,b,O),de.resetDefaultState(),B=-1,x=null,E.pop(),E.length>0?(A=E[E.length-1],mt===!0&&ct.setGlobalState(_.clippingPlanes,A.state.camera)):A=null,C.pop(),C.length>0?g=C[C.length-1]:g=null};function Ih(b,O,Y,Z){if(b.visible===!1)return;if(b.layers.test(O.layers)){if(b.isGroup)Y=b.renderOrder;else if(b.isLOD)b.autoUpdate===!0&&b.update(O);else if(b.isLight)A.pushLight(b),b.castShadow&&A.pushShadow(b);else if(b.isSprite){if(!b.frustumCulled||at.intersectsSprite(b)){Z&&Vt.setFromMatrixPosition(b.matrixWorld).applyMatrix4(vt);const It=W.update(b),Lt=b.material;Lt.visible&&g.push(b,It,Lt,Y,Vt.z,null)}}else if((b.isMesh||b.isLine||b.isPoints)&&(!b.frustumCulled||at.intersectsObject(b))){const It=W.update(b),Lt=b.material;if(Z&&(b.boundingSphere!==void 0?(b.boundingSphere===null&&b.computeBoundingSphere(),Vt.copy(b.boundingSphere.center)):(It.boundingSphere===null&&It.computeBoundingSphere(),Vt.copy(It.boundingSphere.center)),Vt.applyMatrix4(b.matrixWorld).applyMatrix4(vt)),Array.isArray(Lt)){const Pt=It.groups;for(let Wt=0,jt=Pt.length;Wt<jt;Wt++){const Ft=Pt[Wt],ie=Lt[Ft.materialIndex];ie&&ie.visible&&g.push(b,It,ie,Y,Vt.z,Ft)}}else Lt.visible&&g.push(b,It,Lt,Y,Vt.z,null)}}const _t=b.children;for(let It=0,Lt=_t.length;It<Lt;It++)Ih(_t[It],O,Y,Z)}function ep(b,O,Y,Z){const G=b.opaque,_t=b.transmissive,It=b.transparent;A.setupLightsView(Y),mt===!0&&ct.setGlobalState(_.clippingPlanes,Y),Z&&K.viewport(D.copy(Z)),G.length>0&&$a(G,O,Y),_t.length>0&&$a(_t,O,Y),It.length>0&&$a(It,O,Y),K.buffers.depth.setTest(!0),K.buffers.depth.setMask(!0),K.buffers.color.setMask(!0),K.setPolygonOffset(!1)}function np(b,O,Y,Z){if((Y.isScene===!0?Y.overrideMaterial:null)!==null)return;A.state.transmissionRenderTarget[Z.id]===void 0&&(A.state.transmissionRenderTarget[Z.id]=new Ds(1,1,{generateMipmaps:!0,type:st.has("EXT_color_buffer_half_float")||st.has("EXT_color_buffer_float")?si:We,minFilter:Mi,samples:4,stencilBuffer:r,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ee.workingColorSpace}));const _t=A.state.transmissionRenderTarget[Z.id],It=Z.viewport||D;_t.setSize(It.z,It.w);const Lt=_.getRenderTarget();_.setRenderTarget(_t),_.getClearColor(k),et=_.getClearAlpha(),et<1&&_.setClearColor(16777215,.5),_.clear(),Zt&&Rt.render(Y);const Pt=_.toneMapping;_.toneMapping=Ss;const Wt=Z.viewport;if(Z.viewport!==void 0&&(Z.viewport=void 0),A.setupLightsView(Z),mt===!0&&ct.setGlobalState(_.clippingPlanes,Z),$a(b,Y,Z),I.updateMultisampleRenderTarget(_t),I.updateRenderTargetMipmap(_t),st.has("WEBGL_multisampled_render_to_texture")===!1){let jt=!1;for(let Ft=0,ie=O.length;Ft<ie;Ft++){const Ce=O[Ft],Be=Ce.object,En=Ce.geometry,le=Ce.material,Ut=Ce.group;if(le.side===Un&&Be.layers.test(Z.layers)){const Ni=le.side;le.side=Mn,le.needsUpdate=!0,ip(Be,Y,Z,En,le,Ut),le.side=Ni,le.needsUpdate=!0,jt=!0}}jt===!0&&(I.updateMultisampleRenderTarget(_t),I.updateRenderTargetMipmap(_t))}_.setRenderTarget(Lt),_.setClearColor(k,et),Wt!==void 0&&(Z.viewport=Wt),_.toneMapping=Pt}function $a(b,O,Y){const Z=O.isScene===!0?O.overrideMaterial:null;for(let G=0,_t=b.length;G<_t;G++){const It=b[G],Lt=It.object,Pt=It.geometry,Wt=Z===null?It.material:Z,jt=It.group;Lt.layers.test(Y.layers)&&ip(Lt,O,Y,Pt,Wt,jt)}}function ip(b,O,Y,Z,G,_t){b.onBeforeRender(_,O,Y,Z,G,_t),b.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,b.matrixWorld),b.normalMatrix.getNormalMatrix(b.modelViewMatrix),G.onBeforeRender(_,O,Y,Z,b,_t),G.transparent===!0&&G.side===Un&&G.forceSinglePass===!1?(G.side=Mn,G.needsUpdate=!0,_.renderBufferDirect(Y,O,Z,G,b,_t),G.side=os,G.needsUpdate=!0,_.renderBufferDirect(Y,O,Z,G,b,_t),G.side=Un):_.renderBufferDirect(Y,O,Z,G,b,_t),b.onAfterRender(_,O,Y,Z,G,_t)}function tl(b,O,Y){O.isScene!==!0&&(O=ae);const Z=nt.get(b),G=A.state.lights,_t=A.state.shadowsArray,It=G.state.version,Lt=pt.getParameters(b,G.state,_t,O,Y),Pt=pt.getProgramCacheKey(Lt);let Wt=Z.programs;Z.environment=b.isMeshStandardMaterial?O.environment:null,Z.fog=O.fog,Z.envMap=(b.isMeshStandardMaterial?P:y).get(b.envMap||Z.environment),Z.envMapRotation=Z.environment!==null&&b.envMap===null?O.environmentRotation:b.envMapRotation,Wt===void 0&&(b.addEventListener("dispose",qt),Wt=new Map,Z.programs=Wt);let jt=Wt.get(Pt);if(jt!==void 0){if(Z.currentProgram===jt&&Z.lightsStateVersion===It)return rp(b,Lt),jt}else Lt.uniforms=pt.getUniforms(b),b.onBeforeCompile(Lt,_),jt=pt.acquireProgram(Lt,Pt),Wt.set(Pt,jt),Z.uniforms=Lt.uniforms;const Ft=Z.uniforms;return(!b.isShaderMaterial&&!b.isRawShaderMaterial||b.clipping===!0)&&(Ft.clippingPlanes=ct.uniform),rp(b,Lt),Z.needsLights=yx(b),Z.lightsStateVersion=It,Z.needsLights&&(Ft.ambientLightColor.value=G.state.ambient,Ft.lightProbe.value=G.state.probe,Ft.directionalLights.value=G.state.directional,Ft.directionalLightShadows.value=G.state.directionalShadow,Ft.spotLights.value=G.state.spot,Ft.spotLightShadows.value=G.state.spotShadow,Ft.rectAreaLights.value=G.state.rectArea,Ft.ltc_1.value=G.state.rectAreaLTC1,Ft.ltc_2.value=G.state.rectAreaLTC2,Ft.pointLights.value=G.state.point,Ft.pointLightShadows.value=G.state.pointShadow,Ft.hemisphereLights.value=G.state.hemi,Ft.directionalShadowMap.value=G.state.directionalShadowMap,Ft.directionalShadowMatrix.value=G.state.directionalShadowMatrix,Ft.spotShadowMap.value=G.state.spotShadowMap,Ft.spotLightMatrix.value=G.state.spotLightMatrix,Ft.spotLightMap.value=G.state.spotLightMap,Ft.pointShadowMap.value=G.state.pointShadowMap,Ft.pointShadowMatrix.value=G.state.pointShadowMatrix),Z.currentProgram=jt,Z.uniformsList=null,jt}function sp(b){if(b.uniformsList===null){const O=b.currentProgram.getUniforms();b.uniformsList=fc.seqWithValue(O.seq,b.uniforms)}return b.uniformsList}function rp(b,O){const Y=nt.get(b);Y.outputColorSpace=O.outputColorSpace,Y.batching=O.batching,Y.batchingColor=O.batchingColor,Y.instancing=O.instancing,Y.instancingColor=O.instancingColor,Y.instancingMorph=O.instancingMorph,Y.skinning=O.skinning,Y.morphTargets=O.morphTargets,Y.morphNormals=O.morphNormals,Y.morphColors=O.morphColors,Y.morphTargetsCount=O.morphTargetsCount,Y.numClippingPlanes=O.numClippingPlanes,Y.numIntersection=O.numClipIntersection,Y.vertexAlphas=O.vertexAlphas,Y.vertexTangents=O.vertexTangents,Y.toneMapping=O.toneMapping}function _x(b,O,Y,Z,G){O.isScene!==!0&&(O=ae),I.resetTextureUnits();const _t=O.fog,It=Z.isMeshStandardMaterial?O.environment:null,Lt=R===null?_.outputColorSpace:R.isXRRenderTarget===!0?R.texture.colorSpace:tn,Pt=(Z.isMeshStandardMaterial?P:y).get(Z.envMap||It),Wt=Z.vertexColors===!0&&!!Y.attributes.color&&Y.attributes.color.itemSize===4,jt=!!Y.attributes.tangent&&(!!Z.normalMap||Z.anisotropy>0),Ft=!!Y.morphAttributes.position,ie=!!Y.morphAttributes.normal,Ce=!!Y.morphAttributes.color;let Be=Ss;Z.toneMapped&&(R===null||R.isXRRenderTarget===!0)&&(Be=_.toneMapping);const En=Y.morphAttributes.position||Y.morphAttributes.normal||Y.morphAttributes.color,le=En!==void 0?En.length:0,Ut=nt.get(Z),Ni=A.state.lights;if(mt===!0&&(H===!0||b!==x)){const kn=b===x&&Z.id===B;ct.setState(Z,b,kn)}let ce=!1;Z.version===Ut.__version?(Ut.needsLights&&Ut.lightsStateVersion!==Ni.state.version||Ut.outputColorSpace!==Lt||G.isBatchedMesh&&Ut.batching===!1||!G.isBatchedMesh&&Ut.batching===!0||G.isBatchedMesh&&Ut.batchingColor===!0&&G.colorTexture===null||G.isBatchedMesh&&Ut.batchingColor===!1&&G.colorTexture!==null||G.isInstancedMesh&&Ut.instancing===!1||!G.isInstancedMesh&&Ut.instancing===!0||G.isSkinnedMesh&&Ut.skinning===!1||!G.isSkinnedMesh&&Ut.skinning===!0||G.isInstancedMesh&&Ut.instancingColor===!0&&G.instanceColor===null||G.isInstancedMesh&&Ut.instancingColor===!1&&G.instanceColor!==null||G.isInstancedMesh&&Ut.instancingMorph===!0&&G.morphTexture===null||G.isInstancedMesh&&Ut.instancingMorph===!1&&G.morphTexture!==null||Ut.envMap!==Pt||Z.fog===!0&&Ut.fog!==_t||Ut.numClippingPlanes!==void 0&&(Ut.numClippingPlanes!==ct.numPlanes||Ut.numIntersection!==ct.numIntersection)||Ut.vertexAlphas!==Wt||Ut.vertexTangents!==jt||Ut.morphTargets!==Ft||Ut.morphNormals!==ie||Ut.morphColors!==Ce||Ut.toneMapping!==Be||Ut.morphTargetsCount!==le)&&(ce=!0):(ce=!0,Ut.__version=Z.version);let Kn=Ut.currentProgram;ce===!0&&(Kn=tl(Z,O,G));let Er=!1,Sn=!1,vo=!1;const Ie=Kn.getUniforms(),gi=Ut.uniforms;if(K.useProgram(Kn.program)&&(Er=!0,Sn=!0,vo=!0),Z.id!==B&&(B=Z.id,Sn=!0),Er||x!==b){K.buffers.depth.getReversed()?(ot.copy(b.projectionMatrix),rb(ot),ob(ot),Ie.setValue(v,"projectionMatrix",ot)):Ie.setValue(v,"projectionMatrix",b.projectionMatrix),Ie.setValue(v,"viewMatrix",b.matrixWorldInverse);const cs=Ie.map.cameraPosition;cs!==void 0&&cs.setValue(v,Mt.setFromMatrixPosition(b.matrixWorld)),$.logarithmicDepthBuffer&&Ie.setValue(v,"logDepthBufFC",2/(Math.log(b.far+1)/Math.LN2)),(Z.isMeshPhongMaterial||Z.isMeshToonMaterial||Z.isMeshLambertMaterial||Z.isMeshBasicMaterial||Z.isMeshStandardMaterial||Z.isShaderMaterial)&&Ie.setValue(v,"isOrthographic",b.isOrthographicCamera===!0),x!==b&&(x=b,Sn=!0,vo=!0)}if(G.isSkinnedMesh){Ie.setOptional(v,G,"bindMatrix"),Ie.setOptional(v,G,"bindMatrixInverse");const kn=G.skeleton;kn&&(kn.boneTexture===null&&kn.computeBoneTexture(),Ie.setValue(v,"boneTexture",kn.boneTexture,I))}G.isBatchedMesh&&(Ie.setOptional(v,G,"batchingTexture"),Ie.setValue(v,"batchingTexture",G._matricesTexture,I),Ie.setOptional(v,G,"batchingIdTexture"),Ie.setValue(v,"batchingIdTexture",G._indirectTexture,I),Ie.setOptional(v,G,"batchingColorTexture"),G._colorsTexture!==null&&Ie.setValue(v,"batchingColorTexture",G._colorsTexture,I));const Bo=Y.morphAttributes;if((Bo.position!==void 0||Bo.normal!==void 0||Bo.color!==void 0)&&Ot.update(G,Y,Kn),(Sn||Ut.receiveShadow!==G.receiveShadow)&&(Ut.receiveShadow=G.receiveShadow,Ie.setValue(v,"receiveShadow",G.receiveShadow)),Z.isMeshGouraudMaterial&&Z.envMap!==null&&(gi.envMap.value=Pt,gi.flipEnvMap.value=Pt.isCubeTexture&&Pt.isRenderTargetTexture===!1?-1:1),Z.isMeshStandardMaterial&&Z.envMap===null&&O.environment!==null&&(gi.envMapIntensity.value=O.environmentIntensity),Sn&&(Ie.setValue(v,"toneMappingExposure",_.toneMappingExposure),Ut.needsLights&&Ex(gi,vo),_t&&Z.fog===!0&&dt.refreshFogUniforms(gi,_t),dt.refreshMaterialUniforms(gi,Z,U,X,A.state.transmissionRenderTarget[b.id]),fc.upload(v,sp(Ut),gi,I)),Z.isShaderMaterial&&Z.uniformsNeedUpdate===!0&&(fc.upload(v,sp(Ut),gi,I),Z.uniformsNeedUpdate=!1),Z.isSpriteMaterial&&Ie.setValue(v,"center",G.center),Ie.setValue(v,"modelViewMatrix",G.modelViewMatrix),Ie.setValue(v,"normalMatrix",G.normalMatrix),Ie.setValue(v,"modelMatrix",G.matrixWorld),Z.isShaderMaterial||Z.isRawShaderMaterial){const kn=Z.uniformsGroups;for(let cs=0,hs=kn.length;cs<hs;cs++){const op=kn[cs];F.update(op,Kn),F.bind(op,Kn)}}return Kn}function Ex(b,O){b.ambientLightColor.needsUpdate=O,b.lightProbe.needsUpdate=O,b.directionalLights.needsUpdate=O,b.directionalLightShadows.needsUpdate=O,b.pointLights.needsUpdate=O,b.pointLightShadows.needsUpdate=O,b.spotLights.needsUpdate=O,b.spotLightShadows.needsUpdate=O,b.rectAreaLights.needsUpdate=O,b.hemisphereLights.needsUpdate=O}function yx(b){return b.isMeshLambertMaterial||b.isMeshToonMaterial||b.isMeshPhongMaterial||b.isMeshStandardMaterial||b.isShadowMaterial||b.isShaderMaterial&&b.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return R},this.setRenderTargetTextures=function(b,O,Y){nt.get(b.texture).__webglTexture=O,nt.get(b.depthTexture).__webglTexture=Y;const Z=nt.get(b);Z.__hasExternalTextures=!0,Z.__autoAllocateDepthBuffer=Y===void 0,Z.__autoAllocateDepthBuffer||st.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Z.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(b,O){const Y=nt.get(b);Y.__webglFramebuffer=O,Y.__useDefaultFramebuffer=O===void 0},this.setRenderTarget=function(b,O=0,Y=0){R=b,M=O,S=Y;let Z=!0,G=null,_t=!1,It=!1;if(b){const Pt=nt.get(b);if(Pt.__useDefaultFramebuffer!==void 0)K.bindFramebuffer(v.FRAMEBUFFER,null),Z=!1;else if(Pt.__webglFramebuffer===void 0)I.setupRenderTarget(b);else if(Pt.__hasExternalTextures)I.rebindTextures(b,nt.get(b.texture).__webglTexture,nt.get(b.depthTexture).__webglTexture);else if(b.depthBuffer){const Ft=b.depthTexture;if(Pt.__boundDepthTexture!==Ft){if(Ft!==null&&nt.has(Ft)&&(b.width!==Ft.image.width||b.height!==Ft.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");I.setupDepthRenderbuffer(b)}}const Wt=b.texture;(Wt.isData3DTexture||Wt.isDataArrayTexture||Wt.isCompressedArrayTexture)&&(It=!0);const jt=nt.get(b).__webglFramebuffer;b.isWebGLCubeRenderTarget?(Array.isArray(jt[O])?G=jt[O][Y]:G=jt[O],_t=!0):b.samples>0&&I.useMultisampledRTT(b)===!1?G=nt.get(b).__webglMultisampledFramebuffer:Array.isArray(jt)?G=jt[Y]:G=jt,D.copy(b.viewport),V.copy(b.scissor),Q=b.scissorTest}else D.copy(Et).multiplyScalar(U).floor(),V.copy(Dt).multiplyScalar(U).floor(),Q=Jt;if(K.bindFramebuffer(v.FRAMEBUFFER,G)&&Z&&K.drawBuffers(b,G),K.viewport(D),K.scissor(V),K.setScissorTest(Q),_t){const Pt=nt.get(b.texture);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+O,Pt.__webglTexture,Y)}else if(It){const Pt=nt.get(b.texture),Wt=O||0;v.framebufferTextureLayer(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,Pt.__webglTexture,Y||0,Wt)}B=-1},this.readRenderTargetPixels=function(b,O,Y,Z,G,_t,It){if(!(b&&b.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Lt=nt.get(b).__webglFramebuffer;if(b.isWebGLCubeRenderTarget&&It!==void 0&&(Lt=Lt[It]),Lt){K.bindFramebuffer(v.FRAMEBUFFER,Lt);try{const Pt=b.texture,Wt=Pt.format,jt=Pt.type;if(!$.textureFormatReadable(Wt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!$.textureTypeReadable(jt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}O>=0&&O<=b.width-Z&&Y>=0&&Y<=b.height-G&&v.readPixels(O,Y,Z,G,Gt.convert(Wt),Gt.convert(jt),_t)}finally{const Pt=R!==null?nt.get(R).__webglFramebuffer:null;K.bindFramebuffer(v.FRAMEBUFFER,Pt)}}},this.readRenderTargetPixelsAsync=async function(b,O,Y,Z,G,_t,It){if(!(b&&b.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Lt=nt.get(b).__webglFramebuffer;if(b.isWebGLCubeRenderTarget&&It!==void 0&&(Lt=Lt[It]),Lt){const Pt=b.texture,Wt=Pt.format,jt=Pt.type;if(!$.textureFormatReadable(Wt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!$.textureTypeReadable(jt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(O>=0&&O<=b.width-Z&&Y>=0&&Y<=b.height-G){K.bindFramebuffer(v.FRAMEBUFFER,Lt);const Ft=v.createBuffer();v.bindBuffer(v.PIXEL_PACK_BUFFER,Ft),v.bufferData(v.PIXEL_PACK_BUFFER,_t.byteLength,v.STREAM_READ),v.readPixels(O,Y,Z,G,Gt.convert(Wt),Gt.convert(jt),0);const ie=R!==null?nt.get(R).__webglFramebuffer:null;K.bindFramebuffer(v.FRAMEBUFFER,ie);const Ce=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);return v.flush(),await sb(v,Ce,4),v.bindBuffer(v.PIXEL_PACK_BUFFER,Ft),v.getBufferSubData(v.PIXEL_PACK_BUFFER,0,_t),v.deleteBuffer(Ft),v.deleteSync(Ce),_t}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(b,O=null,Y=0){b.isTexture!==!0&&(Ko("WebGLRenderer: copyFramebufferToTexture function signature has changed."),O=arguments[0]||null,b=arguments[1]);const Z=Math.pow(2,-Y),G=Math.floor(b.image.width*Z),_t=Math.floor(b.image.height*Z),It=O!==null?O.x:0,Lt=O!==null?O.y:0;I.setTexture2D(b,0),v.copyTexSubImage2D(v.TEXTURE_2D,Y,0,0,It,Lt,G,_t),K.unbindTexture()},this.copyTextureToTexture=function(b,O,Y=null,Z=null,G=0){b.isTexture!==!0&&(Ko("WebGLRenderer: copyTextureToTexture function signature has changed."),Z=arguments[0]||null,b=arguments[1],O=arguments[2],G=arguments[3]||0,Y=null);let _t,It,Lt,Pt,Wt,jt,Ft,ie,Ce;const Be=b.isCompressedTexture?b.mipmaps[G]:b.image;Y!==null?(_t=Y.max.x-Y.min.x,It=Y.max.y-Y.min.y,Lt=Y.isBox3?Y.max.z-Y.min.z:1,Pt=Y.min.x,Wt=Y.min.y,jt=Y.isBox3?Y.min.z:0):(_t=Be.width,It=Be.height,Lt=Be.depth||1,Pt=0,Wt=0,jt=0),Z!==null?(Ft=Z.x,ie=Z.y,Ce=Z.z):(Ft=0,ie=0,Ce=0);const En=Gt.convert(O.format),le=Gt.convert(O.type);let Ut;O.isData3DTexture?(I.setTexture3D(O,0),Ut=v.TEXTURE_3D):O.isDataArrayTexture||O.isCompressedArrayTexture?(I.setTexture2DArray(O,0),Ut=v.TEXTURE_2D_ARRAY):(I.setTexture2D(O,0),Ut=v.TEXTURE_2D),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,O.flipY),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,O.premultiplyAlpha),v.pixelStorei(v.UNPACK_ALIGNMENT,O.unpackAlignment);const Ni=v.getParameter(v.UNPACK_ROW_LENGTH),ce=v.getParameter(v.UNPACK_IMAGE_HEIGHT),Kn=v.getParameter(v.UNPACK_SKIP_PIXELS),Er=v.getParameter(v.UNPACK_SKIP_ROWS),Sn=v.getParameter(v.UNPACK_SKIP_IMAGES);v.pixelStorei(v.UNPACK_ROW_LENGTH,Be.width),v.pixelStorei(v.UNPACK_IMAGE_HEIGHT,Be.height),v.pixelStorei(v.UNPACK_SKIP_PIXELS,Pt),v.pixelStorei(v.UNPACK_SKIP_ROWS,Wt),v.pixelStorei(v.UNPACK_SKIP_IMAGES,jt);const vo=b.isDataArrayTexture||b.isData3DTexture,Ie=O.isDataArrayTexture||O.isData3DTexture;if(b.isRenderTargetTexture||b.isDepthTexture){const gi=nt.get(b),Bo=nt.get(O),kn=nt.get(gi.__renderTarget),cs=nt.get(Bo.__renderTarget);K.bindFramebuffer(v.READ_FRAMEBUFFER,kn.__webglFramebuffer),K.bindFramebuffer(v.DRAW_FRAMEBUFFER,cs.__webglFramebuffer);for(let hs=0;hs<Lt;hs++)vo&&v.framebufferTextureLayer(v.READ_FRAMEBUFFER,v.COLOR_ATTACHMENT0,nt.get(b).__webglTexture,G,jt+hs),b.isDepthTexture?(Ie&&v.framebufferTextureLayer(v.DRAW_FRAMEBUFFER,v.COLOR_ATTACHMENT0,nt.get(O).__webglTexture,G,Ce+hs),v.blitFramebuffer(Pt,Wt,_t,It,Ft,ie,_t,It,v.DEPTH_BUFFER_BIT,v.NEAREST)):Ie?v.copyTexSubImage3D(Ut,G,Ft,ie,Ce+hs,Pt,Wt,_t,It):v.copyTexSubImage2D(Ut,G,Ft,ie,Ce+hs,Pt,Wt,_t,It);K.bindFramebuffer(v.READ_FRAMEBUFFER,null),K.bindFramebuffer(v.DRAW_FRAMEBUFFER,null)}else Ie?b.isDataTexture||b.isData3DTexture?v.texSubImage3D(Ut,G,Ft,ie,Ce,_t,It,Lt,En,le,Be.data):O.isCompressedArrayTexture?v.compressedTexSubImage3D(Ut,G,Ft,ie,Ce,_t,It,Lt,En,Be.data):v.texSubImage3D(Ut,G,Ft,ie,Ce,_t,It,Lt,En,le,Be):b.isDataTexture?v.texSubImage2D(v.TEXTURE_2D,G,Ft,ie,_t,It,En,le,Be.data):b.isCompressedTexture?v.compressedTexSubImage2D(v.TEXTURE_2D,G,Ft,ie,Be.width,Be.height,En,Be.data):v.texSubImage2D(v.TEXTURE_2D,G,Ft,ie,_t,It,En,le,Be);v.pixelStorei(v.UNPACK_ROW_LENGTH,Ni),v.pixelStorei(v.UNPACK_IMAGE_HEIGHT,ce),v.pixelStorei(v.UNPACK_SKIP_PIXELS,Kn),v.pixelStorei(v.UNPACK_SKIP_ROWS,Er),v.pixelStorei(v.UNPACK_SKIP_IMAGES,Sn),G===0&&O.generateMipmaps&&v.generateMipmap(Ut),K.unbindTexture()},this.copyTextureToTexture3D=function(b,O,Y=null,Z=null,G=0){return b.isTexture!==!0&&(Ko("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Y=arguments[0]||null,Z=arguments[1]||null,b=arguments[2],O=arguments[3],G=arguments[4]||0),Ko('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(b,O,Y,Z,G)},this.initRenderTarget=function(b){nt.get(b).__webglFramebuffer===void 0&&I.setupRenderTarget(b)},this.initTexture=function(b){b.isCubeTexture?I.setTextureCube(b,0):b.isData3DTexture?I.setTexture3D(b,0):b.isDataArrayTexture||b.isCompressedArrayTexture?I.setTexture2DArray(b,0):I.setTexture2D(b,0),K.unbindTexture()},this.resetState=function(){M=0,S=0,R=null,K.reset(),de.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return es}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorspace=ee._getDrawingBufferColorSpace(t),e.unpackColorSpace=ee._getUnpackColorSpace()}}class jE extends Me{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Hn,this.environmentIntensity=1,this.environmentRotation=new Hn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class d1{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=nf,this.updateRanges=[],this.version=0,this.uuid=ci()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,r=this.stride;s<r;s++)this.array[t+s]=e.array[i+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ci()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ci()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const dn=new L;class hA{constructor(t,e,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.applyMatrix4(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.applyNormalMatrix(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)dn.fromBufferAttribute(this,e),dn.transformDirection(t),this.setXYZ(e,dn.x,dn.y,dn.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=ni(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=Ae(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=ni(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=ni(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=ni(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=ni(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ae(e,this.array),i=Ae(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ae(e,this.array),i=Ae(i,this.array),s=Ae(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this}setXYZW(t,e,i,s,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ae(e,this.array),i=Ae(i,this.array),s=Ae(s,this.array),r=Ae(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=r,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return new Ue(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new hA(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[s+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const Og=new L,Gg=new oe,Qg=new oe,f1=new L,Hg=new wt,Il=new L,du=new Ai,kg=new wt,fu=new Va;class A1 extends Ye{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Gp,this.bindMatrix=new wt,this.bindMatrixInverse=new wt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new ui),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Il),this.boundingBox.expandByPoint(Il)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ai),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Il),this.boundingSphere.expandByPoint(Il)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),du.copy(this.boundingSphere),du.applyMatrix4(s),t.ray.intersectsSphere(du)!==!1&&(kg.copy(s).invert(),fu.copy(t.ray).applyMatrix4(kg),!(this.boundingBox!==null&&fu.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,fu)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new oe,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){t.fromBufferAttribute(e,i);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===Gp?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===SI?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,s=this.geometry;Gg.fromBufferAttribute(s.attributes.skinIndex,t),Qg.fromBufferAttribute(s.attributes.skinWeight,t),Og.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const o=Qg.getComponent(r);if(o!==0){const a=Gg.getComponent(r);Hg.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(f1.copy(Og).applyMatrix4(Hg),o)}}return e.applyMatrix4(this.bindMatrixInverse)}}class XE extends Me{constructor(){super(),this.isBone=!0,this.type="Bone"}}class uA extends Fe{constructor(t=null,e=1,i=1,s,r,o,a,l,c=Ze,h=Ze,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Vg=new wt,p1=new wt;class dA{constructor(t=[],e=[]){this.uuid=ci(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new wt)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const i=new wt;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let r=0,o=t.length;r<o;r++){const a=t[r]?t[r].matrixWorld:p1;Vg.multiplyMatrices(a,e[r]),Vg.toArray(i,r*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new dA(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new uA(e,t,t,Qe,Ke);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];if(s.name===t)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,s=t.bones.length;i<s;i++){const r=t.bones[i];let o=e[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new XE),this.bones.push(o),this.boneInverses.push(new wt().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let s=0,r=e.length;s<r;s++){const o=e[s];t.bones.push(o.uuid);const a=i[s];t.boneInverses.push(a.toArray())}return t}}class rf extends Ue{constructor(t,e,i,s=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Fr=new wt,zg=new wt,bl=[],Wg=new ui,g1=new wt,Ro=new Ye,Do=new Ai;class m1 extends Ye{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new rf(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,g1)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new ui),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Fr),Wg.copy(t.boundingBox).applyMatrix4(Fr),this.boundingBox.union(Wg)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ai),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Fr),Do.copy(t.boundingSphere).applyMatrix4(Fr),this.boundingSphere.union(Do)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const i=e.morphTargetInfluences,s=this.morphTexture.source.data.data,r=i.length+1,o=t*r+1;for(let a=0;a<i.length;a++)i[a]=s[o+a]}raycast(t,e){const i=this.matrixWorld,s=this.count;if(Ro.geometry=this.geometry,Ro.material=this.material,Ro.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Do.copy(this.boundingSphere),Do.applyMatrix4(i),t.ray.intersectsSphere(Do)!==!1))for(let r=0;r<s;r++){this.getMatrixAt(r,Fr),zg.multiplyMatrices(i,Fr),Ro.matrixWorld=zg,Ro.raycast(t,bl);for(let o=0,a=bl.length;o<a;o++){const l=bl[o];l.instanceId=r,l.object=this,e.push(l)}bl.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new rf(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const i=e.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new uA(new Float32Array(s*this.count),s,this.count,Bs,Ke));const r=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=s*t;r[l]=a,r.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class Wa extends wi{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new tt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Pc=new L,Fc=new L,Jg=new wt,Lo=new Va,Ml=new Ai,Au=new L,qg=new L;class ch extends Me{constructor(t=new en,e=new Wa){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let s=1,r=e.count;s<r;s++)Pc.fromBufferAttribute(e,s-1),Fc.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=Pc.distanceTo(Fc);t.setAttribute("lineDistance",new Ne(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,r=t.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Ml.copy(i.boundingSphere),Ml.applyMatrix4(s),Ml.radius+=r,t.ray.intersectsSphere(Ml)===!1)return;Jg.copy(s).invert(),Lo.copy(t.ray).applyMatrix4(Jg);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,h=i.index,d=i.attributes.position;if(h!==null){const f=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let m=f,g=p-1;m<g;m+=c){const A=h.getX(m),C=h.getX(m+1),E=Sl(this,t,Lo,l,A,C);E&&e.push(E)}if(this.isLineLoop){const m=h.getX(p-1),g=h.getX(f),A=Sl(this,t,Lo,l,m,g);A&&e.push(A)}}else{const f=Math.max(0,o.start),p=Math.min(d.count,o.start+o.count);for(let m=f,g=p-1;m<g;m+=c){const A=Sl(this,t,Lo,l,m,m+1);A&&e.push(A)}if(this.isLineLoop){const m=Sl(this,t,Lo,l,p-1,f);m&&e.push(m)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function Sl(n,t,e,i,s,r){const o=n.geometry.attributes.position;if(Pc.fromBufferAttribute(o,s),Fc.fromBufferAttribute(o,r),e.distanceSqToSegment(Pc,Fc,Au,qg)>i)return;Au.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(Au);if(!(l<t.near||l>t.far))return{distance:l,point:qg.clone().applyMatrix4(n.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:n}}const jg=new L,Xg=new L;class fA extends ch{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[];for(let s=0,r=e.count;s<r;s+=2)jg.fromBufferAttribute(e,s),Xg.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+jg.distanceTo(Xg);t.setAttribute("lineDistance",new Ne(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class _1 extends ch{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class KE extends wi{static get type(){return"PointsMaterial"}constructor(t){super(),this.isPointsMaterial=!0,this.color=new tt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Kg=new wt,of=new Va,Tl=new Ai,wl=new L;class YE extends Me{constructor(t=new en,e=new KE){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,r=t.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Tl.copy(i.boundingSphere),Tl.applyMatrix4(s),Tl.radius+=r,t.ray.intersectsSphere(Tl)===!1)return;Kg.copy(s).invert(),of.copy(t.ray).applyMatrix4(Kg);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,u=i.attributes.position;if(c!==null){const d=Math.max(0,o.start),f=Math.min(c.count,o.start+o.count);for(let p=d,m=f;p<m;p++){const g=c.getX(p);wl.fromBufferAttribute(u,g),Yg(wl,g,l,s,t,e,this)}}else{const d=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let p=d,m=f;p<m;p++)wl.fromBufferAttribute(u,p),Yg(wl,p,l,s,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=s.length;r<o;r++){const a=s[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function Yg(n,t,e,i,s,r,o){const a=of.distanceSqToPoint(n);if(a<e){const l=new L;of.closestPointToPoint(n,l),l.applyMatrix4(i);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class hh extends Fe{constructor(t,e,i,s,r,o,a,l,c,h,u,d){super(null,o,a,l,c,h,s,r,u,d),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class E1 extends hh{constructor(t,e,i,s,r,o){super(t,e,i,r,o),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=ts,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class y1 extends hh{constructor(t,e,i){super(void 0,t[0].width,t[0].height,e,i,ur),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class C1 extends Fe{constructor(t,e,i,s,r,o,a,l,c){super(t,e,i,s,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class AA extends en{constructor(t=1,e=1,i=1,s=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:s,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;s=Math.floor(s),r=Math.floor(r);const h=[],u=[],d=[],f=[];let p=0;const m=[],g=i/2;let A=0;C(),o===!1&&(t>0&&E(!0),e>0&&E(!1)),this.setIndex(h),this.setAttribute("position",new Ne(u,3)),this.setAttribute("normal",new Ne(d,3)),this.setAttribute("uv",new Ne(f,2));function C(){const _=new L,T=new L;let M=0;const S=(e-t)/i;for(let R=0;R<=r;R++){const B=[],x=R/r,D=x*(e-t)+t;for(let V=0;V<=s;V++){const Q=V/s,k=Q*l+a,et=Math.sin(k),j=Math.cos(k);T.x=D*et,T.y=-x*i+g,T.z=D*j,u.push(T.x,T.y,T.z),_.set(et,S,j).normalize(),d.push(_.x,_.y,_.z),f.push(Q,1-x),B.push(p++)}m.push(B)}for(let R=0;R<s;R++)for(let B=0;B<r;B++){const x=m[B][R],D=m[B+1][R],V=m[B+1][R+1],Q=m[B][R+1];(t>0||B!==0)&&(h.push(x,D,Q),M+=3),(e>0||B!==r-1)&&(h.push(D,V,Q),M+=3)}c.addGroup(A,M,0),A+=M}function E(_){const T=p,M=new kt,S=new L;let R=0;const B=_===!0?t:e,x=_===!0?1:-1;for(let V=1;V<=s;V++)u.push(0,g*x,0),d.push(0,x,0),f.push(.5,.5),p++;const D=p;for(let V=0;V<=s;V++){const k=V/s*l+a,et=Math.cos(k),j=Math.sin(k);S.x=B*j,S.y=g*x,S.z=B*et,u.push(S.x,S.y,S.z),d.push(0,x,0),M.x=et*.5+.5,M.y=j*.5*x+.5,f.push(M.x,M.y),p++}for(let V=0;V<s;V++){const Q=T+V,k=D+V;_===!0?h.push(k,k+1,Q):h.push(k+1,k,Q),R+=3}c.addGroup(A,R,_===!0?1:2),A+=R}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new AA(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}const Rl=new L,Dl=new L,pu=new L,Ll=new Nn;class x1 extends en{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const s=Math.pow(10,4),r=Math.cos(or*e),o=t.getIndex(),a=t.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],u=new Array(3),d={},f=[];for(let p=0;p<l;p+=3){o?(c[0]=o.getX(p),c[1]=o.getX(p+1),c[2]=o.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:m,b:g,c:A}=Ll;if(m.fromBufferAttribute(a,c[0]),g.fromBufferAttribute(a,c[1]),A.fromBufferAttribute(a,c[2]),Ll.getNormal(pu),u[0]=`${Math.round(m.x*s)},${Math.round(m.y*s)},${Math.round(m.z*s)}`,u[1]=`${Math.round(g.x*s)},${Math.round(g.y*s)},${Math.round(g.z*s)}`,u[2]=`${Math.round(A.x*s)},${Math.round(A.y*s)},${Math.round(A.z*s)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let C=0;C<3;C++){const E=(C+1)%3,_=u[C],T=u[E],M=Ll[h[C]],S=Ll[h[E]],R=`${_}_${T}`,B=`${T}_${_}`;B in d&&d[B]?(pu.dot(d[B].normal)<=r&&(f.push(M.x,M.y,M.z),f.push(S.x,S.y,S.z)),d[B]=null):R in d||(d[R]={index0:c[C],index1:c[E],normal:pu.clone()})}}for(const p in d)if(d[p]){const{index0:m,index1:g}=d[p];Rl.fromBufferAttribute(a,m),Dl.fromBufferAttribute(a,g),f.push(Rl.x,Rl.y,Rl.z),f.push(Dl.x,Dl.y,Dl.z)}this.setAttribute("position",new Ne(f,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class pA extends wi{static get type(){return"MeshStandardMaterial"}constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new tt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=bE,this.normalScale=new kt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Hn,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Pi extends pA{static get type(){return"MeshPhysicalMaterial"}constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new kt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Je(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new tt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new tt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new tt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}function Pl(n,t,e){return!n||!e&&n.constructor===t?n:typeof t.BYTES_PER_ELEMENT=="number"?new t(n):Array.prototype.slice.call(n)}function v1(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function B1(n){function t(s,r){return n[s]-n[r]}const e=n.length,i=new Array(e);for(let s=0;s!==e;++s)i[s]=s;return i.sort(t),i}function Zg(n,t,e){const i=n.length,s=new n.constructor(i);for(let r=0,o=0;o!==i;++r){const a=e[r]*t;for(let l=0;l!==t;++l)s[o++]=n[a+l]}return s}function ZE(n,t,e,i){let s=1,r=n[0];for(;r!==void 0&&r[i]===void 0;)r=n[s++];if(r===void 0)return;let o=r[i];if(o!==void 0)if(Array.isArray(o))do o=r[i],o!==void 0&&(t.push(r.time),e.push.apply(e,o)),r=n[s++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[i],o!==void 0&&(t.push(r.time),o.toArray(e,e.length)),r=n[s++];while(r!==void 0);else do o=r[i],o!==void 0&&(t.push(r.time),e.push(o)),r=n[s++];while(r!==void 0)}class Ja{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],r=e[i-1];t:{e:{let o;n:{i:if(!(t<s)){for(let a=i+2;;){if(s===void 0){if(t<r)break i;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=s,s=e[++i],t<s)break e}o=e.length;break n}if(!(t>=r)){const a=e[1];t<a&&(i=2,r=a);for(let l=i-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=r,r=e[--i-1],t>=r)break e}o=i,i=0;break n}break t}for(;i<o;){const a=i+o>>>1;t<e[a]?o=a:i=a+1}if(s=e[i],r=e[i-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,s)}return this.interpolate_(i,r,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s;for(let o=0;o!==s;++o)e[o]=i[r+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class I1 extends Ja{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Qp,endingEnd:Qp}}intervalChanged_(t,e,i){const s=this.parameterPositions;let r=t-2,o=t+1,a=s[r],l=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case Hp:r=t,a=2*e-i;break;case kp:r=s.length-2,a=e+s[r]-s[r+1];break;default:r=t,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case Hp:o=t,l=2*i-e;break;case kp:o=1,l=i+s[1]-s[0];break;default:o=t-1,l=e}const c=(i-e)*.5,h=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(l-i),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=t*a,c=l-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(i-e)/(s-e),m=p*p,g=m*p,A=-d*g+2*d*m-d*p,C=(1+d)*g+(-1.5-2*d)*m+(-.5+d)*p+1,E=(-1-f)*g+(1.5+f)*m+.5*p,_=f*g-f*m;for(let T=0;T!==a;++T)r[T]=A*o[h+T]+C*o[c+T]+E*o[l+T]+_*o[u+T];return r}}class b1 extends Ja{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=t*a,c=l-a,h=(i-e)/(s-e),u=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*u+o[l+d]*h;return r}}class M1 extends Ja{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class Fi{constructor(t,e,i,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Pl(e,this.TimeBufferType),this.values=Pl(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Pl(t.times,Array),values:Pl(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new M1(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new b1(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new I1(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Ta:e=this.InterpolantFactoryMethodDiscrete;break;case wa:e=this.InterpolantFactoryMethodLinear;break;case Oh:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ta;case this.InterpolantFactoryMethodLinear:return wa;case this.InterpolantFactoryMethodSmooth:return Oh}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let r=0,o=s-1;for(;r!==s&&i[r]<t;)++r;for(;o!==-1&&i[o]>e;)--o;if(++o,r!==0||o!==s){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=i.slice(r,o),this.values=this.values.slice(r*a,o*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,r=i.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let a=0;a!==r;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),t=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),t=!1;break}o=l}if(s!==void 0&&v1(s))for(let a=0,l=s.length;a!==l;++a){const c=s[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===Oh,r=t.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=t[a],h=t[a+1];if(c!==h&&(a!==1||c!==t[0]))if(s)l=!0;else{const u=a*i,d=u-i,f=u+i;for(let p=0;p!==i;++p){const m=e[u+p];if(m!==e[d+p]||m!==e[f+p]){l=!0;break}}}if(l){if(a!==o){t[o]=t[a];const u=a*i,d=o*i;for(let f=0;f!==i;++f)e[d+f]=e[u+f]}++o}}if(r>0){t[o]=t[r];for(let a=r*i,l=o*i,c=0;c!==i;++c)e[l+c]=e[a+c];++o}return o!==t.length?(this.times=t.slice(0,o),this.values=e.slice(0,o*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=this.constructor,s=new i(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}Fi.prototype.TimeBufferType=Float32Array;Fi.prototype.ValueBufferType=Float32Array;Fi.prototype.DefaultInterpolation=wa;class Co extends Fi{constructor(t,e,i){super(t,e,i)}}Co.prototype.ValueTypeName="bool";Co.prototype.ValueBufferType=Array;Co.prototype.DefaultInterpolation=Ta;Co.prototype.InterpolantFactoryMethodLinear=void 0;Co.prototype.InterpolantFactoryMethodSmooth=void 0;class $E extends Fi{}$E.prototype.ValueTypeName="color";class uo extends Fi{}uo.prototype.ValueTypeName="number";class S1 extends Ja{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-e)/(s-e);let c=t*a;for(let h=c+a;c!==h;c+=4)hi.slerpFlat(r,0,o,c-a,o,c,l);return r}}class fo extends Fi{InterpolantFactoryMethodLinear(t){return new S1(this.times,this.values,this.getValueSize(),t)}}fo.prototype.ValueTypeName="quaternion";fo.prototype.InterpolantFactoryMethodSmooth=void 0;class xo extends Fi{constructor(t,e,i){super(t,e,i)}}xo.prototype.ValueTypeName="string";xo.prototype.ValueBufferType=Array;xo.prototype.DefaultInterpolation=Ta;xo.prototype.InterpolantFactoryMethodLinear=void 0;xo.prototype.InterpolantFactoryMethodSmooth=void 0;class Ao extends Fi{}Ao.prototype.ValueTypeName="vector";class T1{constructor(t="",e=-1,i=[],s=TI){this.name=t,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=ci(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,s=1/(t.fps||1);for(let o=0,a=i.length;o!==a;++o)e.push(R1(i[o]).scale(s));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,o=i.length;r!==o;++r)e.push(Fi.toJSON(i[r]));return s}static CreateFromMorphTargetSequence(t,e,i,s){const r=e.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=B1(l);l=Zg(l,1,h),c=Zg(c,1,h),!s&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new uo(".morphTargetInfluences["+e[a].name+"]",l,c).scale(1/i))}return new this(t,-1,o)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const s=t;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===e)return i[s];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const s={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=t.length;a<l;a++){const c=t[a],h=c.name.match(r);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const o=[];for(const a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],e,i));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,d,f,p,m){if(f.length!==0){const g=[],A=[];ZE(f,g,A,p),g.length!==0&&m.push(new u(d,g,A))}},s=[],r=t.name||"default",o=t.fps||30,a=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let u=0;u<c.length;u++){const d=c[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let m=0;m<d[p].morphTargets.length;m++)f[d[p].morphTargets[m]]=-1;for(const m in f){const g=[],A=[];for(let C=0;C!==d[p].morphTargets.length;++C){const E=d[p];g.push(E.time),A.push(E.morphTarget===m?1:0)}s.push(new uo(".morphTargetInfluence["+m+"]",g,A))}l=f.length*o}else{const f=".bones["+e[u].name+"]";i(Ao,f+".position",d,"pos",s),i(fo,f+".quaternion",d,"rot",s),i(Ao,f+".scale",d,"scl",s)}}return s.length===0?null:new this(r,l,s,a)}resetDuration(){const t=this.tracks;let e=0;for(let i=0,s=t.length;i!==s;++i){const r=this.tracks[i];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function w1(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return uo;case"vector":case"vector2":case"vector3":case"vector4":return Ao;case"color":return $E;case"quaternion":return fo;case"bool":case"boolean":return Co;case"string":return xo}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function R1(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=w1(n.type);if(n.times===void 0){const e=[],i=[];ZE(n.keys,e,i,"value"),n.times=e,n.values=i}return t.parse!==void 0?t.parse(n):new t(n.name,n.times,n.values,n.interpolation)}const Is={enabled:!1,files:{},add:function(n,t){this.enabled!==!1&&(this.files[n]=t)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class D1{constructor(t,e,i){const s=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(h){a++,r===!1&&s.onStart!==void 0&&s.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,s.onProgress!==void 0&&s.onProgress(h,o,a),o===a&&(r=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const f=c[u],p=c[u+1];if(f.global&&(f.lastIndex=0),f.test(h))return p}return null}}}const L1=new D1;class Ns{constructor(t){this.manager=t!==void 0?t:L1,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,r){i.load(t,s,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ns.DEFAULT_MATERIAL_NAME="__DEFAULT";const zi={};class P1 extends Error{constructor(t,e){super(t),this.response=e}}class ar extends Ns{constructor(t){super(t)}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Is.get(t);if(r!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(zi[t]!==void 0){zi[t].push({onLoad:e,onProgress:i,onError:s});return}zi[t]=[],zi[t].push({onLoad:e,onProgress:i,onError:s});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=zi[t],u=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let m=0;const g=new ReadableStream({start(A){C();function C(){u.read().then(({done:E,value:_})=>{if(E)A.close();else{m+=_.byteLength;const T=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:f});for(let M=0,S=h.length;M<S;M++){const R=h[M];R.onProgress&&R.onProgress(T)}A.enqueue(_),C()}},E=>{A.error(E)})}}});return new Response(g)}else throw new P1(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{Is.add(t,c);const h=zi[t];delete zi[t];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onLoad&&f.onLoad(c)}}).catch(c=>{const h=zi[t];if(h===void 0)throw this.manager.itemError(t),c;delete zi[t];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onError&&f.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class F1 extends Ns{constructor(t){super(t)}load(t,e,i,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Is.get(t);if(o!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const a=Ra("img");function l(){h(),Is.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(u){h(),s&&s(u),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class U1 extends Ns{constructor(t){super(t)}load(t,e,i,s){const r=new Fe,o=new F1(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){r.image=a,r.needsUpdate=!0,e!==void 0&&e(r)},i,s),r}}class uh extends Me{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new tt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}const gu=new wt,$g=new L,tm=new L;class gA{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new kt(512,512),this.map=null,this.mapPass=null,this.matrix=new wt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oh,this._frameExtents=new kt(1,1),this._viewportCount=1,this._viewports=[new oe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;$g.setFromMatrixPosition(t.matrixWorld),e.position.copy($g),tm.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(tm),e.updateMatrixWorld(),gu.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gu),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(gu)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class N1 extends gA{constructor(){super(new Xe(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=co*2*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(i!==e.fov||s!==e.aspect||r!==e.far)&&(e.fov=i,e.aspect=s,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class O1 extends uh{constructor(t,e,i=0,s=Math.PI/3,r=0,o=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Me.DEFAULT_UP),this.updateMatrix(),this.target=new Me,this.distance=i,this.angle=s,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new N1}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const em=new wt,Po=new L,mu=new L;class G1 extends gA{constructor(){super(new Xe(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new kt(4,2),this._viewportCount=6,this._viewports=[new oe(2,1,1,1),new oe(0,1,1,1),new oe(3,1,1,1),new oe(1,1,1,1),new oe(3,0,1,1),new oe(1,0,1,1)],this._cubeDirections=[new L(1,0,0),new L(-1,0,0),new L(0,0,1),new L(0,0,-1),new L(0,1,0),new L(0,-1,0)],this._cubeUps=[new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,1,0),new L(0,0,1),new L(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,s=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Po.setFromMatrixPosition(t.matrixWorld),i.position.copy(Po),mu.copy(i.position),mu.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(mu),i.updateMatrixWorld(),s.makeTranslation(-Po.x,-Po.y,-Po.z),em.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(em)}}class Q1 extends uh{constructor(t,e,i=0,s=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new G1}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class H1 extends gA{constructor(){super(new ah(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class ty extends uh{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Me.DEFAULT_UP),this.updateMatrix(),this.target=new Me,this.shadow=new H1}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class k1 extends uh{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class da{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let i=0,s=t.length;i<s;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class V1 extends Ns{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Is.get(t);if(o!==void 0){if(r.manager.itemStart(t),o.then){o.then(c=>{e&&e(c),r.manager.itemEnd(t)}).catch(c=>{s&&s(c)});return}return setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(t,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(c){return Is.add(t,c),e&&e(c),r.manager.itemEnd(t),c}).catch(function(c){s&&s(c),Is.remove(t),r.manager.itemError(t),r.manager.itemEnd(t)});Is.add(t,l),r.manager.itemStart(t)}}const nm=new wt,im=new wt,qs=new wt;class z1{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Xe,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Xe,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,qs.copy(t.projectionMatrix);const s=e.eyeSep/2,r=s*e.near/e.focus,o=e.near*Math.tan(or*e.fov*.5)/e.zoom;let a,l;im.elements[12]=-s,nm.elements[12]=s,a=-o*e.aspect+r,l=o*e.aspect+r,qs.elements[0]=2*e.near/(l-a),qs.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(qs),a=-o*e.aspect-r,l=o*e.aspect-r,qs.elements[0]=2*e.near/(l-a),qs.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(qs)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(im),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(nm)}}class W1{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=sm(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=sm();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function sm(){return performance.now()}const mA="\\[\\]\\.:\\/",J1=new RegExp("["+mA+"]","g"),_A="[^"+mA+"]",q1="[^"+mA.replace("\\.","")+"]",j1=/((?:WC+[\/:])*)/.source.replace("WC",_A),X1=/(WCOD+)?/.source.replace("WCOD",q1),K1=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_A),Y1=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_A),Z1=new RegExp("^"+j1+X1+K1+Y1+"$"),$1=["material","materials","bones","map"];class tR{constructor(t,e,i){const s=i||pe.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,s)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,r=i.length;s!==r;++s)i[s].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}class pe{constructor(t,e,i){this.path=e,this.parsedPath=i||pe.parseTrackName(e),this.node=pe.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new pe.Composite(t,e,i):new pe(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(J1,"")}static parseTrackName(t){const e=Z1.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const r=i.nodeName.substring(s+1);$1.indexOf(r)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=r)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){const i=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===e||a.uuid===e)return a;const l=i(a.children);if(l)return l}return null},s=i(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)t[e++]=i[s]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let s=0,r=i.length;s!==r;++s)i[s]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,s=e.propertyName;let r=e.propertyIndex;if(t||(t=pe.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let h=0;h<t.length;h++)if(t[h].name===c){c=h;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const o=t[s];if(o===void 0){const c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+s+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(s==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[r]!==void 0&&(r=t.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}pe.Composite=tR;pe.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};pe.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};pe.prototype.GetterByBindingType=[pe.prototype._getValue_direct,pe.prototype._getValue_array,pe.prototype._getValue_arrayElement,pe.prototype._getValue_toArray];pe.prototype.SetterByBindingTypeAndVersioning=[[pe.prototype._setValue_direct,pe.prototype._setValue_direct_setNeedsUpdate,pe.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[pe.prototype._setValue_array,pe.prototype._setValue_array_setNeedsUpdate,pe.prototype._setValue_array_setMatrixWorldNeedsUpdate],[pe.prototype._setValue_arrayElement,pe.prototype._setValue_arrayElement_setNeedsUpdate,pe.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[pe.prototype._setValue_fromArray,pe.prototype._setValue_fromArray_setNeedsUpdate,pe.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class rm{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Je(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const om=new L,Fl=new L;class ey{constructor(t=new L,e=new L){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){om.subVectors(t,this.start),Fl.subVectors(this.end,this.start);const i=Fl.dot(Fl);let r=Fl.dot(om)/i;return e&&(r=Je(r,0,1)),r}closestPointToPoint(t,e,i){const s=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const am=new L;let Ul,_u;class eR extends Me{constructor(t=new L(0,0,1),e=new L(0,0,0),i=1,s=16776960,r=i*.2,o=r*.2){super(),this.type="ArrowHelper",Ul===void 0&&(Ul=new en,Ul.setAttribute("position",new Ne([0,0,0,0,1,0],3)),_u=new AA(0,.5,1,5,1),_u.translate(0,-.5,0)),this.position.copy(e),this.line=new ch(Ul,new Wa({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ye(_u,new Gn({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,o)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{am.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(am,e)}}setLength(t,e=t*.2,i=e*.2){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class nR extends fA{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new en;s.setAttribute("position",new Ne(e,3)),s.setAttribute("color",new Ne(i,3));const r=new Wa({vertexColors:!0,toneMapped:!1});super(s,r),this.type="AxesHelper"}setColors(t,e,i){const s=new tt,r=this.geometry.attributes.color.array;return s.set(t),s.toArray(r,0),s.toArray(r,3),s.set(e),s.toArray(r,6),s.toArray(r,9),s.set(i),s.toArray(r,12),s.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}let ny=class extends Us{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:tA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=tA);class iR{static createPerspectiveCamera(t,e){var i=new Xe(45,window.width/window.height,.1,1e3);return i.position.copy(t),i.lookAt(e),i}static createOrthographicCamera(t){var e=new ah(width/-2,width/2,height/2,height/-2,1,1e3);return e.position.copy(t),e}static createCubeCamera(t){var e=new OE(1,1e5,cubeRenderTarget);return e.position.copy(t),e}static createArrayCamera(t=[]){return new JE(t)}static createStereoCamera(t=[]){return new z1}dispose(){}}var fa=function(){var n=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(h){h.preventDefault(),i(++n%t.children.length)},!1);function e(h){return t.appendChild(h.dom),h}function i(h){for(var u=0;u<t.children.length;u++)t.children[u].style.display=u===h?"block":"none";n=h}var s=(performance||Date).now(),r=s,o=0,a=e(new fa.Panel("FPS","#0ff","#002")),l=e(new fa.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new fa.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:t,addPanel:e,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(l.update(h-s,200),h>=r+1e3&&(a.update(o*1e3/(h-r),100),r=h,o=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){s=this.end()},domElement:t,setMode:i}};fa.Panel=function(n,t,e){var i=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,h=2*o,u=3*o,d=15*o,f=74*o,p=30*o,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var g=m.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=e,g.fillRect(0,0,a,l),g.fillStyle=t,g.fillText(n,c,h),g.fillRect(u,d,f,p),g.fillStyle=e,g.globalAlpha=.9,g.fillRect(u,d,f,p),{dom:m,update:function(A,C){i=Math.min(i,A),s=Math.max(s,A),g.fillStyle=e,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=t,g.fillText(r(A)+" "+n+" ("+r(i)+"-"+r(s)+")",c,h),g.drawImage(m,u+o,d,f-o,p,u,d,f-o,p),g.fillRect(u+f-o,d,o,p),g.fillStyle=e,g.globalAlpha=.9,g.fillRect(u+f-o,d,o,r((1-A/C)*p))}}};class iy{constructor(t,e,i){this.id=0,this.name=t,this.fg=e,this.bg=i,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px;background-color: transparent !important;",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){if(!this.context)throw new Error("No context");const t=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT);let e;const i=this.fg;switch(this.fg.toLowerCase()){case"#0ff":e="#006666";break;case"#0f0":e="#006600";break;case"#ff0":e="#666600";break;case"#e1e1e1":e="#666666";break;default:e=this.bg;break}return t.addColorStop(0,e),t.addColorStop(1,i),t}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(t,e,i=0){if(!this.context||!this.gradient)return;const s=Math.min(1/0,t),r=Math.max(e,t);this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${t.toFixed(i)} ${this.name} (${s.toFixed(i)}-${parseFloat(r.toFixed(i))})`,this.TEXT_X,this.TEXT_Y)}updateGraph(t,e){if(!this.context||!this.gradient)return;t===0&&e===0&&(e=1),e=Math.max(e,t,.1),t=Math.max(t,0);const i=Math.round(this.GRAPH_X),s=Math.round(this.GRAPH_Y),r=Math.round(this.GRAPH_WIDTH),o=Math.round(this.GRAPH_HEIGHT),a=Math.round(this.PR);this.context.drawImage(this.canvas,i+a,s,r-a,o,i,s,r-a,o),this.context.fillStyle=this.bg,this.context.fillRect(i+r-a,s,a,o);const l=Math.min(o,Math.round(t/e*o));l>0&&(this.context.globalAlpha=.9,this.context.fillStyle=this.gradient,this.context.fillRect(i+r-a,s+(o-l),a,l)),this.context.globalAlpha=1}}class sR extends iy{constructor(t,e,i){super(t,e,i),this.vsyncValue=0,this.SMALL_HEIGHT=9*this.PR,this.HEIGHT=this.SMALL_HEIGHT,this.WIDTH=35*this.PR,this.TEXT_Y=0*this.PR,this.canvas.height=this.HEIGHT,this.canvas.width=this.WIDTH,this.canvas.style.height="9px",this.canvas.style.width="35px",this.canvas.style.cssText=`
            width: 35px;
            height: 9px;
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent !important;
            pointer-events: none;
        `,this.initializeCanvas()}initializeCanvas(){this.context&&(this.context.imageSmoothingEnabled=!1,this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.globalAlpha=1)}update(t,e,i=0){this.context&&(this.vsyncValue=t,this.context.clearRect(0,0,this.WIDTH,this.HEIGHT),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillText(`${t.toFixed(0)}Hz`,this.TEXT_X,this.TEXT_Y))}updateGraph(t,e){}setOffset(t,e){this.canvas.style.transform=`translate(${t}px, ${e}px)`}}const sy=class Vr{constructor({trackGPU:t=!1,trackCPT:e=!1,trackHz:i=!1,logsPerSecond:s=4,graphsPerSecond:r=30,samplesLog:o=40,samplesGraph:a=10,precision:l=2,minimal:c=!1,horizontal:h=!0,mode:u=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frameTimes=[],this.renderCount=0,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.vsyncPanel=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.updateCounter=0,this.lastMin={},this.lastMax={},this.lastValue={},this.VSYNC_RATES=[{refreshRate:60,frameTime:16.67},{refreshRate:75,frameTime:13.33},{refreshRate:90,frameTime:11.11},{refreshRate:120,frameTime:8.33},{refreshRate:144,frameTime:6.94},{refreshRate:165,frameTime:6.06},{refreshRate:240,frameTime:4.17}],this.detectedVSync=null,this.frameTimeHistory=[],this.HISTORY_SIZE=120,this.VSYNC_THRESHOLD=.05,this.lastFrameTime=0,this.handleClick=f=>{f.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel),this.resizePanel(this.msPanel),this.gpuPanel&&this.resizePanel(this.gpuPanel),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute)},this.mode=u,this.horizontal=h,this.minimal=c,this.trackGPU=t,this.trackCPT=e,this.trackHz=i,this.samplesLog=o,this.samplesGraph=a,this.precision=l,this.logsPerSecond=s,this.graphsPerSecond=r;const d=performance.now();this.prevGraphTime=d,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTextTime=this.beginTime,this.prevCpuTime=this.beginTime,this._panelId=0,this.fpsPanel=this.addPanel(new Vr.Panel("FPS","#0ff","#002")),this.msPanel=this.addPanel(new Vr.Panel("CPU","#0f0","#020")),this.trackHz===!0&&(this.vsyncPanel=new sR("","#f0f","#202"),this.dom.appendChild(this.vsyncPanel.canvas),this.vsyncPanel.setOffset(56,35)),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(t){if(!t){console.error('Stats: The "canvas" parameter is undefined.');return}if(!this.handleThreeRenderer(t)&&!await this.handleWebGPURenderer(t))if(this.initializeWebGL(t)){this.trackGPU&&this.initializeGPUTracking();return}else console.error("Stats-gl: Failed to initialize WebGL context")}handleThreeRenderer(t){return t.isWebGLRenderer&&!this.threeRendererPatched?(this.patchThreeRenderer(t),this.gl=t.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0):!1}async handleWebGPURenderer(t){return t.isWebGPURenderer?((this.trackGPU||this.trackCPT)&&(t.backend.trackTimestamp=!0,await t.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=t.info,this.patchThreeWebGPU(t),!0):!1}initializeWebGPUPanels(){this.trackGPU&&(this.gpuPanel=this.addPanel(new Vr.Panel("GPU","#ff0","#220"))),this.trackCPT&&(this.gpuPanelCompute=this.addPanel(new Vr.Panel("CPT","#e1e1e1","#212121")))}initializeWebGL(t){if(t instanceof WebGL2RenderingContext)this.gl=t;else if(t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas){if(this.gl=t.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1}else return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new Vr.Panel("GPU","#ff0","#220"))))}begin(){this.beginProfiling("cpu-started"),!(!this.gl||!this.ext)&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null),this.endProfiling("cpu-started","cpu-finished","cpu-duration")}update(){this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp}resetCounters(){this.renderCount=0,this.totalCpuDuration=0,this.beginTime=this.endInternal()}resizePanel(t){t.canvas.style.position="absolute",this.minimal?t.canvas.style.display="none":(t.canvas.style.display="block",this.horizontal?(t.canvas.style.top="0px",t.canvas.style.left=t.id*t.WIDTH/t.PR+"px"):(t.canvas.style.left="0px",t.canvas.style.top=t.id*t.HEIGHT/t.PR+"px"))}addPanel(t){return t.canvas&&(this.dom.appendChild(t.canvas),t.id=this._panelId,this.resizePanel(t),this._panelId++),t}showPanel(t){for(let e=0;e<this.dom.children.length;e++){const i=this.dom.children[e];i.style.display=e===t?"block":"none"}this.mode=t}processGpuQueries(){!this.gl||!this.ext||(this.totalGpuDuration=0,this.gpuQueries.forEach((t,e)=>{if(this.gl){const i=this.gl.getQueryParameter(t.query,this.gl.QUERY_RESULT_AVAILABLE),s=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(i&&!s){const o=this.gl.getQueryParameter(t.query,this.gl.QUERY_RESULT)*1e-6;this.totalGpuDuration+=o,this.gl.deleteQuery(t.query),this.gpuQueries.splice(e,1)}}}))}detectVSync(t){if(this.lastFrameTime===0){this.lastFrameTime=t;return}const e=t-this.lastFrameTime;if(this.lastFrameTime=t,this.frameTimeHistory.push(e),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameTimeHistory.length<60)return;const i=this.frameTimeHistory.reduce((l,c)=>l+c)/this.frameTimeHistory.length,s=this.frameTimeHistory.reduce((l,c)=>l+Math.pow(c-i,2),0)/this.frameTimeHistory.length;if(Math.sqrt(s)>2){this.detectedVSync=null;return}let o=null,a=1/0;for(const l of this.VSYNC_RATES){const c=Math.abs(i-l.frameTime);c<a&&(a=c,o=l)}o&&a/o.frameTime<=this.VSYNC_THRESHOLD?this.detectedVSync=o:this.detectedVSync=null}endInternal(){var t;const e=performance.now();for(this.frameTimes.push(e);this.frameTimes.length>0&&this.frameTimes[0]<=e-1e3;)this.frameTimes.shift();const i=Math.round(this.frameTimes.length);this.addToAverage(i,this.averageFps);const s=e>=this.prevTextTime+1e3/this.logsPerSecond,r=e>=this.prevGraphTime+1e3/this.graphsPerSecond;if(this.updatePanelComponents(this.fpsPanel,this.averageFps,0,s,r),this.updatePanelComponents(this.msPanel,this.averageCpu,this.precision,s,r),this.gpuPanel&&this.updatePanelComponents(this.gpuPanel,this.averageGpu,this.precision,s,r),this.trackCPT&&this.gpuPanelCompute&&this.updatePanelComponents(this.gpuPanelCompute,this.averageGpuCompute,this.precision,s,r),s&&(this.prevTextTime=e),r&&(this.prevGraphTime=e),this.vsyncPanel!==null){this.detectVSync(e);const o=((t=this.detectedVSync)==null?void 0:t.refreshRate)||0;s&&o>0&&this.vsyncPanel.update(o,o)}return e}updatePanelComponents(t,e,i,s,r){if(!t||e.logs.length===0)return;t.name in this.lastMin||(this.lastMin[t.name]=1/0,this.lastMax[t.name]=0,this.lastValue[t.name]=0);const o=e.logs[e.logs.length-1];this.lastMax[t.name]=Math.max(...e.logs),this.lastMin[t.name]=Math.min(this.lastMin[t.name],o),this.lastValue[t.name]=this.lastValue[t.name]*.7+o*.3;const a=Math.max(Math.max(...e.logs),...e.graph.slice(-this.samplesGraph));this.updateCounter++,s&&t.update(this.lastValue[t.name],this.lastMax[t.name],i),r&&t.updateGraph(o,a)}beginProfiling(t){if(window.performance)try{window.performance.clearMarks(t),window.performance.mark(t)}catch(e){console.debug("Stats: Performance marking failed:",e)}}endProfiling(t,e,i){if(!(!window.performance||!e||!t))try{window.performance.getEntriesByName(t,"mark").length===0&&this.beginProfiling(t),window.performance.clearMarks(e),window.performance.mark(e),window.performance.clearMeasures(i);const r=performance.measure(i,t,e);this.totalCpuDuration+=r.duration,window.performance.clearMarks(t),window.performance.clearMarks(e),window.performance.clearMeasures(i)}catch(s){console.debug("Stats: Performance measurement failed:",s)}}updatePanel(t,e,i=2){if(!t||e.logs.length===0)return;const s=performance.now();t.name in this.lastMin||(this.lastMin[t.name]=1/0,this.lastMax[t.name]=0,this.lastValue[t.name]=0);const r=e.logs[e.logs.length-1],o=Math.max(...e.logs.slice(-30));this.lastMin[t.name]=Math.min(this.lastMin[t.name],r),this.lastMax[t.name]=Math.max(this.lastMax[t.name],r),this.lastValue[t.name]=this.lastValue[t.name]*.7+r*.3;const a=Math.max(o,...e.graph.slice(-this.samplesGraph));this.updateCounter++,this.updateCounter%(this.logsPerSecond*2)===0&&(this.lastMax[t.name]=o,this.lastMin[t.name]=r),t.update&&(s>=this.prevCpuTime+1e3/this.logsPerSecond&&t.update(this.lastValue[t.name],r,this.lastMax[t.name],a,i),s>=this.prevGraphTime+1e3/this.graphsPerSecond&&(t.updateGraph(r,a),this.prevGraphTime=s))}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu),this.info&&this.totalGpuDurationCompute!==void 0&&this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}addToAverage(t,e){e.logs.push(t),e.logs.length>this.samplesLog&&(e.logs=e.logs.slice(-this.samplesLog)),e.graph.push(t),e.graph.length>this.samplesGraph&&(e.graph=e.graph.slice(-this.samplesGraph))}get domElement(){return this.dom}patchThreeWebGPU(t){const e=t.info.reset,i=this;t.info.reset=function(){i.beginProfiling("cpu-started"),e.call(this)}}patchThreeRenderer(t){const e=t.render,i=this;t.render=function(s,r){i.begin(),e.call(this,s,r),i.end()},this.threeRendererPatched=!0}};sy.Panel=iy;let rR=sy;/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.20.0
 * @author George Michael Brower
 * @license MIT
 */class Ri{constructor(t,e,i,s,r="div"){this.parent=t,this.object=e,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(r),this.domElement.classList.add("controller"),this.domElement.classList.add(s),this.$name=document.createElement("div"),this.$name.classList.add("name"),Ri.nextNameID=Ri.nextNameID||0,this.$name.id=`lil-gui-name-${++Ri.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",o=>o.stopPropagation()),this.domElement.addEventListener("keyup",o=>o.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(t){return this._name=t,this.$name.textContent=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled?this:(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t),this)}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.getValue()!==t&&(this.object[this.property]=t,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class oR extends Ri{constructor(t,e,i){super(t,e,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function af(n){let t,e;return(t=n.match(/(#|0x)?([a-f0-9]{6})/i))?e=t[2]:(t=n.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?e=parseInt(t[1]).toString(16).padStart(2,0)+parseInt(t[2]).toString(16).padStart(2,0)+parseInt(t[3]).toString(16).padStart(2,0):(t=n.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(e=t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),e?"#"+e:!1}const aR={isPrimitive:!0,match:n=>typeof n=="string",fromHexString:af,toHexString:af},Da={isPrimitive:!0,match:n=>typeof n=="number",fromHexString:n=>parseInt(n.substring(1),16),toHexString:n=>"#"+n.toString(16).padStart(6,0)},lR={isPrimitive:!1,match:n=>Array.isArray(n),fromHexString(n,t,e=1){const i=Da.fromHexString(n);t[0]=(i>>16&255)/255*e,t[1]=(i>>8&255)/255*e,t[2]=(i&255)/255*e},toHexString([n,t,e],i=1){i=255/i;const s=n*i<<16^t*i<<8^e*i<<0;return Da.toHexString(s)}},cR={isPrimitive:!1,match:n=>Object(n)===n,fromHexString(n,t,e=1){const i=Da.fromHexString(n);t.r=(i>>16&255)/255*e,t.g=(i>>8&255)/255*e,t.b=(i&255)/255*e},toHexString({r:n,g:t,b:e},i=1){i=255/i;const s=n*i<<16^t*i<<8^e*i<<0;return Da.toHexString(s)}},hR=[aR,Da,lR,cR];function uR(n){return hR.find(t=>t.match(n))}class dR extends Ri{constructor(t,e,i,s){super(t,e,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=uR(this.initialValue),this._rgbScale=s,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const r=af(this.$text.value);r&&this._setValueFromHexString(r)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class Eu extends Ri{constructor(t,e,i){super(t,e,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",s=>{s.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class fR extends Ri{constructor(t,e,i,s,r,o){super(t,e,i,"number"),this._initInput(),this.min(s),this.max(r);const a=o!==void 0;this.step(a?o:this._getImplicitStep(),a),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=e*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const e=()=>{let C=parseFloat(this.$input.value);isNaN(C)||(this._stepExplicit&&(C=this._snap(C)),this.setValue(this._clamp(C)))},i=C=>{const E=parseFloat(this.$input.value);isNaN(E)||(this._snapClampSetValue(E+C),this.$input.value=this.getValue())},s=C=>{C.key==="Enter"&&this.$input.blur(),C.code==="ArrowUp"&&(C.preventDefault(),i(this._step*this._arrowKeyMultiplier(C))),C.code==="ArrowDown"&&(C.preventDefault(),i(this._step*this._arrowKeyMultiplier(C)*-1))},r=C=>{this._inputFocused&&(C.preventDefault(),i(this._step*this._normalizeMouseWheel(C)))};let o=!1,a,l,c,h,u;const d=5,f=C=>{a=C.clientX,l=c=C.clientY,o=!0,h=this.getValue(),u=0,window.addEventListener("mousemove",p),window.addEventListener("mouseup",m)},p=C=>{if(o){const E=C.clientX-a,_=C.clientY-l;Math.abs(_)>d?(C.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(E)>d&&m()}if(!o){const E=C.clientY-c;u-=E*this._step*this._arrowKeyMultiplier(C),h+u>this._max?u=this._max-h:h+u<this._min&&(u=this._min-h),this._snapClampSetValue(h+u)}c=C.clientY},m=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",m)},g=()=>{this._inputFocused=!0},A=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",e),this.$input.addEventListener("keydown",s),this.$input.addEventListener("wheel",r,{passive:!1}),this.$input.addEventListener("mousedown",f),this.$input.addEventListener("focus",g),this.$input.addEventListener("blur",A)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=(A,C,E,_,T)=>(A-C)/(E-C)*(T-_)+_,e=A=>{const C=this.$slider.getBoundingClientRect();let E=t(A,C.left,C.right,this._min,this._max);this._snapClampSetValue(E)},i=A=>{this._setDraggingStyle(!0),e(A.clientX),window.addEventListener("mousemove",s),window.addEventListener("mouseup",r)},s=A=>{e(A.clientX)},r=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r)};let o=!1,a,l;const c=A=>{A.preventDefault(),this._setDraggingStyle(!0),e(A.touches[0].clientX),o=!1},h=A=>{A.touches.length>1||(this._hasScrollBar?(a=A.touches[0].clientX,l=A.touches[0].clientY,o=!0):c(A),window.addEventListener("touchmove",u,{passive:!1}),window.addEventListener("touchend",d))},u=A=>{if(o){const C=A.touches[0].clientX-a,E=A.touches[0].clientY-l;Math.abs(C)>Math.abs(E)?c(A):(window.removeEventListener("touchmove",u),window.removeEventListener("touchend",d))}else A.preventDefault(),e(A.touches[0].clientX)},d=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",d)},f=this._callOnFinishChange.bind(this),p=400;let m;const g=A=>{if(Math.abs(A.deltaX)<Math.abs(A.deltaY)&&this._hasScrollBar)return;A.preventDefault();const E=this._normalizeMouseWheel(A)*this._step;this._snapClampSetValue(this.getValue()+E),this.$input.value=this.getValue(),clearTimeout(m),m=setTimeout(f,p)};this.$slider.addEventListener("mousedown",i),this.$slider.addEventListener("touchstart",h,{passive:!1}),this.$slider.addEventListener("wheel",g,{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:i}=t;return Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,i=-t.wheelDelta/120,i*=this._stepExplicit?1:10),e+-i}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){let e=0;return this._hasMin?e=this._min:this._hasMax&&(e=this._max),t-=e,t=Math.round(t/this._step)*this._step,t+=e,t=parseFloat(t.toPrecision(15)),t}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class AR extends Ri{constructor(t,e,i,s){super(t,e,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(s)}options(t){return this._values=Array.isArray(t)?t:Object.values(t),this._names=Array.isArray(t)?t:Object.keys(t),this.$select.replaceChildren(),this._names.forEach(e=>{const i=document.createElement("option");i.textContent=e,this.$select.appendChild(i)}),this.updateDisplay(),this}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.textContent=e===-1?t:this._names[e],this}}class pR extends Ri{constructor(t,e,i){super(t,e,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",s=>{s.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var gR=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "↕";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  font-weight: 600;
  padding: 0 var(--padding);
  width: 100%;
  text-align: left;
  background: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "▾";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "▸";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "✓";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  border: none;
}
.lil-gui .controller button {
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
}
@media (hover: hover) {
  .lil-gui .controller button:hover {
    background: var(--hover-color);
  }
  .lil-gui .controller button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui .controller button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function mR(n){const t=document.createElement("style");t.innerHTML=n;const e=document.querySelector("head link[rel=stylesheet], head style");e?document.head.insertBefore(t,e):document.head.appendChild(t)}let lm=!1;class EA{constructor({parent:t,autoPlace:e=t===void 0,container:i,width:s,title:r="Controls",closeFolders:o=!1,injectStyles:a=!0,touchStyles:l=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("button"),this.$title.classList.add("title"),this.$title.setAttribute("aria-expanded",!0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(r),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),l&&this.domElement.classList.add("allow-touch-styles"),!lm&&a&&(mR(gR),lm=!0),i?i.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),s&&this.domElement.style.setProperty("--width",s+"px"),this._closeFolders=o}add(t,e,i,s,r){if(Object(i)===i)return new AR(this,t,e,i);const o=t[e];switch(typeof o){case"number":return new fR(this,t,e,i,s,r);case"boolean":return new oR(this,t,e);case"string":return new pR(this,t,e);case"function":return new Eu(this,t,e)}console.error(`gui.add failed
	property:`,e,`
	object:`,t,`
	value:`,o)}addColor(t,e,i=1){return new dR(this,t,e,i)}addFolder(t){const e=new EA({parent:this,title:t});return this.root._closeFolders&&e.close(),e}load(t,e=!0){return t.controllers&&this.controllers.forEach(i=>{i instanceof Eu||i._name in t.controllers&&i.load(t.controllers[i._name])}),e&&t.folders&&this.folders.forEach(i=>{i._title in t.folders&&i.load(t.folders[i._title])}),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach(i=>{if(!(i instanceof Eu)){if(i._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${i._name}"`);e.controllers[i._name]=i.save()}}),t&&this.folders.forEach(i=>{if(i._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${i._title}"`);e.folders[i._title]=i.save()}),e}open(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(t){this._closed!==t&&(this._closed=t,this._callOnOpenClose(this))}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const i=r=>{r.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const s=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame(()=>{this.$children.style.height=s+"px"})}),this}title(t){return this._title=t,this.$title.textContent=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach(i=>i.reset()),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),this._onChange!==void 0&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onOpenClose(t){return this._onOpenClose=t,this}_callOnOpenClose(t){this.parent&&this.parent._callOnOpenClose(t),this._onOpenClose!==void 0&&this._onOpenClose.call(this,t)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(t=>t.destroy())}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach(e=>{t=t.concat(e.controllersRecursive())}),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach(e=>{t=t.concat(e.foldersRecursive())}),t}}class _R{constructor(t=!1,e=!0){this.showDebug=t,this.showAxes=e,this.gui=new EA,this.gui.domElement.style.right="0px"}createStats(t=document.body,e,i){if(this.showDebug){var s=new fa,r=s.dom;return r.style.display="flex",r.style.position="",r.querySelectorAll("canvas").forEach(o=>o.style.display="block"),this.addGui("stats",r),i.push(()=>{s.update()}),s}}removeStats(t,e){t.domElement.parentElement.removeChild(t.domElement)}createStatsGl(t=document.body,e,i){if(this.showDebug){var s=new rR,r=s.dom;return r.style.display="flex",r.style.position="relative",r.querySelectorAll("canvas").forEach(o=>o.style.position=""),s.init(e),this.addGui("stats-gl",r),i.push(()=>{s.update()}),s}}createAxes(t){if(this.showAxes){var e=new nR(2e3);t.scene.add(e)}}addGui(t,e,i=!0){const s=this.gui.addFolder(t);return e&&s.$children.appendChild(e),i&&s.open(),s}}class dh{constructor(t=new L(0,0,0),e=new L(0,1,0),i=1){this.start=t,this.end=e,this.radius=i}clone(){return new dh(this.start.clone(),this.end.clone(),this.radius)}set(t,e,i){this.start.copy(t),this.end.copy(e),this.radius=i}copy(t){this.start.copy(t.start),this.end.copy(t.end),this.radius=t.radius}getCenter(t){return t.copy(this.end).add(this.start).multiplyScalar(.5)}translate(t){this.start.add(t),this.end.add(t)}checkAABBAxis(t,e,i,s,r,o,a,l,c){return(r-t<c||r-i<c)&&(t-o<c||i-o<c)&&(a-e<c||a-s<c)&&(e-l<c||s-l<c)}intersectsBox(t){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,t.min.x,t.max.x,t.min.y,t.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,t.min.x,t.max.x,t.min.z,t.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,t.min.y,t.max.y,t.min.z,t.max.z,this.radius)}}const Fo=new L,Uo=new L,Nl=new L,No=new L,_i=new Yi,yu=new ey,ER=new ey,Ol=new Ai,Oo=new dh,yR=new L,CR=new L,xR=new L,vR=1e-10;function BR(n,t,e=null,i=null){const s=yR.copy(n.end).sub(n.start),r=CR.copy(t.end).sub(t.start),o=xR.copy(t.start).sub(n.start),a=s.dot(r),l=s.dot(s),c=r.dot(r),h=r.dot(o),u=s.dot(o);let d,f;const p=l*c-a*a;if(Math.abs(p)<vR){const m=-h/c,g=(a-h)/c;Math.abs(m-.5)<Math.abs(g-.5)?(d=0,f=m):(d=1,f=g)}else d=(h*a+u*c)/p,f=(d*a-h)/c;f=Math.max(0,Math.min(1,f)),d=Math.max(0,Math.min(1,d)),e&&e.copy(s).multiplyScalar(d).add(n.start),i&&i.copy(r).multiplyScalar(f).add(t.start)}class fh{constructor(t){this.box=t,this.bounds=new ui,this.subTrees=[],this.triangles=[],this.layers=new lA}addTriangle(t){return this.bounds.min.x=Math.min(this.bounds.min.x,t.a.x,t.b.x,t.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,t.a.y,t.b.y,t.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,t.a.z,t.b.z,t.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,t.a.x,t.b.x,t.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,t.a.y,t.b.y,t.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,t.a.z,t.b.z,t.c.z),this.triangles.push(t),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(t){if(!this.box)return;const e=[],i=Uo.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let r=0;r<2;r++)for(let o=0;o<2;o++)for(let a=0;a<2;a++){const l=new ui,c=Fo.set(r,o,a);l.min.copy(this.box.min).add(c.multiply(i)),l.max.copy(l.min).add(i),e.push(new fh(l))}let s;for(;s=this.triangles.pop();)for(let r=0;r<e.length;r++)e[r].box.intersectsTriangle(s)&&e[r].triangles.push(s);for(let r=0;r<e.length;r++){const o=e[r].triangles.length;o>8&&t<16&&e[r].split(t+1),o!==0&&this.subTrees.push(e[r])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(t,e){for(let i=0;i<this.subTrees.length;i++){const s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(let r=0;r<s.triangles.length;r++)e.indexOf(s.triangles[r])===-1&&e.push(s.triangles[r]);else s.getRayTriangles(t,e)}return e}triangleCapsuleIntersect(t,e){e.getPlane(_i);const i=_i.distanceToPoint(t.start)-t.radius,s=_i.distanceToPoint(t.end)-t.radius;if(i>0&&s>0||i<-t.radius&&s<-t.radius)return!1;const r=Math.abs(i/(Math.abs(i)+Math.abs(s))),o=Fo.copy(t.start).lerp(t.end,r);if(e.containsPoint(o))return{normal:_i.normal.clone(),point:o.clone(),depth:Math.abs(Math.min(i,s))};const a=t.radius*t.radius,l=yu.set(t.start,t.end),c=[[e.a,e.b],[e.b,e.c],[e.c,e.a]];for(let h=0;h<c.length;h++){const u=ER.set(c[h][0],c[h][1]);if(BR(l,u,Nl,No),Nl.distanceToSquared(No)<a)return{normal:Nl.clone().sub(No).normalize(),point:No.clone(),depth:t.radius-Nl.distanceTo(No)}}return!1}triangleSphereIntersect(t,e){if(e.getPlane(_i),!t.intersectsPlane(_i))return!1;const i=Math.abs(_i.distanceToSphere(t)),s=t.radius*t.radius-i*i,r=_i.projectPoint(t.center,Fo);if(e.containsPoint(t.center))return{normal:_i.normal.clone(),point:r.clone(),depth:Math.abs(_i.distanceToSphere(t))};const o=[[e.a,e.b],[e.b,e.c],[e.c,e.a]];for(let a=0;a<o.length;a++){yu.set(o[a][0],o[a][1]),yu.closestPointToPoint(r,!0,Uo);const l=Uo.distanceToSquared(t.center);if(l<s)return{normal:t.center.clone().sub(Uo).normalize(),point:Uo.clone(),depth:t.radius-Math.sqrt(l)}}return!1}getSphereTriangles(t,e){for(let i=0;i<this.subTrees.length;i++){const s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(let r=0;r<s.triangles.length;r++)e.indexOf(s.triangles[r])===-1&&e.push(s.triangles[r]);else s.getSphereTriangles(t,e)}}getCapsuleTriangles(t,e){for(let i=0;i<this.subTrees.length;i++){const s=this.subTrees[i];if(t.intersectsBox(s.box))if(s.triangles.length>0)for(let r=0;r<s.triangles.length;r++)e.indexOf(s.triangles[r])===-1&&e.push(s.triangles[r]);else s.getCapsuleTriangles(t,e)}}sphereIntersect(t){Ol.copy(t);const e=[];let i,s=!1;this.getSphereTriangles(t,e);for(let r=0;r<e.length;r++)(i=this.triangleSphereIntersect(Ol,e[r]))&&(s=!0,Ol.center.add(i.normal.multiplyScalar(i.depth)));if(s){const r=Ol.center.clone().sub(t.center),o=r.length();return{normal:r.normalize(),depth:o}}return!1}capsuleIntersect(t){Oo.copy(t);const e=[];let i,s=!1;this.getCapsuleTriangles(Oo,e);for(let r=0;r<e.length;r++)(i=this.triangleCapsuleIntersect(Oo,e[r]))&&(s=!0,Oo.translate(i.normal.multiplyScalar(i.depth)));if(s){const r=Oo.getCenter(new L).sub(t.getCenter(Fo)),o=r.length();return{normal:r.normalize(),depth:o}}return!1}rayIntersect(t){if(t.direction.length()===0)return;const e=[];let i,s,r=1e100;this.getRayTriangles(t,e);for(let o=0;o<e.length;o++){const a=t.intersectTriangle(e[o].a,e[o].b,e[o].c,!0,Fo);if(a){const l=a.sub(t.origin).length();r>l&&(s=a.clone().add(t.origin),r=l,i=e[o])}}return r<1e100?{distance:r,triangle:i,position:s}:!1}fromGraphNode(t){return t.updateWorldMatrix(!0,!0),t.traverse(e=>{if(e.isMesh===!0&&this.layers.test(e.layers)){let i,s=!1;e.geometry.index!==null?(s=!0,i=e.geometry.toNonIndexed()):i=e.geometry;const r=i.getAttribute("position");for(let o=0;o<r.count;o+=3){const a=new L().fromBufferAttribute(r,o),l=new L().fromBufferAttribute(r,o+1),c=new L().fromBufferAttribute(r,o+2);a.applyMatrix4(e.matrixWorld),l.applyMatrix4(e.matrixWorld),c.applyMatrix4(e.matrixWorld),this.addTriangle(new Nn(a,l,c))}s&&i.dispose()}}),this.build(),this}clear(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}const cm={type:"change"},yA={type:"start"},ry={type:"end"},Gl=new Va,hm=new Yi,IR=Math.cos(70*SE.DEG2RAD),Ge=new L,yn=2*Math.PI,_e={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Cu=1e-6;class bR extends ny{constructor(t,e=null){super(t,e),this.state=_e.NONE,this.enabled=!0,this.target=new L,this.cursor=new L,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:to.ROTATE,MIDDLE:to.DOLLY,RIGHT:to.PAN},this.touches={ONE:Jr.ROTATE,TWO:Jr.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new L,this._lastQuaternion=new hi,this._lastTargetPosition=new L,this._quat=new hi().setFromUnitVectors(t.up,new L(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new rm,this._sphericalDelta=new rm,this._scale=1,this._panOffset=new L,this._rotateStart=new kt,this._rotateEnd=new kt,this._rotateDelta=new kt,this._panStart=new kt,this._panEnd=new kt,this._panDelta=new kt,this._dollyStart=new kt,this._dollyEnd=new kt,this._dollyDelta=new kt,this._dollyDirection=new L,this._mouse=new kt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=SR.bind(this),this._onPointerDown=MR.bind(this),this._onPointerUp=TR.bind(this),this._onContextMenu=UR.bind(this),this._onMouseWheel=DR.bind(this),this._onKeyDown=LR.bind(this),this._onTouchStart=PR.bind(this),this._onTouchMove=FR.bind(this),this._onMouseDown=wR.bind(this),this._onMouseMove=RR.bind(this),this._interceptControlDown=NR.bind(this),this._interceptControlUp=OR.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(cm),this.update(),this.state=_e.NONE}update(t=null){const e=this.object.position;Ge.copy(e).sub(this.target),Ge.applyQuaternion(this._quat),this._spherical.setFromVector3(Ge),this.autoRotate&&this.state===_e.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let i=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(i)&&isFinite(s)&&(i<-Math.PI?i+=yn:i>Math.PI&&(i-=yn),s<-Math.PI?s+=yn:s>Math.PI&&(s-=yn),i<=s?this._spherical.theta=Math.max(i,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(i+s)/2?Math.max(i,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let r=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),r=o!=this._spherical.radius}if(Ge.setFromSpherical(this._spherical),Ge.applyQuaternion(this._quatInverse),e.copy(this.target).add(Ge),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=Ge.length();o=this._clampDistance(a*this._scale);const l=a-o;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),r=!!l}else if(this.object.isOrthographicCamera){const a=new L(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),r=l!==this.object.zoom;const c=new L(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),o=Ge.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(Gl.origin.copy(this.object.position),Gl.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(Gl.direction))<IR?this.object.lookAt(this.target):(hm.setFromNormalAndCoplanarPoint(this.object.up,this.target),Gl.intersectPlane(hm,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),r=!0)}return this._scale=1,this._performCursorZoom=!1,r||this._lastPosition.distanceToSquared(this.object.position)>Cu||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Cu||this._lastTargetPosition.distanceToSquared(this.target)>Cu?(this.dispatchEvent(cm),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?yn/60*this.autoRotateSpeed*t:yn/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){Ge.setFromMatrixColumn(e,0),Ge.multiplyScalar(-t),this._panOffset.add(Ge)}_panUp(t,e){this.screenSpacePanning===!0?Ge.setFromMatrixColumn(e,1):(Ge.setFromMatrixColumn(e,0),Ge.crossVectors(this.object.up,Ge)),Ge.multiplyScalar(t),this._panOffset.add(Ge)}_pan(t,e){const i=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;Ge.copy(s).sub(this.target);let r=Ge.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*r/i.clientHeight,this.object.matrix),this._panUp(2*e*r/i.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const i=this.domElement.getBoundingClientRect(),s=t-i.left,r=e-i.top,o=i.width,a=i.height;this._mouse.x=s/o*2-1,this._mouse.y=-(r/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(yn*this._rotateDelta.x/e.clientHeight),this._rotateUp(yn*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(-yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(-yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._rotateStart.set(i,s)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._panStart.set(i,s)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,s=t.pageY-e.y,r=Math.sqrt(i*i+s*s);this._dollyStart.set(0,r)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const i=this._getSecondPointerPosition(t),s=.5*(t.pageX+i.x),r=.5*(t.pageY+i.y);this._rotateEnd.set(s,r)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(yn*this._rotateDelta.x/e.clientHeight),this._rotateUp(yn*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),i=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._panEnd.set(i,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),i=t.pageX-e.x,s=t.pageY-e.y,r=Math.sqrt(i*i+s*s);this._dollyEnd.set(0,r),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(t.pageX+e.x)*.5,a=(t.pageY+e.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new kt,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,i={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:i.deltaY*=16;break;case 2:i.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(i.deltaY*=10),i}}function MR(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function SR(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function TR(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(ry),this.state=_e.NONE;break;case 1:const t=this._pointers[0],e=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:e.x,pageY:e.y});break}}function wR(n){let t;switch(n.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case to.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=_e.DOLLY;break;case to.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=_e.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=_e.ROTATE}break;case to.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=_e.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=_e.PAN}break;default:this.state=_e.NONE}this.state!==_e.NONE&&this.dispatchEvent(yA)}function RR(n){switch(this.state){case _e.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case _e.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case _e.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function DR(n){this.enabled===!1||this.enableZoom===!1||this.state!==_e.NONE||(n.preventDefault(),this.dispatchEvent(yA),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(ry))}function LR(n){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(n)}function PR(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case Jr.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=_e.TOUCH_ROTATE;break;case Jr.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=_e.TOUCH_PAN;break;default:this.state=_e.NONE}break;case 2:switch(this.touches.TWO){case Jr.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=_e.TOUCH_DOLLY_PAN;break;case Jr.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=_e.TOUCH_DOLLY_ROTATE;break;default:this.state=_e.NONE}break;default:this.state=_e.NONE}this.state!==_e.NONE&&this.dispatchEvent(yA)}function FR(n){switch(this._trackPointer(n),this.state){case _e.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case _e.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case _e.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case _e.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=_e.NONE}}function UR(n){this.enabled!==!1&&n.preventDefault()}function NR(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function OR(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class GR extends ny{constructor(e){super();el(this,"STEPS_PER_FRAME",5);this.glviewer=e,this.glviewer.camera.rotation.order="YXZ",this.worldOctree=new fh,this.playerCollider=new dh(new L(this.glviewer.cameraPosition.x,.75,this.glviewer.cameraPosition.z),new L(this.glviewer.cameraPosition.x,4,this.glviewer.cameraPosition.z),.35),this.playerVelocity=new L,this.playerDirection=new L,this.playerOnFloor=!1,this.GRAVITY=30,this.keyStates={},this._keyDown=this.keyDown.bind(this),this._keyUp=this.keyUp.bind(this),this._cameraRotate=this.cameraRotate.bind(this),this._pointerLock=this.pointerLock.bind(this),this.bindEvents()}playerCollisions(){const e=this.worldOctree.capsuleIntersect(this.playerCollider);this.playerOnFloor=!1,e&&(this.playerOnFloor=e.normal.y>0,this.playerOnFloor||(console.log("当前发生了碰撞,玩家不在地板上"),this.playerVelocity.addScaledVector(e.normal,-e.normal.dot(this.playerVelocity))),this.playerCollider.translate(e.normal.multiplyScalar(e.depth)))}updatePlayer(e){let i=Math.exp(-4*e)-1;this.playerOnFloor||(console.log("玩家在空中"),this.playerVelocity.y-=this.GRAVITY*e,i*=.1),this.playerVelocity.addScaledVector(this.playerVelocity,i);const s=this.playerVelocity.clone().multiplyScalar(e);this.playerCollider.translate(s),this.playerCollisions(),this.glviewer.camera.position.copy(this.playerCollider.end)}getForwardVector(){return this.glviewer.camera.getWorldDirection(this.playerDirection),this.playerDirection.y=0,this.playerDirection.normalize(),this.playerDirection}getSideVector(){return this.glviewer.camera.getWorldDirection(this.playerDirection),this.playerDirection.y=0,this.playerDirection.normalize(),this.playerDirection.cross(this.glviewer.camera.up),this.playerDirection}controls(e){const i=e*(this.playerOnFloor?25:8);this.keyStates.KeyW&&this.playerVelocity.add(this.getForwardVector().multiplyScalar(i)),this.keyStates.KeyS&&this.playerVelocity.add(this.getForwardVector().multiplyScalar(-i)),this.keyStates.KeyA&&this.playerVelocity.add(this.getSideVector().multiplyScalar(-i)),this.keyStates.KeyD&&this.playerVelocity.add(this.getSideVector().multiplyScalar(i)),this.playerOnFloor&&this.keyStates.Space&&(this.playerVelocity.y=15)}teleportPlayerIfOob(){this.glviewer.camera.position.y<=-35&&(this.playerCollider.start.set(0,.75,0),this.playerCollider.end.set(0,4,0),this.playerCollider.radius=.35,this.glviewer.camera.position.copy(this.playerCollider.end),this.glviewer.camera.rotation.set(0,0,0))}pointerLock(){document.body.requestPointerLock()}keyDown(e){this.keyStates[e.code]=!0}keyUp(e){this.keyStates[e.code]=!1}cameraRotate(e){document.pointerLockElement===document.body&&(this.glviewer.camera.rotation.y-=e.movementX/500,this.glviewer.camera.rotation.x-=e.movementY/500)}bindEvents(){document.addEventListener("keydown",this._keyDown),document.addEventListener("keyup",this._keyUp),document.addEventListener("mousemove",this._cameraRotate),this.glviewer.renderer.domElement.addEventListener("mousedown",this._pointerLock)}dispose(){document.removeEventListener("keydown",this._keyDown),document.removeEventListener("keyup",this._keyUp),document.removeEventListener("mousemove",this._cameraRotate),glviewer.renderer.domElement.removeEventListener("mousedown",this._pointerLock),camera.rotation.order=camera.rotation.DEFAULT_ORDER}update(e){const i=Math.min(.05,e)/this.STEPS_PER_FRAME;for(let s=0;s<this.STEPS_PER_FRAME;s++)this.controls(i),this.updatePlayer(i),this.teleportPlayerIfOob()}}class QR{static createOrbitControls(t){var{cameraTarget:e,camera:i,container:s}=t;const r=new bR(i,s);return r.controlsType="fly",r.screenSpacePanning=!1,r.target.copy(e),r.minDistance=.1,r.zoomSpeed=3,r.enableDamping=!0,r.listenToKeyEvents(window),r}static createMy1tPersonControls(t){var e=new GR(t);return e.controlsType="firstPerson",e}static createMy3dPersonControls(t){return null}}class HR extends Us{constructor(e){super();el(this,"animationLoops",[]);this.container=e.container,this.showDebug=e.showDebug||!1,this.cameraTarget=e.cameraTarget,this.cameraPosition=e.cameraPosition,this.octree=new fh,this.clock=new W1,this._fogFactor=1,this.renderer=this.createRenderer(),this.scene=this.createScene(),this.camera=iR.createPerspectiveCamera(this.cameraPosition,this.cameraTarget),this.controls=QR.createOrbitControls(this),this.debugInfo=this.createDebugInfo(this.showDebug),this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",this.resize.bind(this)),this.resize(),this.animate()}get fogFactor(){return this._fogFactor}set fogFactor(e){this._fogFactor=e,this.controls.dispatchEvent({type:"change",target:this.controls})}toggleControls(e,i){this.controls.dispose(),this.controls=e,i&&i()}createDirLight(){var e=new ty(16777215,.5*Math.PI);return e.target.position.copy(this.controls.target),e.position.set(-1e3,-2e3,1e4),e}createAmbLight(){return new k1(16777215,.7*Math.PI)}createScene(){var e=new jE;return e.background=new tt(14414079),e}createRenderer(){const e=new qE({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0,precision:"highp"});return e.setPixelRatio(window.devicePixelRatio),e}createDebugInfo(){var e=new _R(this.showDebug);return{stats:e.createStats(this.container,this.renderer,this.animationLoops),axes:e.createAxes(this),gui:e.gui}}resize(){this.renderer.setPixelRatio(window.devicePixelRatio);var e=this.container.clientWidth,i=this.container.clientHeight;return this.camera.aspect=e/i,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,i),this}animate(e){var s;var i=this.clock.getDelta();this.animationLoops.forEach(r=>{r()}),(s=this.controls)==null||s.update(i),this.dispatchEvent({type:"update",deltaTime:i}),this.renderer.render(this.scene,this.camera),requestAnimationFrame(this.animate.bind(this))}}function um(n,t){if(t===wI)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(t===ef||t===IE){let e=n.getIndex();if(e===null){const o=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)o.push(l);n.setIndex(o),e=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=e.count-2,s=[];if(t===ef)for(let o=1;o<=i;o++)s.push(e.getX(0)),s.push(e.getX(o)),s.push(e.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(s.push(e.getX(o)),s.push(e.getX(o+1)),s.push(e.getX(o+2))):(s.push(e.getX(o+2)),s.push(e.getX(o+1)),s.push(e.getX(o)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=n.clone();return r.setIndex(s),r.clearGroups(),r}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),n}class oy extends Ns{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new JR(e)}),this.register(function(e){return new qR(e)}),this.register(function(e){return new nD(e)}),this.register(function(e){return new iD(e)}),this.register(function(e){return new sD(e)}),this.register(function(e){return new XR(e)}),this.register(function(e){return new KR(e)}),this.register(function(e){return new YR(e)}),this.register(function(e){return new ZR(e)}),this.register(function(e){return new WR(e)}),this.register(function(e){return new $R(e)}),this.register(function(e){return new jR(e)}),this.register(function(e){return new eD(e)}),this.register(function(e){return new tD(e)}),this.register(function(e){return new VR(e)}),this.register(function(e){return new rD(e)}),this.register(function(e){return new oD(e)})}load(t,e,i,s){const r=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=da.extractUrlBase(t);o=da.resolveURL(c,this.path)}else o=da.extractUrlBase(t);this.manager.itemStart(t);const a=function(c){s?s(c):console.error(c),r.manager.itemError(t),r.manager.itemEnd(t)},l=new ar(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(c){try{r.parse(c,o,function(h){e(h),r.manager.itemEnd(t)},a)}catch(h){a(h)}},i,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let r;const o={},a={},l=new TextDecoder;if(typeof t=="string")r=JSON.parse(t);else if(t instanceof ArrayBuffer)if(l.decode(new Uint8Array(t,0,4))===ay){try{o[te.KHR_BINARY_GLTF]=new aD(t)}catch(u){s&&s(u);return}r=JSON.parse(o[te.KHR_BINARY_GLTF].content)}else r=JSON.parse(l.decode(t));else r=t;if(r.asset===void 0||r.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new yD(r,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,o[u.name]=!0}if(r.extensionsUsed)for(let h=0;h<r.extensionsUsed.length;++h){const u=r.extensionsUsed[h],d=r.extensionsRequired||[];switch(u){case te.KHR_MATERIALS_UNLIT:o[u]=new zR;break;case te.KHR_DRACO_MESH_COMPRESSION:o[u]=new lD(r,this.dracoLoader);break;case te.KHR_TEXTURE_TRANSFORM:o[u]=new cD;break;case te.KHR_MESH_QUANTIZATION:o[u]=new hD;break;default:d.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,r){i.parse(t,e,s,r)})}}function kR(){let n={};return{get:function(t){return n[t]},add:function(t,e){n[t]=e},remove:function(t){delete n[t]},removeAll:function(){n={}}}}const te={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class VR{constructor(t){this.parser=t,this.name=te.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const r=e[i];r.extensions&&r.extensions[this.name]&&r.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,r.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let s=e.cache.get(i);if(s)return s;const r=e.json,l=((r.extensions&&r.extensions[this.name]||{}).lights||[])[t];let c;const h=new tt(16777215);l.color!==void 0&&h.setRGB(l.color[0],l.color[1],l.color[2],tn);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new ty(h),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Q1(h),c.distance=u;break;case"spot":c=new O1(h),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,Xi(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=e.createUniqueName(l.name||"light_"+t),s=Promise.resolve(c),e.cache.add(i,s),s}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,r=i.json.nodes[t],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(e.cache,a,l)})}}class zR{constructor(){this.name=te.KHR_MATERIALS_UNLIT}getMaterialType(){return Gn}extendParams(t,e,i){const s=[];t.color=new tt(1,1,1),t.opacity=1;const r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){const o=r.baseColorFactor;t.color.setRGB(o[0],o[1],o[2],tn),t.opacity=o[3]}r.baseColorTexture!==void 0&&s.push(i.assignTexture(t,"map",r.baseColorTexture,De))}return Promise.all(s)}}class WR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name].emissiveStrength;return r!==void 0&&(e.emissiveIntensity=r),Promise.resolve()}}class JR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(r.push(i.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new kt(a,a)}return Promise.all(r)}}class qR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_DISPERSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return e.dispersion=r.dispersion!==void 0?r.dispersion:0,Promise.resolve()}}class jR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&r.push(i.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(r)}}class XR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[];e.sheenColor=new tt(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=s.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],tn)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&r.push(i.assignTexture(e,"sheenColorMap",o.sheenColorTexture,De)),o.sheenRoughnessTexture!==void 0&&r.push(i.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(r)}}class KR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&r.push(i.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(r)}}class YR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&r.push(i.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new tt().setRGB(a[0],a[1],a[2],tn),Promise.all(r)}}class ZR{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=s.extensions[this.name];return e.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class $R{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&r.push(i.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new tt().setRGB(a[0],a[1],a[2],tn),o.specularColorTexture!==void 0&&r.push(i.assignTexture(e,"specularColorMap",o.specularColorTexture,De)),Promise.all(r)}}class tD{constructor(t){this.parser=t,this.name=te.EXT_MATERIALS_BUMP}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&r.push(i.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(r)}}class eD{constructor(t){this.parser=t,this.name=te.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:Pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const r=[],o=s.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&r.push(i.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(r)}}class nD{constructor(t){this.parser=t,this.name=te.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const r=s.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,o)}}class iD{constructor(t){this.parser=t,this.name=te.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,r=s.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(t,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class sD{constructor(t){this.parser=t,this.name=te.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,s=i.json,r=s.textures[t];if(!r.extensions||!r.extensions[e])return null;const o=r.extensions[e],a=s.images[o.source];let l=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(t,o.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class rD{constructor(t){this.name=te.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],r=this.parser.getDependency("buffer",s.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return r.then(function(a){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(a,l,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(f),h,u,d,s.mode,s.filter),f})})}else return null}}class oD{constructor(t){this.name=te.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const c of s.primitives)if(c.mode!==zn.TRIANGLES&&c.mode!==zn.TRIANGLE_STRIP&&c.mode!==zn.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],l={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(h=>(l[c]=h,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(c=>{const h=c.pop(),u=h.isGroup?h.children:[h],d=c[0].count,f=[];for(const p of u){const m=new wt,g=new L,A=new hi,C=new L(1,1,1),E=new m1(p.geometry,p.material,d);for(let _=0;_<d;_++)l.TRANSLATION&&g.fromBufferAttribute(l.TRANSLATION,_),l.ROTATION&&A.fromBufferAttribute(l.ROTATION,_),l.SCALE&&C.fromBufferAttribute(l.SCALE,_),E.setMatrixAt(_,m.compose(g,A,C));for(const _ in l)if(_==="_COLOR_0"){const T=l[_];E.instanceColor=new rf(T.array,T.itemSize,T.normalized)}else _!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&p.geometry.setAttribute(_,l[_]);Me.prototype.copy.call(E,p),this.parser.assignFinalMaterial(E),f.push(E)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const ay="glTF",Go=12,dm={JSON:1313821514,BIN:5130562};class aD{constructor(t){this.name=te.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,Go),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==ay)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Go,r=new DataView(t,Go);let o=0;for(;o<s;){const a=r.getUint32(o,!0);o+=4;const l=r.getUint32(o,!0);if(o+=4,l===dm.JSON){const c=new Uint8Array(t,Go+o,a);this.content=i.decode(c)}else if(l===dm.BIN){const c=Go+o;this.body=t.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class lD{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=te.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,r=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},l={},c={};for(const h in o){const u=lf[h]||h.toLowerCase();a[u]=o[h]}for(const h in t.attributes){const u=lf[h]||h.toLowerCase();if(o[h]!==void 0){const d=i.accessors[t.attributes[h]],f=io[d.componentType];c[u]=f.name,l[u]=d.normalized===!0}}return e.getDependency("bufferView",r).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(f){for(const p in f.attributes){const m=f.attributes[p],g=l[p];g!==void 0&&(m.normalized=g)}u(f)},a,c,tn,d)})})}}class cD{constructor(){this.name=te.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class hD{constructor(){this.name=te.KHR_MESH_QUANTIZATION}}class ly extends Ja{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,r=t*s*3+s;for(let o=0;o!==s;o++)e[o]=i[r+o];return e}interpolate_(t,e,i,s){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,h=s-e,u=(i-e)/h,d=u*u,f=d*u,p=t*c,m=p-c,g=-2*f+3*d,A=f-d,C=1-g,E=A-d+u;for(let _=0;_!==a;_++){const T=o[m+_+a],M=o[m+_+l]*h,S=o[p+_+a],R=o[p+_]*h;r[_]=C*T+E*M+g*S+A*R}return r}}const uD=new hi;class dD extends ly{interpolate_(t,e,i,s){const r=super.interpolate_(t,e,i,s);return uD.fromArray(r).normalize().toArray(r),r}}const zn={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},io={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},fm={9728:Ze,9729:ln,9984:gE,9985:hc,9986:Xo,9987:Mi},Am={33071:ts,33648:bc,10497:Rs},xu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lf={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ms={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fD={CUBICSPLINE:void 0,LINEAR:wa,STEP:Ta},vu={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function AD(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new pA({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:os})),n.DefaultMaterial}function js(n,t,e){for(const i in e.extensions)n[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function Xi(n,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(n.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function pD(n,t,e){let i=!1,s=!1,r=!1;for(let c=0,h=t.length;c<h;c++){const u=t[c];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(r=!0),i&&s&&r)break}if(!i&&!s&&!r)return Promise.resolve(n);const o=[],a=[],l=[];for(let c=0,h=t.length;c<h;c++){const u=t[c];if(i){const d=u.POSITION!==void 0?e.getDependency("accessor",u.POSITION):n.attributes.position;o.push(d)}if(s){const d=u.NORMAL!==void 0?e.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(d)}if(r){const d=u.COLOR_0!==void 0?e.getDependency("accessor",u.COLOR_0):n.attributes.color;l.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then(function(c){const h=c[0],u=c[1],d=c[2];return i&&(n.morphAttributes.position=h),s&&(n.morphAttributes.normal=u),r&&(n.morphAttributes.color=d),n.morphTargetsRelative=!0,n})}function gD(n,t){if(n.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)n.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(n.morphTargetInfluences.length===e.length){n.morphTargetDictionary={};for(let i=0,s=e.length;i<s;i++)n.morphTargetDictionary[e[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mD(n){let t;const e=n.extensions&&n.extensions[te.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+Bu(e.attributes):t=n.indices+":"+Bu(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)t+=":"+Bu(n.targets[i]);return t}function Bu(n){let t="";const e=Object.keys(n).sort();for(let i=0,s=e.length;i<s;i++)t+=e[i]+":"+n[e[i]]+";";return t}function cf(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function _D(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const ED=new wt;class yD{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new kR,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,r=!1,o=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);s=i&&l?parseInt(l[1],10):-1,r=a.indexOf("Firefox")>-1,o=r?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||r&&o<98?this.textureLoader=new U1(this.options.manager):this.textureLoader=new V1(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ar(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,r=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][s.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:s.asset,parser:i,userData:{}};return js(r,a,s),Xi(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();t(a)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,r=e.length;s<r;s++){const o=e[s].joints;for(let a=0,l=o.length;a<l;a++)t[o[a]].isBone=!0}for(let s=0,r=t.length;s<r;s++){const o=t[s];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),r=(o,a)=>{const l=this.associations.get(o);l!=null&&this.associations.set(a,l);for(const[c,h]of o.children.entries())r(h,a.children[c])};return r(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const r=t(e[s]);r&&i.push(r)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(r){return r.loadNode&&r.loadNode(e)});break;case"mesh":s=this._invokeOne(function(r){return r.loadMesh&&r.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(r){return r.loadBufferView&&r.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(r){return r.loadMaterial&&r.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(r){return r.loadTexture&&r.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(r){return r.loadAnimation&&r.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(t,e)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(r,o){return i.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[te.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(r,o){i.load(da.resolveURL(e.uri,s.path),r,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,r=e.byteOffset||0;return i.slice(r,r+s)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const o=xu[s.type],a=io[s.componentType],l=s.normalized===!0,c=new a(s.count*o);return Promise.resolve(new Ue(c,o,l))}const r=[];return s.bufferView!==void 0?r.push(this.getDependency("bufferView",s.bufferView)):r.push(null),s.sparse!==void 0&&(r.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(r).then(function(o){const a=o[0],l=xu[s.type],c=io[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,f=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let m,g;if(f&&f!==u){const A=Math.floor(d/f),C="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+A+":"+s.count;let E=e.cache.get(C);E||(m=new c(a,A*f,s.count*f/h),E=new d1(m,f/h),e.cache.add(C,E)),g=new hA(E,l,d%f/h,p)}else a===null?m=new c(s.count*l):m=new c(a,d,s.count*l),g=new Ue(m,l,p);if(s.sparse!==void 0){const A=xu.SCALAR,C=io[s.sparse.indices.componentType],E=s.sparse.indices.byteOffset||0,_=s.sparse.values.byteOffset||0,T=new C(o[1],E,s.sparse.count*A),M=new c(o[2],_,s.sparse.count*l);a!==null&&(g=new Ue(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let S=0,R=T.length;S<R;S++){const B=T[S];if(g.setX(B,M[S*l]),l>=2&&g.setY(B,M[S*l+1]),l>=3&&g.setZ(B,M[S*l+2]),l>=4&&g.setW(B,M[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=p}return g})}loadTexture(t){const e=this.json,i=this.options,r=e.textures[t].source,o=e.images[r];let a=this.textureLoader;if(o.uri){const l=i.manager.getHandler(o.uri);l!==null&&(a=l)}return this.loadTextureImage(t,r,a)}loadTextureImage(t,e,i){const s=this,r=this.json,o=r.textures[t],a=r.images[e],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(e,i).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const d=(r.samplers||{})[o.sampler]||{};return h.magFilter=fm[d.magFilter]||ln,h.minFilter=fm[d.minFilter]||Mi,h.wrapS=Am[d.wrapS]||Rs,h.wrapT=Am[d.wrapT]||Rs,h.generateMipmaps=!h.isCompressedTexture&&h.minFilter!==Ze&&h.minFilter!==ln,s.associations.set(h,{textures:t}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(t,e){const i=this,s=this.json,r=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(u=>u.clone());const o=s.images[t],a=self.URL||self.webkitURL;let l=o.uri||"",c=!1;if(o.bufferView!==void 0)l=i.getDependency("bufferView",o.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:o.mimeType});return l=a.createObjectURL(d),l});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,f){let p=d;e.isImageBitmapLoader===!0&&(p=function(m){const g=new Fe(m);g.needsUpdate=!0,d(g)}),e.load(da.resolveURL(u,r.path),p,void 0,f)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),Xi(u,o),u.userData.mimeType=o.mimeType||_D(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[t]=h,h}assignTexture(t,e,i,s){const r=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),r.extensions[te.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[te.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=r.associations.get(o);o=r.extensions[te.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),r.associations.set(o,l)}}return s!==void 0&&(o.colorSpace=s),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=e.attributes.tangent===void 0,r=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new KE,wi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(t.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new Wa,wi.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||r||o){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),r&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),r&&(l.vertexColors=!0),o&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}t.material=i}getMaterialType(){return pA}loadMaterial(t){const e=this,i=this.json,s=this.extensions,r=i.materials[t];let o;const a={},l=r.extensions||{},c=[];if(l[te.KHR_MATERIALS_UNLIT]){const u=s[te.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),c.push(u.extendParams(a,r,e))}else{const u=r.pbrMetallicRoughness||{};if(a.color=new tt(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],tn),a.opacity=d[3]}u.baseColorTexture!==void 0&&c.push(e.assignTexture(a,"map",u.baseColorTexture,De)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(e.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(e.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,a)})))}r.doubleSided===!0&&(a.side=Un);const h=r.alphaMode||vu.OPAQUE;if(h===vu.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===vu.MASK&&(a.alphaTest=r.alphaCutoff!==void 0?r.alphaCutoff:.5)),r.normalTexture!==void 0&&o!==Gn&&(c.push(e.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new kt(1,1),r.normalTexture.scale!==void 0)){const u=r.normalTexture.scale;a.normalScale.set(u,u)}if(r.occlusionTexture!==void 0&&o!==Gn&&(c.push(e.assignTexture(a,"aoMap",r.occlusionTexture)),r.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=r.occlusionTexture.strength)),r.emissiveFactor!==void 0&&o!==Gn){const u=r.emissiveFactor;a.emissive=new tt().setRGB(u[0],u[1],u[2],tn)}return r.emissiveTexture!==void 0&&o!==Gn&&c.push(e.assignTexture(a,"emissiveMap",r.emissiveTexture,De)),Promise.all(c).then(function(){const u=new o(a);return r.name&&(u.name=r.name),Xi(u,r),e.associations.set(u,{materials:t}),r.extensions&&js(s,u,r),u})}createUniqueName(t){const e=pe.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function r(a){return i[te.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(l){return pm(l,a,e)})}const o=[];for(let a=0,l=t.length;a<l;a++){const c=t[a],h=mD(c),u=s[h];if(u)o.push(u.promise);else{let d;c.extensions&&c.extensions[te.KHR_DRACO_MESH_COMPRESSION]?d=r(c):d=pm(new en,c,e),s[h]={primitive:c,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(t){const e=this,i=this.json,s=this.extensions,r=i.meshes[t],o=r.primitives,a=[];for(let l=0,c=o.length;l<c;l++){const h=o[l].material===void 0?AD(this.cache):this.getDependency("material",o[l].material);a.push(h)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),h=l[l.length-1],u=[];for(let f=0,p=h.length;f<p;f++){const m=h[f],g=o[f];let A;const C=c[f];if(g.mode===zn.TRIANGLES||g.mode===zn.TRIANGLE_STRIP||g.mode===zn.TRIANGLE_FAN||g.mode===void 0)A=r.isSkinnedMesh===!0?new A1(m,C):new Ye(m,C),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),g.mode===zn.TRIANGLE_STRIP?A.geometry=um(A.geometry,IE):g.mode===zn.TRIANGLE_FAN&&(A.geometry=um(A.geometry,ef));else if(g.mode===zn.LINES)A=new fA(m,C);else if(g.mode===zn.LINE_STRIP)A=new ch(m,C);else if(g.mode===zn.LINE_LOOP)A=new _1(m,C);else if(g.mode===zn.POINTS)A=new YE(m,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(A.geometry.morphAttributes).length>0&&gD(A,r),A.name=e.createUniqueName(r.name||"mesh_"+t),Xi(A,r),g.extensions&&js(s,A,g),e.assignFinalMaterial(A),u.push(A)}for(let f=0,p=u.length;f<p;f++)e.associations.set(u[f],{meshes:t,primitives:f});if(u.length===1)return r.extensions&&js(s,u[0],r),u[0];const d=new ri;r.extensions&&js(s,d,r),e.associations.set(d,{meshes:t});for(let f=0,p=u.length;f<p;f++)d.add(u[f]);return d})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?e=new Xe(SE.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new ah(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Xi(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let s=0,r=e.joints.length;s<r;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const r=s.pop(),o=s,a=[],l=[];for(let c=0,h=o.length;c<h;c++){const u=o[c];if(u){a.push(u);const d=new wt;r!==null&&d.fromArray(r.array,c*16),l.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[c])}return new dA(a,l)})}loadAnimation(t){const e=this.json,i=this,s=e.animations[t],r=s.name?s.name:"animation_"+t,o=[],a=[],l=[],c=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const f=s.channels[u],p=s.samplers[f.sampler],m=f.target,g=m.node,A=s.parameters!==void 0?s.parameters[p.input]:p.input,C=s.parameters!==void 0?s.parameters[p.output]:p.output;m.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",A)),l.push(this.getDependency("accessor",C)),c.push(p),h.push(m))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],f=u[1],p=u[2],m=u[3],g=u[4],A=[];for(let C=0,E=d.length;C<E;C++){const _=d[C],T=f[C],M=p[C],S=m[C],R=g[C];if(_===void 0)continue;_.updateMatrix&&_.updateMatrix();const B=i._createAnimationTracks(_,T,M,S,R);if(B)for(let x=0;x<B.length;x++)A.push(B[x])}return new T1(r,void 0,A)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(r){const o=i._getNodeRef(i.meshCache,s.mesh,r);return s.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let l=0,c=s.weights.length;l<c;l++)a.morphTargetInfluences[l]=s.weights[l]}),o})}loadNode(t){const e=this.json,i=this,s=e.nodes[t],r=i._loadNodeShallow(t),o=[],a=s.children||[];for(let c=0,h=a.length;c<h;c++)o.push(i.getDependency("node",a[c]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([r,Promise.all(o),l]).then(function(c){const h=c[0],u=c[1],d=c[2];d!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(d,ED)});for(let f=0,p=u.length;f<p;f++)h.add(u[f]);return h})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const r=e.nodes[t],o=r.name?s.createUniqueName(r.name):"",a=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(t)});return l&&a.push(l),r.camera!==void 0&&a.push(s.getDependency("camera",r.camera).then(function(c){return s._getNodeRef(s.cameraCache,r.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(t)}).forEach(function(c){a.push(c)}),this.nodeCache[t]=Promise.all(a).then(function(c){let h;if(r.isBone===!0?h=new XE:c.length>1?h=new ri:c.length===1?h=c[0]:h=new Me,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(r.name&&(h.userData.name=r.name,h.name=o),Xi(h,r),r.extensions&&js(i,h,r),r.matrix!==void 0){const u=new wt;u.fromArray(r.matrix),h.applyMatrix4(u)}else r.translation!==void 0&&h.position.fromArray(r.translation),r.rotation!==void 0&&h.quaternion.fromArray(r.rotation),r.scale!==void 0&&h.scale.fromArray(r.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=t,h}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,r=new ri;i.name&&(r.name=s.createUniqueName(i.name)),Xi(r,i),i.extensions&&js(e,r,i);const o=i.nodes||[],a=[];for(let l=0,c=o.length;l<c;l++)a.push(s.getDependency("node",o[l]));return Promise.all(a).then(function(l){for(let h=0,u=l.length;h<u;h++)r.add(l[h]);const c=h=>{const u=new Map;for(const[d,f]of s.associations)(d instanceof wi||d instanceof Fe)&&u.set(d,f);return h.traverse(d=>{const f=s.associations.get(d);f!=null&&u.set(d,f)}),u};return s.associations=c(r),r})}_createAnimationTracks(t,e,i,s,r){const o=[],a=t.name?t.name:t.uuid,l=[];ms[r.path]===ms.weights?t.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(a);let c;switch(ms[r.path]){case ms.weights:c=uo;break;case ms.rotation:c=fo;break;case ms.position:case ms.scale:c=Ao;break;default:switch(i.itemSize){case 1:c=uo;break;case 2:case 3:default:c=Ao;break}break}const h=s.interpolation!==void 0?fD[s.interpolation]:wa,u=this._getArrayFromAccessor(i);for(let d=0,f=l.length;d<f;d++){const p=new c(l[d]+"."+ms[r.path],e.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),o.push(p)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const i=cf(e.constructor),s=new Float32Array(e.length);for(let r=0,o=e.length;r<o;r++)s[r]=e[r]*i;e=s}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(i){const s=this instanceof fo?dD:ly;return new s(this.times,this.values,this.getValueSize()/3,i)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function CD(n,t,e){const i=t.attributes,s=new ui;if(i.POSITION!==void 0){const a=e.json.accessors[i.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(s.set(new L(l[0],l[1],l[2]),new L(c[0],c[1],c[2])),a.normalized){const h=cf(io[a.componentType]);s.min.multiplyScalar(h),s.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const r=t.targets;if(r!==void 0){const a=new L,l=new L;for(let c=0,h=r.length;c<h;c++){const u=r[c];if(u.POSITION!==void 0){const d=e.json.accessors[u.POSITION],f=d.min,p=d.max;if(f!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),d.normalized){const m=cf(io[d.componentType]);l.multiplyScalar(m)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const o=new Ai;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=o}function pm(n,t,e){const i=t.attributes,s=[];function r(o,a){return e.getDependency("accessor",o).then(function(l){n.setAttribute(a,l)})}for(const o in i){const a=lf[o]||o.toLowerCase();a in n.attributes||s.push(r(i[o],a))}if(t.indices!==void 0&&!n.index){const o=e.getDependency("accessor",t.indices).then(function(a){n.setIndex(a)});s.push(o)}return ee.workingColorSpace!==tn&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ee.workingColorSpace}" not supported.`),Xi(n,t),CD(n,t,e),Promise.all(s).then(function(){return t.targets!==void 0?pD(n,t.targets,e):n})}const Iu=new WeakMap;class xD extends Ns{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,s){const r=new ar(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,o=>{this.parse(o,e,s)},i,s)}parse(t,e,i=()=>{}){this.decodeDracoFile(t,e,null,null,De,i).catch(i)}decodeDracoFile(t,e,i,s,r=tn,o=()=>{}){const a={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:r};return this.decodeGeometry(t,a).then(e).catch(o)}decodeGeometry(t,e){const i=JSON.stringify(e);if(Iu.has(t)){const l=Iu.get(t);if(l.key===i)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const r=this.workerNextTaskID++,o=t.byteLength,a=this._getWorker(r,o).then(l=>(s=l,new Promise((c,h)=>{s._callbacks[r]={resolve:c,reject:h},s.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{s&&r&&this._releaseTask(s,r)}),Iu.set(t,{key:i,promise:a}),a}_createGeometry(t){const e=new en;t.index&&e.setIndex(new Ue(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const s=t.attributes[i],r=s.name,o=s.array,a=s.itemSize,l=new Ue(o,a);r==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(o instanceof Float32Array)),e.setAttribute(r,l)}return e}_assignVertexColorSpace(t,e){if(e!==De)return;const i=new tt;for(let s=0,r=t.count;s<r;s++)i.fromBufferAttribute(t,s),ee.toWorkingColorSpace(i,De),t.setXYZ(s,i.r,i.g,i.b)}_loadLibrary(t,e){const i=new ar(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((s,r)=>{i.load(t,s,void 0,r)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{const s=i[0];t||(this.decoderConfig.wasmBinary=i[1]);const r=vD.toString(),o=["/* draco decoder */",s,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(r){const o=r.data;switch(o.type){case"decode":s._callbacks[o.id].resolve(o);break;case"error":s._callbacks[o.id].reject(o);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,r){return s._taskLoad>r._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function vD(){let n,t;onmessage=function(o){const a=o.data;switch(a.type){case"init":n=a.decoderConfig,t=new Promise(function(h){n.onModuleLoaded=function(u){h({draco:u})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,c=a.taskConfig;t.then(h=>{const u=h.draco,d=new u.Decoder;try{const f=e(u,d,new Int8Array(l),c),p=f.attributes.map(m=>m.array.buffer);f.index&&p.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},p)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{u.destroy(d)}});break}};function e(o,a,l,c){const h=c.attributeIDs,u=c.attributeTypes;let d,f;const p=a.GetEncodedGeometryType(l);if(p===o.TRIANGULAR_MESH)d=new o.Mesh,f=a.DecodeArrayToMesh(l,l.byteLength,d);else if(p===o.POINT_CLOUD)d=new o.PointCloud,f=a.DecodeArrayToPointCloud(l,l.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const m={index:null,attributes:[]};for(const g in h){const A=self[u[g]];let C,E;if(c.useUniqueIDs)E=h[g],C=a.GetAttributeByUniqueId(d,E);else{if(E=a.GetAttributeId(d,o[h[g]]),E===-1)continue;C=a.GetAttribute(d,E)}const _=s(o,a,d,g,A,C);g==="color"&&(_.vertexColorSpace=c.vertexColorSpace),m.attributes.push(_)}return p===o.TRIANGULAR_MESH&&(m.index=i(o,a,d)),o.destroy(d),m}function i(o,a,l){const h=l.num_faces()*3,u=h*4,d=o._malloc(u);a.GetTrianglesUInt32Array(l,u,d);const f=new Uint32Array(o.HEAPF32.buffer,d,h).slice();return o._free(d),{array:f,itemSize:1}}function s(o,a,l,c,h,u){const d=u.num_components(),p=l.num_points()*d,m=p*h.BYTES_PER_ELEMENT,g=r(o,h),A=o._malloc(m);a.GetAttributeDataArrayForAllPoints(l,u,g,m,A);const C=new h(o.HEAPF32.buffer,A,p).slice();return o._free(A),{name:c,array:C,itemSize:d}}function r(o,a){switch(a){case Float32Array:return o.DT_FLOAT32;case Int8Array:return o.DT_INT8;case Int16Array:return o.DT_INT16;case Int32Array:return o.DT_INT32;case Uint8Array:return o.DT_UINT8;case Uint16Array:return o.DT_UINT16;case Uint32Array:return o.DT_UINT32}}}class BD{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const i=this.workersResolve[t];if(i&&i(e),this.queue.length){const{resolve:s,msg:r,transfer:o}=this.queue.shift();this.workersResolve[t]=s,this.workers[t].postMessage(r,o)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise(i=>{const s=this._getIdleWorker();s!==-1?(this._initWorker(s),this.workerStatus|=1<<s,this.workersResolve[s]=i,this.workers[s].postMessage(t,e)):this.queue.push({resolve:i,msg:t,transfer:e})})}dispose(){this.workers.forEach(t=>t.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const ID=0,gm=2,bD=1,mm=2,MD=0,SD=1,TD=10,wD=0,cy=9,hy=15,uy=16,dy=22,fy=37,Ay=43,py=76,gy=83,my=97,_y=100,Ey=103,yy=109,Cy=165,xy=166,CA=1000066e3;let RD=class{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}},Qo=class{constructor(t,e,i,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(t.buffer,t.byteOffset+e,i),this._littleEndian=s,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint8Array(t){const e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,t);return this._offset+=t,e}_skip(t){return this._offset+=t,this}_scan(t,e){e===void 0&&(e=0);const i=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==e&&s<t;)s++,this._offset++;return s<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,s)}};const fn=[171,75,84,88,32,50,48,187,13,10,26,10];function _m(n){return new TextDecoder().decode(n)}function DD(n){const t=new Uint8Array(n.buffer,n.byteOffset,fn.length);if(t[0]!==fn[0]||t[1]!==fn[1]||t[2]!==fn[2]||t[3]!==fn[3]||t[4]!==fn[4]||t[5]!==fn[5]||t[6]!==fn[6]||t[7]!==fn[7]||t[8]!==fn[8]||t[9]!==fn[9]||t[10]!==fn[10]||t[11]!==fn[11])throw new Error("Missing KTX 2.0 identifier.");const e=new RD,i=17*Uint32Array.BYTES_PER_ELEMENT,s=new Qo(n,fn.length,i,!0);e.vkFormat=s._nextUint32(),e.typeSize=s._nextUint32(),e.pixelWidth=s._nextUint32(),e.pixelHeight=s._nextUint32(),e.pixelDepth=s._nextUint32(),e.layerCount=s._nextUint32(),e.faceCount=s._nextUint32();const r=s._nextUint32();e.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),l=s._nextUint32(),c=s._nextUint32(),h=s._nextUint64(),u=s._nextUint64(),d=new Qo(n,fn.length+i,3*r*8,!0);for(let X=0;X<r;X++)e.levels.push({levelData:new Uint8Array(n.buffer,n.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const f=new Qo(n,o,a,!0),p={vendorId:f._skip(4)._nextUint16(),descriptorType:f._nextUint16(),versionNumber:f._nextUint16(),descriptorBlockSize:f._nextUint16(),colorModel:f._nextUint8(),colorPrimaries:f._nextUint8(),transferFunction:f._nextUint8(),flags:f._nextUint8(),texelBlockDimension:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],bytesPlane:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],samples:[]},m=(p.descriptorBlockSize/4-6)/4;for(let X=0;X<m;X++){const U={bitOffset:f._nextUint16(),bitLength:f._nextUint8(),channelType:f._nextUint8(),samplePosition:[f._nextUint8(),f._nextUint8(),f._nextUint8(),f._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&U.channelType?(U.sampleLower=f._nextInt32(),U.sampleUpper=f._nextInt32()):(U.sampleLower=f._nextUint32(),U.sampleUpper=f._nextUint32()),p.samples[X]=U}e.dataFormatDescriptor.length=0,e.dataFormatDescriptor.push(p);const g=new Qo(n,l,c,!0);for(;g._offset<c;){const X=g._nextUint32(),U=g._scan(X),ut=_m(U);if(e.keyValue[ut]=g._nextUint8Array(X-U.byteLength-1),ut.match(/^ktx/i)){const gt=_m(e.keyValue[ut]);e.keyValue[ut]=gt.substring(0,gt.lastIndexOf("\0"))}g._skip(X%4?4-X%4:0)}if(u<=0)return e;const A=new Qo(n,h,u,!0),C=A._nextUint16(),E=A._nextUint16(),_=A._nextUint32(),T=A._nextUint32(),M=A._nextUint32(),S=A._nextUint32(),R=[];for(let X=0;X<r;X++)R.push({imageFlags:A._nextUint32(),rgbSliceByteOffset:A._nextUint32(),rgbSliceByteLength:A._nextUint32(),alphaSliceByteOffset:A._nextUint32(),alphaSliceByteLength:A._nextUint32()});const B=h+A._offset,x=B+_,D=x+T,V=D+M,Q=new Uint8Array(n.buffer,n.byteOffset+B,_),k=new Uint8Array(n.buffer,n.byteOffset+x,T),et=new Uint8Array(n.buffer,n.byteOffset+D,M),j=new Uint8Array(n.buffer,n.byteOffset+V,S);return e.globalData={endpointCount:C,selectorCount:E,imageDescs:R,endpointsData:Q,selectorsData:k,tablesData:et,extendedData:j},e}let bu,qi,hf;const Mu={env:{emscripten_notify_memory_growth:function(n){hf=new Uint8Array(qi.exports.memory.buffer)}}};class LD{init(){return bu||(bu=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Em).then(t=>t.arrayBuffer()).then(t=>WebAssembly.instantiate(t,Mu)).then(this._init):WebAssembly.instantiate(Buffer.from(Em,"base64"),Mu).then(this._init),bu)}_init(t){qi=t.instance,Mu.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!qi)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=t.byteLength,s=qi.exports.malloc(i);hf.set(t,s),e=e||Number(qi.exports.ZSTD_findDecompressedSize(s,i));const r=qi.exports.malloc(e),o=qi.exports.ZSTD_decompress(r,e,s,i),a=hf.slice(r,r+o);return qi.exports.free(s),qi.exports.free(r),a}}const Em="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",PD="display-p3",FD="display-p3-linear",Su=new WeakMap;let Tu=0,wu;class Jn extends Ns{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new BD,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}async detectSupportAsync(t){return this.workerConfig={astcSupported:await t.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await t.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await t.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await t.hasFeatureAsync("texture-compression-bc"),bptcSupported:await t.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await t.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(t){return t.isWebGPURenderer===!0?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:t.hasFeature("texture-compression-etc1"),etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:t.hasFeature("texture-compression-bptc"),pvrtcSupported:t.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:t.extensions.has("WEBGL_compressed_texture_astc")&&t.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const t=new ar(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),i=new ar(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,s]).then(([r,o])=>{const a=Jn.BasisWorker.toString(),l=["/* constants */","let _EngineFormat = "+JSON.stringify(Jn.EngineFormat),"let _EngineType = "+JSON.stringify(Jn.EngineType),"let _TranscoderFormat = "+JSON.stringify(Jn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Jn.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([l])),this.transcoderBinary=o,this.workerPool.setWorkerCreator(()=>{const c=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return c.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),c})}),Tu>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Tu++}return this.transcoderPending}load(t,e,i,s){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const r=new ar(this.manager);r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials),r.load(t,o=>{this.parse(o,e,s)},i,s)}parse(t,e,i){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Su.has(t))return Su.get(t).promise.then(e).catch(i);this._createTexture(t).then(s=>e?e(s):null).catch(i)}_createTextureFrom(t,e){const{type:i,error:s,data:{faces:r,width:o,height:a,format:l,type:c,dfdFlags:h}}=t;if(i==="error")return Promise.reject(s);let u;if(e.faceCount===6)u=new y1(r,l,c);else{const d=r[0].mipmaps;u=e.layerCount>1?new E1(d,o,a,e.layerCount,l,c):new hh(d,o,a,l,c)}return u.minFilter=r[0].mipmaps.length===1?ln:Mi,u.magFilter=ln,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=vy(e),u.premultiplyAlpha=!!(h&bD),u}async _createTexture(t,e={}){const i=DD(new Uint8Array(t)),s=i.vkFormat===CA&&i.dataFormatDescriptor[0].colorModel===167;if(!(i.vkFormat===wD||s&&!this.workerConfig.astcHDRSupported))return ND(i);const o=e,a=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:o},[t])).then(l=>this._createTextureFrom(l.data,i));return Su.set(t,{promise:a}),a}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Tu--,this}}Jn.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};Jn.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};Jn.EngineFormat={RGBAFormat:Qe,RGBA_ASTC_4x4_Format:Ma,RGB_BPTC_UNSIGNED_Format:Dc,RGBA_BPTC_Format:ha,RGBA_ETC2_EAC_Format:Rc,RGBA_PVRTC_4BPPV1_Format:Sc,RGBA_S3TC_DXT5_Format:ca,RGB_ETC1_Format:Tc,RGB_ETC2_Format:wc,RGB_PVRTC_4BPPV1_Format:Mc,RGBA_S3TC_DXT1_Format:la};Jn.EngineType={UnsignedByteType:We,HalfFloatType:si,FloatType:Ke};Jn.BasisWorker=function(){let n,t,e;const i=_EngineFormat,s=_EngineType,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(p){const m=p.data;switch(m.type){case"init":n=m.config,a(m.transcoderBinary);break;case"transcode":t.then(()=>{try{const{faces:g,buffers:A,width:C,height:E,hasAlpha:_,format:T,type:M,dfdFlags:S}=l(m.buffer);self.postMessage({type:"transcode",id:m.id,data:{faces:g,width:C,height:E,hasAlpha:_,format:T,type:M,dfdFlags:S}},A)}catch(g){console.error(g),self.postMessage({type:"error",id:m.id,error:g.message})}});break}});function a(p){t=new Promise(m=>{e={wasmBinary:p,onRuntimeInitialized:m},BASIS(e)}).then(()=>{e.initializeBasis(),e.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function l(p){const m=new e.KTX2File(new Uint8Array(p));function g(){m.close(),m.delete()}if(!m.isValid())throw g(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let A;if(m.isUASTC())A=o.UASTC;else if(m.isETC1S())A=o.ETC1S;else if(m.isHDR())A=o.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const C=m.getWidth(),E=m.getHeight(),_=m.getLayers()||1,T=m.getLevels(),M=m.getFaces(),S=m.getHasAlpha(),R=m.getDFDFlags(),{transcoderFormat:B,engineFormat:x,engineType:D}=u(A,C,E,S);if(!C||!E||!T)throw g(),new Error("THREE.KTX2Loader:	Invalid texture");if(!m.startTranscoding())throw g(),new Error("THREE.KTX2Loader: .startTranscoding failed");const V=[],Q=[];for(let k=0;k<M;k++){const et=[];for(let j=0;j<T;j++){const X=[];let U,ut;for(let Et=0;Et<_;Et++){const Dt=m.getImageLevelInfo(j,Et,k);k===0&&j===0&&Et===0&&(Dt.origWidth%4!==0||Dt.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),T>1?(U=Dt.origWidth,ut=Dt.origHeight):(U=Dt.width,ut=Dt.height);let Jt=new Uint8Array(m.getImageTranscodedSizeInBytes(j,Et,0,B));const at=m.transcodeImage(Jt,j,Et,k,B,0,-1,-1);if(D===s.HalfFloatType&&(Jt=new Uint16Array(Jt.buffer,Jt.byteOffset,Jt.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!at)throw g(),new Error("THREE.KTX2Loader: .transcodeImage failed.");X.push(Jt)}const gt=f(X);et.push({data:gt,width:U,height:ut}),Q.push(gt.buffer)}V.push({mipmaps:et,width:C,height:E,format:x,type:D})}return g(),{faces:V,buffers:Q,width:C,height:E,hasAlpha:S,dfdFlags:R,format:x,type:D}}const c=[{if:"astcSupported",basisFormat:[o.UASTC],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],engineType:[s.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],engineType:[s.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGBA_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],engineType:[s.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],engineType:[s.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],engineType:[s.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],engineType:[s.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[o.UASTC_HDR],transcoderFormat:[r.BC6H],engineFormat:[i.RGB_BPTC_UNSIGNED_Format],engineType:[s.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[r.RGBA32,r.RGBA32],engineFormat:[i.RGBAFormat,i.RGBAFormat],engineType:[s.UnsignedByteType,s.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[o.UASTC_HDR],transcoderFormat:[r.RGBA_HALF],engineFormat:[i.RGBAFormat],engineType:[s.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],h={[o.ETC1S]:c.filter(p=>p.basisFormat.includes(o.ETC1S)).sort((p,m)=>p.priorityUASTC-m.priorityUASTC),[o.UASTC]:c.filter(p=>p.basisFormat.includes(o.UASTC)).sort((p,m)=>p.priorityUASTC-m.priorityUASTC),[o.UASTC_HDR]:c.filter(p=>p.basisFormat.includes(o.UASTC_HDR)).sort((p,m)=>p.priorityHDR-m.priorityHDR)};function u(p,m,g,A){const C=h[p];for(let E=0;E<C.length;E++){const _=C[E];if(_.if&&!n[_.if]||!_.basisFormat.includes(p)||A&&_.transcoderFormat.length<2||_.needsPowerOfTwo&&!(d(m)&&d(g)))continue;const T=_.transcoderFormat[A?1:0],M=_.engineFormat[A?1:0],S=_.engineType[0];return{transcoderFormat:T,engineFormat:M,engineType:S}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function d(p){return p<=2?!0:(p&p-1)===0&&p!==0}function f(p){if(p.length===1)return p[0];let m=0;for(let C=0;C<p.length;C++){const E=p[C];m+=E.byteLength}const g=new Uint8Array(m);let A=0;for(let C=0;C<p.length;C++){const E=p[C];g.set(E,A),A+=E.byteLength}return g}};const UD=new Set([Qe,er,Bs]),Ru={[yy]:Qe,[my]:Qe,[fy]:Qe,[Ay]:Qe,[Ey]:er,[gy]:er,[uy]:er,[dy]:er,[_y]:Bs,[py]:Bs,[hy]:Bs,[cy]:Bs,[CA]:Ma,[xy]:Sa,[Cy]:Sa},Du={[yy]:Ke,[my]:si,[fy]:We,[Ay]:We,[Ey]:Ke,[gy]:si,[uy]:We,[dy]:We,[_y]:Ke,[py]:si,[hy]:We,[cy]:We,[CA]:si,[xy]:We,[Cy]:We};async function ND(n){const{vkFormat:t}=n;if(Ru[t]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let e;n.supercompressionScheme===gm&&(wu||(wu=new Promise(async r=>{const o=new LD;await o.init(),r(o)})),e=await wu);const i=[];for(let r=0;r<n.levels.length;r++){const o=Math.max(1,n.pixelWidth>>r),a=Math.max(1,n.pixelHeight>>r),l=n.pixelDepth?Math.max(1,n.pixelDepth>>r):0,c=n.levels[r];let h;if(n.supercompressionScheme===ID)h=c.levelData;else if(n.supercompressionScheme===gm)h=e.decode(c.levelData,c.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let u;Du[t]===Ke?u=new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):Du[t]===si?u=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):u=h,i.push({data:u,width:o,height:a,depth:l})}let s;if(UD.has(Ru[t]))s=n.pixelDepth===0?new uA(i[0].data,n.pixelWidth,n.pixelHeight):new DE(i[0].data,n.pixelWidth,n.pixelHeight,n.pixelDepth);else{if(n.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new hh(i,n.pixelWidth,n.pixelHeight)}return s.mipmaps=i,s.type=Du[t],s.format=Ru[t],s.colorSpace=vy(n),s.needsUpdate=!0,Promise.resolve(s)}function vy(n){const t=n.dataFormatDescriptor[0];return t.colorPrimaries===SD?t.transferFunction===mm?De:tn:t.colorPrimaries===TD?t.transferFunction===mm?PD:FD:(t.colorPrimaries===MD||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),vi)}var OD=Object.defineProperty,GD=(n,t,e)=>t in n?OD(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,it=(n,t,e)=>GD(n,typeof t!="symbol"?t+"":t,e);async function qa(n,t,e,i){return i._parse(n,t,e,i)}function Se(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const Ah=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ym=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ym&&parseFloat(ym[1]);function QD(n,t){return By(n||{},t)}function By(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(e>3)return t;const i={...n};for(const[s,r]of Object.entries(t))r&&typeof r=="object"&&!Array.isArray(r)?i[s]=By(i[s]||{},t[s],e+1):i[s]=t[s];return i}const HD="latest";function kD(){var n;return(n=globalThis._loadersgl_)!==null&&n!==void 0&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.1"),globalThis._loadersgl_.version}const Iy=kD();function as(n,t){if(!n)throw new Error(t||"loaders.gl assertion failed.")}const Di=typeof process!="object"||String(process)!=="[object process]"||process.browser,xA=typeof importScripts=="function",VD=typeof window<"u"&&typeof window.orientation<"u",Cm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Cm&&parseFloat(Cm[1]);class zD{constructor(t,e){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=e,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){as(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){as(this.isRunning),this.isRunning=!1,this._reject(t)}}class Lu{terminate(){}}const Pu=new Map;function WD(n){as(n.source&&!n.url||!n.source&&n.url);let t=Pu.get(n.source||n.url);return t||(n.url&&(t=JD(n.url),Pu.set(n.url,t)),n.source&&(t=by(n.source),Pu.set(n.source,t))),as(t),t}function JD(n){if(!n.startsWith("http"))return n;const t=qD(n);return by(t)}function by(n){const t=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(t)}function qD(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function My(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=arguments.length>2?arguments[2]:void 0;const i=e||new Set;if(n){if(xm(n))i.add(n);else if(xm(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)&&t&&typeof n=="object")for(const s in n)My(n[s],t,i)}return e===void 0?Array.from(i):[]}function xm(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Fu=()=>{};class uf{static isSupported(){return typeof Worker<"u"&&Di||typeof Lu<"u"&&!Di}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:e,source:i,url:s}=t;as(i||s),this.name=e,this.source=i,this.url=s,this.onMessage=Fu,this.onError=r=>console.log(r),this.worker=Di?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Fu,this.onError=Fu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||My(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=WD({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new Lu(e,{eval:!1})}else if(this.source)t=new Lu(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class jD{static isSupported(){return uf.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(r,o,a)=>r.done(a),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(r,o)=>r.error(o);const s=new Promise(r=>(this.jobQueue.push({name:t,onMessage:e,onError:i,onStart:r}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const i=new zD(e.name,t);t.onMessage=s=>e.onMessage(i,s.type,s.payload),t.onError=s=>e.onError(i,s),e.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Di||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new uf({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return VD?this.maxMobileConcurrency:this.maxConcurrency}}const XD={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class $i{static isSupported(){return uf.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return $i._workerFarm=$i._workerFarm||new $i({}),$i._workerFarm.setProps(t),$i._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={...XD},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:i,url:s}=t;let r=this.workerPools.get(e);return r||(r=new jD({name:e,source:i,url:s}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}$i._workerFarm=void 0;function KD(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t[n.id]||{},i=Di?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=e.workerUrl;if(!s&&n.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(Di?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let r=n.version;r==="latest"&&(r=HD);const o=r?`@${r}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${i}`}return as(s),s}function YD(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Iy;as(n,"no worker provided");const e=n.version;return!(!t||!e)}const ZD={},$D=Object.freeze(Object.defineProperty({__proto__:null,default:ZD},Symbol.toStringTag,{value:"Module"})),Uu={};async function lr(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return t&&(n=tL(n,t,e,i)),Uu[n]=Uu[n]||eL(n),await Uu[n]}function tL(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!e.useLocalLibraries&&n.startsWith("http"))return n;i=i||n;const s=e.modules||{};return s[i]?s[i]:Di?e.CDN?(as(e.CDN.startsWith("http")),`${e.CDN}/${t}@${Iy}/dist/libs/${i}`):xA?`../src/libs/${i}`:`modules/${t}/src/libs/${i}`:`modules/${t}/dist/libs/${i}`}async function eL(n){if(n.endsWith("wasm"))return await iL(n);if(!Di)try{return $D&&void 0}catch(e){return console.error(e),null}if(xA)return importScripts(n);const t=await sL(n);return nL(t,n)}function nL(n,t){if(!Di)return;if(xA)return eval.call(globalThis,n),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(n))}catch{e.text=n}return document.body.appendChild(e),null}async function iL(n){return await(await fetch(n)).arrayBuffer()}async function sL(n){return await(await fetch(n)).text()}function rL(n,t){return!$i.isSupported()||!Di&&!(t!=null&&t._nodeWorkers)?!1:n.worker&&(t==null?void 0:t.worker)}async function oL(n,t,e,i,s){const r=n.id,o=KD(n,e),a=$i.getWorkerFarm(e).getWorkerPool({name:r,url:o});e=JSON.parse(JSON.stringify(e)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",aL.bind(null,s));return l.postMessage("process",{input:t,options:e,context:i}),await(await l.result).result}async function aL(n,t,e,i){switch(e){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:s,input:r,options:o}=i;try{const a=await n(r,o);t.postMessage("done",{id:s,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:s,error:l})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function lL(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?vm(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?vm(n,0,t):""}function vm(n,t,e){if(n.byteLength<=t+e)return"";const i=new DataView(n);let s="";for(let r=0;r<e;r++)s+=String.fromCharCode(i.getUint8(t+r));return s}function cL(n){try{return JSON.parse(n)}catch{throw new Error(`Failed to parse JSON from data starting with "${lL(n)}"`)}}function hL(n,t,e){if(e=e||n.byteLength,n.byteLength<e||t.byteLength<e)return!1;const i=new Uint8Array(n),s=new Uint8Array(t);for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0}function uL(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];return dL(t)}function dL(n){const t=n.map(r=>r instanceof ArrayBuffer?new Uint8Array(r):r),e=t.reduce((r,o)=>r+o.byteLength,0),i=new Uint8Array(e);let s=0;for(const r of t)i.set(r,s),s+=r.byteLength;return i.buffer}function vA(n,t,e){const i=e!==void 0?new Uint8Array(n).subarray(t,t+e):new Uint8Array(n).subarray(t);return new Uint8Array(i).buffer}function ja(n,t){return Se(n>=0),Se(t>0),n+(t-1)&~(t-1)}function fL(n,t,e){let i;if(n instanceof ArrayBuffer)i=new Uint8Array(n);else{const s=n.byteOffset,r=n.byteLength;i=new Uint8Array(n.buffer||n.arrayBuffer,s,r)}return t.set(i,e),e+ja(i.byteLength,4)}async function AL(n){const t=[];for await(const e of n)t.push(e);return uL(...t)}function Bm(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();n=t[0]*1e3+t[1]/1e6}else n=Date.now();return n}class Im{constructor(t,e){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=e,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Bm(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Bm()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Sy{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const e of Object.values(this.stats))t(e)}getTable(){const t={};return this.forEach(e=>{t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(t){const{name:e,type:i}=t;let s=this.stats[e];return s||(t instanceof Im?s=t:s=new Im(e,i),this.stats[e]=s),s}}let pL="";const bm={};function gL(n){for(const t in bm)if(n.startsWith(t)){const e=bm[t];n=n.replace(t,e)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${pL}${n}`),n}function mL(n){return n&&typeof n=="object"&&n.isBuffer}function Ty(n){if(mL(n)||n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const t=n;return new TextEncoder().encode(t).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function _L(){var n;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(n=window.location)===null||n===void 0?void 0:n.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function wy(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(t+1):""}function Ry(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(0,t):""}function EL(){const n=[];for(let s=0;s<arguments.length;s++)n[s]=s<0||arguments.length<=s?void 0:arguments[s];let t="",e=!1,i;for(let s=n.length-1;s>=-1&&!e;s--){let r;s>=0?r=n[s]:(i===void 0&&(i=_L()),r=i),r.length!==0&&(t=`${r}/${t}`,e=r.charCodeAt(0)===Zo)}return t=yL(t,!e),e?`/${t}`:t.length>0?t:"."}const Zo=47,Nu=46;function yL(n,t){let e="",i=-1,s=0,r,o=!1;for(let a=0;a<=n.length;++a){if(a<n.length)r=n.charCodeAt(a);else{if(r===Zo)break;r=Zo}if(r===Zo){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(e.length<2||!o||e.charCodeAt(e.length-1)!==Nu||e.charCodeAt(e.length-2)!==Nu){if(e.length>2){const l=e.length-1;let c=l;for(;c>=0&&e.charCodeAt(c)!==Zo;--c);if(c!==l){e=c===-1?"":e.slice(0,c),i=a,s=0,o=!1;continue}}else if(e.length===2||e.length===1){e="",i=a,s=0,o=!1;continue}}t&&(e.length>0?e+="/..":e="..",o=!0)}else{const l=n.slice(i+1,a);e.length>0?e+=`/${l}`:e=l,o=!1}i=a,s=0}else r===Nu&&s!==-1?++s:s=-1}return e}const CL=n=>typeof n=="boolean",Aa=n=>typeof n=="function",Xa=n=>n!==null&&typeof n=="object",Mm=n=>Xa(n)&&n.constructor==={}.constructor,xL=n=>!!n&&typeof n[Symbol.iterator]=="function",vL=n=>n&&typeof n[Symbol.asyncIterator]=="function",gr=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,mr=n=>typeof Blob<"u"&&n instanceof Blob,BL=n=>n&&typeof n=="object"&&n.isBuffer,IL=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Xa(n)&&Aa(n.tee)&&Aa(n.cancel)&&Aa(n.getReader),bL=n=>Xa(n)&&Aa(n.read)&&Aa(n.pipe)&&CL(n.readable),Dy=n=>IL(n)||bL(n),ML=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,SL=/^([-\w.]+\/[-\w.+]+)/;function TL(n){const t=SL.exec(n);return t?t[1]:n}function Sm(n){const t=ML.exec(n);return t?t[1]:""}const Ly=/\?.*/;function wL(n){const t=n.match(Ly);return t&&t[0]}function BA(n){return n.replace(Ly,"")}function ph(n){return gr(n)?n.url:mr(n)?n.name||"":typeof n=="string"?n:""}function IA(n){if(gr(n)){const t=n,e=t.headers.get("content-type")||"",i=BA(t.url);return TL(e)||Sm(i)}return mr(n)?n.type||"":typeof n=="string"?Sm(n):""}function RL(n){return gr(n)?n.headers["content-length"]||-1:mr(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Py(n){if(gr(n))return n;const t={},e=RL(n);e>=0&&(t["content-length"]=String(e));const i=ph(n),s=IA(n);s&&(t["content-type"]=s);const r=await PL(n);r&&(t["x-first-bytes"]=r),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:t});return Object.defineProperty(o,"url",{value:i}),o}async function DL(n){if(!n.ok){const t=await LL(n);throw new Error(t)}}async function LL(n){let t=`Failed to fetch resource ${n.url} (${n.status}): `;try{const e=n.headers.get("Content-Type");let i=n.statusText;e!=null&&e.includes("application/json")&&(i+=` ${await n.text()}`),t+=i,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}async function PL(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(e=>{const i=new FileReader;i.onload=s=>{var r;return e(s==null||(r=s.target)===null||r===void 0?void 0:r.result)},i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${FL(t)}`}return null}function FL(n){let t="";const e=new Uint8Array(n);for(let i=0;i<e.byteLength;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function UL(n){return!NL(n)&&!OL(n)}function NL(n){return n.startsWith("http:")||n.startsWith("https:")}function OL(n){return n.startsWith("data:")}async function La(n,t){if(typeof n=="string"){const s=gL(n);if(UL(s)){var e;if((e=globalThis.loaders)!==null&&e!==void 0&&e.fetchNode){var i;return(i=globalThis.loaders)===null||i===void 0?void 0:i.fetchNode(s,t)}}return await fetch(s,t)}return await Py(n)}const Ou=globalThis,Ql=globalThis.process||{};function QL(n){var t,e;if(typeof window<"u"&&((t=window.process)==null?void 0:t.type)==="renderer"||typeof process<"u"&&(e=process.versions)!=null&&e.electron)return!0;const i=typeof navigator<"u"&&navigator.userAgent;return!!(i&&i.indexOf("Electron")>=0)}function bA(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||QL()}const Fy="4.0.7";function HL(n){try{const t=window[n],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class kL{constructor(t,e,i="sessionStorage"){this.storage=HL(i),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function VL(n){let t;return n<10?t=`${n.toFixed(2)}ms`:n<100?t=`${n.toFixed(1)}ms`:n<1e3?t=`${n.toFixed(0)}ms`:t=`${(n/1e3).toFixed(2)}s`,t}function zL(n,t=8){const e=Math.max(t-n.length,0);return`${" ".repeat(e)}${n}`}var Uc;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Uc||(Uc={}));const WL=10;function Tm(n){return typeof n!="string"?n:(n=n.toUpperCase(),Uc[n]||Uc.WHITE)}function JL(n,t,e){return!bA&&typeof n=="string"&&(t&&(n=`\x1B[${Tm(t)}m${n}\x1B[39m`),e&&(n=`\x1B[${Tm(e)+WL}m${n}\x1B[49m`)),n}function qL(n,t=["constructor"]){const e=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(e),s=n;for(const r of i){const o=s[r];typeof o=="function"&&(t.find(a=>r===a)||(s[r]=o.bind(n)))}}function MA(n,t){if(!n)throw new Error("Assertion failed")}function Ur(){var n,t,e;let i;if(bA()&&Ou.performance)i=(t=(n=Ou==null?void 0:Ou.performance)==null?void 0:n.now)==null?void 0:t.call(n);else if("hrtime"in Ql){const s=(e=Ql==null?void 0:Ql.hrtime)==null?void 0:e.call(Ql);i=s[0]*1e3+s[1]/1e6}else i=Date.now();return i}const Nr={debug:bA()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jL={enabled:!0,level:0};function Or(){}const wm={},Rm={once:!0};class gh{constructor({id:t}={id:""}){this.VERSION=Fy,this._startTs=Ur(),this._deltaTs=Ur(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new kL(`__probe-${this.id}__`,jL),this.timeStamp(`${this.id} started`),qL(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ur()-this._startTs).toPrecision(10))}getDelta(){return Number((Ur()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Nr.warn,arguments,Rm)}error(t){return this._getLogFunction(0,t,Nr.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Nr.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Nr.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Nr.debug||Nr.info,arguments,Rm)}table(t,e,i){return e?this._getLogFunction(t,e,console.table||Or,i&&[i],{tag:KL(e)}):Or}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Or)}group(t,e,i={collapsed:!1}){const s=Dm({logLevel:t,message:e,opts:i}),{collapsed:r}=i;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,e,i={}){return this.group(t,e,Object.assign({},i,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Or)}withGroup(t,e,i){this.group(t,e)();try{i()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Uy(t)}_getLogFunction(t,e,i,s,r){if(this._shouldLog(t)){r=Dm({logLevel:t,message:e,args:s,opts:r}),i=i||r.method,MA(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Ur();const o=r.tag||r.message;if(r.once&&o)if(!wm[o])wm[o]=Ur();else return Or;return e=XL(this.id,r.message,r),i.bind(console,e,...r.args)}return Or}}gh.VERSION=Fy;function Uy(n){if(!n)return 0;let t;switch(typeof n){case"number":t=n;break;case"object":t=n.logLevel||n.priority||0;break;default:return 0}return MA(Number.isFinite(t)&&t>=0),t}function Dm(n){const{logLevel:t,message:e}=n;n.logLevel=Uy(t);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&i.unshift(e),n.message=t;break;case"object":Object.assign(n,t);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return MA(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function XL(n,t,e){if(typeof t=="string"){const i=e.time?zL(VL(e.total)):"";t=e.time?`${n}: ${i}  ${t}`:`${n}: ${t}`,t=JL(t,e.color,e.background)}return t}function KL(n){for(const t in n)for(const e in n[t])return e||"untitled";return"empty"}globalThis.probe={};const Ny=new gh({id:"@probe.gl/log"}),Lm=new gh({id:"loaders.gl"});class YL{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class ZL{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.log.bind(this.console,...e)}info(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.info.bind(this.console,...e)}warn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.warn.bind(this.console,...e)}error(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.console.error.bind(this.console,...e)}}const Oy={fetch:null,mimeType:void 0,nothrow:!1,log:new ZL,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ah,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},$L={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Gy(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state=n._state||{},n._state}function Qy(){const n=Gy();return n.globalOptions=n.globalOptions||{...Oy},n.globalOptions}function tP(n,t,e,i){return e=e||[],e=Array.isArray(e)?e:[e],eP(n,e),iP(t,n,i)}function eP(n,t){Pm(n,null,Oy,$L,t);for(const e of t){const i=n&&n[e.id]||{},s=e.options&&e.options[e.id]||{},r=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};Pm(i,e.id,s,r,t)}}function Pm(n,t,e,i,s){const r=t||"Top level",o=t?`${t}.`:"";for(const a in n){const l=!t&&Xa(n[a]),c=a==="baseUri"&&!t,h=a==="workerUrl"&&t;if(!(a in e)&&!c&&!h){if(a in i)Lm.warn(`${r} loader option '${o}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const u=nP(a,s);Lm.warn(`${r} loader option '${o}${a}' not recognized. ${u}`)()}}}}function nP(n,t){const e=n.toLowerCase();let i="";for(const s of t)for(const r in s.options){if(n===r)return`Did you mean '${s.id}.${r}'?`;const o=r.toLowerCase();(e.startsWith(o)||o.startsWith(e))&&(i=i||`Did you mean '${s.id}.${r}'?`)}return i}function iP(n,t,e){const i={...n.options||{}};return sP(i,e),i.log===null&&(i.log=new YL),Fm(i,Qy()),Fm(i,t),i}function Fm(n,t){for(const e in t)if(e in t){const i=t[e];Mm(i)&&Mm(n[e])?n[e]={...n[e],...t[e]}:n[e]=t[e]}}function sP(n,t){t&&!("baseUri"in n)&&(n.baseUri=t)}function SA(n){var t;return n?(Array.isArray(n)&&(n=n[0]),Array.isArray((t=n)===null||t===void 0?void 0:t.extensions)):!1}function Hy(n){var t,e;Se(n,"null loader"),Se(SA(n),"invalid loader");let i;return Array.isArray(n)&&(i=n[1],n=n[0],n={...n,options:{...n.options,...i}}),((t=n)!==null&&t!==void 0&&t.parseTextSync||(e=n)!==null&&e!==void 0&&e.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const rP=()=>{const n=Gy();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function oP(){return rP()}const aP=new gh({id:"loaders.gl"}),lP=/\.([^.]+)$/;async function cP(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!ky(n))return null;let s=Um(n,t,{...e,nothrow:!0},i);if(s)return s;if(mr(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Um(n,t,e,i)),!s&&!(e!=null&&e.nothrow))throw new Error(Vy(n));return s}function Um(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!ky(n))return null;if(t&&!Array.isArray(t))return Hy(t);let s=[];t&&(s=s.concat(t)),e!=null&&e.ignoreRegisteredLoaders||s.push(...oP()),uP(s);const r=hP(n,s,e,i);if(!r&&!(e!=null&&e.nothrow))throw new Error(Vy(n));return r}function hP(n,t,e,i){const s=ph(n),r=IA(n),o=BA(s)||(i==null?void 0:i.url);let a=null,l="";if(e!=null&&e.mimeType&&(a=Gu(t,e==null?void 0:e.mimeType),l=`match forced by supplied MIME type ${e==null?void 0:e.mimeType}`),a=a||dP(t,o),l=l||(a?`matched url ${o}`:""),a=a||Gu(t,r),l=l||(a?`matched MIME type ${r}`:""),a=a||AP(t,n),l=l||(a?`matched initial data ${zy(n)}`:""),e!=null&&e.fallbackMimeType&&(a=a||Gu(t,e==null?void 0:e.fallbackMimeType),l=l||(a?`matched fallback MIME type ${r}`:"")),l){var c;aP.log(1,`selectLoader selected ${(c=a)===null||c===void 0?void 0:c.name}: ${l}.`)}return a}function ky(n){return!(n instanceof Response&&n.status===204)}function Vy(n){const t=ph(n),e=IA(n);let i="No valid loader found (";i+=t?`${wy(t)}, `:"no url provided, ",i+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const s=n?zy(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function uP(n){for(const t of n)Hy(t)}function dP(n,t){const e=t&&lP.exec(t),i=e&&e[1];return i?fP(n,i):null}function fP(n,t){t=t.toLowerCase();for(const e of n)for(const i of e.extensions)if(i.toLowerCase()===t)return e;return null}function Gu(n,t){for(const e of n)if(e.mimeTypes&&e.mimeTypes.includes(t)||t===`application/x.${e.id}`)return e;return null}function AP(n,t){if(!t)return null;for(const e of n)if(typeof t=="string"){if(pP(t,e))return e}else if(ArrayBuffer.isView(t)){if(Nm(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&Nm(t,0,e))return e;return null}function pP(n,t){return t.testText?t.testText(n):(Array.isArray(t.tests)?t.tests:[t.tests]).some(e=>n.startsWith(e))}function Nm(n,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>gP(n,t,e,i))}function gP(n,t,e,i){if(i instanceof ArrayBuffer)return hL(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=df(n,t,i.length);return i===s;default:return!1}}function zy(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?df(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?df(n,0,t):""}function df(n,t,e){if(n.byteLength<t+e)return"";const i=new DataView(n);let s="";for(let r=0;r<e;r++)s+=String.fromCharCode(i.getUint8(t+r));return s}const mP=256*1024;function*_P(n,t){const e=(t==null?void 0:t.chunkSize)||mP;let i=0;const s=new TextEncoder;for(;i<n.length;){const r=Math.min(n.length-i,e),o=n.slice(i,i+r);i+=r,yield s.encode(o)}}const EP=256*1024;function yP(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:e=EP}=t;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,e),r=new ArrayBuffer(s),o=new Uint8Array(n,i,s);new Uint8Array(r).set(o),i+=s,yield r}}()}const CP=1024*1024;async function*xP(n,t){const e=(t==null?void 0:t.chunkSize)||CP;let i=0;for(;i<n.size;){const s=i+e,r=await n.slice(i,s).arrayBuffer();i=s,yield r}}function Om(n,t){return Ah?vP(n,t):BP(n)}async function*vP(n,t){const e=n.getReader();let i;try{for(;;){const s=i||e.read();t!=null&&t._streamReadAhead&&(i=e.read());const{done:r,value:o}=await s;if(r)return;yield Ty(o)}}catch{e.releaseLock()}}async function*BP(n,t){for await(const e of n)yield Ty(e)}function IP(n,t){if(typeof n=="string")return _P(n,t);if(n instanceof ArrayBuffer)return yP(n,t);if(mr(n))return xP(n,t);if(Dy(n))return Om(n,t);if(gr(n))return Om(n.body,t);throw new Error("makeIterator")}const Wy="Cannot convert supplied data type";function bP(n,t,e){if(t.text&&typeof n=="string")return n;if(BL(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(Wy)}async function MP(n,t,e){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return bP(n,t);if(mr(n)&&(n=await Py(n)),gr(n)){const s=n;return await DL(s),t.binary?await s.arrayBuffer():await s.text()}if(Dy(n)&&(n=IP(n,e)),xL(n)||vL(n))return AL(n);throw new Error(Wy)}function Jy(n,t){const e=Qy(),i=n||e;return typeof i.fetch=="function"?i.fetch:Xa(i.fetch)?s=>La(s,i.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:La}function SP(n,t,e){if(e)return e;const i={fetch:Jy(t,n),...n};if(i.url){const s=BA(i.url);i.baseUrl=s,i.queryString=wL(i.url),i.filename=wy(s),i.baseUrl=Ry(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function TP(n,t){if(n&&!Array.isArray(n))return n;let e;if(n&&(e=Array.isArray(n)?n:[n]),t&&t.loaders){const i=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...i]:i}return e&&e.length?e:void 0}async function Nc(n,t,e,i){t&&!Array.isArray(t)&&!SA(t)&&(i=void 0,e=t,t=void 0),n=await n,e=e||{};const s=ph(n),r=TP(t,i),o=await cP(n,r,e);return o?(e=tP(e,o,r,s),i=SP({url:s,_parse:Nc,loaders:r},e,i||null),await wP(o,n,e,i)):null}async function wP(n,t,e,i){if(YD(n),e=QD(n.options,e),gr(t)){const r=t,{ok:o,redirected:a,status:l,statusText:c,type:h,url:u}=r,d=Object.fromEntries(r.headers.entries());i.response={headers:d,ok:o,redirected:a,status:l,statusText:c,type:h,url:u}}t=await MP(t,n,e);const s=n;if(s.parseTextSync&&typeof t=="string")return s.parseTextSync(t,e,i);if(rL(n,e))return await oL(n,t,e,i,Nc);if(s.parseText&&typeof t=="string")return await s.parseText(t,e,i);if(s.parse)return await s.parse(t,e,i);throw as(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}function RP(n){switch(n.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function DP(n){let t=1/0,e=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;const a=n.POSITION?n.POSITION.value:[],l=a&&a.length;for(let c=0;c<l;c+=3){const h=a[c],u=a[c+1],d=a[c+2];t=h<t?h:t,e=u<e?u:e,i=d<i?d:i,s=h>s?h:s,r=u>r?u:r,o=d>o?d:o}return[[t,e,i],[s,r,o]]}function LP(n,t,e){const i=RP(t.value),s=e||PP(t);return{name:n,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:i}]},nullable:!1,metadata:s}}function PP(n){const t={};return"byteOffset"in n&&(t.byteOffset=n.byteOffset.toString(10)),"byteStride"in n&&(t.byteStride=n.byteStride.toString(10)),"normalized"in n&&(t.normalized=n.normalized.toString()),t}async function po(n,t,e,i){let s,r;!Array.isArray(t)&&!SA(t)?(s=[],r=t):(s=t,r=e);const o=Jy(r);let a=n;return typeof n=="string"&&(a=await o(n)),mr(n)&&(a=await o(n)),Array.isArray(s)?await Nc(a,s,r):await Nc(a,s,r)}const FP=1/Math.PI*180,UP=1/180*Math.PI,NP={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...NP}};const He=globalThis.mathgl.config;function OP(n,{precision:t=He.precision}={}){return n=VP(n),"".concat(parseFloat(n.toPrecision(t)))}function fr(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function GP(n){return HP(n)}function QP(n){return ei(n)}function HP(n,t){return TA(n,e=>e*UP,t)}function ei(n,t){return TA(n,e=>e*FP,t)}function kP(n,t,e){return TA(n,i=>Math.max(t,Math.min(e,i)))}function Ts(n,t,e){const i=He.EPSILON;e&&(He.EPSILON=e);try{if(n===t)return!0;if(fr(n)&&fr(t)){if(n.length!==t.length)return!1;for(let s=0;s<n.length;++s)if(!Ts(n[s],t[s]))return!1;return!0}return n&&n.equals?n.equals(t):t&&t.equals?t.equals(n):typeof n=="number"&&typeof t=="number"?Math.abs(n-t)<=He.EPSILON*Math.max(1,Math.abs(n),Math.abs(t)):!1}finally{He.EPSILON=i}}function VP(n){return Math.round(n/He.EPSILON)*He.EPSILON}function zP(n){return n.clone?n.clone():new Array(n.length)}function TA(n,t,e){if(fr(n)){const i=n;e=e||zP(i);for(let s=0;s<e.length&&s<i.length;++s){const r=typeof n=="number"?n:n[s];e[s]=t(r,s,e)}return e}return t(n)}function WP(n){function t(){var e=Reflect.construct(n,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return t.prototype=Object.create(n.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n,t}class wA extends WP(Array){clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=t[i+e];return this.check()}toArray(t=[],e=0){for(let i=0;i<this.ELEMENTS;++i)t[e+i]=this[i];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:fr(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(He)}formatString(t){let e="";for(let i=0;i<this.ELEMENTS;++i)e+=(i>0?", ":"")+OP(this[i],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Ts(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,i){if(i===void 0)return this.lerp(this,t,e);for(let s=0;s<this.ELEMENTS;++s){const r=t[s],o=typeof e=="number"?e:e[s];this[s]=r+i*(o-r)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t[i]),e[i]);return this.check()}add(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]+=e[i];return this.check()}subtract(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]-=e[i];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(He.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],t),e);return this.check()}get elements(){return this}}function JP(n,t){if(n.length!==t)return!1;for(let e=0;e<n.length;++e)if(!Number.isFinite(n[e]))return!1;return!0}function re(n){if(!Number.isFinite(n))throw new Error("Invalid number ".concat(JSON.stringify(n)));return n}function pa(n,t,e=""){if(He.debug&&!JP(n,t))throw new Error("math.gl: ".concat(e," some fields set to invalid numbers'"));return n}function be(n,t){if(!n)throw new Error("math.gl assertion ".concat(t))}class RA extends wA{get x(){return this[0]}set x(t){this[0]=re(t)}get y(){return this[1]}set y(t){this[1]=re(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-t[i];e+=s*s}return re(e)}dot(t){let e=0;for(let i=0;i<this.ELEMENTS;++i)e+=this[i]*t[i];return re(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]*=e[i];return this.check()}divide(...t){for(const e of t)for(let i=0;i<this.ELEMENTS;++i)this[i]/=e[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return be(t>=0&&t<this.ELEMENTS,"index is out of range"),re(this[t])}setComponent(t,e){return be(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}const ga=1e-6;let fi=typeof Float32Array<"u"?Float32Array:Array;function qP(){const n=new fi(2);return fi!=Float32Array&&(n[0]=0,n[1]=0),n}function jP(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[2]*s,n[1]=e[1]*i+e[3]*s,n}function XP(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[2]*s+e[4],n[1]=e[1]*i+e[3]*s+e[5],n}function qy(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[3]*s+e[6],n[1]=e[1]*i+e[4]*s+e[7],n}function jy(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[4]*s+e[12],n[1]=e[1]*i+e[5]*s+e[13],n}(function(){const n=qP();return function(t,e,i,s,r,o){let a,l;for(e||(e=2),i||(i=0),s?l=Math.min(s*e+i,t.length):l=t.length,a=i;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],r(n,n,o),t[a]=n[0],t[a+1]=n[1];return t}})();function Xy(n,t,e){const i=t[0],s=t[1],r=e[3]*i+e[7]*s||1;return n[0]=(e[0]*i+e[4]*s)/r,n[1]=(e[1]*i+e[5]*s)/r,n}function Ky(n,t,e){const i=t[0],s=t[1],r=t[2],o=e[3]*i+e[7]*s+e[11]*r||1;return n[0]=(e[0]*i+e[4]*s+e[8]*r)/o,n[1]=(e[1]*i+e[5]*s+e[9]*r)/o,n[2]=(e[2]*i+e[6]*s+e[10]*r)/o,n}function KP(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[2]*s,n[1]=e[1]*i+e[3]*s,n[2]=t[2],n}function YP(n,t,e){const i=t[0],s=t[1];return n[0]=e[0]*i+e[2]*s,n[1]=e[1]*i+e[3]*s,n[2]=t[2],n[3]=t[3],n}function Yy(n,t,e){const i=t[0],s=t[1],r=t[2];return n[0]=e[0]*i+e[3]*s+e[6]*r,n[1]=e[1]*i+e[4]*s+e[7]*r,n[2]=e[2]*i+e[5]*s+e[8]*r,n[3]=t[3],n}class mh extends RA{constructor(t=0,e=0){super(2),fr(t)&&arguments.length===1?this.copy(t):(He.debug&&(re(t),re(e)),this[0]=t,this[1]=e)}set(t,e){return this[0]=t,this[1]=e,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return He.debug&&(re(t.x),re(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return jy(this,this,t),this.check()}transformAsVector(t){return Xy(this,this,t),this.check()}transformByMatrix3(t){return qy(this,this,t),this.check()}transformByMatrix2x3(t){return XP(this,this,t),this.check()}transformByMatrix2(t){return jP(this,this,t),this.check()}}function Zy(){const n=new fi(3);return fi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function $y(n){const t=n[0],e=n[1],i=n[2];return Math.sqrt(t*t+e*e+i*i)}function Gm(n,t,e){const i=new fi(3);return i[0]=n,i[1]=t,i[2]=e,i}function ZP(n,t){const e=t[0],i=t[1],s=t[2];let r=e*e+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n}function DA(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ac(n,t,e){const i=t[0],s=t[1],r=t[2],o=e[0],a=e[1],l=e[2];return n[0]=s*l-r*a,n[1]=r*o-i*l,n[2]=i*a-s*o,n}function LA(n,t,e){const i=t[0],s=t[1],r=t[2];let o=e[3]*i+e[7]*s+e[11]*r+e[15];return o=o||1,n[0]=(e[0]*i+e[4]*s+e[8]*r+e[12])/o,n[1]=(e[1]*i+e[5]*s+e[9]*r+e[13])/o,n[2]=(e[2]*i+e[6]*s+e[10]*r+e[14])/o,n}function tC(n,t,e){const i=t[0],s=t[1],r=t[2];return n[0]=i*e[0]+s*e[3]+r*e[6],n[1]=i*e[1]+s*e[4]+r*e[7],n[2]=i*e[2]+s*e[5]+r*e[8],n}function eC(n,t,e){const i=e[0],s=e[1],r=e[2],o=e[3],a=t[0],l=t[1],c=t[2];let h=s*c-r*l,u=r*a-i*c,d=i*l-s*a,f=s*d-r*u,p=r*h-i*d,m=i*u-s*h;const g=o*2;return h*=g,u*=g,d*=g,f*=2,p*=2,m*=2,n[0]=a+h+f,n[1]=l+u+p,n[2]=c+d+m,n}function $P(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0],r[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),r[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function tF(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),r[1]=s[1],r[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function eF(n,t,e,i){const s=[],r=[];return s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],r[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),r[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),r[2]=s[2],n[0]=r[0]+e[0],n[1]=r[1]+e[1],n[2]=r[2]+e[2],n}function nF(n,t){const e=n[0],i=n[1],s=n[2],r=t[0],o=t[1],a=t[2],l=Math.sqrt((e*e+i*i+s*s)*(r*r+o*o+a*a)),c=l&&DA(n,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const iF=$y;(function(){const n=Zy();return function(t,e,i,s,r,o){let a,l;for(e||(e=3),i||(i=0),s?l=Math.min(s*e+i,t.length):l=t.length,a=i;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],r(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2];return t}})();const Qu=[0,0,0];let Hl;class q extends RA{static get ZERO(){return Hl||(Hl=new q(0,0,0),Object.freeze(Hl)),Hl}constructor(t=0,e=0,i=0){super(-0,-0,-0),arguments.length===1&&fr(t)?this.copy(t):(He.debug&&(re(t),re(e),re(i)),this[0]=t,this[1]=e,this[2]=i)}set(t,e,i){return this[0]=t,this[1]=e,this[2]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return He.debug&&(re(t.x),re(t.y),re(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=re(t)}angle(t){return nF(this,t)}cross(t){return Ac(this,this,t),this.check()}rotateX({radians:t,origin:e=Qu}){return $P(this,this,e,t),this.check()}rotateY({radians:t,origin:e=Qu}){return tF(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=Qu}){return eF(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return LA(this,this,t),this.check()}transformAsVector(t){return Ky(this,this,t),this.check()}transformByMatrix3(t){return tC(this,this,t),this.check()}transformByMatrix2(t){return KP(this,this,t),this.check()}transformByQuaternion(t){return eC(this,this,t),this.check()}}let kl;class PA extends RA{static get ZERO(){return kl||(kl=new PA(0,0,0,0),Object.freeze(kl)),kl}constructor(t=0,e=0,i=0,s=0){super(-0,-0,-0,-0),fr(t)&&arguments.length===1?this.copy(t):(He.debug&&(re(t),re(e),re(i),re(s)),this[0]=t,this[1]=e,this[2]=i,this[3]=s)}set(t,e,i,s){return this[0]=t,this[1]=e,this[2]=i,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return He.debug&&(re(t.x),re(t.y),re(t.z),re(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=re(t)}get w(){return this[3]}set w(t){this[3]=re(t)}transform(t){return LA(this,this,t),this.check()}transformByMatrix3(t){return Yy(this,this,t),this.check()}transformByMatrix2(t){return YP(this,this,t),this.check()}transformByQuaternion(t){return eC(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class nC extends wA{toString(){let t="[";if(He.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let i=0;i<this.RANK;++i)t+=" ".concat(this[i*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,i){return this[e*this.RANK+t]=re(i),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)e[s]=this[i+s];return e}setColumn(t,e){const i=t*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=e[s];return this}}function sF(){const n=new fi(9);return fi!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function rF(n,t){if(n===t){const e=t[1],i=t[2],s=t[5];n[1]=t[3],n[2]=t[6],n[3]=e,n[5]=t[7],n[6]=i,n[7]=s}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n}function oF(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=h*o-a*c,d=-h*r+a*l,f=c*r-o*l;let p=e*u+i*d+s*f;return p?(p=1/p,n[0]=u*p,n[1]=(-h*i+s*c)*p,n[2]=(a*i-s*o)*p,n[3]=d*p,n[4]=(h*e-s*l)*p,n[5]=(-a*e+s*r)*p,n[6]=f*p,n[7]=(-c*e+i*l)*p,n[8]=(o*e-i*r)*p,n):null}function aF(n){const t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],o=n[5],a=n[6],l=n[7],c=n[8];return t*(c*r-o*l)+e*(-c*s+o*a)+i*(l*s-r*a)}function Qm(n,t,e){const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=e[0],f=e[1],p=e[2],m=e[3],g=e[4],A=e[5],C=e[6],E=e[7],_=e[8];return n[0]=d*i+f*o+p*c,n[1]=d*s+f*a+p*h,n[2]=d*r+f*l+p*u,n[3]=m*i+g*o+A*c,n[4]=m*s+g*a+A*h,n[5]=m*r+g*l+A*u,n[6]=C*i+E*o+_*c,n[7]=C*s+E*a+_*h,n[8]=C*r+E*l+_*u,n}function lF(n,t,e){const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=e[0],f=e[1];return n[0]=i,n[1]=s,n[2]=r,n[3]=o,n[4]=a,n[5]=l,n[6]=d*i+f*o+c,n[7]=d*s+f*a+h,n[8]=d*r+f*l+u,n}function cF(n,t,e){const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=Math.sin(e),f=Math.cos(e);return n[0]=f*i+d*o,n[1]=f*s+d*a,n[2]=f*r+d*l,n[3]=f*o-d*i,n[4]=f*a-d*s,n[5]=f*l-d*r,n[6]=c,n[7]=h,n[8]=u,n}function Hm(n,t,e){const i=e[0],s=e[1];return n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n[3]=s*t[3],n[4]=s*t[4],n[5]=s*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function hF(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],o=e+e,a=i+i,l=s+s,c=e*o,h=i*o,u=i*a,d=s*o,f=s*a,p=s*l,m=r*o,g=r*a,A=r*l;return n[0]=1-u-p,n[3]=h-A,n[6]=d+g,n[1]=h+A,n[4]=1-c-p,n[7]=f-m,n[2]=d-g,n[5]=f+m,n[8]=1-c-u,n}var ff;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(ff||(ff={}));const uF=Object.freeze([1,0,0,0,1,0,0,0,1]);class Re extends nC{static get IDENTITY(){return fF()}static get ZERO(){return dF()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return ff}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(uF)}fromObject(t){return this.check()}fromQuaternion(t){return hF(this,t),this.check()}set(t,e,i,s,r,o,a,l,c){return this[0]=t,this[1]=e,this[2]=i,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this.check()}setRowMajor(t,e,i,s,r,o,a,l,c){return this[0]=t,this[1]=s,this[2]=a,this[3]=e,this[4]=r,this[5]=l,this[6]=i,this[7]=o,this[8]=c,this.check()}determinant(){return aF(this)}transpose(){return rF(this,this),this.check()}invert(){return oF(this,this),this.check()}multiplyLeft(t){return Qm(this,t,this),this.check()}multiplyRight(t){return Qm(this,this,t),this.check()}rotate(t){return cF(this,this,t),this.check()}scale(t){return Array.isArray(t)?Hm(this,this,t):Hm(this,this,[t,t]),this.check()}translate(t){return lF(this,this,t),this.check()}transform(t,e){let i;switch(t.length){case 2:i=qy(e||[-0,-0],t,this);break;case 3:i=tC(e||[-0,-0,-0],t,this);break;case 4:i=Yy(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return pa(i,t.length),i}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let Vl,zl=null;function dF(){return Vl||(Vl=new Re([0,0,0,0,0,0,0,0,0]),Object.freeze(Vl)),Vl}function fF(){return zl||(zl=new Re,Object.freeze(zl)),zl}function AF(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function pF(n,t){if(n===t){const e=t[1],i=t[2],s=t[3],r=t[6],o=t[7],a=t[11];n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=e,n[6]=t[9],n[7]=t[13],n[8]=i,n[9]=r,n[11]=t[14],n[12]=s,n[13]=o,n[14]=a}else n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15];return n}function gF(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],f=t[11],p=t[12],m=t[13],g=t[14],A=t[15],C=e*a-i*o,E=e*l-s*o,_=e*c-r*o,T=i*l-s*a,M=i*c-r*a,S=s*c-r*l,R=h*m-u*p,B=h*g-d*p,x=h*A-f*p,D=u*g-d*m,V=u*A-f*m,Q=d*A-f*g;let k=C*Q-E*V+_*D+T*x-M*B+S*R;return k?(k=1/k,n[0]=(a*Q-l*V+c*D)*k,n[1]=(s*V-i*Q-r*D)*k,n[2]=(m*S-g*M+A*T)*k,n[3]=(d*M-u*S-f*T)*k,n[4]=(l*x-o*Q-c*B)*k,n[5]=(e*Q-s*x+r*B)*k,n[6]=(g*_-p*S-A*E)*k,n[7]=(h*S-d*_+f*E)*k,n[8]=(o*V-a*x+c*R)*k,n[9]=(i*x-e*V-r*R)*k,n[10]=(p*M-m*_+A*C)*k,n[11]=(u*_-h*M-f*C)*k,n[12]=(a*B-o*D-l*R)*k,n[13]=(e*D-i*B+s*R)*k,n[14]=(m*E-p*T-g*C)*k,n[15]=(h*T-u*E+d*C)*k,n):null}function mF(n){const t=n[0],e=n[1],i=n[2],s=n[3],r=n[4],o=n[5],a=n[6],l=n[7],c=n[8],h=n[9],u=n[10],d=n[11],f=n[12],p=n[13],m=n[14],g=n[15],A=t*o-e*r,C=t*a-i*r,E=e*a-i*o,_=c*p-h*f,T=c*m-u*f,M=h*m-u*p,S=t*M-e*T+i*_,R=r*M-o*T+a*_,B=c*E-h*C+u*A,x=f*E-p*C+m*A;return l*S-s*R+g*B-d*x}function km(n,t,e){const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],f=t[10],p=t[11],m=t[12],g=t[13],A=t[14],C=t[15];let E=e[0],_=e[1],T=e[2],M=e[3];return n[0]=E*i+_*a+T*u+M*m,n[1]=E*s+_*l+T*d+M*g,n[2]=E*r+_*c+T*f+M*A,n[3]=E*o+_*h+T*p+M*C,E=e[4],_=e[5],T=e[6],M=e[7],n[4]=E*i+_*a+T*u+M*m,n[5]=E*s+_*l+T*d+M*g,n[6]=E*r+_*c+T*f+M*A,n[7]=E*o+_*h+T*p+M*C,E=e[8],_=e[9],T=e[10],M=e[11],n[8]=E*i+_*a+T*u+M*m,n[9]=E*s+_*l+T*d+M*g,n[10]=E*r+_*c+T*f+M*A,n[11]=E*o+_*h+T*p+M*C,E=e[12],_=e[13],T=e[14],M=e[15],n[12]=E*i+_*a+T*u+M*m,n[13]=E*s+_*l+T*d+M*g,n[14]=E*r+_*c+T*f+M*A,n[15]=E*o+_*h+T*p+M*C,n}function _F(n,t,e){const i=e[0],s=e[1],r=e[2];let o,a,l,c,h,u,d,f,p,m,g,A;return t===n?(n[12]=t[0]*i+t[4]*s+t[8]*r+t[12],n[13]=t[1]*i+t[5]*s+t[9]*r+t[13],n[14]=t[2]*i+t[6]*s+t[10]*r+t[14],n[15]=t[3]*i+t[7]*s+t[11]*r+t[15]):(o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],u=t[5],d=t[6],f=t[7],p=t[8],m=t[9],g=t[10],A=t[11],n[0]=o,n[1]=a,n[2]=l,n[3]=c,n[4]=h,n[5]=u,n[6]=d,n[7]=f,n[8]=p,n[9]=m,n[10]=g,n[11]=A,n[12]=o*i+h*s+p*r+t[12],n[13]=a*i+u*s+m*r+t[13],n[14]=l*i+d*s+g*r+t[14],n[15]=c*i+f*s+A*r+t[15]),n}function EF(n,t,e){const i=e[0],s=e[1],r=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*s,n[5]=t[5]*s,n[6]=t[6]*s,n[7]=t[7]*s,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function yF(n,t,e,i){let s=i[0],r=i[1],o=i[2],a=Math.sqrt(s*s+r*r+o*o),l,c,h,u,d,f,p,m,g,A,C,E,_,T,M,S,R,B,x,D,V,Q,k,et;return a<ga?null:(a=1/a,s*=a,r*=a,o*=a,c=Math.sin(e),l=Math.cos(e),h=1-l,u=t[0],d=t[1],f=t[2],p=t[3],m=t[4],g=t[5],A=t[6],C=t[7],E=t[8],_=t[9],T=t[10],M=t[11],S=s*s*h+l,R=r*s*h+o*c,B=o*s*h-r*c,x=s*r*h-o*c,D=r*r*h+l,V=o*r*h+s*c,Q=s*o*h+r*c,k=r*o*h-s*c,et=o*o*h+l,n[0]=u*S+m*R+E*B,n[1]=d*S+g*R+_*B,n[2]=f*S+A*R+T*B,n[3]=p*S+C*R+M*B,n[4]=u*x+m*D+E*V,n[5]=d*x+g*D+_*V,n[6]=f*x+A*D+T*V,n[7]=p*x+C*D+M*V,n[8]=u*Q+m*k+E*et,n[9]=d*Q+g*k+_*et,n[10]=f*Q+A*k+T*et,n[11]=p*Q+C*k+M*et,t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n)}function CF(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=r*s+c*i,n[5]=o*s+h*i,n[6]=a*s+u*i,n[7]=l*s+d*i,n[8]=c*s-r*i,n[9]=h*s-o*i,n[10]=u*s-a*i,n[11]=d*s-l*i,n}function xF(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],u=t[10],d=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*s-c*i,n[1]=o*s-h*i,n[2]=a*s-u*i,n[3]=l*s-d*i,n[8]=r*i+c*s,n[9]=o*i+h*s,n[10]=a*i+u*s,n[11]=l*i+d*s,n}function vF(n,t,e){const i=Math.sin(e),s=Math.cos(e),r=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=r*s+c*i,n[1]=o*s+h*i,n[2]=a*s+u*i,n[3]=l*s+d*i,n[4]=c*s-r*i,n[5]=h*s-o*i,n[6]=u*s-a*i,n[7]=d*s-l*i,n}function BF(n,t){const e=t[0],i=t[1],s=t[2],r=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return n[0]=Math.sqrt(e*e+i*i+s*s),n[1]=Math.sqrt(r*r+o*o+a*a),n[2]=Math.sqrt(l*l+c*c+h*h),n}function IF(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],o=e+e,a=i+i,l=s+s,c=e*o,h=i*o,u=i*a,d=s*o,f=s*a,p=s*l,m=r*o,g=r*a,A=r*l;return n[0]=1-u-p,n[1]=h+A,n[2]=d-g,n[3]=0,n[4]=h-A,n[5]=1-c-p,n[6]=f+m,n[7]=0,n[8]=d+g,n[9]=f-m,n[10]=1-c-u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function bF(n,t,e,i,s,r,o){const a=1/(e-t),l=1/(s-i),c=1/(r-o);return n[0]=r*2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r*2*l,n[6]=0,n[7]=0,n[8]=(e+t)*a,n[9]=(s+i)*l,n[10]=(o+r)*c,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*r*2*c,n[15]=0,n}function MF(n,t,e,i,s){const r=1/Math.tan(t/2);if(n[0]=r/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const o=1/(i-s);n[10]=(s+i)*o,n[14]=2*s*i*o}else n[10]=-1,n[14]=-2*i;return n}const SF=MF;function TF(n,t,e,i,s,r,o){const a=1/(t-e),l=1/(i-s),c=1/(r-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*c,n[11]=0,n[12]=(t+e)*a,n[13]=(s+i)*l,n[14]=(o+r)*c,n[15]=1,n}const wF=TF;function RF(n,t,e,i){let s,r,o,a,l,c,h,u,d,f;const p=t[0],m=t[1],g=t[2],A=i[0],C=i[1],E=i[2],_=e[0],T=e[1],M=e[2];return Math.abs(p-_)<ga&&Math.abs(m-T)<ga&&Math.abs(g-M)<ga?AF(n):(u=p-_,d=m-T,f=g-M,s=1/Math.sqrt(u*u+d*d+f*f),u*=s,d*=s,f*=s,r=C*f-E*d,o=E*u-A*f,a=A*d-C*u,s=Math.sqrt(r*r+o*o+a*a),s?(s=1/s,r*=s,o*=s,a*=s):(r=0,o=0,a=0),l=d*a-f*o,c=f*r-u*a,h=u*o-d*r,s=Math.sqrt(l*l+c*c+h*h),s?(s=1/s,l*=s,c*=s,h*=s):(l=0,c=0,h=0),n[0]=r,n[1]=l,n[2]=u,n[3]=0,n[4]=o,n[5]=c,n[6]=d,n[7]=0,n[8]=a,n[9]=h,n[10]=f,n[11]=0,n[12]=-(r*p+o*m+a*g),n[13]=-(l*p+c*m+h*g),n[14]=-(u*p+d*m+f*g),n[15]=1,n)}function DF(){const n=new fi(4);return fi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function LF(n,t,e){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n}function PF(n,t,e){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n}function FF(n){const t=n[0],e=n[1],i=n[2],s=n[3];return Math.sqrt(t*t+e*e+i*i+s*s)}function UF(n){const t=n[0],e=n[1],i=n[2],s=n[3];return t*t+e*e+i*i+s*s}function NF(n,t){const e=t[0],i=t[1],s=t[2],r=t[3];let o=e*e+i*i+s*s+r*r;return o>0&&(o=1/Math.sqrt(o)),n[0]=e*o,n[1]=i*o,n[2]=s*o,n[3]=r*o,n}function OF(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]*t[3]}function GF(n,t,e,i){const s=t[0],r=t[1],o=t[2],a=t[3];return n[0]=s+i*(e[0]-s),n[1]=r+i*(e[1]-r),n[2]=o+i*(e[2]-o),n[3]=a+i*(e[3]-a),n}function QF(n,t,e){const i=t[0],s=t[1],r=t[2],o=t[3];return n[0]=e[0]*i+e[4]*s+e[8]*r+e[12]*o,n[1]=e[1]*i+e[5]*s+e[9]*r+e[13]*o,n[2]=e[2]*i+e[6]*s+e[10]*r+e[14]*o,n[3]=e[3]*i+e[7]*s+e[11]*r+e[15]*o,n}function HF(n,t,e){const i=t[0],s=t[1],r=t[2],o=e[0],a=e[1],l=e[2],c=e[3],h=c*i+a*r-l*s,u=c*s+l*i-o*r,d=c*r+o*s-a*i,f=-o*i-a*s-l*r;return n[0]=h*c+f*-o+u*-l-d*-a,n[1]=u*c+f*-a+d*-o-h*-l,n[2]=d*c+f*-l+h*-a-u*-o,n[3]=t[3],n}(function(){const n=DF();return function(t,e,i,s,r,o){let a,l;for(e||(e=4),i||(i=0),s?l=Math.min(s*e+i,t.length):l=t.length,a=i;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],n[2]=t[a+2],n[3]=t[a+3],r(n,n,o),t[a]=n[0],t[a+1]=n[1],t[a+2]=n[2],t[a+3]=n[3];return t}})();var Af;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Af||(Af={}));const kF=45*Math.PI/180,VF=1,Hu=.1,ku=500,zF=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ye extends nC{static get IDENTITY(){return JF()}static get ZERO(){return WF()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Af}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,i,s,r,o,a,l,c,h,u,d,f,p,m,g){return this[0]=t,this[1]=e,this[2]=i,this[3]=s,this[4]=r,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=h,this[10]=u,this[11]=d,this[12]=f,this[13]=p,this[14]=m,this[15]=g,this.check()}setRowMajor(t,e,i,s,r,o,a,l,c,h,u,d,f,p,m,g){return this[0]=t,this[1]=r,this[2]=c,this[3]=f,this[4]=e,this[5]=o,this[6]=h,this[7]=p,this[8]=i,this[9]=a,this[10]=u,this[11]=m,this[12]=s,this[13]=l,this[14]=d,this[15]=g,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(zF)}fromObject(t){return this.check()}fromQuaternion(t){return IF(this,t),this.check()}frustum(t){const{left:e,right:i,bottom:s,top:r,near:o=Hu,far:a=ku}=t;return a===1/0?qF(this,e,i,s,r,o):bF(this,e,i,s,r,o,a),this.check()}lookAt(t){const{eye:e,center:i=[0,0,0],up:s=[0,1,0]}=t;return RF(this,e,i,s),this.check()}ortho(t){const{left:e,right:i,bottom:s,top:r,near:o=Hu,far:a=ku}=t;return wF(this,e,i,s,r,o,a),this.check()}orthographic(t){const{fovy:e=kF,aspect:i=VF,focalDistance:s=1,near:r=Hu,far:o=ku}=t;Vm(e);const a=e/2,l=s*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:r,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:i=1,near:s=.1,far:r=500}=t;return Vm(e),SF(this,e,i,s,r),this.check()}determinant(){return mF(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),s=1/i[0],r=1/i[1],o=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*r,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*r,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const i=this.getScale(e),s=1/i[0],r=1/i[1],o=1/i[2];return t[0]=this[0]*s,t[1]=this[1]*r,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*r,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*r,t[8]=this[10]*o,t}transpose(){return pF(this,this),this.check()}invert(){return gF(this,this),this.check()}multiplyLeft(t){return km(this,t,this),this.check()}multiplyRight(t){return km(this,this,t),this.check()}rotateX(t){return CF(this,this,t),this.check()}rotateY(t){return xF(this,this,t),this.check()}rotateZ(t){return vF(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return yF(this,this,t,e),this.check()}scale(t){return EF(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return _F(this,this,t),this.check()}transform(t,e){return t.length===4?(e=QF(e||[-0,-0,-0,-0],t,this),pa(e,4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:i}=t;let s;switch(i){case 2:s=jy(e||[-0,-0],t,this);break;case 3:s=LA(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return pa(s,t.length),s}transformAsVector(t,e){let i;switch(t.length){case 2:i=Xy(e||[-0,-0],t,this);break;case 3:i=Ky(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return pa(i,t.length),i}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,i){return this.identity().translate([t,e,i])}}let Wl,Jl;function WF(){return Wl||(Wl=new ye([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Wl)),Wl}function JF(){return Jl||(Jl=new ye,Object.freeze(Jl)),Jl}function Vm(n){if(n>Math.PI*2)throw Error("expected radians")}function qF(n,t,e,i,s,r){const o=2*r/(e-t),a=2*r/(s-i),l=(e+t)/(e-t),c=(s+i)/(s-i),h=-1,u=-1,d=-2*r;return n[0]=o,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=l,n[9]=c,n[10]=h,n[11]=u,n[12]=0,n[13]=0,n[14]=d,n[15]=0,n}function zm(){const n=new fi(4);return fi!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function jF(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function iC(n,t,e){e=e*.5;const i=Math.sin(e);return n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n[3]=Math.cos(e),n}function Wm(n,t,e){const i=t[0],s=t[1],r=t[2],o=t[3],a=e[0],l=e[1],c=e[2],h=e[3];return n[0]=i*h+o*a+s*c-r*l,n[1]=s*h+o*l+r*a-i*c,n[2]=r*h+o*c+i*l-s*a,n[3]=o*h-i*a-s*l-r*c,n}function XF(n,t,e){e*=.5;const i=t[0],s=t[1],r=t[2],o=t[3],a=Math.sin(e),l=Math.cos(e);return n[0]=i*l+o*a,n[1]=s*l+r*a,n[2]=r*l-s*a,n[3]=o*l-i*a,n}function KF(n,t,e){e*=.5;const i=t[0],s=t[1],r=t[2],o=t[3],a=Math.sin(e),l=Math.cos(e);return n[0]=i*l-r*a,n[1]=s*l+o*a,n[2]=r*l+i*a,n[3]=o*l-s*a,n}function YF(n,t,e){e*=.5;const i=t[0],s=t[1],r=t[2],o=t[3],a=Math.sin(e),l=Math.cos(e);return n[0]=i*l+s*a,n[1]=s*l-i*a,n[2]=r*l+o*a,n[3]=o*l-r*a,n}function ZF(n,t){const e=t[0],i=t[1],s=t[2];return n[0]=e,n[1]=i,n[2]=s,n[3]=Math.sqrt(Math.abs(1-e*e-i*i-s*s)),n}function pc(n,t,e,i){const s=t[0],r=t[1],o=t[2],a=t[3];let l=e[0],c=e[1],h=e[2],u=e[3],d,f,p,m,g;return d=s*l+r*c+o*h+a*u,d<0&&(d=-d,l=-l,c=-c,h=-h,u=-u),1-d>ga?(f=Math.acos(d),g=Math.sin(f),p=Math.sin((1-i)*f)/g,m=Math.sin(i*f)/g):(p=1-i,m=i),n[0]=p*s+m*l,n[1]=p*r+m*c,n[2]=p*o+m*h,n[3]=p*a+m*u,n}function $F(n,t){const e=t[0],i=t[1],s=t[2],r=t[3],o=e*e+i*i+s*s+r*r,a=o?1/o:0;return n[0]=-e*a,n[1]=-i*a,n[2]=-s*a,n[3]=r*a,n}function tU(n,t){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n}function sC(n,t){const e=t[0]+t[4]+t[8];let i;if(e>0)i=Math.sqrt(e+1),n[3]=.5*i,i=.5/i,n[0]=(t[5]-t[7])*i,n[1]=(t[6]-t[2])*i,n[2]=(t[1]-t[3])*i;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);const r=(s+1)%3,o=(s+2)%3;i=Math.sqrt(t[s*3+s]-t[r*3+r]-t[o*3+o]+1),n[s]=.5*i,i=.5/i,n[3]=(t[r*3+o]-t[o*3+r])*i,n[r]=(t[r*3+s]+t[s*3+r])*i,n[o]=(t[o*3+s]+t[s*3+o])*i}return n}const eU=LF,nU=PF,iU=OF,sU=GF,rU=FF,oU=UF,rC=NF,aU=function(){const n=Zy(),t=Gm(1,0,0),e=Gm(0,1,0);return function(i,s,r){const o=DA(s,r);return o<-.999999?(Ac(n,t,s),iF(n)<1e-6&&Ac(n,e,s),ZP(n,n),iC(i,n,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Ac(n,s,r),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+o,rC(i,i))}}();(function(){const n=zm(),t=zm();return function(e,i,s,r,o,a){return pc(n,i,o,a),pc(t,s,r,a),pc(e,n,t,2*a*(1-a)),e}})();(function(){const n=sF();return function(t,e,i,s){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=s[0],n[4]=s[1],n[7]=s[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],rC(t,sC(t,n))}})();const lU=[0,0,0,1];class Oc extends wA{constructor(t=0,e=0,i=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,e,i,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,i,s){return this[0]=t,this[1]=e,this[2]=i,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return sC(this,t),this.check()}fromAxisRotation(t,e){return iC(this,t,e),this.check()}identity(){return jF(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=re(t)}get y(){return this[1]}set y(t){this[1]=re(t)}get z(){return this[2]}set z(t){this[2]=re(t)}get w(){return this[3]}set w(t){this[3]=re(t)}len(){return rU(this)}lengthSquared(){return oU(this)}dot(t){return iU(this,t)}rotationTo(t,e){return aU(this,t,e),this.check()}add(t){return eU(this,this,t),this.check()}calculateW(){return ZF(this,this),this.check()}conjugate(){return tU(this,this),this.check()}invert(){return $F(this,this),this.check()}lerp(t,e,i){return i===void 0?this.lerp(this,t,e):(sU(this,t,e,i),this.check())}multiplyRight(t){return Wm(this,this,t),this.check()}multiplyLeft(t){return Wm(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,t===0&&(this[3]=1),this.check()}rotateX(t){return XF(this,this,t),this.check()}rotateY(t){return KF(this,this,t),this.check()}rotateZ(t){return YF(this,this,t),this.check()}scale(t){return nU(this,this,t),this.check()}slerp(t,e,i){let s,r,o;switch(arguments.length){case 1:({start:s=lU,target:r,ratio:o}=t);break;case 2:s=this,r=t,o=e;break;default:s=t,r=e,o=i}return pc(this,s,r,o),this.check()}transformVector4(t,e=new PA){return HF(e,t,this),pa(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}function Pa(n){"@babel/helpers - typeof";return Pa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pa(n)}function cU(n,t){if(Pa(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var i=e.call(n,t||"default");if(Pa(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function hU(n){var t=cU(n,"string");return Pa(t)=="symbol"?t:String(t)}function Qt(n,t,e){return t=hU(t),t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}const uU=.1,dU=1e-12,oC=1e-15,fU=1e-20,AU=6378137,pU=6378137,gU=6356752314245179e-9;function _h(n){return n}new q;function mU(n,t=[],e=_h){return"longitude"in n?(t[0]=e(n.longitude),t[1]=e(n.latitude),t[2]=n.height):"x"in n?(t[0]=e(n.x),t[1]=e(n.y),t[2]=n.z):(t[0]=e(n[0]),t[1]=e(n[1]),t[2]=n[2]),t}function _U(n,t=[]){return mU(n,t,He._cartographicRadians?_h:GP)}function EU(n,t,e=_h){return"longitude"in t?(t.longitude=e(n[0]),t.latitude=e(n[1]),t.height=n[2]):"x"in t?(t.x=e(n[0]),t.y=e(n[1]),t.z=n[2]):(t[0]=e(n[0]),t[1]=e(n[1]),t[2]=n[2]),t}function yU(n,t){return EU(n,t,He._cartographicRadians?_h:QP)}const Jm=1e-14,CU=new q,qm={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Vu={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ho={east:new q,north:new q,up:new q,west:new q,south:new q,down:new q},xU=new q,vU=new q,BU=new q;function jm(n,t,e,i,s,r){const o=qm[t]&&qm[t][e];be(o&&(!i||i===o));let a,l,c;const h=CU.copy(s);if(Ts(h.x,0,Jm)&&Ts(h.y,0,Jm)){const u=Math.sign(h.z);a=xU.fromArray(Vu[t]),t!=="east"&&t!=="west"&&a.scale(u),l=vU.fromArray(Vu[e]),e!=="east"&&e!=="west"&&l.scale(u),c=BU.fromArray(Vu[i]),i!=="east"&&i!=="west"&&c.scale(u)}else{const{up:u,east:d,north:f}=Ho;d.set(-h.y,h.x,0).normalize(),n.geodeticSurfaceNormal(h,u),f.copy(u).cross(d);const{down:p,west:m,south:g}=Ho;p.copy(u).scale(-1),m.copy(d).scale(-1),g.copy(f).scale(-1),a=Ho[t],l=Ho[e],c=Ho[i]}return r[0]=a.x,r[1]=a.y,r[2]=a.z,r[3]=0,r[4]=l.x,r[5]=l.y,r[6]=l.z,r[7]=0,r[8]=c.x,r[9]=c.y,r[10]=c.z,r[11]=0,r[12]=h.x,r[13]=h.y,r[14]=h.z,r[15]=1,r}const Gr=new q,IU=new q,bU=new q;function MU(n,t,e=[]){const{oneOverRadii:i,oneOverRadiiSquared:s,centerToleranceSquared:r}=t;Gr.from(n);const o=Gr.x,a=Gr.y,l=Gr.z,c=i.x,h=i.y,u=i.z,d=o*o*c*c,f=a*a*h*h,p=l*l*u*u,m=d+f+p,g=Math.sqrt(1/m);if(!Number.isFinite(g))return;const A=IU;if(A.copy(n).scale(g),m<r)return A.to(e);const C=s.x,E=s.y,_=s.z,T=bU;T.set(A.x*C*2,A.y*E*2,A.z*_*2);let M=(1-g)*Gr.len()/(.5*T.len()),S=0,R,B,x,D;do{M-=S,R=1/(1+M*C),B=1/(1+M*E),x=1/(1+M*_);const V=R*R,Q=B*B,k=x*x,et=V*R,j=Q*B,X=k*x;D=d*V+f*Q+p*k-1;const U=-2*(d*et*C+f*j*E+p*X*_);S=D/U}while(Math.abs(D)>dU);return Gr.scale([R,B,x]).to(e)}const ql=new q,Xm=new q,SU=new q,ti=new q,TU=new q,jl=new q;class Ee{constructor(t=0,e=0,i=0){Qt(this,"radii",void 0),Qt(this,"radiiSquared",void 0),Qt(this,"radiiToTheFourth",void 0),Qt(this,"oneOverRadii",void 0),Qt(this,"oneOverRadiiSquared",void 0),Qt(this,"minimumRadius",void 0),Qt(this,"maximumRadius",void 0),Qt(this,"centerToleranceSquared",uU),Qt(this,"squaredXOverSquaredZ",void 0),be(t>=0),be(e>=0),be(i>=0),this.radii=new q(t,e,i),this.radiiSquared=new q(t*t,e*e,i*i),this.radiiToTheFourth=new q(t*t*t*t,e*e*e*e,i*i*i*i),this.oneOverRadii=new q(t===0?0:1/t,e===0?0:1/e,i===0?0:1/i),this.oneOverRadiiSquared=new q(t===0?0:1/(t*t),e===0?0:1/(e*e),i===0?0:1/(i*i)),this.minimumRadius=Math.min(t,e,i),this.maximumRadius=Math.max(t,e,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,e=[0,0,0]){const i=Xm,s=SU,[,,r]=t;this.geodeticSurfaceNormalCartographic(t,i),s.copy(this.radiiSquared).scale(i);const o=Math.sqrt(i.dot(s));return s.scale(1/o),i.scale(r),s.add(i),s.to(e)}cartesianToCartographic(t,e=[0,0,0]){jl.from(t);const i=this.scaleToGeodeticSurface(jl,ti);if(!i)return;const s=this.geodeticSurfaceNormal(i,Xm),r=TU;r.copy(jl).subtract(i);const o=Math.atan2(s.y,s.x),a=Math.asin(s.z),l=Math.sign(DA(r,jl))*$y(r);return yU([o,a,l],e)}eastNorthUpToFixedFrame(t,e=new ye){return jm(this,"east","north","up",t,e)}localFrameToFixedFrame(t,e,i,s,r=new ye){return jm(this,t,e,i,s,r)}geocentricSurfaceNormal(t,e=[0,0,0]){return ql.from(t).normalize().to(e)}geodeticSurfaceNormalCartographic(t,e=[0,0,0]){const i=_U(t),s=i[0],r=i[1],o=Math.cos(r);return ql.set(o*Math.cos(s),o*Math.sin(s),Math.sin(r)).normalize(),ql.to(e)}geodeticSurfaceNormal(t,e=[0,0,0]){return ql.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}scaleToGeodeticSurface(t,e){return MU(t,this,e)}scaleToGeocentricSurface(t,e=[0,0,0]){ti.from(t);const i=ti.x,s=ti.y,r=ti.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+s*s*o.y+r*r*o.z);return ti.multiplyScalar(a).to(e)}transformPositionToScaledSpace(t,e=[0,0,0]){return ti.from(t).scale(this.oneOverRadii).to(e)}transformPositionFromScaledSpace(t,e=[0,0,0]){return ti.from(t).scale(this.radii).to(e)}getSurfaceNormalIntersectionWithZAxis(t,e=0,i=[0,0,0]){be(Ts(this.radii.x,this.radii.y,oC)),be(this.radii.z>0),ti.from(t);const s=ti.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-e))return ti.set(0,0,s).to(i)}}Qt(Ee,"WGS84",new Ee(AU,pU,gU));const Fn={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new q;new q;const ko=new q,Km=new q;class Ka{constructor(t=[0,0,0],e=0){Qt(this,"center",void 0),Qt(this,"radius",void 0),this.radius=-0,this.center=new q,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=ko.from(e),this.center=new q().from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Ka(this.center,this.radius)}union(t){const e=this.center,i=this.radius,s=t.center,r=t.radius,o=ko.copy(s).subtract(e),a=o.magnitude();if(i>=a+r)return this.clone();if(r>=a+i)return t.clone();const l=(i+a+r)*.5;return Km.copy(o).scale((-i+l)/a).add(e),this.center.copy(Km),this.radius=l,this}expand(t){const e=ko.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=BF(ko,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=ko.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,i=this.radius,s=t.normal.dot(e)+t.distance;return s<-i?Fn.OUTSIDE:s<i?Fn.INTERSECTING:Fn.INSIDE}}const wU=new q,RU=new q,Xl=new q,Kl=new q,Yl=new q,DU=new q,LU=new q,Wi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ya{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){Qt(this,"center",void 0),Qt(this,"halfAxes",void 0),this.center=new q().from(t),this.halfAxes=new Re(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new q(t).len(),new q(e).len(),new q(i).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),s=new q(t).normalize(),r=new q(e).normalize(),o=new q(i).normalize();return new Oc().fromMatrix3(new Re([...s,...r,...o]))}fromCenterHalfSizeQuaternion(t,e,i){const s=new Oc(i),r=new Re().fromQuaternion(s);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],this.center=new q().from(t),this.halfAxes=r,this}clone(){return new Ya(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Ka){const e=this.halfAxes,i=e.getColumn(0,Xl),s=e.getColumn(1,Kl),r=e.getColumn(2,Yl),o=wU.copy(i).add(s).add(r);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const e=this.center,i=t.normal,s=this.halfAxes,r=i.x,o=i.y,a=i.z,l=Math.abs(r*s[Wi.COLUMN0ROW0]+o*s[Wi.COLUMN0ROW1]+a*s[Wi.COLUMN0ROW2])+Math.abs(r*s[Wi.COLUMN1ROW0]+o*s[Wi.COLUMN1ROW1]+a*s[Wi.COLUMN1ROW2])+Math.abs(r*s[Wi.COLUMN2ROW0]+o*s[Wi.COLUMN2ROW1]+a*s[Wi.COLUMN2ROW2]),c=i.dot(e)+t.distance;return c<=-l?Fn.OUTSIDE:c>=l?Fn.INSIDE:Fn.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=RU.from(t).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,Xl),r=i.getColumn(1,Kl),o=i.getColumn(2,Yl),a=s.magnitude(),l=r.magnitude(),c=o.magnitude();s.normalize(),r.normalize(),o.normalize();let h=0,u;return u=Math.abs(e.dot(s))-a,u>0&&(h+=u*u),u=Math.abs(e.dot(r))-l,u>0&&(h+=u*u),u=Math.abs(e.dot(o))-c,u>0&&(h+=u*u),h}computePlaneDistances(t,e,i=[-0,-0]){let s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,l=a.getColumn(0,Xl),c=a.getColumn(1,Kl),h=a.getColumn(2,Yl),u=DU.copy(l).add(c).add(h).add(o),d=LU.copy(u).subtract(t);let f=e.dot(d);return s=Math.min(f,s),r=Math.max(f,r),u.copy(o).add(l).add(c).subtract(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),u.copy(o).add(l).subtract(c).add(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),u.copy(o).add(l).subtract(c).subtract(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),o.copy(u).subtract(l).add(c).add(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),o.copy(u).subtract(l).add(c).subtract(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),o.copy(u).subtract(l).subtract(c).add(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),o.copy(u).subtract(l).subtract(c).subtract(h),d.copy(u).subtract(t),f=e.dot(d),s=Math.min(f,s),r=Math.max(f,r),i[0]=s,i[1]=r,i}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,Xl);e.transformAsPoint(t);const i=this.halfAxes.getColumn(1,Kl);i.transformAsPoint(t);const s=this.halfAxes.getColumn(2,Yl);return s.transformAsPoint(t),this.halfAxes=new Re([...e,...i,...s]),this}getTransform(){throw new Error("not implemented")}}const Ym=new q,Zm=new q;class qe{constructor(t=[0,0,1],e=0){Qt(this,"normal",void 0),Qt(this,"distance",void 0),this.normal=new q,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return be(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Ym.from(t),this.normal.from(e).normalize();const i=-this.normal.dot(t);return this.distance=i,this}fromCoefficients(t,e,i,s){return this.normal.set(t,e,i),be(Ts(this.normal.len(),1)),this.distance=s,this}clone(){return new qe(this.normal,this.distance)}equals(t){return Ts(this.distance,t.distance)&&Ts(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Zm.copy(this.normal).transformAsVector(t).normalize(),i=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(i,e)}projectPointOntoPlane(t,e=[0,0,0]){const i=Ym.from(t),s=this.getPointDistance(i),r=Zm.copy(this.normal).scale(s);return i.subtract(r).to(e)}}const $m=[new q([1,0,0]),new q([0,1,0]),new q([0,0,1])],t0=new q,PU=new q;class In{constructor(t=[]){Qt(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*$m.length;const e=t.center,i=t.radius;let s=0;for(const r of $m){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new qe),a||(a=this.planes[s+1]=new qe);const l=t0.copy(r).scale(-i).add(e);o.fromPointNormal(l,r);const c=t0.copy(r).scale(i).add(e),h=PU.copy(r).negate();a.fromPointNormal(c,h),s+=2}return this}computeVisibility(t){let e=Fn.INSIDE;for(const i of this.planes)switch(t.intersectPlane(i)){case Fn.OUTSIDE:return Fn.OUTSIDE;case Fn.INTERSECTING:e=Fn.INTERSECTING;break}return e}computeVisibilityWithPlaneMask(t,e){if(be(Number.isFinite(e),"parentPlaneMask is required."),e===In.MASK_OUTSIDE||e===In.MASK_INSIDE)return e;let i=In.MASK_INSIDE;const s=this.planes;for(let r=0;r<this.planes.length;++r){const o=r<31?1<<r:0;if(r<31&&!(e&o))continue;const a=s[r],l=t.intersectPlane(a);if(l===Fn.OUTSIDE)return In.MASK_OUTSIDE;l===Fn.INTERSECTING&&(i|=o)}return i}}Qt(In,"MASK_OUTSIDE",4294967295);Qt(In,"MASK_INSIDE",0);Qt(In,"MASK_INDETERMINATE",2147483647);const FU=new q,UU=new q,NU=new q,OU=new q,GU=new q;class Gc{constructor(t={}){Qt(this,"left",void 0),Qt(this,"_left",void 0),Qt(this,"right",void 0),Qt(this,"_right",void 0),Qt(this,"top",void 0),Qt(this,"_top",void 0),Qt(this,"bottom",void 0),Qt(this,"_bottom",void 0),Qt(this,"near",void 0),Qt(this,"_near",void 0),Qt(this,"far",void 0),Qt(this,"_far",void 0),Qt(this,"_cullingVolume",new In([new qe,new qe,new qe,new qe,new qe,new qe])),Qt(this,"_perspectiveMatrix",new ye),Qt(this,"_infinitePerspective",new ye);const{near:e=1,far:i=5e8}=t;this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=e,this._near=e,this.far=i,this._far=i}clone(){return new Gc({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Gc&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return this._update(),this._perspectiveMatrix}get infiniteProjectionMatrix(){return this._update(),this._infinitePerspective}computeCullingVolume(t,e,i){be(t,"position is required."),be(e,"direction is required."),be(i,"up is required.");const s=this._cullingVolume.planes;i=FU.copy(i).normalize();const r=UU.copy(e).cross(i).normalize(),o=NU.copy(e).multiplyByScalar(this.near).add(t),a=OU.copy(e).multiplyByScalar(this.far).add(t);let l=GU;return l.copy(r).multiplyByScalar(this.left).add(o).subtract(t).cross(i),s[0].fromPointNormal(t,l),l.copy(r).multiplyByScalar(this.right).add(o).subtract(t).cross(i).negate(),s[1].fromPointNormal(t,l),l.copy(i).multiplyByScalar(this.bottom).add(o).subtract(t).cross(r).negate(),s[2].fromPointNormal(t,l),l.copy(i).multiplyByScalar(this.top).add(o).subtract(t).cross(r),s[3].fromPointNormal(t,l),l=new q().copy(e),s[4].fromPointNormal(o,l),l.negate(),s[5].fromPointNormal(a,l),this._cullingVolume}getPixelDimensions(t,e,i,s){this._update(),be(Number.isFinite(t)&&Number.isFinite(e)),be(t>0),be(e>0),be(i>0),be(s);const r=1/this.near;let o=this.top*r;const a=2*i*o/e;o=this.right*r;const l=2*i*o/t;return s.x=l,s.y=a,s}_update(){be(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const{top:t,bottom:e,right:i,left:s,near:r,far:o}=this;(t!==this._top||e!==this._bottom||s!==this._left||i!==this._right||r!==this._near||o!==this._far)&&(be(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=s,this._right=i,this._top=t,this._bottom=e,this._near=r,this._far=o,this._perspectiveMatrix=new ye().frustum({left:s,right:i,bottom:e,top:t,near:r,far:o}),this._infinitePerspective=new ye().frustum({left:s,right:i,bottom:e,top:t,near:r,far:1/0}))}}const QU=n=>n!==null&&typeof n<"u";class Qc{constructor(t={}){Qt(this,"_offCenterFrustum",new Gc),Qt(this,"fov",void 0),Qt(this,"_fov",void 0),Qt(this,"_fovy",void 0),Qt(this,"_sseDenominator",void 0),Qt(this,"aspectRatio",void 0),Qt(this,"_aspectRatio",void 0),Qt(this,"near",void 0),Qt(this,"_near",void 0),Qt(this,"far",void 0),Qt(this,"_far",void 0),Qt(this,"xOffset",void 0),Qt(this,"_xOffset",void 0),Qt(this,"yOffset",void 0),Qt(this,"_yOffset",void 0);const{fov:e,aspectRatio:i,near:s=1,far:r=5e8,xOffset:o=0,yOffset:a=0}=t;this.fov=e,this.aspectRatio=i,this.near=s,this.far=r,this.xOffset=o,this.yOffset=a}clone(){return new Qc({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return!QU(t)||!(t instanceof Qc)?!1:(this._update(),t._update(),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return this._update(),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return this._update(),this._fovy}get sseDenominator(){return this._update(),this._sseDenominator}computeCullingVolume(t,e,i){return this._update(),this._offCenterFrustum.computeCullingVolume(t,e,i)}getPixelDimensions(t,e,i,s){return this._update(),this._offCenterFrustum.getPixelDimensions(t,e,i,s||new mh)}_update(){be(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const t=this._offCenterFrustum;(this.fov!==this._fov||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far||this.xOffset!==this._xOffset||this.yOffset!==this._yOffset)&&(be(this.fov>=0&&this.fov<Math.PI),be(this.aspectRatio>0),be(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:Math.atan(Math.tan(this.fov*.5)/this.aspectRatio)*2,this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,t.top=this.near*Math.tan(.5*this._fovy),t.bottom=-t.top,t.right=this.aspectRatio*t.top,t.left=-t.right,t.near=this.near,t.far=this.far,t.right+=this.xOffset,t.left+=this.xOffset,t.top+=this.yOffset,t.bottom+=this.yOffset)}}new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;new q;const Ei=new Re,HU=new Re,kU=new Re,Zl=new Re,e0=new Re;function VU(n,t={}){const e=fU,i=10;let s=0,r=0;const o=HU,a=kU;o.identity(),a.copy(n);const l=e*zU(a);for(;r<i&&WU(a)>l;)JU(a,Zl),e0.copy(Zl).transpose(),a.multiplyRight(Zl),a.multiplyLeft(e0),o.multiplyRight(Zl),++s>2&&(++r,s=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function zU(n){let t=0;for(let e=0;e<9;++e){const i=n[e];t+=i*i}return Math.sqrt(t)}const pf=[1,0,0],gf=[2,2,1];function WU(n){let t=0;for(let e=0;e<3;++e){const i=n[Ei.getElementIndex(gf[e],pf[e])];t+=2*i*i}return Math.sqrt(t)}function JU(n,t){const e=oC;let i=0,s=1;for(let c=0;c<3;++c){const h=Math.abs(n[Ei.getElementIndex(gf[c],pf[c])]);h>i&&(s=c,i=h)}const r=pf[s],o=gf[s];let a=1,l=0;if(Math.abs(n[Ei.getElementIndex(o,r)])>e){const c=n[Ei.getElementIndex(o,o)],h=n[Ei.getElementIndex(r,r)],u=n[Ei.getElementIndex(o,r)],d=(c-h)/2/u;let f;d<0?f=-1/(-d+Math.sqrt(1+d*d)):f=1/(d+Math.sqrt(1+d*d)),a=1/Math.sqrt(1+f*f),l=f*a}return Re.IDENTITY.to(t),t[Ei.getElementIndex(r,r)]=t[Ei.getElementIndex(o,o)]=a,t[Ei.getElementIndex(o,r)]=l,t[Ei.getElementIndex(r,o)]=-l,t}const _s=new q,qU=new q,jU=new q,XU=new q,KU=new q,YU=new Re,ZU={diagonal:new Re,unitary:new Re};function $U(n,t=new Ya){if(!n||n.length===0)return t.halfAxes=new Re([0,0,0,0,0,0,0,0,0]),t.center=new q,t;const e=n.length,i=new q(0,0,0);for(const B of n)i.add(B);const s=1/e;i.multiplyByScalar(s);let r=0,o=0,a=0,l=0,c=0,h=0;for(const B of n){const x=_s.copy(B).subtract(i);r+=x.x*x.x,o+=x.x*x.y,a+=x.x*x.z,l+=x.y*x.y,c+=x.y*x.z,h+=x.z*x.z}r*=s,o*=s,a*=s,l*=s,c*=s,h*=s;const u=YU;u[0]=r,u[1]=o,u[2]=a,u[3]=o,u[4]=l,u[5]=c,u[6]=a,u[7]=c,u[8]=h;const{unitary:d}=VU(u,ZU),f=t.halfAxes.copy(d);let p=f.getColumn(0,jU),m=f.getColumn(1,XU),g=f.getColumn(2,KU),A=-Number.MAX_VALUE,C=-Number.MAX_VALUE,E=-Number.MAX_VALUE,_=Number.MAX_VALUE,T=Number.MAX_VALUE,M=Number.MAX_VALUE;for(const B of n)_s.copy(B),A=Math.max(_s.dot(p),A),C=Math.max(_s.dot(m),C),E=Math.max(_s.dot(g),E),_=Math.min(_s.dot(p),_),T=Math.min(_s.dot(m),T),M=Math.min(_s.dot(g),M);p=p.multiplyByScalar(.5*(_+A)),m=m.multiplyByScalar(.5*(T+C)),g=g.multiplyByScalar(.5*(M+E)),t.center.copy(p).add(m).add(g);const S=qU.set(A-_,C-T,E-M).multiplyByScalar(.5),R=new Re([S[0],0,0,0,S[1],0,0,0,S[2]]);return t.halfAxes.multiplyRight(R),t}let n0=function(n){return n[n.ADD=1]="ADD",n[n.REPLACE=2]="REPLACE",n}({}),$l=function(n){return n.EMPTY="empty",n.SCENEGRAPH="scenegraph",n.POINTCLOUD="pointcloud",n.MESH="mesh",n}({}),t2=function(n){return n.I3S="I3S",n.TILES3D="TILES3D",n}({}),Eh=function(n){return n.GEOMETRIC_ERROR="geometricError",n.MAX_SCREEN_THRESHOLD="maxScreenThreshold",n}({});const aC="4.1.1",Vo={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function lC(n,t,e){Se(n instanceof ArrayBuffer);const i=new TextDecoder("utf8"),s=new Uint8Array(n,t,e);return i.decode(s)}function e2(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const e=new DataView(n);return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}const n2="4.1.1",i2={name:"Draco",id:"draco",module:"draco",version:n2,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function s2(n,t,e){const i=cC(t.metadata),s=[],r=r2(t.attributes);for(const o in n){const a=n[o],l=i0(o,a,r[o]);s.push(l)}if(e){const o=i0("indices",e);s.push(o)}return{fields:s,metadata:i}}function r2(n){const t={};for(const e in n){const i=n[e];t[i.name||"undefined"]=i}return t}function i0(n,t,e){const i=e?cC(e.metadata):void 0;return LP(n,t,i)}function cC(n){Object.entries(n);const t={};for(const e in n)t[`${e}.string`]=JSON.stringify(n[e]);return t}const s0={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},o2={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},a2=4;class l2{constructor(t){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const s=this.decoder.GetEncodedGeometryType(i),r=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(s){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!r.ptr){const u=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(u)}const a=this._getDracoLoaderData(r,s,e),l=this._getMeshData(r,a,e),c=DP(l.attributes),h=s2(l.attributes,a,l.indices);return{loader:"draco",loaderData:a,header:{vertexCount:r.num_points(),boundingBox:c},...l,schema:h}}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}_getDracoLoaderData(t,e,i){const s=this._getTopLevelMetadata(t),r=this._getDracoAttributes(t,i);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:s,attributes:r}}_getDracoAttributes(t,e){const i={};for(let s=0;s<t.num_attributes();s++){const r=this.decoder.GetAttribute(t,s),o=this._getAttributeMetadata(t,s);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:s,metadata:o};const a=this._getQuantizationTransform(r,e);a&&(i[r.unique_id()].quantization_transform=a);const l=this._getOctahedronTransform(r,e);l&&(i[r.unique_id()].octahedron_transform=l)}return i}_getMeshData(t,e,i){const s=this._getMeshAttributes(e,t,i);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(t,e,i){const s={};for(const r of Object.values(t.attributes)){const o=this._deduceAttributeName(r,i);r.name=o;const{value:a,size:l}=this._getAttributeValues(e,r);s[o]={value:a,size:l,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return s}_getTriangleListIndices(t){const e=t.num_faces()*3,i=e*a2,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(t,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,e).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),u2(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const i=o2[e.data_type],s=e.num_components,r=t.num_points()*s,o=r*i.BYTES_PER_ELEMENT,a=c2(this.draco,i);let l;const c=this.draco._malloc(o);try{const h=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,h,a,o,c),l=new i(this.draco.HEAPF32.buffer,c,r).slice()}finally{this.draco._free(c)}return{value:l,size:s}}_deduceAttributeName(t,e){const i=t.unique_id;for(const[o,a]of Object.entries(e.extraAttributes||{}))if(a===i)return o;const s=t.attribute_type;for(const o in s0)if(this.draco[o]===s)return s0[o];const r=e.attributeNameEntry||"name";return t.metadata[r]?t.metadata[r].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const i=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(i)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},i=this.metadataQuerier.NumEntries(t);for(let s=0;s<i;s++){const r=this.metadataQuerier.GetEntryName(t,s);e[r]=this._getDracoMetadataField(t,r)}return e}_getDracoMetadataField(t,e){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,i);const s=h2(i);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:s}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:i=[]}=t,s=[...e,...i];for(const r of s)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(t,e){const{quantizedAttributes:i=[]}=e,s=t.attribute_type();if(i.map(r=>this.decoder[r]).includes(s)){const r=new this.draco.AttributeQuantizationTransform;try{if(r.InitFromAttribute(t))return{quantization_bits:r.quantization_bits(),range:r.range(),min_values:new Float32Array([1,2,3]).map(o=>r.min_value(o))}}finally{this.draco.destroy(r)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:i=[]}=e,s=t.attribute_type();if(i.map(r=>this.decoder[r]).includes(s)){const r=new this.draco.AttributeQuantizationTransform;try{if(r.InitFromAttribute(t))return{quantization_bits:r.quantization_bits()}}finally{this.draco.destroy(r)}}return null}}function c2(n,t){switch(t){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function h2(n){const t=n.size(),e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=n.GetValue(i);return e}function u2(n){const t=n.size(),e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=n.GetValue(i);return e}const d2="1.5.6",f2="1.4.1",zu=`https://www.gstatic.com/draco/versioned/decoders/${d2}`,Bn={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Wu={[Bn.DECODER]:`${zu}/${Bn.DECODER}`,[Bn.DECODER_WASM]:`${zu}/${Bn.DECODER_WASM}`,[Bn.FALLBACK_DECODER]:`${zu}/${Bn.FALLBACK_DECODER}`,[Bn.ENCODER]:`https://raw.githubusercontent.com/google/draco/${f2}/javascript/${Bn.ENCODER}`};let zo;async function A2(n){const t=n.modules||{};return t.draco3d?zo=zo||t.draco3d.createDecoderModule({}).then(e=>({draco:e})):zo=zo||p2(n),await zo}async function p2(n){let t,e;switch(n.draco&&n.draco.decoderType){case"js":t=await lr(Wu[Bn.FALLBACK_DECODER],"draco",n,Bn.FALLBACK_DECODER);break;case"wasm":default:[t,e]=await Promise.all([await lr(Wu[Bn.DECODER],"draco",n,Bn.DECODER),await lr(Wu[Bn.DECODER_WASM],"draco",n,Bn.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await g2(t,e)}function g2(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(i=>{n({...e,onModuleLoaded:s=>i({draco:s})})})}const hC={...i2,parse:m2};async function m2(n,t){const{draco:e}=await A2(t),i=new l2(e);try{return i.parseSync(n,t==null?void 0:t.draco)}finally{i.destroy()}}const _2={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Pe={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ne={..._2,...Pe},Ju={[Pe.DOUBLE]:Float64Array,[Pe.FLOAT]:Float32Array,[Pe.UNSIGNED_SHORT]:Uint16Array,[Pe.UNSIGNED_INT]:Uint32Array,[Pe.UNSIGNED_BYTE]:Uint8Array,[Pe.BYTE]:Int8Array,[Pe.SHORT]:Int16Array,[Pe.INT]:Int32Array},E2={DOUBLE:Pe.DOUBLE,FLOAT:Pe.FLOAT,UNSIGNED_SHORT:Pe.UNSIGNED_SHORT,UNSIGNED_INT:Pe.UNSIGNED_INT,UNSIGNED_BYTE:Pe.UNSIGNED_BYTE,BYTE:Pe.BYTE,SHORT:Pe.SHORT,INT:Pe.INT},qu="Failed to convert GL type";class Si{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const e in Ju)if(Ju[e]===t)return e;throw new Error(qu)}static fromName(t){const e=E2[t];if(!e)throw new Error(qu);return e}static getArrayType(t){switch(t){case Pe.UNSIGNED_SHORT_5_6_5:case Pe.UNSIGNED_SHORT_4_4_4_4:case Pe.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const e=Ju[t];if(!e)throw new Error(qu);return e}}static getByteSize(t){return Si.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!Si.getArrayType(t)}static createTypedArray(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0;s===void 0&&(s=(e.byteLength-i)/Si.getByteSize(t));const r=Si.getArrayType(t);return new r(e,i,s)}}function y2(n,t){if(!n)throw new Error(`math.gl assertion failed. ${t}`)}function C2(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const e=n>>11&31,i=n>>5&63,s=n&31;return t[0]=e<<3,t[1]=i<<2,t[2]=s<<3,t}new mh;new q;new mh;new mh;function r0(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return kP(n,0,t)/t*2-1}function o0(n){return n<0?-1:1}function x2(n,t,e,i){if(y2(i),n<0||n>e||t<0||t>e)throw new Error(`x and y must be unsigned normalized integers between 0 and ${e}`);if(i.x=r0(n,e),i.y=r0(t,e),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const s=i.x;i.x=(1-Math.abs(i.y))*o0(s),i.y=(1-Math.abs(s))*o0(i.y)}return i.normalize()}function v2(n,t,e){return x2(n,t,255,e)}class FA{constructor(t,e){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=t,this.buffer=e}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ne.UNSIGNED_INT,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(t,e,i,1,s.byteOffset):s}getPropertyArray(t,e,i){const s=this.json[t];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(e=Si.fromName(s.componentType)),this._getTypedArrayFromBinary(t,e,i,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(t,e,s)}getProperty(t,e,i,s,r){const o=this.json[t];if(!o)return o;const a=this.getPropertyArray(t,e,i);if(i===1)return a[s];for(let l=0;l<i;++l)r[l]=a[i*s+l];return r}_getTypedArrayFromBinary(t,e,i,s,r){const o=this._cachedTypedArrays;let a=o[t];return a||(a=Si.createTypedArray(e,this.buffer.buffer,this.buffer.byteOffset+r,s*i),o[t]=a),a}_getTypedArrayFromArray(t,e,i){const s=this._cachedTypedArrays;let r=s[t];return r||(r=Si.createTypedArray(e,i),s[t]=r),r}}const B2={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I2={SCALAR:(n,t)=>n[t],VEC2:(n,t)=>[n[2*t+0],n[2*t+1]],VEC3:(n,t)=>[n[3*t+0],n[3*t+1],n[3*t+2]],VEC4:(n,t)=>[n[4*t+0],n[4*t+1],n[4*t+2],n[4*t+3]],MAT2:(n,t)=>[n[4*t+0],n[4*t+1],n[4*t+2],n[4*t+3]],MAT3:(n,t)=>[n[9*t+0],n[9*t+1],n[9*t+2],n[9*t+3],n[9*t+4],n[9*t+5],n[9*t+6],n[9*t+7],n[9*t+8]],MAT4:(n,t)=>[n[16*t+0],n[16*t+1],n[16*t+2],n[16*t+3],n[16*t+4],n[16*t+5],n[16*t+6],n[16*t+7],n[16*t+8],n[16*t+9],n[16*t+10],n[16*t+11],n[16*t+12],n[16*t+13],n[16*t+14],n[16*t+15]]},b2={SCALAR:(n,t,e)=>{t[e]=n},VEC2:(n,t,e)=>{t[2*e+0]=n[0],t[2*e+1]=n[1]},VEC3:(n,t,e)=>{t[3*e+0]=n[0],t[3*e+1]=n[1],t[3*e+2]=n[2]},VEC4:(n,t,e)=>{t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},MAT2:(n,t,e)=>{t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},MAT3:(n,t,e)=>{t[9*e+0]=n[0],t[9*e+1]=n[1],t[9*e+2]=n[2],t[9*e+3]=n[3],t[9*e+4]=n[4],t[9*e+5]=n[5],t[9*e+6]=n[6],t[9*e+7]=n[7],t[9*e+8]=n[8],t[9*e+9]=n[9]},MAT4:(n,t,e)=>{t[16*e+0]=n[0],t[16*e+1]=n[1],t[16*e+2]=n[2],t[16*e+3]=n[3],t[16*e+4]=n[4],t[16*e+5]=n[5],t[16*e+6]=n[6],t[16*e+7]=n[7],t[16*e+8]=n[8],t[16*e+9]=n[9],t[16*e+10]=n[10],t[16*e+11]=n[11],t[16*e+12]=n[12],t[16*e+13]=n[13],t[16*e+14]=n[14],t[16*e+15]=n[15]}};function M2(n,t,e,i){const{componentType:s}=n;Se(n.componentType);const r=typeof s=="string"?Si.fromName(s):s,o=B2[n.type],a=I2[n.type],l=b2[n.type];return e+=n.byteOffset,{values:Si.createTypedArray(r,t,e,o*i),type:r,size:o,unpacker:a,packer:l}}const Bi=n=>n!==void 0;function S2(n,t,e){if(!t)return null;let i=n.getExtension("3DTILES_batch_table_hierarchy");const s=t.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,i=s),i?T2(i,e):null}function T2(n,t){let e,i,s;const r=n.instancesLength,o=n.classes;let a=n.classIds,l=n.parentCounts,c=n.parentIds,h=r;Bi(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,s=getBinaryAccessor(a),a=s.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,r));let u;if(Bi(l))for(Bi(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,r)),u=new Uint16Array(r),h=0,e=0;e<r;++e)u[e]=h,h+=l[e];Bi(c)&&Bi(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,h));const d=o.length;for(e=0;e<d;++e){const g=o[e].length,A=o[e].instances,C=getBinaryProperties(g,A,t);o[e].instances=combine(C,A)}const f=new Array(d).fill(0),p=new Uint16Array(r);for(e=0;e<r;++e)i=a[e],p[e]=f[i],++f[i];const m={classes:o,classIds:a,classIndexes:p,parentCounts:l,parentIndexes:u,parentIds:c};return D2(m),m}function Wo(n,t,e){if(!n)return;const i=n.parentCounts;return n.parentIds?e(n,t):i>0?w2(n,t,e):R2(n,t,e)}function w2(n,t,e){const i=n.classIds,s=n.parentCounts,r=n.parentIds,o=n.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,h=scratchStack;for(h.length=0,h.push(t);h.length>0;){if(t=h.pop(),l[t]===c)continue;l[t]=c;const u=e(n,t);if(Bi(u))return u;const d=s[t],f=o[t];for(let p=0;p<d;++p){const m=r[f+p];m!==t&&h.push(m)}}return null}function R2(n,t,e){let i=!0;for(;i;){const s=e(n,t);if(Bi(s))return s;const r=n.parentIds[t];i=r!==t,t=r}throw new Error("traverseHierarchySingleParent")}function D2(n){const t=n.classIds.length;for(let e=0;e<t;++e)uC(n,e,stack)}function uC(n,t,e){const i=n.parentCounts,s=n.parentIds,r=n.parentIndexes,o=n.classIds.length;if(!Bi(s))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(e.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),e.push(t);const a=Bi(i)?i[t]:1,l=Bi(i)?r[t]:t;for(let c=0;c<a;++c){const h=s[l+c];h!==t&&uC(n,h,e)}e.pop(t)}function Cn(n){return n!=null}const tc=(n,t)=>n,L2={HIERARCHY:!0,extensions:!0,extras:!0};class dC{constructor(t,e,i){var s;let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,Se(i>=0),this.json=t||{},this.binary=e,this.featureCount=i,this._extensions=((s=this.json)===null||s===void 0?void 0:s.extensions)||{},this._properties={};for(const o in this.json)L2[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=S2(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,e){if(this._checkBatchId(t),Se(typeof e=="string",e),this._hierarchy){const i=Wo(this._hierarchy,t,(s,r)=>{const o=s.classIds[r];return s.classes[o].name===e});return Cn(i)}return!1}isExactClass(t,e){return Se(typeof e=="string",e),this.getExactClassName(t)===e}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const e=this._hierarchy.classIds[t];return this._hierarchy.classes[e].name}}hasProperty(t,e){return this._checkBatchId(t),Se(typeof e=="string",e),Cn(this._properties[e])||this._hasPropertyInHierarchy(t,e)}getPropertyNames(t,e){this._checkBatchId(t),e=Cn(e)?e:[],e.length=0;const i=Object.keys(this._properties);return e.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(t,e),e}getProperty(t,e){if(this._checkBatchId(t),Se(typeof e=="string",e),this._binaryProperties){const s=this._binaryProperties[e];if(Cn(s))return this._getBinaryProperty(s,t)}const i=this._properties[e];if(Cn(i))return tc(i[t]);if(this._hierarchy){const s=this._getHierarchyProperty(t,e);if(Cn(s))return s}}setProperty(t,e,i){const s=this.featureCount;if(this._checkBatchId(t),Se(typeof e=="string",e),this._binaryProperties){const o=this._binaryProperties[e];if(o){this._setBinaryProperty(o,t,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,e,i))return;let r=this._properties[e];Cn(r)||(this._properties[e]=new Array(s),r=this._properties[e]),r[t]=tc(i)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,e){return t.unpack(t.typedArray,e)}_setBinaryProperty(t,e,i){t.pack(i,t.typedArray,e)}_initializeBinaryProperties(){let t=null;for(const e in this._properties){const i=this._properties[e],s=this._initializeBinaryProperty(e,i);s&&(t=t||{},t[e]=s)}return t}_initializeBinaryProperty(t,e){if("byteOffset"in e){const i=e;Se(this.binary,`Property ${t} requires a batch table binary.`),Se(i.type,`Property ${t} requires a type.`);const s=M2(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(t,e){if(!this._hierarchy)return!1;const i=Wo(this._hierarchy,t,(s,r)=>{const o=s.classIds[r],a=s.classes[o].instances;return Cn(a[e])});return Cn(i)}_getPropertyNamesInHierarchy(t,e){Wo(this._hierarchy,t,(i,s)=>{const r=i.classIds[s],o=i.classes[r].instances;for(const a in o)o.hasOwnProperty(a)&&e.indexOf(a)===-1&&e.push(a)})}_getHierarchyProperty(t,e){return Wo(this._hierarchy,t,(i,s)=>{const r=i.classIds[s],o=i.classes[r],a=i.classIndexes[s],l=o.instances[e];return Cn(l)?Cn(l.typedArray)?this._getBinaryProperty(l,a):tc(l[a]):null})}_setHierarchyProperty(t,e,i,s){const r=Wo(this._hierarchy,e,(o,a)=>{const l=o.classIds[a],c=o.classes[l],h=o.classIndexes[a],u=c.instances[i];return Cn(u)?(Se(a===e,`Inherited property "${i}" is read-only.`),Cn(u.typedArray)?this._setBinaryProperty(u,h,s):u[h]=tc(s),!0):!1});return Cn(r)}}const ju=4;function yh(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(t);if(n.magic=i.getUint32(e,!0),e+=ju,n.version=i.getUint32(e,!0),e+=ju,n.byteLength=i.getUint32(e,!0),e+=ju,n.version!==1)throw new Error(`3D Tile Version ${n.version} not supported`);return e}const Qr=4,a0="b3dm tile in legacy format.";function UA(n,t,e){const i=new DataView(t);let s;n.header=n.header||{};let r=i.getUint32(e,!0);e+=Qr;let o=i.getUint32(e,!0);e+=Qr;let a=i.getUint32(e,!0);e+=Qr;let l=i.getUint32(e,!0);return e+=Qr,a>=570425344?(e-=Qr*2,s=r,a=o,l=0,r=0,o=0,console.warn(a0)):l>=570425344&&(e-=Qr,s=a,a=r,l=o,r=0,o=0,console.warn(a0)),n.header.featureTableJsonByteLength=r,n.header.featureTableBinaryByteLength=o,n.header.batchTableJsonByteLength=a,n.header.batchTableBinaryByteLength=l,n.header.batchLength=s,e}function NA(n,t,e,i){return e=P2(n,t,e),e=F2(n,t,e),e}function P2(n,t,e,i){const{featureTableJsonByteLength:s,featureTableBinaryByteLength:r,batchLength:o}=n.header||{};if(n.featureTableJson={BATCH_LENGTH:o||0},s&&s>0){const a=lC(t,e,s);n.featureTableJson=JSON.parse(a)}return e+=s||0,n.featureTableBinary=new Uint8Array(t,e,r),e+=r||0,e}function F2(n,t,e,i){const{batchTableJsonByteLength:s,batchTableBinaryByteLength:r}=n.header||{};if(s&&s>0){const o=lC(t,e,s);n.batchTableJson=JSON.parse(o),e+=s,r&&r>0&&(n.batchTableBinary=new Uint8Array(t,e,r),n.batchTableBinary=new Uint8Array(n.batchTableBinary),e+=r)}return e}function fC(n,t,e){if(!t&&(!n||!n.batchIds||!e))return null;const{batchIds:i,isRGB565:s,pointCount:r=0}=n;if(i&&e){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const l=i[a],c=e.getProperty(l,"dimensions").map(h=>h*255);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:ne.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&s){const o=new Uint8ClampedArray(r*3);for(let a=0;a<r;a++){const l=C2(t[a]);o[a*3]=l[0],o[a*3+1]=l[1],o[a*3+2]=l[2]}return{type:ne.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===r*3?{type:ne.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:ne.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const l0=new q;function U2(n,t){if(!t)return null;if(n.isOctEncoded16P){const e=new Float32Array((n.pointsLength||0)*3);for(let i=0;i<(n.pointsLength||0);i++)v2(t[i*2],t[i*2+1],l0),l0.toArray(e,i*3);return{type:ne.FLOAT,size:2,value:e}}return{type:ne.FLOAT,size:2,value:t}}function N2(n,t,e){return n.isQuantized?e["3d-tiles"]&&e["3d-tiles"].decodeQuantizedPositions?(n.isQuantized=!1,O2(n,t)):{type:ne.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function O2(n,t){const e=new q,i=new Float32Array(n.pointCount*3);for(let s=0;s<n.pointCount;s++)e.set(t[s*3],t[s*3+1],t[s*3+2]).scale(1/n.quantizedRange).multiply(n.quantizedVolumeScale).add(n.quantizedVolumeOffset).toArray(i,s*3);return i}async function G2(n,t,e,i,s){e=yh(n,t,e),e=UA(n,t,e),e=NA(n,t,e),Q2(n);const{featureTable:r,batchTable:o}=H2(n);return await J2(n,r,o,i,s),k2(n,r,i),V2(n,r,o),z2(n,r),e}function Q2(n){n.attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1}function H2(n){const t=new FA(n.featureTableJson,n.featureTableBinary),e=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(e))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=e,n.featuresLength=e,n.pointsLength=e,n.pointCount=e,n.rtcCenter=t.getGlobalProperty("RTC_CENTER",ne.FLOAT,3);const i=W2(n,t);return{featureTable:t,batchTable:i}}function k2(n,t,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.positions){if(t.hasProperty("POSITION"))n.attributes.positions=t.getPropertyArray("POSITION",ne.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const i=t.getPropertyArray("POSITION_QUANTIZED",ne.UNSIGNED_SHORT,3);if(n.isQuantized=!0,n.quantizedRange=65535,n.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ne.FLOAT,3),!n.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(n.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ne.FLOAT,3),!n.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");n.attributes.positions=N2(n,i,e)}}if(!n.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function V2(n,t,e){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.colors){let i=null;t.hasProperty("RGBA")?(i=t.getPropertyArray("RGBA",ne.UNSIGNED_BYTE,4),n.isTranslucent=!0):t.hasProperty("RGB")?i=t.getPropertyArray("RGB",ne.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(i=t.getPropertyArray("RGB565",ne.UNSIGNED_SHORT,1),n.isRGB565=!0),n.attributes.colors=fC(n,i,e)}t.hasProperty("CONSTANT_RGBA")&&(n.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",ne.UNSIGNED_BYTE,4))}function z2(n,t){if(n.attributes=n.attributes||{positions:null,colors:null,normals:null,batchIds:null},!n.attributes.normals){let e=null;t.hasProperty("NORMAL")?e=t.getPropertyArray("NORMAL",ne.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(e=t.getPropertyArray("NORMAL_OCT16P",ne.UNSIGNED_BYTE,2),n.isOctEncoded16P=!0),n.attributes.normals=U2(n,e)}}function W2(n,t){let e=null;if(!n.batchIds&&t.hasProperty("BATCH_ID")&&(n.batchIds=t.getPropertyArray("BATCH_ID",ne.UNSIGNED_SHORT,1),n.batchIds)){const i=t.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:r}=n;e=new dC(s,r,i)}return e}async function J2(n,t,e,i,s){let r,o,a;const l=n.batchTableJson&&n.batchTableJson.extensions&&n.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const c=t.getExtension("3DTILES_draco_point_compression");if(c){o=c.properties;const u=c.byteOffset,d=c.byteLength;if(!o||!Number.isFinite(u)||!d)throw new Error("Draco properties, byteOffset, and byteLength must be defined");r=(n.featureTableBinary||[]).slice(u,u+d),n.hasPositions=Number.isFinite(o.POSITION),n.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),n.hasNormals=Number.isFinite(o.NORMAL),n.hasBatchIds=Number.isFinite(o.BATCH_ID),n.isTranslucent=Number.isFinite(o.RGBA)}if(!r)return!0;const h={buffer:r,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await q2(n,h,i,s)}async function q2(n,t,e,i){if(!i)return;const s={...e,draco:{...e==null?void 0:e.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const r=await qa(t.buffer,hC,s,i),o=r.attributes.POSITION&&r.attributes.POSITION.value,a=r.attributes.COLOR_0&&r.attributes.COLOR_0.value,l=r.attributes.NORMAL&&r.attributes.NORMAL.value,c=r.attributes.BATCH_ID&&r.attributes.BATCH_ID.value,h=o&&r.attributes.POSITION.value.quantization,u=l&&r.attributes.NORMAL.value.quantization;if(h){const f=r.POSITION.data.quantization,p=f.range;n.quantizedVolumeScale=new q(p,p,p),n.quantizedVolumeOffset=new q(f.minValues),n.quantizedRange=(1<<f.quantizationBits)-1,n.isQuantizedDraco=!0}u&&(n.octEncodedRange=(1<<r.NORMAL.data.quantization.quantizationBits)-1,n.isOctEncodedDraco=!0);const d={};if(t.batchTableProperties)for(const f of Object.keys(t.batchTableProperties))r.attributes[f]&&r.attributes[f].value&&(d[f.toLowerCase()]=r.attributes[f].value);n.attributes={positions:o,colors:fC(n,a,void 0),normals:l,batchIds:c,...d}}const j2="4.1.1";var Xu;const X2=(Xu=globalThis.loaders)===null||Xu===void 0?void 0:Xu.parseImageNode,mf=typeof Image<"u",_f=typeof ImageBitmap<"u",K2=!!X2,Ef=Ah?!0:K2;function Y2(n){switch(n){case"auto":return _f||mf||Ef;case"imagebitmap":return _f;case"image":return mf;case"data":return Ef;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function Z2(){if(_f)return"imagebitmap";if(mf)return"image";if(Ef)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function $2(n){const t=tN(n);if(!t)throw new Error("Not an image");return t}function AC(n){switch($2(n)){case"data":return n;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=n.width,t.height=n.height,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function tN(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const eN=/^data:image\/svg\+xml/,nN=/\.svg((\?|#).*)?$/;function OA(n){return n&&(eN.test(n)||nN.test(n))}function iN(n,t){if(OA(t)){let e=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(e=unescape(encodeURIComponent(e)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(e)}`}return pC(n,t)}function pC(n,t){if(OA(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function gC(n,t,e){const i=iN(n,e),s=self.URL||self.webkitURL,r=typeof i!="string"&&s.createObjectURL(i);try{return await sN(r||i,t)}finally{r&&s.revokeObjectURL(r)}}async function sN(n,t){const e=new Image;return e.src=n,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((i,s)=>{try{e.onload=()=>i(e),e.onerror=r=>{const o=r instanceof Error?r.message:"error";s(new Error(o))}}catch(r){s(r)}})}const rN={};let c0=!0;async function oN(n,t,e){let i;OA(e)?i=await gC(n,t,e):i=pC(n,e);const s=t&&t.imagebitmap;return await aN(i,s)}async function aN(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((lN(t)||!c0)&&(t=null),t)try{return await createImageBitmap(n,t)}catch(e){console.warn(e),c0=!1}return await createImageBitmap(n)}function lN(n){for(const t in n||rN)return!1;return!0}function cN(n){return!fN(n,"ftyp",4)||!(n[8]&96)?null:hN(n)}function hN(n){switch(uN(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function uN(n,t,e){return String.fromCharCode(...n.slice(t,e))}function dN(n){return[...n].map(t=>t.charCodeAt(0))}function fN(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=dN(t);for(let s=0;s<i.length;++s)if(i[s]!==n[s+e])return!1;return!0}const Ii=!1,ma=!0;function GA(n){const t=Za(n);return pN(t)||_N(t)||gN(t)||mN(t)||AN(t)}function AN(n){const t=new Uint8Array(n instanceof DataView?n.buffer:n),e=cN(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function pN(n){const t=Za(n);return t.byteLength>=24&&t.getUint32(0,Ii)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Ii),height:t.getUint32(20,Ii)}:null}function gN(n){const t=Za(n);return t.byteLength>=10&&t.getUint32(0,Ii)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,ma),height:t.getUint16(8,ma)}:null}function mN(n){const t=Za(n);return t.byteLength>=14&&t.getUint16(0,Ii)===16973&&t.getUint32(2,ma)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,ma),height:t.getUint32(22,ma)}:null}function _N(n){const t=Za(n);if(!(t.byteLength>=3&&t.getUint16(0,Ii)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:e,sofMarkers:i}=EN();let s=2;for(;s+9<t.byteLength;){const r=t.getUint16(s,Ii);if(i.has(r))return{mimeType:"image/jpeg",height:t.getUint16(s+5,Ii),width:t.getUint16(s+7,Ii)};if(!e.has(r))return null;s+=2,s+=t.getUint16(s,Ii)}return null}function EN(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Za(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function yN(n,t){var e;const{mimeType:i}=GA(n)||{},s=(e=globalThis.loaders)===null||e===void 0?void 0:e.parseImageNode;return Se(s),await s(n,i)}async function CN(n,t,e){t=t||{};const i=(t.image||{}).type||"auto",{url:s}=e||{},r=xN(i);let o;switch(r){case"imagebitmap":o=await oN(n,t,s);break;case"image":o=await gC(n,t,s);break;case"data":o=await yN(n);break;default:Se(!1)}return i==="data"&&(o=AC(o)),o}function xN(n){switch(n){case"auto":case"data":return Z2();default:return Y2(n),n}}const vN=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],BN=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],IN={image:{type:"auto",decode:!0}},bN={id:"image",module:"images",name:"Images",version:j2,mimeTypes:BN,extensions:vN,parse:CN,tests:[n=>!!GA(new DataView(n))],options:IN},Ku={};function MN(n){if(Ku[n]===void 0){const t=Ah?TN(n):SN(n);Ku[n]=t}return Ku[n]}function SN(n){var t,e;const i=["image/png","image/jpeg","image/gif"],s=((t=globalThis.loaders)===null||t===void 0?void 0:t.imageFormatsNode)||i;return!!(!((e=globalThis.loaders)===null||e===void 0)&&e.parseImageNode)&&s.includes(n)}function TN(n){switch(n){case"image/avif":case"image/webp":return wN(n);default:return!0}}function wN(n){try{return document.createElement("canvas").toDataURL(n).indexOf(`data:${n}`)===0}catch{return!1}}function Qn(n,t){if(!n)throw new Error(t||"assert failed: gltf")}const mC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_C={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},RN=1.33,h0=["SCALAR","VEC2","VEC3","VEC4"],DN=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],LN=new Map(DN),PN={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},FN={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},UN={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function EC(n){return h0[n-1]||h0[0]}function QA(n){const t=LN.get(n.constructor);if(!t)throw new Error("Illegal typed array");return t}function HA(n,t){const e=UN[n.componentType],i=PN[n.type],s=FN[n.componentType],r=n.count*i,o=n.count*i*s;Qn(o>=0&&o<=t.byteLength);const a=_C[n.componentType],l=mC[n.type];return{ArrayType:e,length:r,byteLength:o,componentByteSize:a,numberOfComponentsInElement:l}}function yC(n){let{images:t,bufferViews:e}=n;t=t||[],e=e||[];const i=t.map(o=>o.bufferView);e=e.filter(o=>!i.includes(o));const s=e.reduce((o,a)=>o+a.byteLength,0),r=t.reduce((o,a)=>{const{width:l,height:c}=a.image;return o+l*c},0);return s+Math.ceil(4*r*RN)}function NN(n,t,e){const i=n.bufferViews[e];Qn(i);const s=i.buffer,r=t[s];Qn(r);const o=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,i.byteLength)}function ON(n,t,e){var i,s;const r=typeof e=="number"?(i=n.accessors)===null||i===void 0?void 0:i[e]:e;if(!r)throw new Error(`No gltf accessor ${JSON.stringify(e)}`);const o=(s=n.bufferViews)===null||s===void 0?void 0:s[r.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:a,byteOffset:l}=t[o.buffer],c=(l||0)+(r.byteOffset||0)+(o.byteOffset||0),{ArrayType:h,length:u,componentByteSize:d,numberOfComponentsInElement:f}=HA(r,o),p=d*f,m=o.byteStride||p;if(typeof o.byteStride>"u"||o.byteStride===p)return new h(a,c,u);const g=new h(u);for(let A=0;A<r.count;A++){const C=new h(a,c+A*m,f);g.set(C,A*f)}return g}function GN(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class hn{constructor(t){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:(t==null?void 0:t.json)||GN(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find(s=>s===t),i=this.getRequiredExtensions().find(s=>s===t);return typeof e=="string"||typeof i=="string"}getExtension(t){const e=this.getUsedExtensions().find(s=>s===t),i=this.json.extensions||{};return e?i[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(e=>e===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const i=this.json[t]&&this.json[t][e];if(!i)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return i}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,i=this.gltf.buffers[e];Qn(i);const s=(t.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return ON(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),i=this.getBuffer(e.buffer).data,s=e.byteOffset||0;return new Uint8Array(i,s,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,i){return t.extensions=t.extensions||{},t.extensions[e]=i,this.registerUsedExtension(e),this}setObjectExtension(t,e,i){const s=t.extensions||{};s[e]=i}removeObjectExtension(t,e){const i=(t==null?void 0:t.extensions)||{};if(i[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(e)||s.push(e)}delete i[e]}addExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qn(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Qn(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var e;if((e=this.json.extensions)!==null&&e!==void 0&&e[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:i}=t;this.json.nodes=this.json.nodes||[];const s={mesh:e};return i&&(s.matrix=i),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:i,material:s,mode:r=4}=t,o={primitives:[{attributes:this._addAttributes(e),mode:r}]};if(i){const a=this._addIndices(i);o.primitives[0].indices=a}return Number.isFinite(s)&&(o.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const e={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(e),this.json.meshes.length-1}addImage(t,e){const i=GA(t),s=e||(i==null?void 0:i.mimeType),r={bufferView:this.addBufferView(t),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const s=t.byteLength;Qn(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const r={buffer:e,byteOffset:i,byteLength:s};return this.byteLength+=ja(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(t,e){const i={bufferView:t,type:EC(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const i=this.addBufferView(t);let s={min:e.min,max:e.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(t,e.size));const r={size:e.size,componentType:QA(t),count:Math.round(t.length/e.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(r,e))}addTexture(t){const{imageIndex:e}=t,i={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,e;this.gltf.buffers=[];const i=this.byteLength,s=new ArrayBuffer(i),r=new Uint8Array(s);let o=0;for(const a of this.sourceBuffers||[])o=fL(a,r,o);(t=this.json)!==null&&t!==void 0&&(e=t.buffers)!==null&&e!==void 0&&e[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=s,this.sourceBuffers=[s]}_removeStringFromArray(t,e){let i=!0;for(;i;){const s=t.indexOf(e);s>-1?t.splice(s,1):i=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e={};for(const i in t){const s=t[i],r=this._getGltfAttributeName(i),o=this.addBinaryBuffer(s.value,s);e[r]=o}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const i={min:null,max:null};if(t.length<e)return i;i.min=[],i.max=[];const s=t.subarray(0,e);for(const r of s)i.min.push(r),i.max.push(r);for(let r=e;r<t.length;r+=e)for(let o=0;o<e;o++)i.min[0+o]=Math.min(i.min[0+o],t[r+o]),i.max[0+o]=Math.max(i.max[0+o],t[r+o]);return i}}function u0(n){return(n%1+1)%1}const CC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},QN={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},xC={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function kA(n,t){return xC[t]*CC[n]}function Ch(n,t,e,i){if(e!=="UINT8"&&e!=="UINT16"&&e!=="UINT32"&&e!=="UINT64")return null;const s=n.getTypedArrayForBufferView(t),r=xh(s,"SCALAR",e,i+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function xh(n,t,e){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const s=CC[t],r=QN[e],o=xC[e],a=i*s,l=a*o;let c=n.buffer,h=n.byteOffset;return h%o!==0&&(c=new Uint8Array(c).slice(h,h+l).buffer,h=0),new r(c,h,a)}function VA(n,t,e){var i,s;const r=`TEXCOORD_${t.texCoord||0}`,o=e.attributes[r],a=n.getTypedArrayForAccessor(o),l=n.gltf.json,c=t.index,h=(i=l.textures)===null||i===void 0||(s=i[c])===null||s===void 0?void 0:s.source;if(typeof h<"u"){var u,d,f;const p=(u=l.images)===null||u===void 0||(d=u[h])===null||d===void 0?void 0:d.mimeType,m=(f=n.gltf.images)===null||f===void 0?void 0:f[h];if(m&&typeof m.width<"u"){const g=[];for(let A=0;A<a.length;A+=2){const C=HN(m,p,a,A,t.channels);g.push(C)}return g}}return[]}function vC(n,t,e,i,s){if(!(e!=null&&e.length))return;const r=[];for(const h of e){let u=i.findIndex(d=>d===h);u===-1&&(u=i.push(h)-1),r.push(u)}const o=new Uint32Array(r),a=n.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=n.addBufferView(o,a,0),c=n.addAccessor(l,{size:1,componentType:QA(o),count:o.length});s.attributes[t]=c}function HN(n,t,e,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const r={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=e[i],a=e[i+1];let l=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(l=4);const c=kN(o,a,n,l);let h=0;for(const u of s){const d=typeof u=="number"?Object.values(r)[u]:r[u],f=c+d.offset,p=AC(n);if(p.data.length<=f)throw new Error(`${p.data.length} <= ${f}`);const m=p.data[f];h|=m<<d.shift}return h}function kN(n,t,e){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const s=e.width,r=u0(n)*(s-1),o=Math.round(r),a=e.height,l=u0(t)*(a-1),c=Math.round(l),h=e.components?e.components:i;return(c*s+o)*h}function BC(n,t,e,i,s){const r=[];for(let o=0;o<t;o++){const a=e[o],l=e[o+1]-e[o];if(l+a>i)break;const c=a/s,h=l/s;r.push(n.slice(c,c+h))}return r}function IC(n,t,e){const i=[];for(let s=0;s<t;s++){const r=s*e;i.push(n.slice(r,r+e))}return i}function bC(n,t,e,i){if(e)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const s=[],r=new TextDecoder("utf8");let o=0;for(let a=0;a<n;a++){const l=i[a+1]-i[a];if(l+o<=t.length){const c=t.subarray(o,l+o),h=r.decode(c);s.push(h),o+=l}}return s}return[]}const MC="EXT_mesh_features",VN=MC;async function zN(n,t){const e=new hn(n);WN(e,t)}function WN(n,t){const e=n.gltf.json;if(e.meshes)for(const i of e.meshes)for(const s of i.primitives)JN(n,s,t)}function JN(n,t,e){var i,s;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.loadBuffers))return;const r=(s=t.extensions)===null||s===void 0?void 0:s[MC],o=r==null?void 0:r.featureIds;if(o)for(const l of o){var a;let c;if(typeof l.attribute<"u"){const h=`_FEATURE_ID_${l.attribute}`,u=t.attributes[h];c=n.getTypedArrayForAccessor(u)}else typeof l.texture<"u"&&e!==null&&e!==void 0&&(a=e.gltf)!==null&&a!==void 0&&a.loadImages?c=VA(n,l.texture,t):c=[];l.data=c}}const qN=Object.freeze(Object.defineProperty({__proto__:null,decode:zN,name:VN},Symbol.toStringTag,{value:"Module"})),zA="EXT_structural_metadata",jN=zA;async function XN(n,t){const e=new hn(n);KN(e,t)}function KN(n,t){var e,i;if(!((e=t.gltf)!==null&&e!==void 0&&e.loadBuffers))return;const s=n.getExtension(zA);s&&((i=t.gltf)!==null&&i!==void 0&&i.loadImages&&YN(n,s),ZN(n,s))}function YN(n,t){const e=t.propertyTextures,i=n.gltf.json;if(e&&i.meshes)for(const s of i.meshes)for(const r of s.primitives)tO(n,e,r,t)}function ZN(n,t){const e=t.schema;if(!e)return;const i=e.classes,s=t.propertyTables;if(i&&s)for(const r in i){const o=$N(s,r);o&&nO(n,e,o)}}function $N(n,t){for(const e of n)if(e.class===t)return e;return null}function tO(n,t,e,i){var s;if(!t)return;const r=(s=e.extensions)===null||s===void 0?void 0:s[zA],o=r==null?void 0:r.propertyTextures;if(o)for(const a of o){const l=t[a];eO(n,l,e,i)}}function eO(n,t,e,i){if(!t.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const s=t.class;for(const o in t.properties){var r;const a=`${s}_${o}`,l=(r=t.properties)===null||r===void 0?void 0:r[o];if(!l)continue;l.data||(l.data=[]);const c=l.data,h=VA(n,l,e);h!==null&&(vC(n,a,h,c,e),l.data=c,i.dataAttributeNames.push(a))}}function nO(n,t,e){var i;const s=(i=t.classes)===null||i===void 0?void 0:i[e.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const r=e.count;for(const a in s.properties){var o;const l=s.properties[a],c=(o=e.properties)===null||o===void 0?void 0:o[a];if(c){const h=iO(n,t,l,r,c);c.data=h}}}function iO(n,t,e,i,s){let r=[];const o=s.values,a=n.getTypedArrayForBufferView(o),l=sO(n,e,s,i),c=rO(n,s,i);switch(e.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{r=oO(e,i,a,l);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${e.type}`);case"STRING":{r=bC(i,a,l,c);break}case"ENUM":{r=aO(t,e,i,a,l);break}default:throw new Error(`Unknown classProperty type ${e.type}`)}return r}function sO(n,t,e,i){return t.array&&typeof t.count>"u"&&typeof e.arrayOffsets<"u"?Ch(n,e.arrayOffsets,e.arrayOffsetType||"UINT32",i):null}function rO(n,t,e){return typeof t.stringOffsets<"u"?Ch(n,t.stringOffsets,t.stringOffsetType||"UINT32",e):null}function oO(n,t,e,i){const s=n.array,r=n.count,o=kA(n.type,n.componentType),a=e.byteLength/o;let l;return n.componentType?l=xh(e,n.type,n.componentType,a):l=e,s?i?BC(l,t,i,e.length,o):r?IC(l,t,r):[]:l}function aO(n,t,e,i,s){var r;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(r=n.enums)===null||r===void 0?void 0:r[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const l=a.valueType||"UINT16",c=kA(t.type,l),h=i.byteLength/c;let u=xh(i,t.type,l,h);if(u||(u=i),t.array){if(s)return lO({valuesData:u,numberOfElements:e,arrayOffsets:s,valuesDataBytesLength:i.length,elementSize:c,enumEntry:a});const d=t.count;return d?cO(u,e,d,a):[]}return WA(u,0,e,a)}function lO(n){const{valuesData:t,numberOfElements:e,arrayOffsets:i,valuesDataBytesLength:s,elementSize:r,enumEntry:o}=n,a=[];for(let l=0;l<e;l++){const c=i[l],h=i[l+1]-i[l];if(h+c>s)break;const u=c/r,d=h/r,f=WA(t,u,d,o);a.push(f)}return a}function cO(n,t,e,i){const s=[];for(let r=0;r<t;r++){const o=e*r,a=WA(n,o,e,i);s.push(a)}return s}function WA(n,t,e,i){const s=[];for(let r=0;r<e;r++)if(n instanceof BigInt64Array||n instanceof BigUint64Array)s.push("");else{const o=n[t+r],a=hO(i,o);a?s.push(a.name):s.push("")}return s}function hO(n,t){for(const e of n.values)if(e.value===t)return e;return null}const uO=Object.freeze(Object.defineProperty({__proto__:null,decode:XN,name:jN},Symbol.toStringTag,{value:"Module"})),SC="EXT_feature_metadata",dO=SC;async function fO(n,t){const e=new hn(n);AO(e,t)}function AO(n,t){var e,i;if(!((e=t.gltf)!==null&&e!==void 0&&e.loadBuffers))return;const s=n.getExtension(SC);s&&((i=t.gltf)!==null&&i!==void 0&&i.loadImages&&pO(n,s),gO(n,s))}function pO(n,t){const e=t.schema;if(!e)return;const i=e.classes,{featureTextures:s}=t;if(i&&s)for(const r in i){const o=i[r],a=_O(s,r);a&&yO(n,a,o)}}function gO(n,t){const e=t.schema;if(!e)return;const i=e.classes,s=t.featureTables;if(i&&s)for(const r in i){const o=mO(s,r);o&&EO(n,e,o)}}function mO(n,t){for(const e in n){const i=n[e];if(i.class===t)return i}return null}function _O(n,t){for(const e in n){const i=n[e];if(i.class===t)return i}return null}function EO(n,t,e){var i;if(!e.class)return;const s=(i=t.classes)===null||i===void 0?void 0:i[e.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const r=e.count;for(const a in s.properties){var o;const l=s.properties[a],c=(o=e.properties)===null||o===void 0?void 0:o[a];if(c){const h=CO(n,t,l,r,c);c.data=h}}}function yO(n,t,e){const i=t.class;for(const r in e.properties){var s;const o=t==null||(s=t.properties)===null||s===void 0?void 0:s[r];if(o){const a=bO(n,o,i);o.data=a}}}function CO(n,t,e,i,s){let r=[];const o=s.bufferView,a=n.getTypedArrayForBufferView(o),l=xO(n,e,s,i),c=vO(n,e,s,i);return e.type==="STRING"||e.componentType==="STRING"?r=bC(i,a,l,c):BO(e)&&(r=IO(e,i,a,l)),r}function xO(n,t,e,i){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof e.arrayOffsetBufferView<"u"?Ch(n,e.arrayOffsetBufferView,e.offsetType||"UINT32",i):null}function vO(n,t,e,i){return typeof e.stringOffsetBufferView<"u"?Ch(n,e.stringOffsetBufferView,e.offsetType||"UINT32",i):null}function BO(n){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(n.type)||typeof n.componentType<"u"&&t.includes(n.componentType)}function IO(n,t,e,i){const s=n.type==="ARRAY",r=n.componentCount,o="SCALAR",a=n.componentType||n.type,l=kA(o,a),c=e.byteLength/l,h=xh(e,o,a,c);return s?i?BC(h,t,i,e.length,l):r?IC(h,t,r):[]:h}function bO(n,t,e){const i=n.gltf.json;if(!i.meshes)return[];const s=[];for(const r of i.meshes)for(const o of r.primitives)MO(n,e,t,s,o);return s}function MO(n,t,e,i,s){const r={channels:e.channels,...e.texture},o=VA(n,r,s);o&&vC(n,t,o,i,s)}const SO=Object.freeze(Object.defineProperty({__proto__:null,decode:fO,name:dO},Symbol.toStringTag,{value:"Module"})),TO="4.1.1",wO="4.1.1",Hc={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Yu;async function d0(n){const t=n.modules||{};return t.basis?t.basis:(Yu=Yu||RO(n),await Yu)}async function RO(n){let t=null,e=null;return[t,e]=await Promise.all([await lr(Hc.TRANSCODER,"textures",n),await lr(Hc.TRANSCODER_WASM,"textures",n)]),t=t||globalThis.BASIS,await DO(t,e)}function DO(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(i=>{n(e).then(s=>{const{BasisFile:r,initializeBasis:o}=s;o(),i({BasisFile:r})})})}let Zu;async function f0(n){const t=n.modules||{};return t.basisEncoder?t.basisEncoder:(Zu=Zu||LO(n),await Zu)}async function LO(n){let t=null,e=null;return[t,e]=await Promise.all([await lr(Hc.ENCODER,"textures",n),await lr(Hc.ENCODER_WASM,"textures",n)]),t=t||globalThis.BASIS,await PO(t,e)}function PO(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(i=>{n(e).then(s=>{const{BasisFile:r,KTX2File:o,initializeBasis:a,BasisEncoder:l}=s;a(),i({BasisFile:r,KTX2File:o,BasisEncoder:l})})})}const Hr={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},FO=["","WEBKIT_","MOZ_"],A0={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ec=null;function UO(n){if(!ec){n=n||NO()||void 0,ec=new Set;for(const t of FO)for(const e in A0)if(n&&n.getExtension(`${t}${e}`)){const i=A0[e];ec.add(i)}}return ec}function NO(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var p0,g0,m0,_0,E0,y0,C0,x0;(function(n){n[n.NONE=0]="NONE",n[n.BASISLZ=1]="BASISLZ",n[n.ZSTD=2]="ZSTD",n[n.ZLIB=3]="ZLIB"})(p0||(p0={})),function(n){n[n.BASICFORMAT=0]="BASICFORMAT"}(g0||(g0={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.ETC1S=163]="ETC1S",n[n.UASTC=166]="UASTC"}(m0||(m0={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.SRGB=1]="SRGB"}(_0||(_0={})),function(n){n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.LINEAR=1]="LINEAR",n[n.SRGB=2]="SRGB",n[n.ITU=3]="ITU",n[n.NTSC=4]="NTSC",n[n.SLOG=5]="SLOG",n[n.SLOG2=6]="SLOG2"}(E0||(E0={})),function(n){n[n.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",n[n.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(y0||(y0={})),function(n){n[n.RGB=0]="RGB",n[n.RRR=3]="RRR",n[n.GGG=4]="GGG",n[n.AAA=15]="AAA"}(C0||(C0={})),function(n){n[n.RGB=0]="RGB",n[n.RGBA=3]="RGBA",n[n.RRR=4]="RRR",n[n.RRRG=5]="RRRG"}(x0||(x0={}));const Rn=[171,75,84,88,32,50,48,187,13,10,26,10];function OO(n){const t=new Uint8Array(n);return!(t.byteLength<Rn.length||t[0]!==Rn[0]||t[1]!==Rn[1]||t[2]!==Rn[2]||t[3]!==Rn[3]||t[4]!==Rn[4]||t[5]!==Rn[5]||t[6]!==Rn[6]||t[7]!==Rn[7]||t[8]!==Rn[8]||t[9]!==Rn[9]||t[10]!==Rn[10]||t[11]!==Rn[11])}const GO={etc1:{basisFormat:0,compressed:!0,format:Hr.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Hr.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Hr.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Hr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Hr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Hr.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function QO(n,t){if(t.basis.containerFormat==="auto"){if(OO(n)){const i=await f0(t);return v0(i.KTX2File,n,t)}const{BasisFile:e}=await d0(t);return $u(e,n,t)}switch(t.basis.module){case"encoder":const e=await f0(t);switch(t.basis.containerFormat){case"ktx2":return v0(e.KTX2File,n,t);case"basis":default:return $u(e.BasisFile,n,t)}case"transcoder":default:const{BasisFile:i}=await d0(t);return $u(i,n,t)}}function $u(n,t,e){const i=new n(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const s=i.getNumImages(),r=[];for(let o=0;o<s;o++){const a=i.getNumLevels(o),l=[];for(let c=0;c<a;c++)l.push(HO(i,o,c,e));r.push(l)}return r}finally{i.close(),i.delete()}}function HO(n,t,e,i){const s=n.getImageWidth(t,e),r=n.getImageHeight(t,e),o=n.getHasAlpha(),{compressed:a,format:l,basisFormat:c}=TC(i,o),h=n.getImageTranscodedSizeInBytes(t,e,c),u=new Uint8Array(h);if(!n.transcodeImage(u,t,e,c,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:r,data:u,compressed:a,format:l,hasAlpha:o}}function v0(n,t,e){const i=new n(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const s=i.getLevels(),r=[];for(let o=0;o<s;o++){r.push(kO(i,o,e));break}return[r]}finally{i.close(),i.delete()}}function kO(n,t,e){const{alphaFlag:i,height:s,width:r}=n.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=TC(e,i),c=n.getImageTranscodedSizeInBytes(t,0,0,l),h=new Uint8Array(c);if(!n.transcodeImage(h,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:r,height:s,data:h,compressed:o,levelSize:c,hasAlpha:i,format:a}}function TC(n,t){let e=n&&n.basis&&n.basis.format;return e==="auto"&&(e=wC()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),GO[e]}function wC(){const n=UO();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const VO={name:"Basis",id:"basis",module:"textures",version:wO,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},zO={...VO,parse:QO},go=!0,B0=1735152710,JA=12,kc=8,WO=1313821514,JO=5130562,qO=0,jO=0,XO=1;function KO(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}function YO(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new DataView(n),{magic:s=B0}=e,r=i.getUint32(t,!1);return r===s||r===B0}function ZO(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(t),s=KO(i,e+0),r=i.getUint32(e+4,go),o=i.getUint32(e+8,go);switch(Object.assign(n,{header:{byteOffset:e,byteLength:o,hasBinChunk:!1},type:s,version:r,json:{},binChunks:[]}),e+=JA,n.version){case 1:return $O(n,i,e);case 2:return t3(n,i,e,{});default:throw new Error(`Invalid GLB version ${n.version}. Only supports version 1 and 2.`)}}function $O(n,t,e){Se(n.header.byteLength>JA+kc);const i=t.getUint32(e+0,go),s=t.getUint32(e+4,go);return e+=kc,Se(s===qO),yf(n,t,e,i),e+=i,e+=Cf(n,t,e,n.header.byteLength),e}function t3(n,t,e,i){return Se(n.header.byteLength>JA+kc),e3(n,t,e,i),e+n.header.byteLength}function e3(n,t,e,i){for(;e+8<=n.header.byteLength;){const s=t.getUint32(e+0,go),r=t.getUint32(e+4,go);switch(e+=kc,r){case WO:yf(n,t,e,s);break;case JO:Cf(n,t,e,s);break;case jO:i.strict||yf(n,t,e,s);break;case XO:i.strict||Cf(n,t,e,s);break}e+=ja(s,4)}return e}function yf(n,t,e,i){const s=new Uint8Array(t.buffer,e,i),r=new TextDecoder("utf8").decode(s);return n.json=JSON.parse(r),ja(i,4)}function Cf(n,t,e,i){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:e,byteLength:i,arrayBuffer:t.buffer}),ja(i,4)}function RC(n,t){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const e=t.baseUri||t.uri;if(!e)throw new Error(`'baseUri' must be provided to resolve relative url ${n}`);return e.substr(0,e.lastIndexOf("/")+1)+n}const n3="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",i3="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",s3=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r3=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),o3={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},a3={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function l3(n,t,e,i,s){let r=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await c3();d3(o,o.exports[a3[s]],n,t,e,i,o.exports[o3[r||"NONE"]])}let td;async function c3(){return td||(td=h3()),td}async function h3(){let n=n3;WebAssembly.validate(s3)&&(n=i3,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(u3(n),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function u3(n){const t=new Uint8Array(n.length);for(let i=0;i<n.length;++i){const s=n.charCodeAt(i);t[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let e=0;for(let i=0;i<n.length;++i)t[e++]=t[i]<60?r3[t[i]]:(t[i]-60)*64+t[++i];return t.buffer.slice(0,e)}function d3(n,t,e,i,s,r,o){const a=n.exports.sbrk,l=i+3&-4,c=a(l*s),h=a(r.length),u=new Uint8Array(n.exports.memory.buffer);u.set(r,h);const d=t(c,i,s,h,r.length);if(d===0&&o&&o(c,l,s),e.set(u.subarray(c,c+i*s)),a(c-a(0)),d!==0)throw new Error(`Malformed buffer data: ${d}`)}const Vc="EXT_meshopt_compression",f3=Vc;async function A3(n,t){var e,i;const s=new hn(n);if(!(t!=null&&(e=t.gltf)!==null&&e!==void 0&&e.decompressMeshes)||!((i=t.gltf)!==null&&i!==void 0&&i.loadBuffers))return;const r=[];for(const o of n.json.bufferViews||[])r.push(p3(s,o));await Promise.all(r),s.removeExtension(Vc)}async function p3(n,t){const e=n.getObjectExtension(t,Vc);if(e){const{byteOffset:i=0,byteLength:s=0,byteStride:r,count:o,mode:a,filter:l="NONE",buffer:c}=e,h=n.gltf.buffers[c],u=new Uint8Array(h.arrayBuffer,h.byteOffset+i,s),d=new Uint8Array(n.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await l3(d,o,r,u,a,l),n.removeObjectExtension(t,Vc)}}const g3=Object.freeze(Object.defineProperty({__proto__:null,decode:A3,name:f3},Symbol.toStringTag,{value:"Module"})),zr="EXT_texture_webp",m3=zr;function _3(n,t){const e=new hn(n);if(!MN("image/webp")){if(e.getRequiredExtensions().includes(zr))throw new Error(`gltf: Required extension ${zr} not supported by browser`);return}const{json:i}=e;for(const s of i.textures||[]){const r=e.getObjectExtension(s,zr);r&&(s.source=r.source),e.removeObjectExtension(s,zr)}e.removeExtension(zr)}const E3=Object.freeze(Object.defineProperty({__proto__:null,name:m3,preprocess:_3},Symbol.toStringTag,{value:"Module"})),gc="KHR_texture_basisu",y3=gc;function C3(n,t){const e=new hn(n),{json:i}=e;for(const s of i.textures||[]){const r=e.getObjectExtension(s,gc);r&&(s.source=r.source,e.removeObjectExtension(s,gc))}e.removeExtension(gc)}const x3=Object.freeze(Object.defineProperty({__proto__:null,name:y3,preprocess:C3},Symbol.toStringTag,{value:"Module"}));function v3(n){const t={};for(const e in n){const i=n[e];if(e!=="indices"){const s=DC(i);t[e]=s}}return t}function DC(n){const{buffer:t,size:e,count:i}=B3(n);return{value:t,size:e,byteOffset:0,count:i,type:EC(e),componentType:QA(t)}}function B3(n){let t=n,e=1,i=0;return n&&n.value&&(t=n.value,e=n.size||1),t&&(ArrayBuffer.isView(t)||(t=I3(t,Float32Array)),i=t.length/e),{buffer:t,size:e,count:i}}function I3(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return n?Array.isArray(n)?new t(n):e&&!(n instanceof t)?new t(n):n:null}const Ls="KHR_draco_mesh_compression",b3=Ls;function M3(n,t,e){const i=new hn(n);for(const s of LC(i))i.getObjectExtension(s,Ls)}async function S3(n,t,e){var i;if(!(t!=null&&(i=t.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const s=new hn(n),r=[];for(const o of LC(s))s.getObjectExtension(o,Ls)&&r.push(w3(s,o,t,e));await Promise.all(r),s.removeExtension(Ls)}function T3(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=new hn(n);for(const i of e.json.meshes||[])R3(i,t),e.addRequiredExtension(Ls)}async function w3(n,t,e,i){const s=n.getObjectExtension(t,Ls);if(!s)return;const r=n.getTypedArrayForBufferView(s.bufferView),o=vA(r.buffer,r.byteOffset),a={...e};delete a["3d-tiles"];const l=await qa(o,hC,a,i),c=v3(l.attributes);for(const[h,u]of Object.entries(c))if(h in t.attributes){const d=t.attributes[h],f=n.getAccessor(d);f!=null&&f.min&&f!==null&&f!==void 0&&f.max&&(u.min=f.min,u.max=f.max)}t.attributes=c,l.indices&&(t.indices=DC(l.indices)),n.removeObjectExtension(t,Ls),D3(t)}function R3(n,t){var e;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=s.DracoWriter.encodeSync({attributes:n}),a=r==null||(e=r.parseSync)===null||e===void 0?void 0:e.call(r,{attributes:n}),l=s._addFauxAttributes(a.attributes),c=s.addBufferView(o);return{primitives:[{attributes:l,mode:i,extensions:{[Ls]:{bufferView:c,attributes:l}}}]}}function D3(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*LC(n){for(const t of n.json.meshes||[])for(const e of t.primitives)yield e}const L3=Object.freeze(Object.defineProperty({__proto__:null,decode:S3,encode:T3,name:b3,preprocess:M3},Symbol.toStringTag,{value:"Module"})),qA="KHR_texture_transform",P3=qA,nc=new q,F3=new Re,U3=new Re;async function N3(n,t){var e;if(!new hn(n).hasExtension(qA)||!((e=t.gltf)!==null&&e!==void 0&&e.loadBuffers))return;const i=n.json.materials||[];for(let s=0;s<i.length;s++)O3(s,n)}function O3(n,t){var e,i,s;const r=[],o=(e=t.json.materials)===null||e===void 0?void 0:e[n],a=o==null||(i=o.pbrMetallicRoughness)===null||i===void 0?void 0:i.baseColorTexture;a&&Jo(t,n,a,r);const l=o==null?void 0:o.emissiveTexture;l&&Jo(t,n,l,r);const c=o==null?void 0:o.normalTexture;c&&Jo(t,n,c,r);const h=o==null?void 0:o.occlusionTexture;h&&Jo(t,n,h,r);const u=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.metallicRoughnessTexture;u&&Jo(t,n,u,r)}function Jo(n,t,e,i){const s=G3(e,i);if(!s)return;const r=n.json.meshes||[];for(const o of r)for(const a of o.primitives){const l=a.material;Number.isFinite(l)&&t===l&&Q3(n,a,s)}}function G3(n,t){var e;const i=(e=n.extensions)===null||e===void 0?void 0:e[qA],{texCoord:s=0}=n,{texCoord:r=s}=i;if(t.findIndex(o=>{let[a,l]=o;return a===s&&l===r})===-1){const o=V3(i);return s!==r&&(n.texCoord=r),t.push([s,r]),{originalTexCoord:s,texCoord:r,matrix:o}}return null}function Q3(n,t,e){const{originalTexCoord:i,texCoord:s,matrix:r}=e,o=t.attributes[`TEXCOORD_${i}`];if(Number.isFinite(o)){var a;const c=(a=n.json.accessors)===null||a===void 0?void 0:a[o];if(c&&c.bufferView){var l;const h=(l=n.json.bufferViews)===null||l===void 0?void 0:l[c.bufferView];if(h){const{arrayBuffer:u,byteOffset:d}=n.buffers[h.buffer],f=(d||0)+(c.byteOffset||0)+(h.byteOffset||0),{ArrayType:p,length:m}=HA(c,h),g=_C[c.componentType],A=mC[c.type],C=h.byteStride||g*A,E=new Float32Array(m);for(let _=0;_<c.count;_++){const T=new p(u,f+_*C,2);nc.set(T[0],T[1],1),nc.transformByMatrix3(r),E.set([nc[0],nc[1]],_*A)}i===s?H3(c,h,n.buffers,E):k3(s,c,t,n,E)}}}}function H3(n,t,e,i){n.componentType=5126,e.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=i.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function k3(n,t,e,i,s){i.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});const r=i.json.bufferViews;if(!r)return;r.push({buffer:i.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});const o=i.json.accessors;o&&(o.push({bufferView:(r==null?void 0:r.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes[`TEXCOORD_${n}`]=o.length-1)}function V3(n){const{offset:t=[0,0],rotation:e=0,scale:i=[1,1]}=n,s=new Re().set(1,0,0,0,1,0,t[0],t[1],1),r=F3.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),o=U3.set(i[0],0,0,0,i[1],0,0,0,1);return s.multiplyRight(r).multiplyRight(o)}const z3=Object.freeze(Object.defineProperty({__proto__:null,decode:N3,name:P3},Symbol.toStringTag,{value:"Module"})),nr="KHR_lights_punctual",W3=nr;async function J3(n){const t=new hn(n),{json:e}=t,i=t.getExtension(nr);i&&(t.json.lights=i.lights,t.removeExtension(nr));for(const s of e.nodes||[]){const r=t.getObjectExtension(s,nr);r&&(s.light=r.light),t.removeObjectExtension(s,nr)}}async function q3(n){const t=new hn(n),{json:e}=t;if(e.lights){const i=t.addExtension(nr);Qn(!i.lights),i.lights=e.lights,delete e.lights}if(t.json.lights){for(const i of t.json.lights){const s=i.node;t.addObjectExtension(s,nr,i)}delete t.json.lights}}const j3=Object.freeze(Object.defineProperty({__proto__:null,decode:J3,encode:q3,name:W3},Symbol.toStringTag,{value:"Module"})),Fa="KHR_materials_unlit",X3=Fa;async function K3(n){const t=new hn(n),{json:e}=t;for(const i of e.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),t.removeObjectExtension(i,Fa);t.removeExtension(Fa)}function Y3(n){const t=new hn(n),{json:e}=t;if(t.materials)for(const i of e.materials||[])i.unlit&&(delete i.unlit,t.addObjectExtension(i,Fa,{}),t.addExtension(Fa))}const Z3=Object.freeze(Object.defineProperty({__proto__:null,decode:K3,encode:Y3,name:X3},Symbol.toStringTag,{value:"Module"})),$o="KHR_techniques_webgl",$3=$o;async function tG(n){const t=new hn(n),{json:e}=t,i=t.getExtension($o);if(i){const s=nG(i,t);for(const r of e.materials||[]){const o=t.getObjectExtension(r,$o);o&&(r.technique=Object.assign({},o,s[o.technique]),r.technique.values=iG(r.technique,t)),t.removeObjectExtension(r,$o)}t.removeExtension($o)}}async function eG(n,t){}function nG(n,t){const{programs:e=[],shaders:i=[],techniques:s=[]}=n,r=new TextDecoder;return i.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=r.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(o=>{o.fragmentShader=i[o.fragmentShader],o.vertexShader=i[o.vertexShader]}),s.forEach(o=>{o.program=e[o.program]}),s}function iG(n,t){const e=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(i=>{n.uniforms[i].value&&!(i in e)&&(e[i]=n.uniforms[i].value)}),Object.keys(e).forEach(i=>{typeof e[i]=="object"&&e[i].index!==void 0&&(e[i].texture=t.getTexture(e[i].index))}),e}const sG=Object.freeze(Object.defineProperty({__proto__:null,decode:tG,encode:eG,name:$3},Symbol.toStringTag,{value:"Module"})),PC=[uO,qN,g3,E3,x3,L3,j3,Z3,sG,z3,SO];function rG(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const i=PC.filter(r=>FC(r.name,t));for(const r of i){var s;(s=r.preprocess)===null||s===void 0||s.call(r,n,t,e)}}async function oG(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const i=PC.filter(r=>FC(r.name,t));for(const r of i){var s;await((s=r.decode)===null||s===void 0?void 0:s.call(r,n,t,e))}}function FC(n,t){var e;const i=(t==null||(e=t.gltf)===null||e===void 0?void 0:e.excludeExtensions)||{};return!(n in i&&!i[n])}const ed="KHR_binary_glTF";function aG(n){const t=new hn(n),{json:e}=t;for(const i of e.images||[]){const s=t.getObjectExtension(i,ed);s&&Object.assign(i,s),t.removeObjectExtension(i,ed)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(ed)}const I0={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},lG={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class cG{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(t,e){this.json=t.json;const i=t.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),aG(t),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in I0)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const i=t[e];if(!(!i||Array.isArray(i))){t[e]=[];for(const s in i){const r=i[s];r.id=r.id||s;const o=t[e].length;t[e].push(r),this.idToIndexMap[e][s]=o}}}_convertObjectIdsToArrayIndices(t){for(const e in I0)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:i,indices:s,material:r}=e;for(const o in i)i[o]=this._convertIdToIndex(i[o],"accessor");s&&(e.indices=this._convertIdToIndex(s,"accessor")),r&&(e.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const i of t[e])for(const s in i){const r=i[s],o=this._convertIdToIndex(r,s);i[s]=o}}_convertIdToIndex(t,e){const i=lG[e];if(i in this.idToIndexMap){const s=this.idToIndexMap[i][t];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return s}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){for(const r of t.materials){var e,i,s;r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((e=r.values)===null||e===void 0?void 0:e.tex)||((i=r.values)===null||i===void 0?void 0:i.texture2d_0)||((s=r.values)===null||s===void 0?void 0:s.diffuseTex),a=t.textures.findIndex(l=>l.id===o);a!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:a})}}}function hG(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new cG().normalize(n,t)}async function uG(n,t){var e,i,s;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return dG(n,t,r,o),hG(n,{normalize:o==null||(e=o.gltf)===null||e===void 0?void 0:e.normalize}),rG(n,o,a),o!=null&&(i=o.gltf)!==null&&i!==void 0&&i.loadBuffers&&n.json.buffers&&await fG(n,o,a),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.loadImages&&await AG(n,o,a),await oG(n,o,a),n}function dG(n,t,e,i){if(i.uri&&(n.baseUri=i.uri),t instanceof ArrayBuffer&&!YO(t,e,i)&&(t=new TextDecoder().decode(t)),typeof t=="string")n.json=cL(t);else if(t instanceof ArrayBuffer){const o={};e=ZO(o,t,e,i.glb),Qn(o.type==="glTF",`Invalid GLB magic string ${o.type}`),n._glb=o,n.json=o.json}else Qn(!1,"GLTF: must be ArrayBuffer or string");const s=n.json.buffers||[];if(n.buffers=new Array(s.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const r=n.json.images||[];n.images=new Array(r.length).fill({})}async function fG(n,t,e){const i=n.json.buffers||[];for(let o=0;o<i.length;++o){const a=i[o];if(a.uri){var s,r;const{fetch:l}=e;Qn(l);const c=RC(a.uri,t),h=await(e==null||(s=e.fetch)===null||s===void 0?void 0:s.call(e,c)),u=await(h==null||(r=h.arrayBuffer)===null||r===void 0?void 0:r.call(h));n.buffers[o]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function AG(n,t,e){const i=pG(n),s=n.json.images||[],r=[];for(const o of i)r.push(gG(n,s[o],o,t,e));return await Promise.all(r)}function pG(n){const t=new Set,e=n.json.textures||[];for(const i of e)i.source!==void 0&&t.add(i.source);return Array.from(t).sort()}async function gG(n,t,e,i,s){let r;if(t.uri&&!t.hasOwnProperty("bufferView")){const a=RC(t.uri,i),{fetch:l}=s;r=await(await l(a)).arrayBuffer(),t.bufferView={data:r}}if(Number.isFinite(t.bufferView)){const a=NN(n.json,n.buffers,t.bufferView);r=vA(a.buffer,a.byteOffset,a.byteLength)}Qn(r,"glTF image has no data");let o=await qa(r,[bN,zO],{...i,mimeType:t.mimeType,basis:i.basis||{format:wC()}},s);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),n.images=n.images||[],n.images[e]=o}const zc={name:"glTF",id:"gltf",module:"gltf",version:TO,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:mG,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function mG(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;t={...zc.options,...t},t.gltf={...zc.options.gltf,...t.gltf};const{byteOffset:i=0}=t;return await uG({},n,i,t,e)}const _G={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},EG={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wn={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},yG={magFilter:Wn.TEXTURE_MAG_FILTER,minFilter:Wn.TEXTURE_MIN_FILTER,wrapS:Wn.TEXTURE_WRAP_S,wrapT:Wn.TEXTURE_WRAP_T},CG={[Wn.TEXTURE_MAG_FILTER]:Wn.LINEAR,[Wn.TEXTURE_MIN_FILTER]:Wn.NEAREST_MIPMAP_LINEAR,[Wn.TEXTURE_WRAP_S]:Wn.REPEAT,[Wn.TEXTURE_WRAP_T]:Wn.REPEAT};function xG(){return{id:"default-sampler",parameters:CG}}function vG(n){return EG[n]}function BG(n){return _G[n]}class IG{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:i,buffers:s=[],images:r=[]}=t,{baseUri:o=""}=t;return Qn(i),this.baseUri=o,this.buffers=s,this.images=r,this.jsonUnprocessed=i,this.json=this._resolveTree(t.json,e),this.json}_resolveTree(t){const e={...t};return this.json=e,t.bufferViews&&(e.bufferViews=t.bufferViews.map((i,s)=>this._resolveBufferView(i,s))),t.images&&(e.images=t.images.map((i,s)=>this._resolveImage(i,s))),t.samplers&&(e.samplers=t.samplers.map((i,s)=>this._resolveSampler(i,s))),t.textures&&(e.textures=t.textures.map((i,s)=>this._resolveTexture(i,s))),t.accessors&&(e.accessors=t.accessors.map((i,s)=>this._resolveAccessor(i,s))),t.materials&&(e.materials=t.materials.map((i,s)=>this._resolveMaterial(i,s))),t.meshes&&(e.meshes=t.meshes.map((i,s)=>this._resolveMesh(i,s))),t.nodes&&(e.nodes=t.nodes.map((i,s)=>this._resolveNode(i,s)),e.nodes=e.nodes.map((i,s)=>this._resolveNodeChildren(i))),t.skins&&(e.skins=t.skins.map((i,s)=>this._resolveSkin(i,s))),t.scenes&&(e.scenes=t.scenes.map((i,s)=>this._resolveScene(i,s))),typeof this.json.scene=="number"&&e.scenes&&(e.scene=e.scenes[this.json.scene]),e}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,e){if(typeof e=="object")return e;const i=t&&t[e];return i||console.warn(`glTF file error: Could not find ${t}[${e}]`),i}_resolveScene(t,e){return{...t,id:t.id||`scene-${e}`,nodes:(t.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(t,e){const i={...t,id:(t==null?void 0:t.id)||`node-${e}`};return t.mesh!==void 0&&(i.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(i.camera=this.getCamera(t.camera)),t.skin!==void 0&&(i.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(i.mesh=t.meshes.reduce((s,r)=>{const o=this.getMesh(r);return s.id=o.id,s.primitives=s.primitives.concat(o.primitives),s},{primitives:[]})),i}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(e=>this.getNode(e))),t}_resolveSkin(t,e){const i=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${e}`,inverseBindMatrices:i}}_resolveMesh(t,e){const i={...t,id:t.id||`mesh-${e}`,primitives:[]};return t.primitives&&(i.primitives=t.primitives.map(s=>{const r={...s,attributes:{},indices:void 0,material:void 0},o=s.attributes;for(const a in o)r.attributes[a]=this.getAccessor(o[a]);return s.indices!==void 0&&(r.indices=this.getAccessor(s.indices)),s.material!==void 0&&(r.material=this.getMaterial(s.material)),r})),i}_resolveMaterial(t,e){const i={...t,id:t.id||`material-${e}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const s=i.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return i}_resolveAccessor(t,e){const i=vG(t.componentType),s=BG(t.type),r=i*s,o={...t,id:t.id||`accessor-${e}`,bytesPerComponent:i,components:s,bytesPerElement:r,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:l,byteLength:c}=HA(o,o.bufferView),h=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let u=a.arrayBuffer.slice(h,h+c);o.bufferView.byteStride&&(u=this._getValueFromInterleavedBuffer(a,h,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new l(u)}return o}_getValueFromInterleavedBuffer(t,e,i,s,r){const o=new Uint8Array(r*s);for(let a=0;a<r;a++){const l=e+a*i;o.set(new Uint8Array(t.arrayBuffer.slice(l,l+s)),a*s)}return o.buffer}_resolveTexture(t,e){return{...t,id:t.id||`texture-${e}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):xG(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,e){const i={id:t.id||`sampler-${e}`,...t,parameters:{}};for(const s in i){const r=this._enumSamplerParameter(s);r!==void 0&&(i.parameters[r]=i[s])}return i}_enumSamplerParameter(t){return yG[t]}_resolveImage(t,e){const i={...t,id:t.id||`image-${e}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},s=this.images[e];return s&&(i.image=s),i}_resolveBufferView(t,e){const i=t.buffer,s=this.buffers[i].arrayBuffer;let r=this.buffers[i].byteOffset||0;return t.byteOffset&&(r+=t.byteOffset),{id:`bufferView-${e}`,...t,buffer:this.buffers[i],data:new Uint8Array(s,r,t.byteLength)}}_resolveCamera(t,e){const i={...t,id:t.id||`camera-${e}`};return i.perspective,i.orthographic,i}}function UC(n,t){return new IG().postProcess(n,t)}const xf={URI:0,EMBEDDED:1};function NC(n,t,e,i){n.rotateYtoZ=!0;const s=(n.byteOffset||0)+(n.byteLength||0)-e;if(s===0)throw new Error("glTF byte length must be greater than 0.");return n.gltfUpAxis=i!=null&&i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",n.gltfArrayBuffer=vA(t,e,s),n.gltfByteOffset=0,n.gltfByteLength=s,e%4===0||console.warn(`${n.type}: embedded glb is not aligned to a 4-byte boundary.`),(n.byteOffset||0)+(n.byteLength||0)}async function OC(n,t,e,i){const s=(e==null?void 0:e["3d-tiles"])||{};if(bG(n,t),s.loadGLTF){if(!i)return;if(n.gltfUrl){const{fetch:r}=i,o=await r(n.gltfUrl,e);n.gltfArrayBuffer=await o.arrayBuffer(),n.gltfByteOffset=0}if(n.gltfArrayBuffer){const r=await qa(n.gltfArrayBuffer,zc,e,i);n.gltf=UC(r),n.gpuMemoryUsageInBytes=yC(n.gltf),delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength}}}function bG(n,t,e){switch(t){case xf.URI:if(n.gltfArrayBuffer){const i=new Uint8Array(n.gltfArrayBuffer,n.gltfByteOffset),s=new TextDecoder().decode(i);n.gltfUrl=s.replace(/[\s\0]+$/,"")}delete n.gltfArrayBuffer,delete n.gltfByteOffset,delete n.gltfByteLength;break;case xf.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function MG(n,t,e,i,s){var r;e=SG(n,t,e,i),await OC(n,xf.EMBEDDED,i,s);const o=n==null||(r=n.gltf)===null||r===void 0?void 0:r.extensions;return o&&o.CESIUM_RTC&&(n.rtcCenter=o.CESIUM_RTC.center),e}function SG(n,t,e,i,s){e=yh(n,t,e),e=UA(n,t,e),e=NA(n,t,e),e=NC(n,t,e,i);const r=new FA(n.featureTableJson,n.featureTableBinary);return n.rtcCenter=r.getGlobalProperty("RTC_CENTER",ne.FLOAT,3),e}async function TG(n,t,e,i,s){return e=wG(n,t,e,i),await OC(n,n.gltfFormat||0,i,s),e}function wG(n,t,e,i,s){var r;if(e=yh(n,t,e),n.version!==1)throw new Error(`Instanced 3D Model version ${n.version} is not supported`);e=UA(n,t,e);const o=new DataView(t);if(n.gltfFormat=o.getUint32(e,!0),e+=4,e=NA(n,t,e),e=NC(n,t,e,i),!(n!=null&&(r=n.header)!==null&&r!==void 0&&r.featureTableJsonByteLength)||n.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new FA(n.featureTableJson,n.featureTableBinary),l=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=l,!Number.isFinite(l))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");n.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),n.rtcCenter=a.getGlobalProperty("RTC_CENTER",ne.FLOAT,3);const c=new dC(n.batchTableJson,n.batchTableBinary,l);return RG(n,a,c,l),e}function RG(n,t,e,i){const s=new Array(i),r=new q;new q,new q,new q;const o=new Re,a=new Oc,l=new q,c={},h=new ye,u=[],d=[],f=[],p=[];for(let m=0;m<i;m++){let g;if(t.hasProperty("POSITION"))g=t.getProperty("POSITION",ne.FLOAT,3,m,r);else if(t.hasProperty("POSITION_QUANTIZED")){g=t.getProperty("POSITION_QUANTIZED",ne.UNSIGNED_SHORT,3,m,r);const M=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ne.FLOAT,3);if(!M)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const S=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ne.FLOAT,3);if(!S)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const R=65535;for(let B=0;B<3;B++)g[B]=g[B]/R*S[B]+M[B]}if(!g)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(r.copy(g),c.translation=r,n.normalUp=t.getProperty("NORMAL_UP",ne.FLOAT,3,m,u),n.normalRight=t.getProperty("NORMAL_RIGHT",ne.FLOAT,3,m,d),n.normalUp){if(!n.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");n.hasCustomOrientation=!0}else{if(n.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",ne.UNSIGNED_SHORT,2,m,u),n.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",ne.UNSIGNED_SHORT,2,m,d),n.octNormalUp)throw n.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");n.eastNorthUp?(Ee.WGS84.eastNorthUpToFixedFrame(r,h),h.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),c.rotation=a,l.set(1,1,1);const A=t.getProperty("SCALE",ne.FLOAT,1,m,f);Number.isFinite(A)&&l.multiplyByScalar(A);const C=t.getProperty("SCALE_NON_UNIFORM",ne.FLOAT,3,m,u);C&&l.scale(C),c.scale=l;let E=t.getProperty("BATCH_ID",ne.UNSIGNED_SHORT,1,m,p);E===void 0&&(E=m);const _=new ye().fromQuaternion(c.rotation);h.identity(),h.translate(c.translation),h.multiplyRight(_),h.scale(c.scale);const T=h.clone();s[m]={modelMatrix:T,batchId:E}}n.instances=s}async function DG(n,t,e,i,s,r){e=yh(n,t,e);const o=new DataView(t);for(n.tilesLength=o.getUint32(e,!0),e+=4,n.tiles=[];n.tiles.length<n.tilesLength&&(n.byteLength||0)-e>12;){const a={shape:"tile3d"};n.tiles.push(a),e=await r(t,e,i,s,a)}return e}async function LG(n,t,e,i){var s,r;if(n.rotateYtoZ=!0,n.gltfUpAxis=e!=null&&(s=e["3d-tiles"])!==null&&s!==void 0&&s.assetGltfUpAxis?e["3d-tiles"].assetGltfUpAxis:"Y",e!=null&&(r=e["3d-tiles"])!==null&&r!==void 0&&r.loadGLTF){if(!i)return t.byteLength;const o=await qa(t,zc,e,i);n.gltf=UC(o),n.gpuMemoryUsageInBytes=yC(n.gltf)}else n.gltfArrayBuffer=t;return t.byteLength}async function GC(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(s.byteOffset=t,s.type=e2(n,t),s.type){case Vo.COMPOSITE:return await DG(s,n,t,e,i,GC);case Vo.BATCHED_3D_MODEL:return await MG(s,n,t,e,i);case Vo.GLTF:return await LG(s,n,e,i);case Vo.INSTANCED_3D_MODEL:return await TG(s,n,t,e,i);case Vo.POINT_CLOUD:return await G2(s,n,t,e,i);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}const PG=1952609651,FG=1;async function UG(n,t,e){if(new Uint32Array(n.slice(0,4))[0]!==PG)throw new Error("Wrong subtree file magic number");if(new Uint32Array(n.slice(4,8))[0]!==FG)throw new Error("Wrong subtree file verson, must be 1");const i=b0(n.slice(8,16)),s=new Uint8Array(n,24,i),r=new TextDecoder("utf8").decode(s),o=JSON.parse(r),a=b0(n.slice(16,24));let l=new ArrayBuffer(0);if(a&&(l=n.slice(24+i)),await ic(o,o.tileAvailability,l,e),Array.isArray(o.contentAvailability))for(const c of o.contentAvailability)await ic(o,c,l,e);else await ic(o,o.contentAvailability,l,e);return await ic(o,o.childSubtreeAvailability,l,e),o}async function ic(n,t,e,i){const s=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof s!="number")return;const r=n.bufferViews[s],o=n.buffers[r.buffer];if(!(i!=null&&i.baseUrl))throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){const l=`${(i==null?void 0:i.baseUrl)||""}/${o.uri}`,c=await(await i.fetch(l)).arrayBuffer();t.explicitBitstream=new Uint8Array(c,r.byteOffset,r.byteLength);return}const a=n.buffers.slice(0,r.buffer).reduce((l,c)=>l+c.byteLength,0);t.explicitBitstream=new Uint8Array(e.slice(a,a+o.byteLength),r.byteOffset,r.byteLength)}function b0(n){const t=new DataView(n),e=t.getUint32(0,!0),i=t.getUint32(4,!0);return e+2**32*i}const QC={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:aC,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:UG,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var qn=null;try{qn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ge(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}ge.prototype.__isLong__;Object.defineProperty(ge.prototype,"__isLong__",{value:!0});function un(n){return(n&&n.__isLong__)===!0}function M0(n){var t=Math.clz32(n&-n);return n?31-t:t}ge.isLong=un;var S0={},T0={};function _r(n,t){var e,i,s;return t?(n>>>=0,(s=0<=n&&n<256)&&(i=T0[n],i)?i:(e=se(n,0,!0),s&&(T0[n]=e),e)):(n|=0,(s=-128<=n&&n<128)&&(i=S0[n],i)?i:(e=se(n,n<0?-1:0,!1),s&&(S0[n]=e),e))}ge.fromInt=_r;function jn(n,t){if(isNaN(n))return t?ns:oi;if(t){if(n<0)return ns;if(n>=HC)return zC}else{if(n<=-R0)return bn;if(n+1>=R0)return VC}return n<0?jn(-n,t).neg():se(n%mo|0,n/mo|0,t)}ge.fromNumber=jn;function se(n,t,e){return new ge(n,t,e)}ge.fromBits=se;var Wc=Math.pow;function jA(n,t,e){if(n.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return t?ns:oi;if(e=e||10,e<2||36<e)throw RangeError("radix");var i;if((i=n.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return jA(n.substring(1),t,e).neg();for(var s=jn(Wc(e,8)),r=oi,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),l=parseInt(n.substring(o,o+a),e);if(a<8){var c=jn(Wc(e,a));r=r.mul(c).add(jn(l))}else r=r.mul(s),r=r.add(jn(l))}return r.unsigned=t,r}ge.fromString=jA;function pi(n,t){return typeof n=="number"?jn(n,t):typeof n=="string"?jA(n,t):se(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}ge.fromValue=pi;var w0=65536,NG=1<<24,mo=w0*w0,HC=mo*mo,R0=HC/2,D0=_r(NG),oi=_r(0);ge.ZERO=oi;var ns=_r(0,!0);ge.UZERO=ns;var jr=_r(1);ge.ONE=jr;var kC=_r(1,!0);ge.UONE=kC;var vf=_r(-1);ge.NEG_ONE=vf;var VC=se(-1,2147483647,!1);ge.MAX_VALUE=VC;var zC=se(-1,-1,!0);ge.MAX_UNSIGNED_VALUE=zC;var bn=se(0,-2147483648,!1);ge.MIN_VALUE=bn;var At=ge.prototype;At.toInt=function(){return this.unsigned?this.low>>>0:this.low};At.toNumber=function(){return this.unsigned?(this.high>>>0)*mo+(this.low>>>0):this.high*mo+(this.low>>>0)};At.toString=function(n){if(n=n||10,n<2||36<n)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(bn)){var t=jn(n),e=this.div(t),i=e.mul(t).sub(this);return e.toString(n)+i.toInt().toString(n)}else return"-"+this.neg().toString(n);for(var s=jn(Wc(n,6),this.unsigned),r=this,o="";;){var a=r.div(s),l=r.sub(a.mul(s)).toInt()>>>0,c=l.toString(n);if(r=a,r.isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}};At.getHighBits=function(){return this.high};At.getHighBitsUnsigned=function(){return this.high>>>0};At.getLowBits=function(){return this.low};At.getLowBitsUnsigned=function(){return this.low>>>0};At.getNumBitsAbs=function(){if(this.isNegative())return this.eq(bn)?64:this.neg().getNumBitsAbs();for(var n=this.high!=0?this.high:this.low,t=31;t>0&&!(n&1<<t);t--);return this.high!=0?t+33:t+1};At.isZero=function(){return this.high===0&&this.low===0};At.eqz=At.isZero;At.isNegative=function(){return!this.unsigned&&this.high<0};At.isPositive=function(){return this.unsigned||this.high>=0};At.isOdd=function(){return(this.low&1)===1};At.isEven=function(){return(this.low&1)===0};At.equals=function(n){return un(n)||(n=pi(n)),this.unsigned!==n.unsigned&&this.high>>>31===1&&n.high>>>31===1?!1:this.high===n.high&&this.low===n.low};At.eq=At.equals;At.notEquals=function(n){return!this.eq(n)};At.neq=At.notEquals;At.ne=At.notEquals;At.lessThan=function(n){return this.comp(n)<0};At.lt=At.lessThan;At.lessThanOrEqual=function(n){return this.comp(n)<=0};At.lte=At.lessThanOrEqual;At.le=At.lessThanOrEqual;At.greaterThan=function(n){return this.comp(n)>0};At.gt=At.greaterThan;At.greaterThanOrEqual=function(n){return this.comp(n)>=0};At.gte=At.greaterThanOrEqual;At.ge=At.greaterThanOrEqual;At.compare=function(n){if(un(n)||(n=pi(n)),this.eq(n))return 0;var t=this.isNegative(),e=n.isNegative();return t&&!e?-1:!t&&e?1:this.unsigned?n.high>>>0>this.high>>>0||n.high===this.high&&n.low>>>0>this.low>>>0?-1:1:this.sub(n).isNegative()?-1:1};At.comp=At.compare;At.negate=function(){return!this.unsigned&&this.eq(bn)?bn:this.not().add(jr)};At.neg=At.negate;At.add=function(n){un(n)||(n=pi(n));var t=this.high>>>16,e=this.high&65535,i=this.low>>>16,s=this.low&65535,r=n.high>>>16,o=n.high&65535,a=n.low>>>16,l=n.low&65535,c=0,h=0,u=0,d=0;return d+=s+l,u+=d>>>16,d&=65535,u+=i+a,h+=u>>>16,u&=65535,h+=e+o,c+=h>>>16,h&=65535,c+=t+r,c&=65535,se(u<<16|d,c<<16|h,this.unsigned)};At.subtract=function(n){return un(n)||(n=pi(n)),this.add(n.neg())};At.sub=At.subtract;At.multiply=function(n){if(this.isZero())return this;if(un(n)||(n=pi(n)),qn){var t=qn.mul(this.low,this.high,n.low,n.high);return se(t,qn.get_high(),this.unsigned)}if(n.isZero())return this.unsigned?ns:oi;if(this.eq(bn))return n.isOdd()?bn:oi;if(n.eq(bn))return this.isOdd()?bn:oi;if(this.isNegative())return n.isNegative()?this.neg().mul(n.neg()):this.neg().mul(n).neg();if(n.isNegative())return this.mul(n.neg()).neg();if(this.lt(D0)&&n.lt(D0))return jn(this.toNumber()*n.toNumber(),this.unsigned);var e=this.high>>>16,i=this.high&65535,s=this.low>>>16,r=this.low&65535,o=n.high>>>16,a=n.high&65535,l=n.low>>>16,c=n.low&65535,h=0,u=0,d=0,f=0;return f+=r*c,d+=f>>>16,f&=65535,d+=s*c,u+=d>>>16,d&=65535,d+=r*l,u+=d>>>16,d&=65535,u+=i*c,h+=u>>>16,u&=65535,u+=s*l,h+=u>>>16,u&=65535,u+=r*a,h+=u>>>16,u&=65535,h+=e*c+i*l+s*a+r*o,h&=65535,se(d<<16|f,h<<16|u,this.unsigned)};At.mul=At.multiply;At.divide=function(n){if(un(n)||(n=pi(n)),n.isZero())throw Error("division by zero");if(qn){if(!this.unsigned&&this.high===-2147483648&&n.low===-1&&n.high===-1)return this;var t=(this.unsigned?qn.div_u:qn.div_s)(this.low,this.high,n.low,n.high);return se(t,qn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ns:oi;var e,i,s;if(this.unsigned){if(n.unsigned||(n=n.toUnsigned()),n.gt(this))return ns;if(n.gt(this.shru(1)))return kC;s=ns}else{if(this.eq(bn)){if(n.eq(jr)||n.eq(vf))return bn;if(n.eq(bn))return jr;var r=this.shr(1);return e=r.div(n).shl(1),e.eq(oi)?n.isNegative()?jr:vf:(i=this.sub(n.mul(e)),s=e.add(i.div(n)),s)}else if(n.eq(bn))return this.unsigned?ns:oi;if(this.isNegative())return n.isNegative()?this.neg().div(n.neg()):this.neg().div(n).neg();if(n.isNegative())return this.div(n.neg()).neg();s=oi}for(i=this;i.gte(n);){e=Math.max(1,Math.floor(i.toNumber()/n.toNumber()));for(var o=Math.ceil(Math.log(e)/Math.LN2),a=o<=48?1:Wc(2,o-48),l=jn(e),c=l.mul(n);c.isNegative()||c.gt(i);)e-=a,l=jn(e,this.unsigned),c=l.mul(n);l.isZero()&&(l=jr),s=s.add(l),i=i.sub(c)}return s};At.div=At.divide;At.modulo=function(n){if(un(n)||(n=pi(n)),qn){var t=(this.unsigned?qn.rem_u:qn.rem_s)(this.low,this.high,n.low,n.high);return se(t,qn.get_high(),this.unsigned)}return this.sub(this.div(n).mul(n))};At.mod=At.modulo;At.rem=At.modulo;At.not=function(){return se(~this.low,~this.high,this.unsigned)};At.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};At.clz=At.countLeadingZeros;At.countTrailingZeros=function(){return this.low?M0(this.low):M0(this.high)+32};At.ctz=At.countTrailingZeros;At.and=function(n){return un(n)||(n=pi(n)),se(this.low&n.low,this.high&n.high,this.unsigned)};At.or=function(n){return un(n)||(n=pi(n)),se(this.low|n.low,this.high|n.high,this.unsigned)};At.xor=function(n){return un(n)||(n=pi(n)),se(this.low^n.low,this.high^n.high,this.unsigned)};At.shiftLeft=function(n){return un(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?se(this.low<<n,this.high<<n|this.low>>>32-n,this.unsigned):se(0,this.low<<n-32,this.unsigned)};At.shl=At.shiftLeft;At.shiftRight=function(n){return un(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?se(this.low>>>n|this.high<<32-n,this.high>>n,this.unsigned):se(this.high>>n-32,this.high>=0?0:-1,this.unsigned)};At.shr=At.shiftRight;At.shiftRightUnsigned=function(n){return un(n)&&(n=n.toInt()),(n&=63)===0?this:n<32?se(this.low>>>n|this.high<<32-n,this.high>>>n,this.unsigned):n===32?se(this.high,0,this.unsigned):se(this.high>>>n-32,0,this.unsigned)};At.shru=At.shiftRightUnsigned;At.shr_u=At.shiftRightUnsigned;At.rotateLeft=function(n){var t;return un(n)&&(n=n.toInt()),(n&=63)===0?this:n===32?se(this.high,this.low,this.unsigned):n<32?(t=32-n,se(this.low<<n|this.high>>>t,this.high<<n|this.low>>>t,this.unsigned)):(n-=32,t=32-n,se(this.high<<n|this.low>>>t,this.low<<n|this.high>>>t,this.unsigned))};At.rotl=At.rotateLeft;At.rotateRight=function(n){var t;return un(n)&&(n=n.toInt()),(n&=63)===0?this:n===32?se(this.high,this.low,this.unsigned):n<32?(t=32-n,se(this.high<<t|this.low>>>n,this.low<<t|this.high>>>n,this.unsigned)):(n-=32,t=32-n,se(this.low<<t|this.high>>>n,this.high<<t|this.low>>>n,this.unsigned))};At.rotr=At.rotateRight;At.toSigned=function(){return this.unsigned?se(this.low,this.high,!1):this};At.toUnsigned=function(){return this.unsigned?this:se(this.low,this.high,!0)};At.toBytes=function(n){return n?this.toBytesLE():this.toBytesBE()};At.toBytesLE=function(){var n=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,n&255,n>>>8&255,n>>>16&255,n>>>24]};At.toBytesBE=function(){var n=this.high,t=this.low;return[n>>>24,n>>>16&255,n>>>8&255,n&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ge.fromBytes=function(n,t,e){return e?ge.fromBytesLE(n,t):ge.fromBytesBE(n,t)};ge.fromBytesLE=function(n,t){return new ge(n[0]|n[1]<<8|n[2]<<16|n[3]<<24,n[4]|n[5]<<8|n[6]<<16|n[7]<<24,t)};ge.fromBytesBE=function(n,t){return new ge(n[4]<<24|n[5]<<16|n[6]<<8|n[7],n[0]<<24|n[1]<<16|n[2]<<8|n[3],t)};const OG=16;function WC(n){n==="X"&&(n="");const t=n.padEnd(OG,"0");return ge.fromString(t,!0,16)}function GG(n){if(n.isZero())return"X";let t=n.countTrailingZeros();const e=t%4;t=(t-e)/4;const i=t;t*=4;const s=n.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-i-s.length).join("0")+s}function QG(n,t){const e=HG(n).shiftRightUnsigned(2);return n.add(ge.fromNumber(2*t+1-4).multiply(e))}function HG(n){return n.and(n.not().add(1))}const kG=3,VG=30,zG=2*VG+1,L0=180/Math.PI;function WG(n){if(n.length===0)throw new Error(`Invalid Hilbert quad key ${n}`);const t=n.split("/"),e=parseInt(t[0],10),i=t[1],s=i.length;let r=0;const o=[0,0];for(let a=s-1;a>=0;a--){r=s-a;const l=i[a];let c=0,h=0;l==="1"?h=1:l==="2"?(c=1,h=1):l==="3"&&(c=1);const u=Math.pow(2,r-1);qG(u,o,c,h),o[0]+=u*c,o[1]+=u*h}if(e%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:e,ij:o,level:r}}function JG(n){if(n.isZero())return"";let t=n.toString(2);for(;t.length<kG+zG;)t="0"+t;const e=t.lastIndexOf("1"),i=t.substring(0,3),s=t.substring(3,e),r=s.length/2,o=ge.fromString(i,!0,2).toString(10);let a="";if(r!==0)for(a=ge.fromString(s,!0,2).toString(4);a.length<r;)a="0"+a;return`${o}/${a}`}function JC(n,t,e){const i=1<<t;return[(n[0]+e[0])/i,(n[1]+e[1])/i]}function P0(n){return n>=.5?1/3*(4*n*n-1):1/3*(1-4*(1-n)*(1-n))}function qC(n){return[P0(n[0]),P0(n[1])]}function jC(n,t){let[e,i]=t;switch(n){case 0:return[1,e,i];case 1:return[-e,1,i];case 2:return[-e,-i,1];case 3:return[-1,-i,-e];case 4:return[i,-1,-e];case 5:return[i,e,-1];default:throw new Error("Invalid face")}}function XC(n){let[t,e,i]=n;const s=Math.atan2(i,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*L0,s*L0]}function qG(n,t,e,i){if(i===0){e===1&&(t[0]=n-1-t[0],t[1]=n-1-t[1]);const s=t[0];t[0]=t[1],t[1]=s}}function jG(n){const t=JC(n.ij,n.level,[.5,.5]),e=qC(t),i=jC(n.face,e);return XC(i)}const XG=100;function F0(n){const{face:t,ij:e,level:i}=n,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(XG*Math.pow(2,-i))),o=new Float64Array(4*r*2+2);let a=0,l=0;for(let c=0;c<4;c++){const h=s[c].slice(0),u=s[c+1],d=(u[0]-h[0])/r,f=(u[1]-h[1])/r;for(let p=0;p<r;p++){h[0]+=d,h[1]+=f;const m=JC(e,i,h),g=qC(m),A=jC(t,g),C=XC(A);Math.abs(C[1])>89.999&&(C[0]=l);const E=C[0]-l;C[0]+=E>180?-360:E<-180?360:0,o[a++]=C[0],o[a++]=C[1],l=C[0]}}return o[a++]=o[0],o[a++]=o[1],o}function XA(n){const t=KG(n);return WG(t)}function KG(n){if(n.indexOf("/")>0)return n;const t=WC(n);return JG(t)}function YG(n){const t=XA(n);return jG(t)}function ZG(n){let t;if(n.face===2||n.face===5){let e=null,i=0;for(let s=0;s<4;s++){const r=`${n.face}/${s}`,o=XA(r),a=F0(o);(typeof e>"u"||e===null)&&(e=new Float64Array(4*a.length)),e.set(a,i),i+=a.length}t=U0(e)}else{const e=F0(n);t=U0(e)}return t}function U0(n){if(n.length%2!==0)throw new Error("Invalid corners");const t=[],e=[];for(let i=0;i<n.length;i+=2)t.push(n[i]),e.push(n[i+1]);return t.sort((i,s)=>i-s),e.sort((i,s)=>i-s),{west:t[0],east:t[t.length-1],north:e[e.length-1],south:e[0]}}function $G(n,t){const e=(t==null?void 0:t.minimumHeight)||0,i=(t==null?void 0:t.maximumHeight)||0,s=XA(n),r=ZG(s),o=r.west,a=r.south,l=r.east,c=r.north,h=[];return h.push(new q(o,c,e)),h.push(new q(l,c,e)),h.push(new q(l,a,e)),h.push(new q(o,a,e)),h.push(new q(o,c,i)),h.push(new q(l,c,i)),h.push(new q(l,a,i)),h.push(new q(o,a,i)),h}function KC(n){const t=n.token,e={minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight},i=$G(t,e),s=YG(t),r=s[0],o=s[1],a=Ee.WGS84.cartographicToCartesian([r,o,e.maximumHeight]),l=new q(a[0],a[1],a[2]);i.push(l);const c=$U(i);return[...c.center,...c.halfAxes]}const tQ=4,eQ=8,nQ={QUADTREE:tQ,OCTREE:eQ};function iQ(n,t,e){if(n!=null&&n.box){const i=WC(n.s2VolumeInfo.token),s=QG(i,t),r=GG(s),o={...n.s2VolumeInfo};switch(o.token=r,e){case"OCTREE":const a=n.s2VolumeInfo,l=a.maximumHeight-a.minimumHeight,c=l/2,h=a.minimumHeight+l/2;a.minimumHeight=h-c,a.maximumHeight=h+c;break}return{box:KC(o),s2VolumeInfo:o}}}async function YC(n){const{implicitOptions:t,parentData:e={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,s2VolumeBox:s,loaderOptions:r}=n;let{subtree:o,level:a=0,globalData:l={level:0,mortonIndex:0,x:0,y:0,z:0}}=n;const{subdivisionScheme:c,subtreeLevels:h,maximumLevel:u,contentUrlTemplate:d,subtreesUriTemplate:f,basePath:p}=t,m={children:[],lodMetricValue:0,contentUrl:""};if(!u)return Ny.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${d} won't be loaded...`),m;const g=a+l.level;if(g>u)return m;const A=nQ[c],C=Math.log2(A),E=i&1,_=i>>1&1,T=i>>2&1,M=(A**a-1)/(A-1);let S=Xs(e.mortonIndex,i,C),R=M+S,B=Xs(e.x,E,1),x=Xs(e.y,_,1),D=Xs(e.z,T,1),V=!1;a>=h&&(V=nd(o.childSubtreeAvailability,S));const Q=Xs(l.x,B,a),k=Xs(l.y,x,a),et=Xs(l.z,D,a);if(V){const U=`${p}/${f}`,ut=Bf(U,g,Q,k,et);o=await po(ut,QC,r),l={mortonIndex:S,x:B,y:x,z:D,level:a},S=0,R=0,B=0,x=0,D=0,a=0}if(!nd(o.tileAvailability,R))return m;nd(o.contentAvailability,R)&&(m.contentUrl=Bf(d,g,Q,k,et));const j=a+1,X={mortonIndex:S,x:B,y:x,z:D};for(let U=0;U<A;U++){const ut=iQ(s,U,c),gt=await YC({subtree:o,implicitOptions:t,loaderOptions:r,parentData:X,childIndex:U,level:j,globalData:{...l},s2VolumeBox:ut});if(gt.contentUrl||gt.children.length){const Et=g+1,Dt=sQ(gt,Et,{childTileX:B,childTileY:x,childTileZ:D},t,s);m.children.push(Dt)}}return m}function nd(n,t){let e;return Array.isArray(n)?(e=n[0],n.length>1&&Ny.once('Not supported extension "3DTILES_multiple_contents" has been detected')):e=n,"constant"in e?!!e.constant:e.explicitBitstream?aQ(t,e.explicitBitstream):!1}function sQ(n,t,e,i,s){const{basePath:r,refine:o,getRefine:a,lodMetricType:l,getTileType:c,rootLodMetricValue:h,rootBoundingVolume:u}=i,d=n.contentUrl&&n.contentUrl.replace(`${r}/`,""),f=h/2**t,p=s!=null&&s.box?{box:s.box}:u,m=rQ(t,p,e);return{children:n.children,contentUrl:n.contentUrl,content:{uri:d},id:n.contentUrl,refine:a(o),type:c(n),lodMetricType:l,lodMetricValue:f,geometricError:f,transform:n.transform,boundingVolume:m}}function rQ(n,t,e){if(t.region){const{childTileX:i,childTileY:s,childTileZ:r}=e,[o,a,l,c,h,u]=t.region,d=2**n,f=(l-o)/d,p=(c-a)/d,m=(u-h)/d,[g,A]=[o+f*i,o+f*(i+1)],[C,E]=[a+p*s,a+p*(s+1)],[_,T]=[h+m*r,h+m*(r+1)];return{region:[g,C,A,E,_,T]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${t}`)}function Xs(n,t,e){return(n<<e)+t}function Bf(n,t,e,i,s){const r=oQ({level:t,x:e,y:i,z:s});return n.replace(/{level}|{x}|{y}|{z}/gi,o=>r[o])}function oQ(n){const t={};for(const e in n)t[`{${e}}`]=n[e];return t}function aQ(n,t){const e=Math.floor(n/8),i=n%8;return(t[e]>>i&1)===1}function KA(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!t)return $l.EMPTY;const e=t.split("?")[0].split(".").pop();switch(e){case"pnts":return $l.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return $l.SCENEGRAPH;default:return e||$l.EMPTY}}function YA(n){switch(n){case"REPLACE":case"replace":return n0.REPLACE;case"ADD":case"add":return n0.ADD;default:return n}}function If(n,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const e=new URL(n,`${t}/`);return decodeURI(e.toString())}else if(n.startsWith("/"))return n;return EL(t,n)}function N0(n,t){if(!n)return null;let e;if(n.content){var i;const s=n.content.uri||((i=n.content)===null||i===void 0?void 0:i.url);typeof s<"u"&&(e=If(s,t))}return{...n,id:e,contentUrl:e,lodMetricType:Eh.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:KA(n,e),refine:YA(n.refine)}}async function lQ(n,t,e){let i=null;const s=G0(n.root);s&&n.root?i=await O0(n.root,n,t,s,e):i=N0(n.root,t);const r=[];for(r.push(i);r.length>0;){const o=r.pop()||{},a=o.children||[],l=[];for(const c of a){const h=G0(c);let u;h?u=await O0(c,n,t,h,e):u=N0(c,t),u&&(l.push(u),r.push(u))}o.children=l}return i}async function O0(n,t,e,i,s){var r,o,a;const{subdivisionScheme:l,maximumLevel:c,availableLevels:h,subtreeLevels:u,subtrees:{uri:d}}=i,f=Bf(d,0,0,0,0),p=If(f,e),m=await po(p,QC,s),g=(r=n.content)===null||r===void 0?void 0:r.uri,A=g?If(g,e):"",C=t==null||(o=t.root)===null||o===void 0?void 0:o.refine,E=n.geometricError,_=(a=n.boundingVolume.extensions)===null||a===void 0?void 0:a["3DTILES_bounding_volume_S2"];if(_){const S={box:KC(_),s2VolumeInfo:_};n.boundingVolume=S}const T=n.boundingVolume,M={contentUrlTemplate:A,subtreesUriTemplate:d,subdivisionScheme:l,subtreeLevels:u,maximumLevel:Number.isFinite(h)?h-1:c,refine:C,basePath:e,lodMetricType:Eh.GEOMETRIC_ERROR,rootLodMetricValue:E,rootBoundingVolume:T,getTileType:KA,getRefine:YA};return await cQ(n,e,m,M,s)}async function cQ(n,t,e,i,s){if(!n)return null;const{children:r,contentUrl:o}=await YC({subtree:e,implicitOptions:i,loaderOptions:s});let a,l=null;return o&&(a=o,l={uri:o.replace(`${t}/`,"")}),{...n,id:a,contentUrl:a,lodMetricType:Eh.GEOMETRIC_ERROR,lodMetricValue:n.geometricError,transformMatrix:n.transform,type:KA(n,a),refine:YA(n.refine),content:l||n.content,children:r}}function G0(n){var t;return(n==null||(t=n.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(n==null?void 0:n.implicitTiling)}const _a={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:aC,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:hQ,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function hQ(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const i=t["3d-tiles"]||{};let s;return i.isTileset==="auto"?s=(e==null?void 0:e.url)&&e.url.indexOf(".json")!==-1:s=i.isTileset,s?uQ(n,t,e):dQ(n,t,e)}async function uQ(n,t,e){var i;const s=JSON.parse(new TextDecoder().decode(n)),r=(e==null?void 0:e.url)||"",o=fQ(r),a=await lQ(s,o,t||{});return{...s,shape:"tileset3d",loader:_a,url:r,queryString:(e==null?void 0:e.queryString)||"",basePath:o,root:a||s.root,type:t2.TILES3D,lodMetricType:Eh.GEOMETRIC_ERROR,lodMetricValue:((i=s.root)===null||i===void 0?void 0:i.geometricError)||0}}async function dQ(n,t,e){const i={content:{shape:"tile3d",featureIds:null}};return await GC(n,0,t,e,i.content),i.content}function fQ(n){return Ry(n)}const ZC="https://api.cesium.com/v1/assets";async function AQ(n,t){if(!t){const r=await pQ(n);for(const o of r.items)o.type==="3DTILES"&&(t=o.id)}const e=await gQ(n,t),{type:i,url:s}=e;return Se(i==="3DTILES"&&s),e.headers={Authorization:`Bearer ${e.accessToken}`},e}async function pQ(n){Se(n);const t=ZC,e={Authorization:`Bearer ${n}`},i=await La(t,{headers:e});if(!i.ok)throw new Error(i.statusText);return await i.json()}async function gQ(n,t){Se(n,t);const e={Authorization:`Bearer ${n}`},i=`${ZC}/${t}`;let s=await La(`${i}`,{headers:e});if(!s.ok)throw new Error(s.statusText);let r=await s.json();if(s=await La(`${i}/endpoint`,{headers:e}),!s.ok)throw new Error(s.statusText);const o=await s.json();return r={...r,...o},r}async function mQ(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t["cesium-ion"]||{};const{accessToken:e}=t;let i=t.assetId;if(!Number.isFinite(i)){const s=n.match(/\/([0-9]+)\/tileset.json/);i=s&&s[1]}return AQ(e,i)}const $C={..._a,id:"cesium-ion",name:"Cesium Ion",preload:mQ,parse:async(n,t,e)=>(t={...t},t["3d-tiles"]=t["cesium-ion"],t.loader=$C,_a.parse(n,t,e)),options:{"cesium-ion":{..._a.options["3d-tiles"],accessToken:null}}},Q0=100;class _Q{constructor(t,e){if(this.schema=void 0,this.options=void 0,this.shape=void 0,this.length=0,this.rows=null,this.cursor=0,this._headers=[],this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const i in t)this._headers[t[i].index]=t[i].name}}rowCount(){return this.length}addArrayRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="array-row-table",this.rows=this.rows||new Array(Q0),this.rows[this.length]=t,this.length++}addObjectRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="object-row-table",this.rows=this.rows||new Array(Q0),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function EQ(n,t){if(!n)throw new Error("null row");const e={};if(t)for(let i=0;i<t.length;i++)e[t[i]]=n[i];else for(let i=0;i<n.length;i++){const s=`column-${i}`;e[s]=n[i]}return e}function yQ(n,t){if(!n)throw new Error("null row");if(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=n[t[i]];return e}return Object.values(n)}function CQ(n){const t=[];for(let e=0;e<n.length;e++){const i=`column-${e}`;t.push(i)}return t}function xQ(n){return Object.keys(n)}const H0=100;class vQ{constructor(t,e){if(this.schema=void 0,this.options=void 0,this.length=0,this.objectRows=null,this.arrayRows=null,this.cursor=0,this._headers=null,this.options=e,this.schema=t,t){this._headers=[];for(const i in t)this._headers[t[i].index]=t[i].name}}rowCount(){return this.length}addArrayRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||(this._headers=CQ(t)),this.options.shape){case"object-row-table":const i=EQ(t,this._headers);this.addObjectRow(i,e);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(H0),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||(this._headers=xQ(t)),this.options.shape){case"array-row-table":const i=yQ(t,this._headers);this.addArrayRow(i,e);break;case"object-row-table":this.objectRows=this.objectRows||new Array(H0),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const BQ=100;class IQ{constructor(t,e){this.schema=void 0,this.length=0,this.allocated=0,this.columns={},this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let e=0;for(const i in this.columns)this.columns[i][this.length]=t[e++];this.length++}addObjectRow(t){this._reallocateColumns();for(const e in t)this.columns[e][this.length]=t[e];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const e in this.schema){const i=this.schema[e];t[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:BQ,this.columns={};for(const t in this.schema){const e=this.schema[t],i=e.type||Float32Array,s=this.columns[e.index];if(s&&ArrayBuffer.isView(s)){const r=new i(this.allocated);r.set(s),this.columns[e.index]=r}else s?(s.length=this.allocated,this.columns[e.index]=s):this.columns[e.index]=new i(this.allocated)}}}_pruneColumns(){for(const[t,e]of Object.entries(this.columns))this.columns[t]=e.slice(0,this.length)}}const bQ={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},MQ="TableBatchBuilder";class Ua{constructor(t,e){this.schema=void 0,this.options=void 0,this.aggregator=null,this.batchCount=0,this.bytesUsed=0,this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),this.totalLength=0,this.totalBytes=0,this.rowBytes=0,this.schema=t,this.options={...bQ,...e}}limitReached(){var t,e;return!!(!((t=this.options)===null||t===void 0)&&t.limit&&this.totalLength>=this.options.limit||!((e=this.options)===null||e===void 0)&&e._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const e=this._getTableBatchType();this.aggregator=new e(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const e=this._getTableBatchType();this.aggregator=new e(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t!=null&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const e=this.aggregator.getBatch();return e.count=this.batchCount,e.bytesUsed=this.bytesUsed,Object.assign(e,t),this.batchCount++,this.aggregator=null,e}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return vQ;case"columnar-table":return IQ;case"arrow-table":if(!Ua.ArrowBatch)throw new Error(MQ);return Ua.ArrowBatch;default:return _Q}}}Ua.ArrowBatch=void 0;function SQ(n){try{let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return async function*(){const e=new TextDecoder(void 0,t);for await(const i of n)yield typeof i=="string"?i:e.decode(i,{stream:!0})}()}catch(t){return Promise.reject(t)}}const bf=Number.MAX_SAFE_INTEGER;var Tt=function(n){return n[n.BEGIN=0]="BEGIN",n[n.VALUE=1]="VALUE",n[n.OPEN_OBJECT=2]="OPEN_OBJECT",n[n.CLOSE_OBJECT=3]="CLOSE_OBJECT",n[n.OPEN_ARRAY=4]="OPEN_ARRAY",n[n.CLOSE_ARRAY=5]="CLOSE_ARRAY",n[n.TEXT_ESCAPE=6]="TEXT_ESCAPE",n[n.STRING=7]="STRING",n[n.BACKSLASH=8]="BACKSLASH",n[n.END=9]="END",n[n.OPEN_KEY=10]="OPEN_KEY",n[n.CLOSE_KEY=11]="CLOSE_KEY",n[n.TRUE=12]="TRUE",n[n.TRUE2=13]="TRUE2",n[n.TRUE3=14]="TRUE3",n[n.FALSE=15]="FALSE",n[n.FALSE2=16]="FALSE2",n[n.FALSE3=17]="FALSE3",n[n.FALSE4=18]="FALSE4",n[n.NULL=19]="NULL",n[n.NULL2=20]="NULL2",n[n.NULL3=21]="NULL3",n[n.NUMBER_DECIMAL_POINT=22]="NUMBER_DECIMAL_POINT",n[n.NUMBER_DIGIT=23]="NUMBER_DIGIT",n}(Tt||{});const Nt={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125},k0=/[\\"\n]/g,V0={onready:()=>{},onopenobject:()=>{},onkey:()=>{},oncloseobject:()=>{},onopenarray:()=>{},onclosearray:()=>{},onvalue:()=>{},onerror:()=>{},onend:()=>{},onchunkparsed:()=>{}};class TQ{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.options=V0,this.bufferCheckPosition=bf,this.q="",this.c="",this.p="",this.closed=!1,this.closedRoot=!1,this.sawRoot=!1,this.error=null,this.state=Tt.BEGIN,this.stack=[],this.position=0,this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,this.textNode=void 0,this.numberNode=void 0,this.options={...V0,...t},this.textNode=void 0,this.numberNode="",this.emit("onready")}end(){return(this.state!==Tt.VALUE||this.depth!==0)&&this._error("Unexpected end"),this._closeValue(),this.c="",this.closed=!0,this.emit("onend"),this}resume(){return this.error=null,this}close(){return this.write(null)}emit(t,e){var i,s;(i=(s=this.options)[t])===null||i===void 0||i.call(s,e,this)}emitNode(t,e){this._closeValue(),this.emit(t,e)}write(t){if(this.error)throw this.error;if(this.closed)return this._error("Cannot write after close. Assign an onready handler.");if(t===null)return this.end();let e=0,i=t.charCodeAt(0),s=this.p;for(;i&&(s=i,this.c=i=t.charCodeAt(e++),s!==i?this.p=s:s=this.p,!!i);)switch(this.position++,i===Nt.lineFeed?(this.line++,this.column=0):this.column++,this.state){case Tt.BEGIN:i===Nt.openBrace?this.state=Tt.OPEN_OBJECT:i===Nt.openBracket?this.state=Tt.OPEN_ARRAY:qo(i)||this._error("Non-whitespace before {[.");continue;case Tt.OPEN_KEY:case Tt.OPEN_OBJECT:if(qo(i))continue;if(this.state===Tt.OPEN_KEY)this.stack.push(Tt.CLOSE_KEY);else if(i===Nt.closeBrace){this.emit("onopenobject"),this.depth++,this.emit("oncloseobject"),this.depth--,this.state=this.stack.pop()||Tt.VALUE;continue}else this.stack.push(Tt.CLOSE_OBJECT);i===Nt.doubleQuote?this.state=Tt.STRING:this._error('Malformed object key should start with "');continue;case Tt.CLOSE_KEY:case Tt.CLOSE_OBJECT:if(qo(i))continue;i===Nt.colon?(this.state===Tt.CLOSE_OBJECT?(this.stack.push(Tt.CLOSE_OBJECT),this._closeValue("onopenobject"),this.depth++):this._closeValue("onkey"),this.state=Tt.VALUE):i===Nt.closeBrace?(this.emitNode("oncloseobject"),this.depth--,this.state=this.stack.pop()||Tt.VALUE):i===Nt.comma?(this.state===Tt.CLOSE_OBJECT&&this.stack.push(Tt.CLOSE_OBJECT),this._closeValue(),this.state=Tt.OPEN_KEY):this._error("Bad object");continue;case Tt.OPEN_ARRAY:case Tt.VALUE:if(qo(i))continue;if(this.state===Tt.OPEN_ARRAY)if(this.emit("onopenarray"),this.depth++,this.state=Tt.VALUE,i===Nt.closeBracket){this.emit("onclosearray"),this.depth--,this.state=this.stack.pop()||Tt.VALUE;continue}else this.stack.push(Tt.CLOSE_ARRAY);i===Nt.doubleQuote?this.state=Tt.STRING:i===Nt.openBrace?this.state=Tt.OPEN_OBJECT:i===Nt.openBracket?this.state=Tt.OPEN_ARRAY:i===Nt.t?this.state=Tt.TRUE:i===Nt.f?this.state=Tt.FALSE:i===Nt.n?this.state=Tt.NULL:i===Nt.minus?this.numberNode+="-":Nt._0<=i&&i<=Nt._9?(this.numberNode+=String.fromCharCode(i),this.state=Tt.NUMBER_DIGIT):this._error("Bad value");continue;case Tt.CLOSE_ARRAY:if(i===Nt.comma)this.stack.push(Tt.CLOSE_ARRAY),this._closeValue("onvalue"),this.state=Tt.VALUE;else if(i===Nt.closeBracket)this.emitNode("onclosearray"),this.depth--,this.state=this.stack.pop()||Tt.VALUE;else{if(qo(i))continue;this._error("Bad array")}continue;case Tt.STRING:this.textNode===void 0&&(this.textNode="");let r=e-1,o=this.slashed,a=this.unicodeI;t:for(;;){for(;a>0;)if(this.unicodeS+=String.fromCharCode(i),i=t.charCodeAt(e++),this.position++,a===4?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),a=0,r=e-1):a++,!i)break t;if(i===Nt.doubleQuote&&!o){this.state=this.stack.pop()||Tt.VALUE,this.textNode+=t.substring(r,e-1),this.position+=e-1-r;break}if(i===Nt.backslash&&!o&&(o=!0,this.textNode+=t.substring(r,e-1),this.position+=e-1-r,i=t.charCodeAt(e++),this.position++,!i))break;if(o){if(o=!1,i===Nt.n?this.textNode+=`
`:i===Nt.r?this.textNode+="\r":i===Nt.t?this.textNode+="	":i===Nt.f?this.textNode+="\f":i===Nt.b?this.textNode+="\b":i===Nt.u?(a=1,this.unicodeS=""):this.textNode+=String.fromCharCode(i),i=t.charCodeAt(e++),this.position++,r=e-1,i)continue;break}k0.lastIndex=e;const l=k0.exec(t);if(l===null){e=t.length+1,this.textNode+=t.substring(r,e-1),this.position+=e-1-r;break}if(e=l.index+1,i=t.charCodeAt(l.index),!i){this.textNode+=t.substring(r,e-1),this.position+=e-1-r;break}}this.slashed=o,this.unicodeI=a;continue;case Tt.TRUE:i===Nt.r?this.state=Tt.TRUE2:this._error(`Invalid true started with t${i}`);continue;case Tt.TRUE2:i===Nt.u?this.state=Tt.TRUE3:this._error(`Invalid true started with tr${i}`);continue;case Tt.TRUE3:i===Nt.e?(this.emit("onvalue",!0),this.state=this.stack.pop()||Tt.VALUE):this._error(`Invalid true started with tru${i}`);continue;case Tt.FALSE:i===Nt.a?this.state=Tt.FALSE2:this._error(`Invalid false started with f${i}`);continue;case Tt.FALSE2:i===Nt.l?this.state=Tt.FALSE3:this._error(`Invalid false started with fa${i}`);continue;case Tt.FALSE3:i===Nt.s?this.state=Tt.FALSE4:this._error(`Invalid false started with fal${i}`);continue;case Tt.FALSE4:i===Nt.e?(this.emit("onvalue",!1),this.state=this.stack.pop()||Tt.VALUE):this._error(`Invalid false started with fals${i}`);continue;case Tt.NULL:i===Nt.u?this.state=Tt.NULL2:this._error(`Invalid null started with n${i}`);continue;case Tt.NULL2:i===Nt.l?this.state=Tt.NULL3:this._error(`Invalid null started with nu${i}`);continue;case Tt.NULL3:i===Nt.l?(this.emit("onvalue",null),this.state=this.stack.pop()||Tt.VALUE):this._error(`Invalid null started with nul${i}`);continue;case Tt.NUMBER_DECIMAL_POINT:i===Nt.period?(this.numberNode+=".",this.state=Tt.NUMBER_DIGIT):this._error("Leading zero not followed by .");continue;case Tt.NUMBER_DIGIT:Nt._0<=i&&i<=Nt._9?this.numberNode+=String.fromCharCode(i):i===Nt.period?(this.numberNode.indexOf(".")!==-1&&this._error("Invalid number has two dots"),this.numberNode+="."):i===Nt.e||i===Nt.E?((this.numberNode.indexOf("e")!==-1||this.numberNode.indexOf("E")!==-1)&&this._error("Invalid number has two exponential"),this.numberNode+="e"):i===Nt.plus||i===Nt.minus?(s===Nt.e||s===Nt.E||this._error("Invalid symbol in number"),this.numberNode+=String.fromCharCode(i)):(this._closeNumber(),e--,this.state=this.stack.pop()||Tt.VALUE);continue;default:this._error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&wQ(this),this.emit("onchunkparsed"),this}_closeValue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"onvalue";this.textNode!==void 0&&this.emit(t,this.textNode),this.textNode=void 0}_closeNumber(){this.numberNode&&this.emit("onvalue",parseFloat(this.numberNode)),this.numberNode=""}_error(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this._closeValue(),t+=`
Line: ${this.line}
Column: ${this.column}
Char: ${this.c}`;const e=new Error(t);this.error=e,this.emit("onerror",e)}}function qo(n){return n===Nt.carriageReturn||n===Nt.lineFeed||n===Nt.space||n===Nt.tab}function wQ(n){const t=Math.max(bf,10);let e=0;for(const i of["textNode","numberNode"]){const s=n[i]===void 0?0:n[i].length;if(s>t)switch(i){case"text":break;default:n._error(`Max buffer length exceeded: ${i}`)}e=Math.max(e,s)}n.bufferCheckPosition=bf-e+n.position}class cr{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(this.path=void 0,this.path=["$"],t instanceof cr){this.path=[...t.path];return}if(Array.isArray(t)){this.path.push(...t);return}if(typeof t=="string"&&(this.path=t.split("."),this.path[0]!=="$"))throw new Error("JSONPaths must start with $")}clone(){return new cr(this)}toString(){return this.path.join(".")}push(t){this.path.push(t)}pop(){return this.path.pop()}set(t){this.path[this.path.length-1]=t}equals(t){if(!this||!t||this.path.length!==t.path.length)return!1;for(let e=0;e<this.path.length;++e)if(this.path[e]!==t.path[e])return!1;return!0}setFieldAtPath(t,e){const i=[...this.path];i.shift();const s=i.pop();for(const r of i)t=t[r];t[s]=e}getFieldAtPath(t){const e=[...this.path];e.shift();const i=e.pop();for(const s of e)t=t[s];return t[i]}}class RQ{constructor(t){this.parser=void 0,this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new cr,this.reset(),this.parser=new TQ({onready:()=>{this.jsonpath=new cr,this.previousStates.length=0,this.currentState.container.length=0},onopenobject:e=>{this._openObject({}),typeof e<"u"&&this.parser.emit("onkey",e)},onkey:e=>{this.jsonpath.set(e),this.currentState.key=e},oncloseobject:()=>{this._closeObject()},onopenarray:()=>{this._openArray()},onclosearray:()=>{this._closeArray()},onvalue:e=>{this._pushOrSet(e)},onerror:e=>{throw e},onend:()=>{this.result=this.currentState.container.pop()},...t})}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new cr}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:e,key:i}=this.currentState;i!==null?(e[i]=t,this.currentState.key=null):e.push(t)}_openArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!0,key:null}}_closeArray(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}_openObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!1,key:null}}_closeObject(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}}class DQ extends RQ{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({onopenarray:()=>{if(!this.streamingArray&&this._matchJSONPath()){this.streamingJsonPath=this.getJsonPath().clone(),this.streamingArray=[],this._openArray(this.streamingArray);return}this._openArray()},onopenobject:i=>{this.topLevelObject?this._openObject({}):(this.topLevelObject={},this._openObject(this.topLevelObject)),typeof i<"u"&&this.parser.emit("onkey",i)}}),this.jsonPaths=void 0,this.streamingJsonPath=null,this.streamingArray=null,this.topLevelObject=null;const e=t.jsonpaths||[];this.jsonPaths=e.map(i=>new cr(i))}write(t){super.write(t);let e=[];return this.streamingArray&&(e=[...this.streamingArray],this.streamingArray.length=0),e}getPartialResult(){return this.topLevelObject}getStreamingJsonPath(){return this.streamingJsonPath}getStreamingJsonPathAsString(){return this.streamingJsonPath&&this.streamingJsonPath.toString()}getJsonPath(){return this.jsonpath}_matchJSONPath(){const t=this.getJsonPath();if(this.jsonPaths.length===0)return!0;for(const e of this.jsonPaths)if(e.equals(t))return!0;return!1}}async function*LQ(n,t){const e=SQ(n),{metadata:i}=t,{jsonpaths:s}=t.json||{};let r=!0;const o=null,a=new Ua(o,t),l=new DQ({jsonpaths:s});for await(const d of e){const f=l.write(d),p=f.length>0&&l.getStreamingJsonPathAsString();if(f.length>0&&r){if(i){var c;yield{shape:(t==null||(c=t.json)===null||c===void 0?void 0:c.shape)||"array-row-table",batchType:"partial-result",data:[],length:0,bytesUsed:0,container:l.getPartialResult(),jsonpath:p}}r=!1}for(const g of f){a.addRow(g);const A=a.getFullBatch({jsonpath:p});A&&(yield A)}a.chunkComplete(d);const m=a.getFullBatch({jsonpath:p});m&&(yield m)}const h=l.getStreamingJsonPathAsString(),u=a.getFinalBatch({jsonpath:h});u&&(yield u),i&&(yield{shape:"json",batchType:"final-result",container:l.getPartialResult(),jsonpath:l.getStreamingJsonPathAsString(),data:[],length:0})}const Jc={x:0,y:1,z:2};function tx(n,t={}){const{start:e=0,end:i=n.length,plane:s="xy"}=t,r=t.size||2;let o=0;const a=Jc[s[0]],l=Jc[s[1]];for(let c=e,h=i-r;c<i;c+=r)o+=(n[c+a]-n[h+a])*(n[c+l]+n[h+l]),h=c;return o/2}function PQ(n,t,e=2,i,s="xy"){const r=t&&t.length,o=r?t[0]*e:n.length;let a=ex(n,0,o,e,!0,i&&i[0],s);const l=[];if(!a||a.next===a.prev)return l;let c,h,u,d,f,p,m;if(r&&(a=GQ(n,t,a,e,i,s)),n.length>80*e){d=h=n[0],f=u=n[1];for(let g=e;g<o;g+=e)p=n[g],m=n[g+1],p<d&&(d=p),m<f&&(f=m),p>h&&(h=p),m>u&&(u=m);c=Math.max(h-d,u-f),c=c!==0?32767/c:0}return Na(a,l,e,d,f,c,0),l}function ex(n,t,e,i,s,r,o){let a,l;r===void 0&&(r=tx(n,{start:t,end:e,size:i,plane:o}));let c=Jc[o[0]],h=Jc[o[1]];if(s===r<0)for(a=t;a<e;a+=i)l=z0(a,n[a+c],n[a+h],l);else for(a=e-i;a>=t;a-=i)l=z0(a,n[a+c],n[a+h],l);return l&&vh(l,l.next)&&(Ga(l),l=l.next),l}function Ar(n,t){if(!n)return n;t||(t=n);let e=n,i;do if(i=!1,!e.steiner&&(vh(e,e.next)||Te(e.prev,e,e.next)===0)){if(Ga(e),e=t=e.prev,e===e.next)break;i=!0}else e=e.next;while(i||e!==t);return t}function Na(n,t,e,i,s,r,o){if(!n)return;!o&&r&&zQ(n,i,s,r);let a=n,l,c;for(;n.prev!==n.next;){if(l=n.prev,c=n.next,r?UQ(n,i,s,r):FQ(n)){t.push(l.i/e|0),t.push(n.i/e|0),t.push(c.i/e|0),Ga(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=NQ(Ar(n),t,e),Na(n,t,e,i,s,r,2)):o===2&&OQ(n,t,e,i,s,r):Na(Ar(n),t,e,i,s,r,1);break}}}function FQ(n){const t=n.prev,e=n,i=n.next;if(Te(t,e,i)>=0)return!1;const s=t.x,r=e.x,o=i.x,a=t.y,l=e.y,c=i.y,h=s<r?s<o?s:o:r<o?r:o,u=a<l?a<c?a:c:l<c?l:c,d=s>r?s>o?s:o:r>o?r:o,f=a>l?a>c?a:c:l>c?l:c;let p=i.next;for(;p!==t;){if(p.x>=h&&p.x<=d&&p.y>=u&&p.y<=f&&Xr(s,a,r,l,o,c,p.x,p.y)&&Te(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function UQ(n,t,e,i){const s=n.prev,r=n,o=n.next;if(Te(s,r,o)>=0)return!1;const a=s.x,l=r.x,c=o.x,h=s.y,u=r.y,d=o.y,f=a<l?a<c?a:c:l<c?l:c,p=h<u?h<d?h:d:u<d?u:d,m=a>l?a>c?a:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,A=Mf(f,p,t,e,i),C=Mf(m,g,t,e,i);let E=n.prevZ,_=n.nextZ;for(;E&&E.z>=A&&_&&_.z<=C;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==s&&E!==o&&Xr(a,h,l,u,c,d,E.x,E.y)&&Te(E.prev,E,E.next)>=0||(E=E.prevZ,_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==o&&Xr(a,h,l,u,c,d,_.x,_.y)&&Te(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;E&&E.z>=A;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==s&&E!==o&&Xr(a,h,l,u,c,d,E.x,E.y)&&Te(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;_&&_.z<=C;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==s&&_!==o&&Xr(a,h,l,u,c,d,_.x,_.y)&&Te(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function NQ(n,t,e){let i=n;do{const s=i.prev,r=i.next.next;!vh(s,r)&&nx(s,i,i.next,r)&&Oa(s,r)&&Oa(r,s)&&(t.push(s.i/e|0),t.push(i.i/e|0),t.push(r.i/e|0),Ga(i),Ga(i.next),i=n=r),i=i.next}while(i!==n);return Ar(i)}function OQ(n,t,e,i,s,r){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&qQ(o,a)){let l=ix(o,a);o=Ar(o,o.next),l=Ar(l,l.next),Na(o,t,e,i,s,r,0),Na(l,t,e,i,s,r,0);return}a=a.next}o=o.next}while(o!==n)}function GQ(n,t,e,i,s,r){const o=[];let a,l,c,h,u;for(a=0,l=t.length;a<l;a++)c=t[a]*i,h=a<l-1?t[a+1]*i:n.length,u=ex(n,c,h,i,!1,s&&s[a+1],r),u===u.next&&(u.steiner=!0),o.push(JQ(u));for(o.sort(QQ),a=0;a<o.length;a++)e=HQ(o[a],e);return e}function QQ(n,t){return n.x-t.x}function HQ(n,t){const e=kQ(n,t);if(!e)return t;const i=ix(e,n);return Ar(i,i.next),Ar(e,e.next)}function kQ(n,t){let e=t;const i=n.x,s=n.y;let r=-1/0,o;do{if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const d=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(d<=i&&d>r&&(r=d,o=e.x<e.next.x?e:e.next,d===i))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let h=1/0,u;e=o;do i>=e.x&&e.x>=l&&i!==e.x&&Xr(s<c?i:r,s,l,c,s<c?r:i,s,e.x,e.y)&&(u=Math.abs(s-e.y)/(i-e.x),Oa(e,n)&&(u<h||u===h&&(e.x>o.x||e.x===o.x&&VQ(o,e)))&&(o=e,h=u)),e=e.next;while(e!==a);return o}function VQ(n,t){return Te(n.prev,n,t.prev)<0&&Te(t.next,n,n.next)<0}function zQ(n,t,e,i){let s=n;do s.z===0&&(s.z=Mf(s.x,s.y,t,e,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,WQ(s)}function WQ(n){let t,e,i=1,s,r,o,a,l,c;do{for(r=n,n=null,c=null,s=0;r;){for(s++,a=r,o=0,e=0;e<i&&(o++,a=a.nextZ,!!a);e++);for(l=i;o>0||l>0&&a;)o!==0&&(l===0||!a||r.z<=a.z)?(t=r,r=r.nextZ,o--):(t=a,a=a.nextZ,l--),c?c.nextZ=t:n=t,t.prevZ=c,c=t;r=a}c.nextZ=null,i*=2}while(s>1);return n}function Mf(n,t,e,i,s){return n=(n-e)*s|0,t=(t-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,n|t<<1}function JQ(n){let t=n,e=n;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==n);return e}function Xr(n,t,e,i,s,r,o,a){return(s-o)*(t-a)>=(n-o)*(r-a)&&(n-o)*(i-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(s-o)*(i-a)}function qQ(n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!jQ(n,t)&&(Oa(n,t)&&Oa(t,n)&&XQ(n,t)&&(Te(n.prev,n,t.prev)||Te(n,t.prev,t))||vh(n,t)&&Te(n.prev,n,n.next)>0&&Te(t.prev,t,t.next)>0)}function Te(n,t,e){return(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y)}function vh(n,t){return n.x===t.x&&n.y===t.y}function nx(n,t,e,i){const s=rc(Te(n,t,e)),r=rc(Te(n,t,i)),o=rc(Te(e,i,n)),a=rc(Te(e,i,t));return!!(s!==r&&o!==a||s===0&&sc(n,e,t)||r===0&&sc(n,i,t)||o===0&&sc(e,n,i)||a===0&&sc(e,t,i))}function sc(n,t,e){return t.x<=Math.max(n.x,e.x)&&t.x>=Math.min(n.x,e.x)&&t.y<=Math.max(n.y,e.y)&&t.y>=Math.min(n.y,e.y)}function rc(n){return n>0?1:n<0?-1:0}function jQ(n,t){let e=n;do{if(e.i!==n.i&&e.next.i!==n.i&&e.i!==t.i&&e.next.i!==t.i&&nx(e,e.next,n,t))return!0;e=e.next}while(e!==n);return!1}function Oa(n,t){return Te(n.prev,n,n.next)<0?Te(n,t,n.next)>=0&&Te(n,n.prev,t)>=0:Te(n,t,n.prev)<0||Te(n,n.next,t)<0}function XQ(n,t){let e=n,i=!1;const s=(n.x+t.x)/2,r=(n.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&s<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(i=!i),e=e.next;while(e!==n);return i}function ix(n,t){const e=new Sf(n.i,n.x,n.y),i=new Sf(t.i,t.x,t.y),s=n.next,r=t.prev;return n.next=t,t.prev=n,e.next=s,s.prev=e,i.next=e,e.prev=i,r.next=i,i.prev=r,i}function z0(n,t,e,i){const s=new Sf(n,t,e);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Ga(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}class Sf{constructor(t,e,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=i}}function KQ(n,t,e){const i=YQ(n),s=Object.keys(i).filter(r=>i[r]!==Array);return ZQ(n,{propArrayTypes:i,...t},{numericPropKeys:e&&e.numericPropKeys||s,PositionDataType:e?e.PositionDataType:Float32Array,triangulate:e?e.triangulate:!0})}function YQ(n){const t={};for(const e of n)if(e.properties)for(const i in e.properties){const s=e.properties[i];t[i]=sH(s,t[i])}return t}function ZQ(n,t,e){const{pointPositionsCount:i,pointFeaturesCount:s,linePositionsCount:r,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:l,polygonObjectsCount:c,polygonRingsCount:h,polygonFeaturesCount:u,propArrayTypes:d,coordLength:f}=t,{numericPropKeys:p=[],PositionDataType:m=Float32Array,triangulate:g=!0}=e,A=n[0]&&"id"in n[0],C=n.length>65535?Uint32Array:Uint16Array,E={type:"Point",positions:new m(i*f),globalFeatureIds:new C(i),featureIds:s>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},_={type:"LineString",pathIndices:r>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new m(r*f),globalFeatureIds:new C(r),featureIds:a>65535?new Uint32Array(r):new Uint16Array(r),numericProps:{},properties:[],fields:[]},T={type:"Polygon",polygonIndices:l>65535?new Uint32Array(c+1):new Uint16Array(c+1),primitivePolygonIndices:l>65535?new Uint32Array(h+1):new Uint16Array(h+1),positions:new m(l*f),globalFeatureIds:new C(l),featureIds:u>65535?new Uint32Array(l):new Uint16Array(l),numericProps:{},properties:[],fields:[]};g&&(T.triangles=[]);for(const S of[E,_,T])for(const R of p){const B=d[R];S.numericProps[R]=new B(S.positions.length/f)}_.pathIndices[o]=r,T.polygonIndices[c]=l,T.primitivePolygonIndices[h]=l;const M={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const S of n){const R=S.geometry,B=S.properties||{};switch(R.type){case"Point":$Q(R,E,M,f,B),E.properties.push(sd(B,p)),A&&E.fields.push({id:S.id}),M.pointFeature++;break;case"LineString":tH(R,_,M,f,B),_.properties.push(sd(B,p)),A&&_.fields.push({id:S.id}),M.lineFeature++;break;case"Polygon":eH(R,T,M,f,B),T.properties.push(sd(B,p)),A&&T.fields.push({id:S.id}),M.polygonFeature++;break;default:throw new Error("Invalid geometry type")}M.feature++}return iH(E,_,T,f)}function $Q(n,t,e,i,s){t.positions.set(n.data,e.pointPosition*i);const r=n.data.length/i;ZA(t,s,e.pointPosition,r),t.globalFeatureIds.fill(e.feature,e.pointPosition,e.pointPosition+r),t.featureIds.fill(e.pointFeature,e.pointPosition,e.pointPosition+r),e.pointPosition+=r}function tH(n,t,e,i,s){t.positions.set(n.data,e.linePosition*i);const r=n.data.length/i;ZA(t,s,e.linePosition,r),t.globalFeatureIds.fill(e.feature,e.linePosition,e.linePosition+r),t.featureIds.fill(e.lineFeature,e.linePosition,e.linePosition+r);for(let o=0,a=n.indices.length;o<a;++o){const l=n.indices[o],c=o===a-1?n.data.length:n.indices[o+1];t.pathIndices[e.linePath++]=e.linePosition,e.linePosition+=(c-l)/i}}function eH(n,t,e,i,s){t.positions.set(n.data,e.polygonPosition*i);const r=n.data.length/i;ZA(t,s,e.polygonPosition,r),t.globalFeatureIds.fill(e.feature,e.polygonPosition,e.polygonPosition+r),t.featureIds.fill(e.polygonFeature,e.polygonPosition,e.polygonPosition+r);for(let o=0,a=n.indices.length;o<a;++o){const l=e.polygonPosition;t.polygonIndices[e.polygonObject++]=l;const c=n.areas[o],h=n.indices[o],u=n.indices[o+1];for(let f=0,p=h.length;f<p;++f){const m=h[f],g=f===p-1?u===void 0?n.data.length:u[0]:h[f+1];t.primitivePolygonIndices[e.polygonRing++]=e.polygonPosition,e.polygonPosition+=(g-m)/i}const d=e.polygonPosition;nH(t,c,h,{startPosition:l,endPosition:d,coordLength:i})}}function nH(n,t,e,i){let{startPosition:s,endPosition:r,coordLength:o}=i;if(!n.triangles)return;const a=s*o,l=r*o,c=n.positions.subarray(a,l),h=e[0],u=e.slice(1).map(f=>(f-h)/o),d=PQ(c,u,o,t);for(let f=0,p=d.length;f<p;++f)n.triangles.push(s+d[f])}function id(n,t){const e={};for(const i in n)e[i]={value:n[i],size:t};return e}function iH(n,t,e,i){const s={shape:"binary-feature-collection",points:{...n,positions:{value:n.positions,size:i},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:id(n.numericProps,1)},lines:{...t,positions:{value:t.positions,size:i},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:id(t.numericProps,1)},polygons:{...e,positions:{value:e.positions,size:i},polygonIndices:{value:e.polygonIndices,size:1},primitivePolygonIndices:{value:e.primitivePolygonIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:id(e.numericProps,1)}};return s.polygons&&e.triangles&&(s.polygons.triangles={value:new Uint32Array(e.triangles),size:1}),s}function ZA(n,t,e,i){for(const s in n.numericProps)if(s in t){const r=t[s];n.numericProps[s].fill(r,e,e+i)}}function sd(n,t){const e={};for(const i in n)t.includes(i)||(e[i]=n[i]);return e}function sH(n,t){return t===Array||!Number.isFinite(n)?Array:t===Float64Array||Math.fround(n)!==n?Float64Array:Float32Array}function rH(n){let t=0,e=0,i=0,s=0,r=0,o=0,a=0,l=0,c=0;const h=new Set;for(const u of n){const d=u.geometry;switch(d.type){case"Point":e++,t++,h.add(d.coordinates.length);break;case"MultiPoint":e++,t+=d.coordinates.length;for(const p of d.coordinates)h.add(p.length);break;case"LineString":r++,i+=d.coordinates.length,s++;for(const p of d.coordinates)h.add(p.length);break;case"MultiLineString":r++;for(const p of d.coordinates){i+=p.length,s++;for(const m of p)h.add(m.length)}break;case"Polygon":c++,a++,l+=d.coordinates.length;const f=d.coordinates.flat();o+=f.length;for(const p of f)h.add(p.length);break;case"MultiPolygon":c++;for(const p of d.coordinates){a++,l+=p.length;const m=p.flat();o+=m.length;for(const g of m)h.add(g.length)}break;default:throw new Error(`Unsupported geometry type: ${d.type}`)}}return{coordLength:h.size>0?Math.max(...h):2,pointPositionsCount:t,pointFeaturesCount:e,linePositionsCount:i,linePathsCount:s,lineFeaturesCount:r,polygonPositionsCount:o,polygonObjectsCount:a,polygonRingsCount:l,polygonFeaturesCount:c}}function oH(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{coordLength:2,fixRingWinding:!0};return n.map(e=>aH(e,t))}function W0(n,t,e,i){e.push(t.length),t.push(...n);for(let s=n.length;s<i.coordLength;s++)t.push(0)}function Tf(n,t,e,i){e.push(t.length);for(const s of n){t.push(...s);for(let r=s.length;r<i.coordLength;r++)t.push(0)}}function J0(n,t,e,i,s){let r=0;const o=[],a=[];for(const l of n){const c=l.map(d=>d.slice(0,2));let h=tx(c.flat());const u=h<0;s.fixRingWinding&&(r===0&&!u||r>0&&u)&&(l.reverse(),h=-h),o.push(h),Tf(l,t,a,s),r++}r>0&&(i.push(o),e.push(a))}function aH(n,t){const{geometry:e}=n;if(e.type==="GeometryCollection")throw new Error("GeometryCollection type not supported");const i=[],s=[];let r,o;switch(e.type){case"Point":o="Point",W0(e.coordinates,i,s,t);break;case"MultiPoint":o="Point",e.coordinates.map(a=>W0(a,i,s,t));break;case"LineString":o="LineString",Tf(e.coordinates,i,s,t);break;case"MultiLineString":o="LineString",e.coordinates.map(a=>Tf(a,i,s,t));break;case"Polygon":o="Polygon",r=[],J0(e.coordinates,i,s,r,t);break;case"MultiPolygon":o="Polygon",r=[],e.coordinates.map(a=>J0(a,i,s,r,t));break;default:throw new Error(`Unknown type: ${o}`)}return{...n,geometry:{type:o,indices:s,data:i,areas:r}}}function sx(n){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{fixRingWinding:!0,triangulate:!0};const e=rH(n),i=e.coordLength,{fixRingWinding:s}=t,r=oH(n,{coordLength:i,fixRingWinding:s});return KQ(r,e,{numericPropKeys:t.numericPropKeys,PositionDataType:t.PositionDataType||Float32Array,triangulate:t.triangulate})}const lH="4.1.4",cH={name:"GeoJSON",id:"geojson",module:"geojson",version:lH,worker:!0,extensions:["geojson"],mimeTypes:["application/geo+json"],category:"geometry",text:!0,options:{geojson:{shape:"object-row-table"},json:{shape:"object-row-table",jsonpaths:["$","$.features"]},gis:{format:"geojson"}}},Qa={...cH,parse:hH,parseTextSync:rx,parseInBatches:uH};async function hH(n,t){return rx(new TextDecoder().decode(n),t)}function rx(n,t){var e;t={...Qa.options,...t},t.geojson={...Qa.options.geojson,...t.geojson},t.gis=t.gis||{};let i;try{i=JSON.parse(n)}catch{i={}}const s={shape:"geojson-table",type:"FeatureCollection",features:((e=i)===null||e===void 0?void 0:e.features)||[]};switch(t.gis.format){case"binary":return sx(s.features);default:return s}}function uH(n,t){t={...Qa.options,...t},t.json={...Qa.options.geojson,...t.geojson};const e=LQ(n,t);switch(t.gis.format){case"binary":return dH(e);default:return e}}async function*dH(n){for await(const t of n)t.data=sx(t.data),yield t}function ir(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const fH="Queued Requests",AH="Active Requests",pH="Cancelled Requests",gH="Queued Requests Ever",mH="Active Requests Ever",_H={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class EH{constructor(t={}){it(this,"props"),it(this,"stats"),it(this,"activeRequestCount",0),it(this,"requestQueue",[]),it(this,"requestMap",new Map),it(this,"updateTimer",null),this.props={..._H,...t},this.stats=new Sy({id:this.props.id}),this.stats.get(fH),this.stats.get(AH),this.stats.get(pH),this.stats.get(gH),this.stats.get(mH)}scheduleRequest(t,e=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const i={handle:t,priority:0,getPriority:e},s=new Promise(r=>(i.resolve=r,i));return this.requestQueue.push(i),this.requestMap.set(t,s),this._issueNewRequests(),s}_issueRequest(t){const{handle:e,resolve:i}=t;let s=!1;const r=()=>{s||(s=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:r}):Promise.resolve({done:r})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let e=0;e<t;++e){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const i=t[e];this._updateRequest(i)||(t.splice(e,1),this.requestMap.delete(i.handle),e--)}t.sort((e,i)=>e.priority-i.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}function yH(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(0,t):""}class CH{constructor(t,e,i){it(this,"item"),it(this,"previous"),it(this,"next"),this.item=t,this.previous=e,this.next=i}}class xH{constructor(){it(this,"head",null),it(this,"tail",null),it(this,"_length",0)}get length(){return this._length}add(t){const e=new CH(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,e){t!==e&&(this.remove(e),this._insert(t,e))}_insert(t,e){const i=t.next;t.next=e,this.tail===t?this.tail=e:i.previous=e,e.next=i,e.previous=t,++this._length}}class vH{constructor(){it(this,"_list"),it(this,"_sentinel"),it(this,"_trimTiles"),this._list=new xH,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const e=t._cacheNode;e&&this._list.splice(this._sentinel,e)}add(t,e,i){e._cacheNode||(e._cacheNode=this._list.add(e),i&&i(t,e))}unloadTile(t,e,i){const s=e._cacheNode;s&&(this._list.remove(s),e._cacheNode=null,i&&i(t,e))}unloadTiles(t,e){const i=this._trimTiles;this._trimTiles=!1;const s=this._list,r=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=s.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>r||i);){const l=a.item;a=a.next,this.unloadTile(t,l,e)}}trim(){this._trimTiles=!0}}function BH(n,t){ir(n),ir(t);const{rtcCenter:e,gltfUpAxis:i}=t,{computedTransform:s,boundingVolume:{center:r}}=n;let o=new ye(s);switch(e&&o.translate(e),i){case"Z":break;case"Y":const h=new ye().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const u=new ye().rotateY(-Math.PI/2);o=o.multiplyRight(u);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new q(r);t.cartesianModelMatrix=o,t.cartesianOrigin=a;const l=Ee.WGS84.cartesianToCartographic(a,new q),c=Ee.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=c.multiplyRight(o),t.cartographicOrigin=l,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const q0=new q,rd=new q,wf=new In([new qe,new qe,new qe,new qe,new qe,new qe]);function IH(n,t){const{cameraDirection:e,cameraUp:i,height:s}=n,{metersPerUnit:r}=n.distanceScales,o=mc(n,n.center),a=Ee.WGS84.eastNorthUpToFixedFrame(o),l=n.unprojectPosition(n.cameraPosition),c=Ee.WGS84.cartographicToCartesian(l,new q),h=new q(a.transformAsVector(new q(e).scale(r))).normalize(),u=new q(a.transformAsVector(new q(i).scale(r))).normalize();MH(n);const d=n.constructor,{longitude:f,latitude:p,width:m,bearing:g,zoom:A}=n,C=new d({longitude:f,latitude:p,height:s,width:m,bearing:g,zoom:A,pitch:0});return{camera:{position:c,direction:h,up:u},viewport:n,topDownViewport:C,height:s,cullingVolume:wf,frameNumber:t,sseDenominator:1.15}}function bH(n,t,e){if(e===0||n.length<=e)return[n,[]];const i=[],{longitude:s,latitude:r}=t.viewport;for(const[c,h]of n.entries()){const[u,d]=h.header.mbs,f=Math.abs(s-u),p=Math.abs(r-d),m=Math.sqrt(p*p+f*f);i.push([c,m])}const o=i.sort((c,h)=>c[1]-h[1]),a=[];for(let c=0;c<e;c++)a.push(n[o[c][0]]);const l=[];for(let c=e;c<o.length;c++)l.push(n[o[c][0]]);return[a,l]}function MH(n){const t=n.getFrustumPlanes(),e=j0(t.near,n.cameraPosition),i=mc(n,e),s=mc(n,n.cameraPosition,rd);let r=0;wf.planes[r++].fromPointNormal(i,q0.copy(i).subtract(s));for(const o in t){if(o==="near")continue;const a=t[o],l=j0(a,e,rd),c=mc(n,l,rd);wf.planes[r++].fromPointNormal(c,q0.copy(i).subtract(c))}}function j0(n,t,e=new q){const i=n.normal.dot(t);return e.copy(n.normal).scale(n.distance-i).add(t),e}function mc(n,t,e=new q){const i=n.unprojectPosition(t);return Ee.WGS84.cartographicToCartesian(i,e)}const SH=6378137,TH=6378137,Rf=6356752314245179e-9,Kr=new q;function wH(n,t){if(n instanceof Ya){const{halfAxes:e}=n,i=DH(e);return Math.log2(Rf/(i+t[2]))}else if(n instanceof Ka){const{radius:e}=n;return Math.log2(Rf/(e+t[2]))}else if(n.width&&n.height){const{width:e,height:i}=n,s=Math.log2(SH/e),r=Math.log2(TH/i);return(s+r)/2}return 1}function ox(n,t,e){Ee.WGS84.cartographicToCartesian([n.xmax,n.ymax,n.zmax],Kr);const i=Math.sqrt(Math.pow(Kr[0]-e[0],2)+Math.pow(Kr[1]-e[1],2)+Math.pow(Kr[2]-e[2],2));return Math.log2(Rf/(i+t[2]))}function RH(n,t,e){const[i,s,r,o]=n;return ox({xmin:i,xmax:r,ymin:s,ymax:o,zmin:0,zmax:0},t,e)}function DH(n){n.getColumn(0,Kr);const t=n.getColumn(1),e=n.getColumn(2);return Kr.add(t).add(e).len()}const xn={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var rs;(function(n){n[n.ADD=1]="ADD",n[n.REPLACE=2]="REPLACE"})(rs||(rs={}));var Ea;(function(n){n.EMPTY="empty",n.SCENEGRAPH="scenegraph",n.POINTCLOUD="pointcloud",n.MESH="mesh"})(Ea||(Ea={}));var Pn;(function(n){n.I3S="I3S",n.TILES3D="TILES3D"})(Pn||(Pn={}));var X0;(function(n){n.GEOMETRIC_ERROR="geometricError",n.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(X0||(X0={}));const LH={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function ax(n){return n!=null}const on=new q,_c=new q,PH=new q,FH=new q,Ks=new q,K0=new q,Y0=new q,Z0=new q;function od(n,t,e){if(ir(n,"3D Tile: boundingVolume must be defined"),n.box)return lx(n.box,t,e);if(n.region)return OH(n.region);if(n.sphere)return NH(n.sphere,t,e);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function UH(n,t){if(n.box)return GH(t);if(n.region){const[e,i,s,r,o,a]=n.region;return[[ei(e),ei(i),o],[ei(s),ei(r),a]]}if(n.sphere)return QH(t);throw new Error("Unkown boundingVolume type")}function lx(n,t,e){const i=new q(n[0],n[1],n[2]);t.transform(i,i);let s=[];if(n.length===10){const c=n.slice(3,6),h=new Oc;h.fromArray(n,6);const u=new q([1,0,0]),d=new q([0,1,0]),f=new q([0,0,1]);u.transformByQuaternion(h),u.scale(c[0]),d.transformByQuaternion(h),d.scale(c[1]),f.transformByQuaternion(h),f.scale(c[2]),s=[...u.toArray(),...d.toArray(),...f.toArray()]}else s=[...n.slice(3,6),...n.slice(6,9),...n.slice(9,12)];const r=t.transformAsVector(s.slice(0,3)),o=t.transformAsVector(s.slice(3,6)),a=t.transformAsVector(s.slice(6,9)),l=new Re([r[0],r[1],r[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return ax(e)?(e.center=i,e.halfAxes=l,e):new Ya(i,l)}function NH(n,t,e){const i=new q(n[0],n[1],n[2]);t.transform(i,i);const s=t.getScale(_c),r=Math.max(Math.max(s[0],s[1]),s[2]),o=n[3]*r;return ax(e)?(e.center=i,e.radius=o,e):new Ka(i,o)}function OH(n){const[t,e,i,s,r,o]=n,a=Ee.WGS84.cartographicToCartesian([ei(t),ei(s),r],PH),l=Ee.WGS84.cartographicToCartesian([ei(i),ei(e),o],FH),c=new q().addVectors(a,l).multiplyByScalar(.5);return Ee.WGS84.cartesianToCartographic(c,Ks),Ee.WGS84.cartographicToCartesian([ei(i),Ks[1],Ks[2]],K0),Ee.WGS84.cartographicToCartesian([Ks[0],ei(s),Ks[2]],Y0),Ee.WGS84.cartographicToCartesian([Ks[0],Ks[1],o],Z0),lx([...c,...K0.subtract(c),...Y0.subtract(c),...Z0.subtract(c)],new ye)}function GH(n){const t=cx(),{halfAxes:e}=n,i=new q(e.getColumn(0)),s=new q(e.getColumn(1)),r=new q(e.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let l=0;l<2;l++)on.copy(n.center),on.add(i),on.add(s),on.add(r),hx(t,on),r.negate();s.negate()}i.negate()}return t}function QH(n){const t=cx(),{center:e,radius:i}=n,s=Ee.WGS84.scaleToGeodeticSurface(e,on);let r;s?r=Ee.WGS84.geodeticSurfaceNormal(s):r=new q(0,0,1);let o=new q(r[2],-r[1],0);o.len()>0?o.normalize():o=new q(0,1,0);const a=o.clone().cross(r);for(const l of[o,a,r]){_c.copy(l).scale(i);for(let c=0;c<2;c++)on.copy(e),on.add(_c),hx(t,on),_c.negate()}return t}function cx(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function hx(n,t){Ee.WGS84.cartesianToCartographic(t,on),n[0][0]=Math.min(n[0][0],on[0]),n[0][1]=Math.min(n[0][1],on[1]),n[0][2]=Math.min(n[0][2],on[2]),n[1][0]=Math.max(n[1][0],on[0]),n[1][1]=Math.max(n[1][1],on[1]),n[1][2]=Math.max(n[1][2],on[2])}new q;new q;new ye;new q;new q;new q;function HH(n,t){const e=n*t;return 1-Math.exp(-(e*e))}function kH(n,t){if(n.dynamicScreenSpaceError&&n.dynamicScreenSpaceErrorComputedDensity){const e=n.dynamicScreenSpaceErrorComputedDensity,i=n.dynamicScreenSpaceErrorFactor;return HH(t,e)*i}return 0}function VH(n,t,e){const i=n.tileset,s=n.parent&&n.parent.lodMetricValue||n.lodMetricValue,r=e?s:n.lodMetricValue;if(r===0)return 0;const o=Math.max(n._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:c}=i.options;let h=r*a*(c||1)/(o*l);return h-=kH(i,o),h}const ad=new q,$0=new q,Es=new q,t_=new q,zH=new q,ld=new ye,e_=new ye;function WH(n,t){if(n.lodMetricValue===0||isNaN(n.lodMetricValue))return"DIG";const e=2*ux(n,t);return e<2?"OUT":!n.header.children||e<=n.lodMetricValue?"DRAW":n.header.children?"DIG":"OUT"}function ux(n,t){const{topDownViewport:e}=t,i=n.header.mbs[1],s=n.header.mbs[0],r=n.header.mbs[2],o=n.header.mbs[3],a=[...n.boundingVolume.center],l=e.unprojectPosition(e.cameraPosition);Ee.WGS84.cartographicToCartesian(l,ad),$0.copy(ad).subtract(a).normalize(),Ee.WGS84.eastNorthUpToFixedFrame(a,ld),e_.copy(ld).invert(),Es.copy(ad).transform(e_);const c=Math.sqrt(Es[0]*Es[0]+Es[1]*Es[1]),h=c*c/Es[2];t_.copy([Es[0],Es[1],h]);const u=t_.transform(ld).subtract(a).normalize(),d=$0.cross(u).normalize().scale(o).add(a),f=Ee.WGS84.cartesianToCartographic(d),p=e.project([s,i,r]),m=e.project(f);return zH.copy(p).subtract(m).magnitude()}function JH(n){return{assetGltfUpAxis:n.asset&&n.asset.gltfUpAxis||"Y"}}class n_{constructor(t=0){it(this,"_map",new Map),it(this,"_array"),it(this,"_length"),this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return ir(t<this._array.length),this._array[t]}set(t,e){ir(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}delete(t){const e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const e=this.length++;this._array[e]=t,this._map.set(t,e)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){ir(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){ir(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const qH={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Bh{constructor(t){it(this,"options"),it(this,"root",null),it(this,"selectedTiles",{}),it(this,"requestedTiles",{}),it(this,"emptyTiles",{}),it(this,"lastUpdate",new Date().getTime()),it(this,"updateDebounceTime",1e3),it(this,"_traversalStack",new n_),it(this,"_emptyTraversalStack",new n_),it(this,"_frameNumber",null),this.options={...qH,...t}}traversalFinished(t){return!0}traverse(t,e,i){this.root=t,this.options={...this.options,...i},this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,e){const i=this._traversalStack;for(t._selectionDepth=1,i.push(t);i.length>0;){const r=i.pop();let o=!1;this.canTraverse(r,e)&&(this.updateChildTiles(r,e),o=this.updateAndPushChildren(r,e,i,r.hasRenderContent?r._selectionDepth+1:r._selectionDepth));const a=r.parent,l=!!(!a||a._shouldRefine),c=!o;r.hasRenderContent?r.refine===rs.ADD?(this.loadTile(r,e),this.selectTile(r,e)):r.refine===rs.REPLACE&&(this.loadTile(r,e),c&&this.selectTile(r,e)):(this.emptyTiles[r.id]=r,this.loadTile(r,e),c&&this.selectTile(r,e)),this.touchTile(r,e),r._shouldRefine=o&&l}const s=new Date().getTime();(this.traversalFinished(e)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(e))}updateChildTiles(t,e){const i=t.children;for(const s of i)this.updateTile(s,e)}updateAndPushChildren(t,e,i,s){const{loadSiblings:r,skipLevelOfDetail:o}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));const l=t.refine===rs.REPLACE&&t.hasRenderContent&&!o;let c=!1,h=!0;for(const u of a)if(u._selectionDepth=s,u.isVisibleAndInRequestVolume?(i.find(u)&&i.delete(u),i.push(u),c=!0):(l||r)&&(this.loadTile(u,e),this.touchTile(u,e)),l){let d;if(u._inRequestVolume?u.hasRenderContent?d=u.contentAvailable:d=this.executeEmptyTraversal(u,e):d=!1,h=h&&d,!h)return!1}return c||(h=!1),h}updateTile(t,e){this.updateTileVisibility(t,e)}selectTile(t,e){this.shouldSelectTile(t)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,e){this.shouldLoadTile(t)&&(t._requestedFrame=e.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}canTraverse(t,e){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,e,i=!1){let s=t._screenSpaceError;return i&&(s=t.getScreenSpaceError(e,!0)),s>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,e){const i=[];if(this.options.viewportTraversersMap)for(const s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===e.viewport.id&&i.push(s);else i.push(e.viewport.id);t.updateVisibility(e,i)}compareDistanceToCamera(t,e){return t._distanceToCamera-e._distanceToCamera}anyChildrenVisible(t,e){let i=!1;for(const s of t.children)s.updateVisibility(e),i=i||s.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(t,e){let i=!0;const s=this._emptyTraversalStack;for(s.push(t);s.length>0;){const r=s.pop(),o=!r.hasRenderContent&&this.canTraverse(r,e),a=!r.hasRenderContent&&r.children.length===0;if(!o&&!r.contentAvailable&&!a&&(i=!1),this.updateTile(r,e),r.isVisibleAndInRequestVolume||(this.loadTile(r,e),this.touchTile(r,e)),o){const l=r.children;for(const c of l)s.push(c)}}return i}}const i_=new q;function jH(n){return n!=null}class Df{constructor(t,e,i,s=""){it(this,"tileset"),it(this,"header"),it(this,"id"),it(this,"url"),it(this,"parent"),it(this,"refine"),it(this,"type"),it(this,"contentUrl"),it(this,"lodMetricType","geometricError"),it(this,"lodMetricValue",0),it(this,"boundingVolume",null),it(this,"content",null),it(this,"contentState",xn.UNLOADED),it(this,"gpuMemoryUsageInBytes",0),it(this,"children",[]),it(this,"depth",0),it(this,"viewportIds",[]),it(this,"transform",new ye),it(this,"extensions",null),it(this,"implicitTiling",null),it(this,"userData",{}),it(this,"computedTransform"),it(this,"hasEmptyContent",!1),it(this,"hasTilesetContent",!1),it(this,"traverser",new Bh({})),it(this,"_cacheNode",null),it(this,"_frameNumber",null),it(this,"_expireDate",null),it(this,"_expiredContent",null),it(this,"_boundingBox"),it(this,"_distanceToCamera",0),it(this,"_screenSpaceError",0),it(this,"_visibilityPlaneMask"),it(this,"_visible"),it(this,"_contentBoundingVolume"),it(this,"_viewerRequestVolume"),it(this,"_initialTransform",new ye),it(this,"_priority",0),it(this,"_selectedFrame",0),it(this,"_requestedFrame",0),it(this,"_selectionDepth",0),it(this,"_touchedFrame",0),it(this,"_centerZDepth",0),it(this,"_shouldRefine",!1),it(this,"_stackLength",0),it(this,"_visitedFrame",0),it(this,"_inRequestVolume",!1),it(this,"_lodJudge",null),this.header=e,this.tileset=t,this.id=s||e.id,this.url=e.url,this.parent=i,this.refine=this._getRefine(e.refine),this.type=e.type,this.contentUrl=e.contentUrl,this._initializeLodMetric(e),this._initializeTransforms(e),this._initializeBoundingVolumes(e),this._initializeContent(e),this._initializeRenderingState(e),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===xn.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===xn.UNLOADED}get contentExpired(){return this.contentState===xn.EXPIRED}get contentFailed(){return this.contentState===xn.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=UH(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,e){switch(this.tileset.type){case Pn.I3S:return ux(this,t);case Pn.TILES3D:return VH(this,t,e);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:e}=t.options,i=this.refine===rs.ADD||e;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===xn.UNLOADED)return-1;const s=this.parent,r=s&&(!i||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-r,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=xn.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=xn.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await po(e,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=xn.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=xn.FAILED,e}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=xn.UNLOADED,!0}updateVisibility(t,e){if(this._frameNumber===t.frameNumber)return;const i=this.parent,s=i?i._visibilityPlaneMask:In.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const r=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(r)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,s),this._visible=this._visibilityPlaneMask!==In.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=e}visibility(t,e){const{cullingVolume:i}=t,{boundingVolume:s}=this;return i.computeVisibilityWithPlaneMask(s,e)}contentVisibility(){return!0}distanceToTile(t){const e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const e=this.boundingVolume;return i_.subVectors(e.center,t.position),t.direction.dot(i_)}insideViewerRequestVolume(t){const e=this._viewerRequestVolume;return!e||e.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(jH(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=xn.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new ye(t.transform):new ye;const e=this.parent,i=this.tileset,s=e&&e.computedTransform?e.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new ye(s).multiplyRight(this.transform);const r=e&&e._initialTransform?e._initialTransform.clone():new ye;this._initialTransform=new ye(r).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=xn.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=In.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||rs.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=od(t.boundingVolume,this.computedTransform,this.boundingVolume);const e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=od(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=od(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new ye){const e=t.clone().multiplyRight(this.transform);e.equals(this.computedTransform)||(this.computedTransform=e,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return JH(this.tileset.tileset)}}}class XH extends Bh{compareDistanceToCamera(t,e){return e._distanceToCamera===0&&t._distanceToCamera===0?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,e){if(super.updateTileVisibility(t,e),!t.isVisibleAndInRequestVolume)return;const i=t.children.length>0;if(t.hasTilesetContent&&i){const o=t.children[0];this.updateTileVisibility(o,e),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,e)){t._visible=!1;return}const s=t.refine===rs.REPLACE,r=t._optimChildrenWithinParent===LH.USE_OPTIMIZATION;if(s&&r&&i&&!this.anyChildrenVisible(t,e)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,e){const{parent:i}=t;return!i||i.hasTilesetContent||i.refine!==rs.ADD?!1:!this.shouldRefine(t,e,!0)}}class KH{constructor(){it(this,"frameNumberMap",new Map)}register(t,e){const i=this.frameNumberMap.get(t)||new Map,s=i.get(e)||0;i.set(e,s+1),this.frameNumberMap.set(t,i)}deregister(t,e){const i=this.frameNumberMap.get(t);if(!i)return;const s=i.get(e)||1;i.set(e,s-1)}isZero(t,e){var i;return(((i=this.frameNumberMap.get(t))==null?void 0:i.get(e))||0)===0}}const cd={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class YH{constructor(){it(this,"_statusMap"),it(this,"pendingTilesRegister",new KH),this._statusMap={}}add(t,e,i,s){if(!this._statusMap[e]){const{frameNumber:r,viewport:{id:o}}=s;this._statusMap[e]={request:t,callback:i,key:e,frameState:s,status:cd.REQUESTED},this.pendingTilesRegister.register(o,r),t().then(a=>{this._statusMap[e].status=cd.COMPLETED;const{frameNumber:l,viewport:{id:c}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(c,l),this._statusMap[e].callback(a,s)}).catch(a=>{this._statusMap[e].status=cd.ERROR;const{frameNumber:l,viewport:{id:c}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(c,l),i(a)})}}update(t,e){if(this._statusMap[t]){const{frameNumber:i,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,i);const{frameNumber:r,viewport:{id:o}}=e;this.pendingTilesRegister.register(o,r),this._statusMap[t].frameState=e}}find(t){return this._statusMap[t]}hasPendingTiles(t,e){return!this.pendingTilesRegister.isZero(t,e)}}class ZH extends Bh{constructor(t){super(t),it(this,"_tileManager"),this._tileManager=new YH}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,e){return t._lodJudge=WH(t,e),t._lodJudge==="DIG"}updateChildTiles(t,e){const i=t.header.children||[],s=t.children,r=t.tileset;for(const o of i){const a=`${o.id}-${e.viewport.id}`,l=s&&s.find(c=>c.id===a);if(l)l&&this.updateTile(l,e);else{let c=()=>this._loadTile(o.id,r);this._tileManager.find(a)?this._tileManager.update(a,e):(r.tileset.nodePages&&(c=()=>r.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(c,a,h=>this._onTileLoad(h,t,a),e))}}return!1}async _loadTile(t,e){const{loader:i}=e,s=e.getTileUrl(`${e.url}/nodes/${t}`),r={...e.loadOptions,i3s:{...e.loadOptions.i3s,isTileHeader:!0}};return await po(s,i,r)}_onTileLoad(t,e,i){const s=new Df(e.tileset,t,e,i);e.children.push(s);const r=this._tileManager.find(s.id).frameState;this.updateTile(s,r),this._frameNumber===r.frameNumber&&(this.traversalFinished(r)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,r)}}const $H={description:"",ellipsoid:Ee.WGS84,modelMatrix:new ye,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:n=>n,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},oc="Tiles In Tileset(s)",hd="Tiles In Memory",s_="Tiles In View",r_="Tiles To Render",o_="Tiles Loaded",ud="Tiles Loading",a_="Tiles Unloaded",l_="Failed Tile Loads",c_="Points/Vertices",dd="Tile Memory Use",h_="Maximum Screen Space Error";class tk{constructor(t,e){it(this,"options"),it(this,"loadOptions"),it(this,"type"),it(this,"tileset"),it(this,"loader"),it(this,"url"),it(this,"basePath"),it(this,"modelMatrix"),it(this,"ellipsoid"),it(this,"lodMetricType"),it(this,"lodMetricValue"),it(this,"refine"),it(this,"root",null),it(this,"roots",{}),it(this,"asset",{}),it(this,"description",""),it(this,"properties"),it(this,"extras",null),it(this,"attributions",{}),it(this,"credits",{}),it(this,"stats"),it(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),it(this,"cartographicCenter",null),it(this,"cartesianCenter",null),it(this,"zoom",1),it(this,"boundingVolume",null),it(this,"dynamicScreenSpaceErrorComputedDensity",0),it(this,"maximumMemoryUsage",32),it(this,"gpuMemoryUsageInBytes",0),it(this,"memoryAdjustedScreenSpaceError",0),it(this,"_cacheBytes",0),it(this,"_cacheOverflowBytes",0),it(this,"_frameNumber",0),it(this,"_queryParams",{}),it(this,"_extensionsUsed",[]),it(this,"_tiles",{}),it(this,"_pendingCount",0),it(this,"selectedTiles",[]),it(this,"traverseCounter",0),it(this,"geometricError",0),it(this,"lastUpdatedVieports",null),it(this,"_requestedTiles",[]),it(this,"_emptyTiles",[]),it(this,"frameStateData",{}),it(this,"_traverser"),it(this,"_cache",new vH),it(this,"_requestScheduler"),it(this,"updatePromise",null),it(this,"tilesetInitializationPromise"),this.options={...$H,...e},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||yH(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new EH({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Sy({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let e=t;return this.queryParams.length&&(e=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),e}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const e=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;const i=[];for(const s of e){const r=s.id;this._needTraverse(r)?i.push(r):this.traverseCounter--}for(const s of e){const r=s.id;if(this.roots[r]||(this.roots[r]=this._initializeTileHeaders(this.tileset,null)),!i.includes(r))continue;const o=IH(s,this._frameNumber);this._traverser.traverse(this.roots[r],o,this.options)}}_needTraverse(t){let e=t;return this.options.viewportTraversersMap&&(e=this.options.viewportTraversersMap[t]),e===t}_onTraversalEnd(t){const e=t.viewport.id;this.frameStateData[e]||(this.frameStateData[e]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[e],s=Object.values(this._traverser.selectedTiles),[r,o]=bH(s,t,this.options.maximumTilesSelected);i.selectedTiles=r;for(const a of o)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const e=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(e.selectedTiles),this._requestedTiles=this._requestedTiles.concat(e._requestedTiles),this._emptyTiles=this._emptyTiles.concat(e._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,e){if(t.length!==e.length)return!0;const i=new Set(t.map(o=>o.id)),s=new Set(e.map(o=>o.id));let r=t.filter(o=>!s.has(o.id)).length>0;return r=r||e.filter(o=>!i.has(o.id)).length>0,r}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,e)=>t._unloadTile(e))}_updateStats(){let t=0,e=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(t++,i.content.pointCount?e+=i.content.pointCount:e+=i.content.vertexCount);this.stats.get(s_).count=this.selectedTiles.length,this.stats.get(r_).count=t,this.stats.get(c_).count=e,this.stats.get(h_).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===Pn.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===Pn.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===Pn.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const e=this.tileset.fullExtent;if(e){const{xmin:s,xmax:r,ymin:o,ymax:a,zmin:l,zmax:c}=e;this.cartographicCenter=new q(s+(r-s)/2,o+(a-o)/2,l+(c-l)/2),this.cartesianCenter=new q,Ee.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=ox(e,this.cartographicCenter,this.cartesianCenter);return}const i=(t=this.tileset.store)==null?void 0:t.extent;if(i){const[s,r,o,a]=i;this.cartographicCenter=new q(s+(o-s)/2,r+(a-r)/2,0),this.cartesianCenter=new q,Ee.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=RH(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new q,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:e}=t.boundingVolume;if(!e){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new q,this.zoom=1;return}e[0]!==0||e[1]!==0||e[2]!==0?(this.cartographicCenter=new q,Ee.WGS84.cartesianToCartographic(e,this.cartographicCenter)):this.cartographicCenter=new q(0,0,-Ee.WGS84.radii[0]),this.cartesianCenter=e,this.zoom=wH(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(oc),this.stats.get(ud),this.stats.get(hd),this.stats.get(s_),this.stats.get(r_),this.stats.get(o_),this.stats.get(a_),this.stats.get(l_),this.stats.get(c_),this.stats.get(dd,"memory"),this.stats.get(h_)}_initializeTileHeaders(t,e){var i;const s=new Df(this,t.root,e);if(e&&(e.children.push(s),s.depth=e.depth+1),this.type===Pn.TILES3D){const r=[];for(r.push(s);r.length>0;){const o=r.pop();this.stats.get(oc).incrementCount();const a=o.header.children||[];for(const l of a){const c=new Df(this,l,o);if((i=c.contentUrl)!=null&&i.includes("?session=")){const h=new URL(c.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(c),c.depth=o.depth+1,r.push(c)}}}return s}_initializeTraverser(){let t;switch(this.type){case Pn.TILES3D:t=XH;break;case Pn.I3S:t=ZH;break;default:t=Bh}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let e;try{this._onStartTileLoading(),e=await t.loadContent()}catch(i){this._onTileLoadError(t,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,e)}}_onTileLoadError(t,e){this.stats.get(l_).incrementCount();const i=e.message||e.toString(),s=t.url;console.error(`A 3D tile failed to load: ${t.url} ${i}`),this.options.onTileError(t,i,s)}_onTileLoad(t,e){var i,s;if(e){if(this.type===Pn.I3S){const r=((s=(i=this.tileset)==null?void 0:i.nodePagesTile)==null?void 0:s.nodesInNodePages)||0;this.stats.get(oc).reset(),this.stats.get(oc).addCount(r)}t&&t.content&&BH(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){var e;if(this.type===Pn.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Pn.TILES3D){const{extensionsRemoved:i=[]}=((e=t.content)==null?void 0:e.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(ud).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(ud).decrementCount()}_addTileToCache(t){this._cache.add(this,t,e=>e._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(o_).incrementCount(),this.stats.get(hd).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(dd).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(hd).decrementCount(),this.stats.get(a_).incrementCount(),this.stats.get(dd).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const e=t.pop();for(const i of e.children)t.push(i);this._destroyTile(e)}this.root=null}_destroySubtree(t){const e=t,i=[];for(i.push(e);i.length>0;){t=i.pop();for(const s of t.children)i.push(s);t!==e&&this._destroyTile(t)}e.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const e=new URLSearchParams(t.queryString),i=Object.fromEntries(e.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}function ek(n){let t=0;for(const i in n.attributes){const s=n.getAttribute(i);t+=s.count*s.itemSize*s.array.BYTES_PER_ELEMENT}const e=n.getIndex();return t+=e?e.count*e.itemSize*e.array.BYTES_PER_ELEMENT:0,t}function dx(n){const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");e.rect(0,0,64,64);const i=e.createLinearGradient(0,0,64,64);for(let r=0;r<n.length;r++){const o=n[r];i.addColorStop(o[0],"#"+o[1].getHexString())}e.fillStyle=i,e.fill();const s=new C1(t);return s.needsUpdate=!0,s.minFilter=ln,s.wrapS=Rs,s.wrapT=Rs,s.repeat.set(2,2),s}function u_(n){n.updateMatrix(),n.updateMatrixWorld(),n.matrixWorldInverse.copy(n.matrixWorld).invert();const t=new oh;return t.setFromProjectionMatrix(new wt().multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse)),t}function nk(n){const t=new ri,e=new za(10,5),i=new L(...n.projectPointOntoPlane([0,0,0])),s=new L(n.normal.x,n.normal.y,n.normal.z),r=new L().copy(i).add(s);e.lookAt(r),e.translate(i.x,i.y,i.z);const o=new Gn({color:65535,side:Un}),a=new Ye(e,o),l=new eR(s,i,5,16776960);return t.add(l),t.add(a),t}function d_(n){const{boundingVolume:t}=n;let e=0;n.content&&(e=Math.min(n.content.byteLength/5e5,1));const i=new tt(e,1,0),s=new Eo(1,1,1),r=new wt;t.halfAxes?r.copy(fx(t.halfAxes)):t.radius&&s.scale(t.radius*2,t.radius*2,t.radius*2),s.applyMatrix4(r);const o=new x1(s),a=new fA(o,new Wa({color:i}));return a.position.copy(new L(...t.center)),a}function fx(n){const t=n;return new wt().fromArray([t[0]*2,t[1]*2,t[2]*2,0,t[3]*2,t[4]*2,t[5]*2,0,t[6]*2,t[7]*2,t[8]*2,0,0,0,0,1])}function ik(n,t){const e=2*Math.PI*6378137/2,i=t*e/180;let s=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return s=s*e/180,new kt(i,s)}function sk(n){let t=0;if((n==null?void 0:n.userData.mimeType)=="image/ktx2"&&n.mipmaps){for(let e=0;e<n.mipmaps.length;e++)t+=n.mipmaps[e].data.byteLength;return t}else if(n.image){const{image:e}=n,i=4;let s=[e.width,e.height];for(;s[0]>1||s[1]>1;)t+=s[0]*s[1]*i,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return t+=1*1*i,t}else return}function Ax(n){return ek(n)}let vn=null,ii=null,qc=null,Ec=null;const f_={minHeight:0,maxHeight:300,samples:4,sampleStep:4,opacity:.5,blendingType:is};function rk(n,t,e,i=f_){vn&&vn.dispose(),ii||(ii=e);const s={...f_,...i};vn=new Ds(n.width*n.devicePixelRatio,n.height*n.devicePixelRatio),vn.texture.minFilter=Ze,vn.texture.magFilter=Ze,vn.stencilBuffer=!1,vn.texture.format=Qe,vn.texture.type=Ke,ii.setPixelRatio(devicePixelRatio),ii.setSize(n.width,n.height),ii.setRenderTarget(vn),qc=new jE,qc.overrideMaterial=lk,Ec=t,ys.uniforms.tPosition.value=vn.texture,ys.uniforms.minHeight.value=s.minHeight,ys.uniforms.maxHeight.value=s.maxHeight,ys.uniforms.samples.value=s.samples,ys.uniforms.sampleStep.value=s.sampleStep,ys.uniforms.opacity.value=s.opacity,ys.blending=s.blendingType}function ok(n){vn.setSize(n.width*n.devicePixelRatio,n.height*n.devicePixelRatio),ii.setPixelRatio(devicePixelRatio),ii.setSize(n.width,n.height)}function ak(n){if(ii){const t=Ec.parent;qc.add(Ec),ii.setRenderTarget(vn),ii.render(qc,n),t&&t.add(Ec),ii.setRenderTarget(null)}}const jc=n=>n.toString(),lk=new di({vertexShader:jc`
        varying vec3 vPosition;
        void main() {
            vPosition =  (modelMatrix * vec4(position, 1.0)).xyz;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    `,fragmentShader:jc`
        varying vec3 vPosition;
        void main() {
            gl_FragColor = vec4(vPosition, 1.0);
        }
    `,side:Un}),ck=jc`
    #include <packing>

    varying vec2 vUv;
    varying vec3 vColor;
    uniform sampler2D tPosition;
    uniform float minHeight;
    uniform float maxHeight;
    uniform int samples;
    uniform float sampleStep;

    mat4 MVP;

    // Convert to normalized screen coordinates
    vec4 toNSC(const in vec4 v) {
        return vec4(0.5 * (v.xyz / v.w) + 0.5, v.w);
    }
    vec4 vertexDraping(
        const in sampler2D positionTex, // Position G-Buffer
        const in vec4 Vin // Vertex to drape
    ) {
        float texSize = float(textureSize(positionTex, 0).x);
        float pixelSize = 1.0 / texSize;
        vec2 stepSize = vec2(sampleStep/texSize);
        vec4 VinWorld = modelMatrix * Vin;

        vec4 lineStart = projectionMatrix * viewMatrix * vec4(VinWorld.x, minHeight, VinWorld.z, 1.0);
        vec4 lineEnd = projectionMatrix * viewMatrix * vec4(VinWorld.x, maxHeight, VinWorld.z, 1.0);

        vec4 Vout = VinWorld;

        // Binary search for line-terrain intersection
        float first = 0.0, last = 1.0;
        while(first <= last) {
            // Compute mid-point
            float mid = first + (last-first) / 2.0;
            // Compute texture coordinates along line
            vec4 texCoords = toNSC(mix(lineStart, lineEnd, mid));
            vec4 texSample = vec4(0.0); // Sample terrain
            for(int s = -samples; s < samples; s++) {
                for(int t = -samples; t < samples; t++) {
                    texSample += texture(positionTex,
                    texCoords.st + vec2(s,t) * stepSize);
                }
            }
            // Smooth samples obtain from G-Buffer
            texSample = texSample / (float(samples) * float(samples) * 4.0);
            float terrainHeight = texSample.y;
            Vout.y = terrainHeight;
           
            if((last-first) < pixelSize) { // Termination criteria
                return Vout;
            }
            // Perform intersection test
            float depthScene = toNSC(projectionMatrix * viewMatrix * Vout).y;
            if(depthScene >= texCoords.y) {
                first = mid;
            }
            else
                last = mid;
        }
        return Vout;
    }

    void main() {
        vColor = color;
        vUv = uv;
        MVP = projectionMatrix * modelViewMatrix;
        vec4 inputVertex = vec4(position, 1.0);
        vec4 outputVertex = vertexDraping(tPosition, inputVertex);
        vec4 finalPosition = projectionMatrix * viewMatrix * outputVertex;
        gl_Position = finalPosition;
    }
`,hk=jc`
    varying vec3 vColor;
    uniform float opacity;

    void main() {
        gl_FragColor = vec4(vColor, opacity);
    }
`,ys=new di({vertexShader:ck,fragmentShader:hk,uniforms:{tPosition:{value:null},minHeight:{value:0},maxHeight:{value:300},opacity:{value:.5},samples:{value:4},sampleStep:{value:4}},vertexColors:!0,transparent:!0,depthTest:!1,blending:is}),px={SPECTRAL:[[0,new tt(.3686,.3098,.6353)],[.1,new tt(.1961,.5333,.7412)],[.2,new tt(.4,.7608,.6471)],[.3,new tt(.6706,.8667,.6431)],[.4,new tt(.902,.9608,.5961)],[.5,new tt(1,1,.749)],[.6,new tt(.9961,.8784,.5451)],[.7,new tt(.9922,.6824,.3804)],[.8,new tt(.9569,.4275,.2627)],[.9,new tt(.8353,.2431,.3098)],[1,new tt(.6196,.0039,.2588)]],PLASMA:[[0,new tt(.241,.015,.61)],[.1,new tt(.387,.001,.654)],[.2,new tt(.524,.025,.653)],[.3,new tt(.651,.125,.596)],[.4,new tt(.752,.227,.513)],[.5,new tt(.837,.329,.431)],[.6,new tt(.907,.435,.353)],[.7,new tt(.963,.554,.272)],[.8,new tt(.992,.681,.195)],[.9,new tt(.987,.822,.144)],[1,new tt(.94,.975,.131)]],YELLOW_GREEN:[[0,new tt(.1647,.2824,.3451)],[.1,new tt(.1338,.3555,.4227)],[.2,new tt(.061,.4319,.4864)],[.3,new tt(0,.5099,.5319)],[.4,new tt(0,.5881,.5569)],[.5,new tt(.137,.665,.5614)],[.6,new tt(.2906,.7395,.5477)],[.7,new tt(.4453,.8099,.5201)],[.8,new tt(.6102,.8748,.485)],[.9,new tt(.7883,.9323,.4514)],[1,new tt(.9804,.9804,.4314)]],VIRIDIS:[[0,new tt(.267,.005,.329)],[.1,new tt(.283,.141,.458)],[.2,new tt(.254,.265,.53)],[.3,new tt(.207,.372,.553)],[.4,new tt(.164,.471,.558)],[.5,new tt(.128,.567,.551)],[.6,new tt(.135,.659,.518)],[.7,new tt(.267,.749,.441)],[.8,new tt(.478,.821,.318)],[.9,new tt(.741,.873,.15)],[1,new tt(.993,.906,.144)]],INFERNO:[[0,new tt(.077,.042,.206)],[.1,new tt(.225,.036,.388)],[.2,new tt(.373,.074,.432)],[.3,new tt(.522,.128,.42)],[.4,new tt(.665,.182,.37)],[.5,new tt(.797,.255,.287)],[.6,new tt(.902,.364,.184)],[.7,new tt(.969,.516,.063)],[.8,new tt(.988,.683,.072)],[.9,new tt(.961,.859,.298)],[1,new tt(.988,.998,.645)]],GRAYSCALE:[[0,new tt(0,0,0)],[1,new tt(1,1,1)]],TURBO:[[0,new tt(.18995,.07176,.23217)],[.07,new tt(.25107,.25237,.63374)],[.13,new tt(.27628,.42118,.89123)],[.2,new tt(.25862,.57958,.99876)],[.27,new tt(.15844,.73551,.92305)],[.33,new tt(.09267,.86554,.7623)],[.4,new tt(.19659,.94901,.59466)],[.47,new tt(.42778,.99419,.38575)],[.53,new tt(.64362,.98999,.23356)],[.6,new tt(.80473,.92452,.20459)],[.67,new tt(.93301,.81236,.22667)],[.73,new tt(.99314,.67408,.20348)],[.8,new tt(.9836,.49291,.12849)],[.87,new tt(.92105,.31489,.05475)],[.93,new tt(.81608,.18462,.01809)],[1,new tt(.66449,.08436,.00424)]],RAINBOW:[[0,new tt(.278,0,.714)],[1/6,new tt(0,0,1)],[2/6,new tt(0,1,1)],[3/6,new tt(0,1,0)],[4/6,new tt(1,1,0)],[5/6,new tt(1,.64,0)],[1,new tt(1,0,0)]],CONTOUR:[[0,new tt(0,0,0)],[.03,new tt(0,0,0)],[.04,new tt(1,1,1)],[1,new tt(1,1,1)]]},uk=`
  varying vec3 vColor;
  uniform float alpha;

  void main() {
    if (vColor == vec3(0.0, 0.0, 0.0)) {
      discard;
    } else {
      gl_FragColor = vec4( vColor, alpha);
    }
  }
`,dk=`
  varying vec3 vColor;
  uniform sampler2D gradient;
  uniform sampler2D grayscale;
  attribute float intensity;
  attribute float classification;
  uniform vec3 rootCenter;
  uniform vec3 rootNormal;
  uniform vec2 elevationRange;
  uniform int coloring;
  uniform bool hideGround;
  uniform float maxIntensity;
  uniform float intensityContrast;
  uniform float pointSize;

  #ifdef USE_COLOR
  vec3 getRGB() {
      vec3 rgb = color;
      return rgb;
  }
  #endif

  vec3 getElevation(){
    vec4 world = modelMatrix * vec4( position, 1.0 );
    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));
    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);
    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;

    return cElevation;
  }

  vec3 getIntensity(){
    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs
    float intmod = pow(intensity, intensityContrast);
    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;
    return cIntensity;
  }

  vec3 getClassification(){
    float classNormalized = classification / 255.0;
    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;
    return cClassification;
  }

  vec3 getColor(){
      vec3 color;
      if (hideGround && classification == 2.0) {
         return vec3(0.0, 0.0, 0.0);               
      }

      if (coloring == 1) {
        color = getIntensity();
      }
      else if (coloring == 2) {
        color = getClassification();
      } else if (coloring == 3) {
        color = getElevation();
      } 
      #ifdef USE_COLOR
      else if (coloring == 4) {
        color = getRGB();
      }
      #endif
      else {
        color = vec3(1.0, 1.0, 1.0);
      }
      return color;
  }

  void main() {
      vColor = getColor();

      gl_PointSize = pointSize;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
`;var gx=(n=>(n[n.Intensity=1]="Intensity",n[n.Classification=2]="Classification",n[n.Elevation=3]="Elevation",n[n.RGB=4]="RGB",n[n.White=5]="White",n))(gx||{}),Xc=(n=>(n[n.FlatTexture=1]="FlatTexture",n[n.ShadedTexture=2]="ShadedTexture",n[n.ShadedNoTexture=3]="ShadedNoTexture",n))(Xc||{});const fk=px.RAINBOW,Ak=typeof document<"u"?dx(fk):null,pk=px.GRAYSCALE,gk=typeof document<"u"?dx(pk):null,mk={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,memoryAdjustedScreenSpaceError:!0,maximumMemoryUsage:400,memoryCacheOverflow:128,viewDistanceScale:1,skipLevelOfDetail:!1,resetTransform:!1,updateTransforms:!0,shading:Xc.FlatTexture,transparent:!1,pointCloudColoring:gx.White,pointSize:1,worker:!0,wireframe:!1,debug:!1,gltfLoader:null,basisTranscoderPath:null,dracoDecoderPath:null,material:null,contentPostProcess:void 0,preloadTilesCount:null,collectAttributions:!1};class _k{static async load(t){const e={...mk,...t.options},{url:i}=t;let{viewport:s,renderer:r}=t;const o=e.updateInterval,a=5,l={};if(e.cesiumIONToken){l["cesium-ion"]={accessToken:e.cesiumIONToken};const H=await $C.preload(i,l);l.fetch={headers:H.headers}}e.googleApiKey&&(l.fetch={headers:{"X-GOOG-API-KEY":e.googleApiKey}},t.options.hasOwnProperty("collectAttributions")||(e.collectAttributions=!0)),t.loadingManager&&t.loadingManager.itemStart(i);const c=await po(i,_a,{...l}),h={},u={},d=[],f=new ri,p=new ri;e.debug||(p.visible=!1);const m={pointSize:{type:"f",value:e.pointSize},gradient:{type:"t",value:Ak},grayscale:{type:"t",value:gk},rootCenter:{type:"vec3",value:new L},rootNormal:{type:"vec3",value:new L},coloring:{type:"i",value:e.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new kt(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1},alpha:{type:"f",value:1}},g=new di({uniforms:m,vertexShader:dk,fragmentShader:uk,transparent:e.transparent,vertexColors:!0});let A,C,E;e.gltfLoader?A=e.gltfLoader:(A=new oy,e.basisTranscoderPath&&(C=new Jn,C.detectSupport(r??new qE),C.setTranscoderPath(e.basisTranscoderPath+"/"),C.setWorkerLimit(1),A.setKTX2Loader(C)),e.dracoDecoderPath&&(E=new xD,E.setDecoderPath(e.dracoDecoderPath+"/"),E.setWorkerLimit(e.maxConcurrency),A.setDRACOLoader(E)));const _=new Gn({transparent:e.transparent}),T={maximumMemoryUsage:e.maximumMemoryUsage,maximumScreenSpaceError:e.maximumScreenSpaceError,memoryAdjustedScreenSpaceError:e.memoryAdjustedScreenSpaceError,memoryCacheOverflow:e.memoryCacheOverflow,viewDistanceScale:e.viewDistanceScale,skipLevelOfDetail:e.skipLevelOfDetail,updateTransforms:e.updateTransforms,throttleRequests:e.throttleRequests,maxRequests:e.maxRequests,contentLoader:async H=>{let ot=null;switch(H.type){case Ea.POINTCLOUD:{ot=yk(H,g,e,Et);break}case Ea.SCENEGRAPH:case Ea.MESH:{ot=await Ek(A,H,_,e,Et);break}}if(ot&&(ot.visible=!1,h[H.id]=ot,f.add(h[H.id]),e.debug)){const vt=d_(H);p.add(vt),u[H.id]=vt}},onTileLoad:async H=>{M&&(e.resetTransform&&!x&&(H==null?void 0:H.depth)<=a&&Dt(H),j=!0)},onTileUnload:H=>{d.push(H)},onTileError:(H,ot)=>{console.warn("Tile error",H.id,ot)},onTraversalComplete(H){return e.collectAttributions&&(D=xk(H)),H}},M=new tk(c,{...T,loadOptions:{...l,maxConcurrency:e.maxConcurrency,worker:e.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}}}),S=new wt,R=new wt,B=new L;let x=!1,D="";if(M.root.boundingVolume?(M.root.header.boundingVolume.region&&console.warn("Cannot apply a model matrix to bounding volumes of type region. Tileset stays in original geo-coordinates."),R.setPosition(M.root.boundingVolume.center[0],M.root.boundingVolume.center[1],M.root.boundingVolume.center[2])):console.warn("Bounding volume not found, no transformations applied"),e.debug){const H=d_(M.root);p.add(H),u[M.root.id]=H}let V=!1,Q=!1;m.rootCenter.value.copy(B),m.rootNormal.value.copy(new L(0,0,1).normalize()),M.stats.get("Loader concurrency").count=e.maxConcurrency,M.stats.get("Maximum mem usage").count=e.maximumMemoryUsage;let k=0,et=null,j=!0,X=null;const U=new L(1/0,1/0,1/0);let ut=null;f.updateMatrixWorld(!0);const gt=new wt().copy(f.matrixWorld),Et=new wt().copy(gt).invert();e.resetTransform&&Dt(M.root),e.debug&&(u[M.root.id].applyMatrix4(S),p.matrixWorld.copy(f.matrixWorld));function Dt(H){if(!H.boundingVolume.halfAxes)return;const ot=H.boundingVolume.halfAxes,vt=new wt().extractRotation(fx(ot)).premultiply(new wt().extractRotation(Et));if(!new Hn().setFromRotationMatrix(vt).equals(new Hn)){x=!0;const Mt=new L(R.elements[12],R.elements[13],R.elements[14]);R.extractRotation(vt),R.setPosition(Mt)}Jt()}function Jt(){S.copy(gt),e.resetTransform&&S.multiply(new wt().copy(R).invert()),M.modelMatrix=new ye(S.toArray())}function at(H,ot,vt,Mt){if(V||!Mt)return;ut||(ut=new Qc({fov:Mt.fov/180*Math.PI,aspectRatio:Mt.aspect,near:Mt.near,far:Mt.far}).sseDenominator,e.debug&&console.log("Updated sse denonimator:",ut));const Vt=u_(Mt).planes.map(z=>new qe(z.normal.toArray(),z.constant)),ae=new In(Vt),Zt={camera:{position:U.toArray()},height:vt.height*vt.devicePixelRatio,frameNumber:H._frameNumber,sseDenominator:ut,cullingVolume:ae,viewport:{id:0}};H._cache.reset(),H._traverser.traverse(H.root,Zt,H.options);for(const z of H.tiles)z.selected?ot[z.id]?ot[z.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",z.id):ot[z.id]&&(ot[z.id].visible=!1);for(;d.length>0;){const z=d.pop();ot[z.id]&&z.contentState==xn.UNLOADED&&(f.remove(ot[z.id]),fd(ot[z.id]),delete ot[z.id]),u[z.id]&&(fd(u[z.id]),p.remove(u[z.id]),delete u[z.id])}const w=H.stats.get("Tiles Loaded").count,v=H.stats.get("Tiles Loading").count;return t.onProgress&&t.onProgress(w,w+v),t.loadingManager&&!Q&&v==0&&(e.preloadTilesCount==null||w>=e.preloadTilesCount)&&(Q=!0,t.loadingManager.itemEnd(t.url)),Zt}function mt(H){const ot=new L,vt=new hi,Mt=new L;H.decompose(ot,vt,Mt),f.position.copy(ot),f.quaternion.copy(vt),f.scale.copy(Mt),f.updateMatrix(),f.updateMatrixWorld(!0),gt.copy(f.matrixWorld),Et.copy(gt).invert(),Jt()}return{model:f,runtime:{getTileset:()=>M,getStats:()=>M.stats,getDataAttributions:()=>D,showTiles:H=>{p.visible=H},setWireframe:H=>{e.wireframe=H,f.traverse(ot=>{ot instanceof Ye&&(ot.material.wireframe=H)})},setDebug:H=>{e.debug=H,p.visible=H},setShading:H=>{e.shading=H},getTileBoxes:()=>p,setViewDistanceScale:H=>{M.options.viewDistanceScale=H,M._frameNumber++,at(M,h,s,X)},setMaximumScreenSpaceError:H=>{M.options.maximumScreenSpaceError=H,M._frameNumber++,at(M,h,s,X)},setHideGround:H=>{m.hideGround.value=H},setPointCloudColoring:H=>{m.coloring.value=H},setElevationRange:H=>{m.elevationRange.value.set(H[0],H[1])},setMaxIntensity:H=>{m.maxIntensity.value=H},setIntensityContrast:H=>{m.intensityContrast.value=H},setPointAlpha:H=>{m.alpha.value=H},getLatLongHeightFromPosition:H=>{const ot=M.ellipsoid.cartesianToCartographic(new L().copy(H).applyMatrix4(new wt().copy(S).invert()).toArray());return{lat:ot[1],long:ot[0],height:ot[2]}},getPositionFromLatLongHeight:H=>{const ot=M.ellipsoid.cartographicToCartesian([H.long,H.lat,H.height]);return new L(...ot).applyMatrix4(S)},orientToGeocoord:H=>{const ot=[H.long,H.lat,H.height],vt=M.ellipsoid.cartographicToCartesian(ot),Mt=new wt().fromArray(M.ellipsoid.eastNorthUpToFixedFrame(vt)),Vt=new wt().makeRotationFromEuler(new Hn(Math.PI/2,Math.PI/2,0)),ae=new wt().copy(Mt).multiply(Vt).invert();mt(ae)},getWebMercatorCoord:H=>ik(H.lat,H.long),getCameraFrustum:H=>{const ot=u_(H).planes.map(Mt=>new qe(Mt.normal.toArray(),Mt.constant)).map(Mt=>nk(Mt)),vt=new ri;for(const Mt of ot)vt.add(Mt);return vt},overlayGeoJSON:(H,ot)=>{if(H.applyMatrix4(S),H.updateMatrixWorld(),!r)throw new Error("GeoJSON draping requires a renderer reference via LoaderProps");return rk(s,f,r,ot),H.material.dispose(),H.material=ys,H},setViewport:H=>{s=H,ut=null,j=!0,vn&&ok(s)},setRenderer:H=>{r=H},update:function(H,ot){if(X=ot,k+=H,vn&&ak(ot),M&&k>=o){if(!gt.equals(f.matrixWorld)){k=0,gt.copy(f.matrixWorld),e.updateTransforms&&Jt();const vt=new L().setFromMatrixPosition(gt);m.rootCenter.value.copy(vt),m.rootNormal.value.copy(new L(0,0,1).applyMatrix4(gt).normalize()),Et.copy(gt).invert(),e.debug&&(u[M.root.id].matrixWorld.copy(S),u[M.root.id].applyMatrix4(gt))}et==null?et=new wt().copy(ot.matrixWorld):(j||Ck(ot,et))&&(k=0,j=!1,M._frameNumber++,ot.getWorldPosition(U),et.copy(ot.matrixWorld),at(M,h,s,ot))}},dispose:function(){for(V=!0,M._destroy();f.children.length>0;){const H=f.children[0];fd(H),f.remove(H)}for(;p.children.length>0;){const H=p.children[0];p.remove(H),H.geometry.dispose(),H.material.dispose()}C&&C.dispose(),E&&E.dispose()}}}}static async loadGeoJSON(t){const{url:e,height:i,featureToColor:s}=t;return po(e,Qa,{worker:!1,gis:{format:"binary"}}).then(r=>{const o=r,a=new en,l=o.polygons.positions.value.reduce((h,u,d,f)=>{if(d%2==0){const p=[u,f[d+1],i??0],m=Ee.WGS84.cartographicToCartesian(p);h.push(...m)}return h},[]);if(a.setAttribute("position",new Ne(l,3)),s){const h=o.polygons.numericProps[s.feature].value.reduce((u,d,f,p)=>{const m=s.colorMap(d);return u[f*3]=m.r,u[f*3+1]=m.g,u[f*3+2]=m.b,u},[]);a.setAttribute("color",new Ne(h,3))}a.setIndex(new Ue(o.polygons.triangles.value,1));const c=new Gn({transparent:!0,vertexColors:!0,opacity:.5,blending:is});return new Ye(a,c)})}}async function Ek(n,t,e,i,s){return new Promise((r,o)=>{const a=new wt().makeRotationAxis(new L(1,0,0),Math.PI/2),l=t.content.gltfUpAxis!=="Z",c=new wt().fromArray(t.computedTransform).premultiply(s);l&&c.multiply(a),t.content.byteLength||(t.content.byteLength=t.content.gltfArrayBuffer.byteLength),n.parse(t.content.gltfArrayBuffer,t.contentUrl?t.contentUrl.substr(0,t.contentUrl.lastIndexOf("/")+1):null,h=>{t.userData.asset=h.asset;const u=h.scenes[0];u.applyMatrix4(c),t.content.texturesByteLength=0,t.content.geometriesByteLength=0,u.traverse(d=>{if(d.type=="Mesh"){const f=d;t.content.geometriesByteLength+=Ax(f.geometry);const p=f.material,m=p.map;if(m){const g=sk(m);g&&(t.content.texturesByteLength+=g)}i.material?(f.material=i.material.clone(),p.dispose()):i.shading==Xc.FlatTexture&&f.material.type!=="MeshBasicMaterial"&&(f.material=e.clone(),p.dispose()),i.shading!=Xc.ShadedNoTexture?f.material.type=="ShaderMaterial"?f.material.uniforms.map={value:m}:f.material.map=m:(m&&m.dispose(),f.material.map=null),f.material.wireframe=i.wireframe,i.contentPostProcess&&i.contentPostProcess(f)}}),t.content.gpuMemoryUsageInBytes=t.content.texturesByteLength+t.content.geometriesByteLength,r(u)},h=>{o(new Error(`error parsing gltf in tile ${t.id}: ${h}`))})})}function yk(n,t,e,i){const s={rtc_center:n.content.rtcCenter,points:n.content.attributes.positions,intensities:n.content.attributes.intensity,classifications:n.content.attributes.classification,rgb:null,rgba:null},{colors:r}=n.content.attributes;r&&r.size===3&&(s.rgb=r.value),r&&r.size===4&&(s.rgba=r.value);const o=new en;o.setAttribute("position",new Ne(s.points,3));const a=new wt().fromArray(n.computedTransform).premultiply(i);s.rgba?o.setAttribute("color",new Ne(s.rgba,4)):s.rgb&&o.setAttribute("color",new ag(s.rgb,3,!0)),s.intensities&&o.setAttribute("intensity",new Ue(s.intensities,1,!0)),s.classifications&&o.setAttribute("classification",new ag(s.classifications,1,!1)),n.content.geometriesByteLength=Ax(o),n.content.gpuMemoryUsageInBytes=n.content.geometriesByteLength;const l=new YE(o,e.material||t);if(s.rtc_center){const c=s.rtc_center;a.multiply(new wt().makeTranslation(c[0],c[1],c[2]))}return l.applyMatrix4(a),e.contentPostProcess&&e.contentPostProcess(l),l}function A_(n){var t,e,i,s;(t=n==null?void 0:n.uniforms)!=null&&t.map?(i=(e=n==null?void 0:n.uniforms)==null?void 0:e.map.value)==null||i.dispose():n.map&&((s=n.map)==null||s.dispose()),n.dispose()}function fd(n){n.traverse(t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)A_(t.material);else for(const e of t.material)A_(e)});for(let t=n.children.length-1;t>=0;t--){const e=n.children[t];n.remove(e)}}function Ck(n,t){return!n.matrixWorld.equals(t)}function xk(n){const t=new Map;return n.forEach(e=>{var i,s;const r=(s=(i=e==null?void 0:e.userData)==null?void 0:i.asset)==null?void 0:s.copyright;r&&r.split(/;/g).map(o=>o.trim()).forEach(o=>{o&&t.set(o,(t.get(o)||0)+1)})}),Array.from(t).sort((e,i)=>i[1]-e[1]).map(([e])=>e).join("; ")}class vk{constructor(t){this.options={scene:null,camera:null,url:"https://yangyangzuo.github.io/gis/3dtiles/b3dm/Photogrammetry_exported_to_3D_Tiles_in_RealityCapture/tileset_tileset.json",tileLoaderRuntime:null,tileLoaded:()=>{},...t}}async loadTileset(){const t=await _k.load({url:this.options.url,viewport:{width:window.innerWidth,height:window.innerHeight,devicePixelRatio:window.devicePixelRatio},options:{cesiumIONToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0YWY4MWFhYi1jMWRkLTRjNjgtODU0MS0zYWVkNDkyZjVmYTgiLCJpZCI6MjU5NjA2LCJpYXQiOjE3MzMyMDEyOTJ9.jOa7Mu5jpWXM4T-CLKB4FMUUUZNR77MWDE6Nv0COxBI",dracoDecoderPath:"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/draco",basisTranscoderPath:"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/basis",resetTransform:!0,maximumScreenSpaceError:JSON.parse(localStorage.getItem("guiconfig")||"{}").渲染设置||16}}),{model:e,runtime:i}=t;this.options.tileLoaded&&this.options.tileLoaded(e),console.log(e,i),this.options.scene.add(e),this.options.tileLoaderRuntime=i}update(t){var e;(e=this.options.tileLoaderRuntime)==null||e.update(t,this.options.camera)}}class mx{static load(t){return this.loader.loadAsync(t)}}el(mx,"loader",new oy);const Bk=(n,t)=>{const e=n.__vccOpts||n;for(const[i,s]of t)e[i]=s;return e},Ik={id:"glviewer"},bk={__name:"App",setup(n){var t=[{tileurl:"https://yangyangzuo.github.io/gis/3dtiles/b3dm/Photogrammetry_exported_to_3D_Tiles_in_RealityCapture/tileset_tileset.json",gltfurl:"/test.glb",tileLoaded(u){u.position.set(0,5,0),u.rotation.set(-Math.PI/2,0,0)},gltfLoaded(u){u.scene.rotateY(Math.PI/2*3),u.scene.position.set(.6,0,-.3),u.scene.scale.set(17,17,17),u.scene.traverse(d=>{d.isMesh&&(d.material=new Gn({color:16711680,opacity:.3,transparent:!0,side:Un}))})}},{tileurl:"https://assets.ion.cesium.com/ap-northeast-1/2890597/tileset.json?v=1",gltfurl:"/ground/ground.glb",tileLoaded(u){u.position.set(0,26.4,0),u.rotation.set(-Math.PI/2,0,0)},gltfLoaded(u){u.scene.position.set(-25,-0,-8),u.scene.scale.set(180,180,183),u.scene.traverse(d=>{d.isMesh&&(d.material=new Gn({color:16711680,opacity:0,transparent:!0}))})}}],e=t[1];e.zUP&&(Me.DEFAULT_UP=new L(0,0,1));var i=()=>{var u=document.querySelector("#glviewer");return new HR({container:u,showDebug:!0,cameraPosition:new L(75.11765410779043,2.98946706173118,365.09740898077337),cameraTarget:new L(-3,2.98946706173118,301.3842270004146)})},s=hp(),r,o,a;V_(()=>{o=document.querySelector(".person"),a=document.querySelector(".minimapContainer"),r=i();var u=r.controls;mx.load(e.gltfurl).then(m=>{var g;e.gltfLoaded&&e.gltfLoaded(m),r.scene.add(m.scene),(g=u.worldOctree)==null||g.fromGraphNode(m.scene)});var d=new vk({scene:r.scene,camera:r.camera,url:e.tileurl,tileLoaded:e.tileLoaded});d.loadTileset(),r.addEventListener("update",m=>{d.update(m.deltaTime);var g=r.controls;if(g.controlsType=="firstPerson"){var A=new L(0,0,-1),C=g.getForwardVector(),E=Math.acos(A.dot(C))*180/Math.PI;C.x>0&&(E=-E),s.value&&(s.value.style.rotate=E+"deg")}else if(g.controlsType!="thirdPerson"){if(g.controlsType=="fly"){var E=r.controls.getAzimuthalAngle()*180/Math.PI;s.value&&(s.value.style.rotate=E+"deg")}}h()});var f=r.debugInfo.gui.addFolder("配置"),p={渲染设置:16,视角切换:"fly",...JSON.parse(localStorage.getItem("guiconfig")||"{}")};localStorage.setItem("guiconfig",JSON.stringify(p)),f.add(p,"渲染设置",{最快:16,平衡:8,效果最好:1}).onChange(()=>{localStorage.setItem("guiconfig",JSON.stringify(p)),window.location.reload()}),f.add(p,"视角切换",{第一人称:"firstPerson",第三人称:"thirdPerson",自由视角:"fly"}).onChange(()=>{localStorage.setItem("guiconfig",JSON.stringify(p))})});var l=hp(),c=()=>{var u=l.value;u.classList.contains("big")?u.classList.remove("big"):u.classList.add("big")},h=()=>{var u=300,d=420;if(r){var f=(r.camera.position.x/u+1)/2,p=(r.camera.position.z/d+1)/2;o.style.left=f*a.clientWidth+"px",o.style.top=p*a.clientHeight+"px"}};return(u,d)=>(aB(),hB("div",Ik,[Wr("img",{ref_key:"compass",ref:s,src:KB,class:"compass",alt:""},null,512),Wr("div",{class:"minimapContainer",ref_key:"minimap",ref:l,onClick:d[0]||(d[0]=(...f)=>Ed(c)&&Ed(c)(...f))},d[1]||(d[1]=[Wr("img",{src:YB,class:"minimap",alt:""},null,-1),Wr("div",{class:"person"},null,-1)]),512)]))}},Mk=Bk(bk,[["__scopeId","data-v-c19cb3a4"]]);qB(Mk).mount(document.body);
